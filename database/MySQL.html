<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL | Gnl&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.05d4800e.css" as="style"><link rel="preload" href="/assets/js/app.ef8f069f.js" as="script"><link rel="preload" href="/assets/js/2.81a6082a.js" as="script"><link rel="preload" href="/assets/js/5.728d53d9.js" as="script"><link rel="prefetch" href="/assets/js/10.b0aafae0.js"><link rel="prefetch" href="/assets/js/11.31961e16.js"><link rel="prefetch" href="/assets/js/12.eef1c1b6.js"><link rel="prefetch" href="/assets/js/13.439fd6b8.js"><link rel="prefetch" href="/assets/js/14.39a78aa7.js"><link rel="prefetch" href="/assets/js/15.7004b033.js"><link rel="prefetch" href="/assets/js/16.0842fd54.js"><link rel="prefetch" href="/assets/js/17.c5625d68.js"><link rel="prefetch" href="/assets/js/18.e0326515.js"><link rel="prefetch" href="/assets/js/19.d6a19ec0.js"><link rel="prefetch" href="/assets/js/20.160441c7.js"><link rel="prefetch" href="/assets/js/21.14bfc07e.js"><link rel="prefetch" href="/assets/js/22.65b6a681.js"><link rel="prefetch" href="/assets/js/23.a022110b.js"><link rel="prefetch" href="/assets/js/24.7ebc3140.js"><link rel="prefetch" href="/assets/js/25.99ab02ac.js"><link rel="prefetch" href="/assets/js/3.99bafbdd.js"><link rel="prefetch" href="/assets/js/4.0e0a7e44.js"><link rel="prefetch" href="/assets/js/6.b36a37d2.js"><link rel="prefetch" href="/assets/js/7.7cfa2f64.js"><link rel="prefetch" href="/assets/js/8.21e0492a.js"><link rel="prefetch" href="/assets/js/9.7cab981e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05d4800e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/head-logo.jpeg" alt="Gnl's Blog" class="logo"> <span class="site-name can-hide">Gnl's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/algorithm/Index.html" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/TypeScript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/Vue.js.html" class="nav-link">
  Vue.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/设计模式.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/backend/Java.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/backend/Spring.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/backend/SpringBoot.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/backend/SpringCloud.html" class="nav-link">
  SpringCloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/MySQL.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/Redis.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/RocketMQ.html" class="nav-link">
  RocketMQ
</a></li><li class="dropdown-item"><!----> <a href="/middleware/ElasticSearch.html" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/middleware/Kafka.html" class="nav-link">
  Kafka
</a></li></ul></div></div><div class="nav-item"><a href="/About.html" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/algorithm/Index.html" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/TypeScript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/Vue.js.html" class="nav-link">
  Vue.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/设计模式.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/backend/Java.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/backend/Spring.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/backend/SpringBoot.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/backend/SpringCloud.html" class="nav-link">
  SpringCloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/MySQL.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/Redis.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/RocketMQ.html" class="nav-link">
  RocketMQ
</a></li><li class="dropdown-item"><!----> <a href="/middleware/ElasticSearch.html" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/middleware/Kafka.html" class="nav-link">
  Kafka
</a></li></ul></div></div><div class="nav-item"><a href="/About.html" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/MySQL.html" aria-current="page" class="active sidebar-link">MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/MySQL.html#mysql体系架构" class="sidebar-link">MySQL体系架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/MySQL.html#网络连接层" class="sidebar-link">网络连接层</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#服务层" class="sidebar-link">服务层</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#存储引擎层" class="sidebar-link">存储引擎层</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#系统文件层" class="sidebar-link">系统文件层</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#sql执行流程" class="sidebar-link">SQL执行流程</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#sql优化" class="sidebar-link">SQL优化</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#索引" class="sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/MySQL.html#关于索引" class="sidebar-link">关于索引</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#索引结构" class="sidebar-link">索引结构</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#事务" class="sidebar-link">事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/MySQL.html#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#事务的实现" class="sidebar-link">事务的实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/MySQL.html#mysql主从库配置" class="sidebar-link">MySQL主从库配置</a></li></ul></li><li><a href="/database/Redis.html" class="sidebar-link">Redis</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> MySQL</h1> <h2 id="mysql体系架构"><a href="#mysql体系架构" class="header-anchor">#</a> MySQL体系架构</h2> <blockquote><p>由上至下分为：网络连接层，服务层，存储引擎层，系统文件层</p></blockquote> <img src="/assets/img/MySQL体系架构.d92685d1.jpg" alt="MySQL体系架构" style="zoom:150%;"> <h3 id="网络连接层"><a href="#网络连接层" class="header-anchor">#</a> 网络连接层</h3> <p>Connectors，提供给各种应用程序（JDBC、ODBC）接入MySQL服务的接口。客户端与服务端建立连接，客户端发送SQL语句到服务端执行</p> <h3 id="服务层"><a href="#服务层" class="header-anchor">#</a> 服务层</h3> <p><strong>管理服务和工具组件</strong></p> <p>系统管理和控制工具，如备份恢复、安全管理、MySQL复制、集群管理等</p> <p><strong>连接池</strong></p> <ul><li>由于每次建立连接需要消耗很多时间，连接器的作用就是将这些连接缓存下来，下次可以直接用已经建立好的连接，提升服务器性能</li> <li>主要负责连接管理、授权认证等。每个客户端连接都对应着服务器上的一个线程，服务器上维护可一个线程池，避免为每个连接都创建销毁一个线程。当客户端连接到MySQL服务器时，服务器对其进行认证，可以通过用户名和密码进行认证，也可以通过SSL证书进行认证。登录认证后，服务器还会验证的客户端角色是否有执行某个查询的操作权限</li></ul> <p><strong>SQL接口</strong></p> <p>接收客户端发送过来的SQL命令，并返回操作结果</p> <ul><li><strong>DDL</strong>（Data Definition Language），DDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL由数据库管理员执行</li> <li><strong>DML</strong>（Data Manipulation（操纵） Language），DML为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作</li> <li><strong>DQL</strong>（Data Query Language），DQL允许用户查询数据，这也是通常最频繁的数据库日常操作</li></ul> <p><strong>查询解析器</strong></p> <ul><li>SQL命令传递到解析器的时候会被解析器验证和解析</li> <li>==MySQL是一个DBMS（数据库管理系统），无法直接理解SQL语句，查询解析器负责对SQL语句进行验证和解析，让DBMS知道下一步该做什么==</li></ul> <p><strong>查询优化器</strong></p> <ul><li><p>SQL语句在查询之前会使用查询优化器对查询进行优化，查询优化器使用的是“选取-投影-联接”策略进行查询，以此选择一个最优的查询路径</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> uid<span class="token punctuation">,</span> name <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> uid <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>select查询先根据where语句进行选取，而不是先全表查询后再进行条件过滤</li> <li>select查询先根据uid和name进行属性投影，而不是将属性全部取出来后再进行过滤</li> <li>将这两个查询条件联接起来，生成最终查询结果</li></ol></li></ul> <p><strong>缓存</strong></p> <ul><li>缓存和缓冲组件，查询缓存，如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中读取数据</li> <li>需要注意的是在MySQL的8.0版本以后，缓存被官方删除掉了。因为查询缓存的失效非常频繁，如果在一个写多读少的环境中，缓存会频繁的新增和失效。对于某些更新压力大的数据库来说，查询缓存的命中率会非常低，MySQL为了维护缓存可能会出现一定的伸缩性的问题。目前在5.6的版本中已经默认关闭了，比较推荐的一种做法是将缓存放在客户端，性能大概会提升5倍左右</li> <li>MySQL缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等</li></ul> <h3 id="存储引擎层"><a href="#存储引擎层" class="header-anchor">#</a> 存储引擎层</h3> <blockquote><p>MySQL中的数据用各种不同的技术存储在文件（内存）中。每一种技术都使用不同的存储机制、索引技巧、锁方式，并且提供不同的功能和能力。通过选择不同的技术，能够获得不同的速度或者功能，从而改善应用的整体功能。 这些不同的技术以及配套的相关功能在MySQL中被称作存储引擎，也称作表类型</p></blockquote> <p><strong>细节</strong></p> <ul><li>==存储引擎的概念是MySQL里面才有的==，不是所有的关系型数据库都有存储引擎这个概念</li> <li>MySQL区别于其他数据库最重要的一个特点就是，==插件式的<strong>表存储引擎</strong>==。需要注意，存储引擎是基于表的</li> <li>MySQL采用插件式的存储引擎，提供了多种存储引擎，每种存储引擎有不同的特点。可以根据不同的业务特点，选择合适的存储引擎</li> <li>负责数据的存储和读取，与数据库文件打交道。服务器中的查询执行引擎通过API与存储引擎进行通信，通过接口屏蔽了不同存储引擎之间的差异</li></ul> <p><strong>查询MySQL存储引擎</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> engines<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>常见存储引擎</strong></p> <ol><li><p><strong>InnoDB</strong>，==默认事务型存储引擎==</p> <ul><li><p>它被设计用来处理大量的短期（short-lived）事务，除非有特别的原因，否则应该优先考虑InnoDB引擎</p></li> <li><p>==行级锁，提供了具有提交，回滚和崩溃回复能力的事务安全，并发能力强，适合高并发操作==</p></li> <li><p>==支持自动增长列，支持外键约束，默认使用B+TREE数据结构存储索引==</p></li> <li><p>占用空间是MyISAM的2.5倍，处理效率相对会差一些</p></li> <li><p>存在缓冲管理，通过缓冲池，将索引和数据全部缓存起来，加快查询的速度</p> <p>读数据，会首先从缓冲池中读取，若是没有则从磁盘读取再放入缓冲池；写数据，会首先写入缓冲池，再定期同步到磁盘上</p></li> <li><p>对于使用InnoDB的表，其数据的物理组织形式是<strong>聚簇表</strong>。所有的数据按照主键来组织，数据和索引放在一起，都位于B+Tree的叶子结点上</p></li></ul></li> <li><p><strong>MyISAM</strong>，拥有较高的插入，查询速度</p> <ul><li>提供了大量的特性，包括全文索引（B+TREE数据结构存储索引），空间函数（GIS）等</li> <li>==全表锁，拥有较快的执行速度，不支持事务，并发性能差，崩溃后无法安全恢复==</li> <li>==不支持外键，使用B+TREE数据结构存储索引==</li> <li>占用空间相对较小，对事务完整性没有要求，以<code>select</code>、<code>insert</code>为主的应用基本上使用这个引擎</li></ul></li> <li><p><strong>Memory</strong></p> <ul><li>所有数据置于内存的存储引擎，拥有极高的插入，更新和查询效率</li> <li>全表锁，存储在内存中，速度快，但会占用与数据量成正比的内存空间，且数据在MySQL重启时会丢失</li> <li>默认使用Hash索引，检索效率非常高，主要用于内容变化不频繁的表</li></ul></li> <li><p>Archive</p> <ul><li>Archive档案存储引擎只支持<code>insert</code>和<code>select</code>操作，在MySQL5.1之前不支持</li> <li>适合日志和数据采集类应用</li> <li>Archive表比MyISAM表小约75%，比InnoDB表小约83%</li></ul></li> <li><p>CSV</p> <ul><li>CSV引擎可以将普通的CSV文件作文MySQL表来处理，但不支持索引</li> <li>CSV引擎可以作为一种数据交换机制</li> <li>CSV存储的数据可以在操作系统里用文本编辑器或Excel打开</li></ul></li> <li><p>Merge，一组MyISAM表的组合，在超大规模数据存储时很有用</p></li></ol> <h3 id="系统文件层"><a href="#系统文件层" class="header-anchor">#</a> 系统文件层</h3> <p><strong>细节</strong></p> <ul><li><p>系统文件层主要是将数据库的数据存储在文件系统中，并完成与存储引擎的交互</p></li> <li><p>==根据存储引擎的不同，存储在文件系统中的数据文件格式不同==</p> <ol><li>MyISAM
<ul><li><code>*.frm</code>，与表相关的元数据信息都存放在frm文件中，包括表结构的定义信息等</li> <li><code>*.MYD</code>，MyISAM Data，用于存储MyISAM表的数据</li> <li><code>*.MYI</code>，MyISAM Idex，用于存储MyISAM表的索引相关信息</li></ul></li> <li>InnoDB
<ul><li><p><code>*.frm</code>，与表相关的元数据信息都存放在frm文件中，包括表结构的定义信息等</p></li> <li><p><code>*.ibd</code>，InnoDB Data，存储表数据和索引的文件。该表的索引（B+树）的每个非叶子结点存储索引，叶子结点存储索引与索引对应的数据</p></li> <li><p><code>*.ibdata</code>，存储内容与<code>*.ibd</code>相同</p> <p>InnoDB的数据存储方式能够通过配置来决定是使用共享表空间存放存储数据，还是独享表空间存放存储数据。独享表空间存储方式使用<code>*.ibd</code>，并且每个表为一个ibd文件。共享表空间存储方式采用ibdata文件，即所有的表共同使用一个ibdata文件</p> <p>决定使用哪种表的存储方式可以通过MySQL的配置文件中的<code>innodb_file_per_table</code>选项来指定。InnoDB默认使用的是独享表的存储方式，这种方式的好处是当数据库产生大量文件碎片的时候，整理磁盘碎片对线上运行环境的影响较小</p></li></ul></li></ol></li></ul> <h2 id="sql执行流程"><a href="#sql执行流程" class="header-anchor">#</a> SQL执行流程</h2> <p><img src="/assets/img/image-20210407205445602.249820d5.png" alt="image-20210407205445602"></p> <ol><li>客户端通过<strong>连接器</strong>（JDBC、ODBC），将<strong>SQL语句发送</strong>到MySQL服务器；</li> <li>客户端与MySQL服务器<strong>建立连接</strong>，MySQL服务器验证请求的用户名和密码是否正确，账户正确；在系统表中验证用户权限，验证通过，进行下一步，验证不通过则报错；</li> <li>命中<strong>缓存</strong>，从缓存中取结果返回；未命中缓存，继续下一步，进入SQL查询解析器；</li> <li><strong>查询解析器</strong>对SQL语句进行解析，包括预处理和解析过程。在这个阶段会对SQL语句进行关键词和非关键词提取、解析，组成一棵解析树。关键字如：select/update/in/or/where/group by等，如果分析到语法错误，报错<code>ERROR: You have an error in your SQL syntax</code>。同时也会对SQL语句做一些验证，如：表是否存在，字段是否存在等；</li> <li>在查询之前，使用<strong>查询优化器</strong>对查询进行优化，查询优化器使用的是“选取-投影-联接”策略进行查询，如：将SQL语句中的查询条件调换位置，为让底层能使用索引，选择一个最优的查询路径</li> <li><strong>执行器</strong>，调用存储引擎对应的API，根据SQL语句对数据文件进行操作，执行完成之后，将具体操作保存到binlog中（select操作除外）。</li> <li>返回结果</li></ol> <h2 id="sql优化"><a href="#sql优化" class="header-anchor">#</a> SQL优化</h2> <ol><li>尽量避免进行全表扫描</li> <li>不要超过三张表关联</li> <li>表字段不宜过多，对太多字段的表进行拆分</li> <li>不使用<code>select *</code></li> <li>适当建立索引，但是不能建立过多索引</li> <li>根据不同的功能使用不同的存储引擎，插入、查询较多则使用MyISAM，支持事务使用innoDB</li> <li>尽量避免大段的事务操作</li></ol> <h2 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h2> <blockquote><p>索引，是关系数据库中对某一列或多个列的值进行预排序的<strong>数据结构</strong></p></blockquote> <h3 id="关于索引"><a href="#关于索引" class="header-anchor">#</a> 关于索引</h3> <p><strong>细节</strong></p> <ul><li>==在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构就是索引，<strong>索引的本质是一种数据结构</strong>==</li> <li>通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度</li> <li>索引是建立在数据库表中的某些列的上面。因此，在创建索引的时候，应该仔细考虑在哪些列上可以创建索引，在哪些列上不能创建索引</li></ul> <p><strong>优点</strong></p> <ul><li>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性</li> <li>索引减小了服务器需要扫描的数据量，从而加快数据的查询速度，这也是创建索引的最主要的原因</li> <li>索引可以将随机IO变成顺序IO</li></ul> <p><strong>缺点</strong></p> <ul><li>创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加</li> <li>索引需要占物理空间，除了数据表占用数据空间之外，每一个索引还要占用一定的物理空间，如果需要建立聚簇索引，那么需要占用的空间会更大</li> <li>对表中的数据进行增、删、改的时候，索引也要动态的维护，这就降低了整数的维护速度</li> <li>如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果</li> <li>对于非常小的表，大部分情况下简单的全表扫描更高效</li></ul> <p><strong>何时创建索引</strong></p> <ul><li>在==经常需要搜索的列==上，可以加快搜索的速度</li> <li>在==作为主键的列==上，强制该列的唯一性和组织表中数据的排列结构</li> <li>在==经常用在连接（JOIN）的列==上，这些列主要是一外键，可以加快连接的速度</li> <li>在==经常需要根据范围（&lt;，&lt;=，=，&gt;，&gt;=，BETWEEN，IN）进行搜索的列==上创建索引，因为索引已经排序，其指定的范围是连续的</li> <li>在==经常需要排序（order by）的列==上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间</li> <li>在==经常使用在WHERE子句中的列==上面创建索引，加快条件的判断速度</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建索引的基本语法</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> <span class="token keyword">table</span><span class="token punctuation">(</span><span class="token keyword">column</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 例子 length默认我们可以忽略</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> <span class="token keyword">user</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>创建索引有什么特别的依据吗？</strong></p> <p>公式：<code>count(distinct(column_name)) : count(*)</code>。这个可以简单地计算出这个字段的离散值，离散值越高说明建立索引效果更明显。例如我们给手机号加索引，最后计算出来的离散度是1，说明非常有必要加索引</p> <p><strong>不需创建索引</strong></p> <ul><li><p>对于那些在查询中很少使用或者参考的列不应该创建索引</p> <p>若列很少使用到，有索引或无索引，并不能提高查询速度。增加了索引，反而降低了系统的维护速度和增大了空间需求</p></li> <li><p>对于那些只有很少数据值或者重复值多的列也不应该增加索引</p> <p>这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度</p></li> <li><p>对于那些定义为text, image和bit数据类型的列不应该增加索引</p> <p>这些列的数据量要么相当大，要么取值很少</p></li> <li><p>当该列修改性能要求远远高于检索性能时，不应该创建索引</p></li></ul> <h3 id="索引结构"><a href="#索引结构" class="header-anchor">#</a> 索引结构</h3> <h4 id="b-tree-b树"><a href="#b-tree-b树" class="header-anchor">#</a> B-TREE（B树）</h4> <blockquote><p>B树中所有结点孩子结点个数的最大值称为B树的阶，通常用m表示，从查找效率考虑，要求m&gt;=3</p></blockquote> <p><strong>细节</strong></p> <p>一颗m阶的B树要么是一颗空树，要么是满足以下要求的m叉树：</p> <ul><li><p>每个结点最多有m个分支（子树）</p></li> <li><p>最少分支树要看是否是根结点。如果是根结点且不是叶子结点，则至少有两个分支，非根非叶结点至少有[m/2]个分支（[a]是对[a]向上取整，即不小于a的最小整数）</p></li> <li><p>有n（k&lt;=n&lt;=m）个分支的结点有n-1个关键字，关键字按照递增顺序排序。k=2（根结点）或[m/2]（非根结点）</p></li> <li><p>结点结构</p> <img src="data:image/png;base64,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" alt="image-20210409193229683" style="zoom:200%;"> <ul><li>n为结点中关键字的个数</li> <li>k<sub>i</sub>为结点的关键字且满足k<sub>i</sub>&lt;k<sub>i+1</sub></li> <li>p<sub>i</sub>（0&lt;=i&lt;=n）为结点的孩子结点指针，且满足p<sub>i</sub>（1&lt;=i&lt;=n-1），所指结点上的关键字大于k<sub>i</sub>且小于k<sub>i+1</sub>，p<sub>0</sub>所指结点上的关键字小于k<sub>1</sub>，且p<sub>n</sub>所指结点上的关键字大于k<sub>n</sub></li> <li>结点内关键字互不相等且按从小到大排序</li> <li>叶子结点处于同一层，可以用空指针表示，是查找失败到达的位置</li></ul></li> <li><p>平衡m叉查找树是指每个关键字的左子树和右子树高度差绝对值不超过1的查找树，其结点结构与B树结点结构相同。因此可认为B树是平衡m叉查找树，但限制更强，要求把所有叶子结点放在同一层</p></li> <li><p>B树的查找，是多路查找，从根结点开始，对结点内的关键字（递增排序）序列进行二分查找，如果命中则结束。否则进入查询关键字所属范围的孩子结点，并重复二分查找，直到遍历到的结点为空（查找失败），或者命中</p></li></ul> <p><strong>B树特征</strong></p> <ul><li>关键字集合分布在整棵树中</li> <li>任何一个关键字出现且只出现在一个结点中</li> <li>搜索有可能在非叶子结点结束</li> <li>搜索性能等价于在关键字全集内做一次二分查找</li> <li>自动层次控制（平衡控制）</li></ul> <h4 id="b-tree-b-树"><a href="#b-tree-b-树" class="header-anchor">#</a> B+TREE（B+树）</h4> <blockquote><p>B+ Tree 是基于 B Tree 和叶子节点顺序访问指针进行实现</p></blockquote> <p><strong>细节</strong></p> <ul><li><p>根且非叶子结点的孩子结点数为[2, m]</p></li> <li><p>非根非叶结点的孩子结点数为[m/2, m]</p></li> <li><p>在B+树中，具有n个关键字的结点含有n个分支；而在B树中，具有n个关键字的结点含有n+1个分支</p></li> <li><p>在B+树中，每个结点（除根结点）中的关键字个数n的取值范围为[m/2]&lt;=n&lt;=m，跟结点取值范围为2&lt;=n&lt;=m；</p> <p>而在B树中，它们的取值范围分别是[m/2]-1&lt;=n&lt;=m-1和1&lt;=n&lt;=m-1</p></li> <li><p>在B+树中叶子结点包含信息，并且包含全部关键字，叶子结点引出的指针指向<strong>记录</strong></p></li> <li><p>B+树中的所有非叶子结点仅仅起到了一个索引的作用（作为叶子结点的索引），即结点中的每个索引项只含有对应子树的最大关键字和指向该字数的指针</p></li> <li><p>在B+树上有一个指针指向关键字最小的叶子结点，所有叶子结点连接成一个双向线性链表，而B树没有</p></li> <li><p>B+树的搜索与B树也基本相同，区别是B+树只有达到叶子结点才命中（B树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找</p></li> <li><p>B+Tree是自底向上插入的，优先会将数据插入到叶子节点中，然后整个树会根据底部的叶子节点进行变动</p></li></ul> <p><strong>B+树特征</strong></p> <ul><li>所有关键字都出现在叶子结点的链表中（稠密索引），且链表中的关键字是有序的</li> <li>查找操作不会在非叶子结点命中</li> <li>非叶子结点相当于叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层</li> <li>每一个叶子结点都包含一个指向下一个叶子结点的指针，从而方便叶子结点的范围遍历</li> <li>更适合文件索引系统</li></ul> <p><img src="/assets/img/image-20210522195820218.4430c591.png" alt="image-20210522195820218"></p> <h4 id="b-树比b树索引对比"><a href="#b-树比b树索引对比" class="header-anchor">#</a> B+树比B树索引对比</h4> <ol><li><p>B+树的==磁盘读写代价更低==</p> <p>B+树的数据都集中在叶子结点，分支结点只作为索引存在；B树的分支结点既有指针也有数据。这将导致B+树的层次会高于B树，也就是说B+树平均的IO次数会小于B树</p></li> <li><p>B+树的==查询效率更加稳定==</p> <p>B+树的数据都存放在叶子结点，因此任何关键字的查找必须走一条从根结点到叶子结点的路径，所有结点的查询路径相同，每个数据查询效率相当</p></li> <li><p>B+树==更便于遍历==</p> <p>由于B+树的数据都存储在叶子结点中，分支结点均为索引，遍历只需要扫描一遍叶子结点即可；B树因为其分支结点同样存储着数据，要找到具体的数据，需要进行一次中序遍历按序来搜索。简单来说就是，B+树需要遍历有序链表，而B树需要对整颗树进行中序遍历</p></li> <li><p>B+树==更擅长范围查询==</p> <p>B+树叶子结点存放数据，数据是按照顺序放置的双向链表。B树范围查询只能中序遍历</p></li> <li><p>B+树==占用内存空间小==</p> <p>B+树索引结点没有数据，比较小。在内存有限的情况下，相比于B树索引可以加载更多B+树索引</p></li></ol> <p><strong>推荐使用自增id而不推荐使用uuid或者身份证号等</strong></p> <p>叶子节点链表会根据当前最后一条的位置，将最新的一条数据顺序的插入到后面</p> <p><img src="/assets/img/image-20210522201305456.f71f177f.png" alt="image-20210522201305456"></p> <p>但是当你插入一个uuid时，MySQL根本不知道他该插入到哪个位置，需要从头开始寻找插入的位置。当我们的插入的页满了时，这就造成了页的分裂和合并，极大的影响了效率</p> <p><img src="/assets/img/image-20210522201351202.92a0c52a.png" alt="image-20210522201351202"></p> <p>而且我们使用uuid的话，uuid所占字节也比较长，就导致了每一页存储的数据就会变少，也不利于索引的数据查询</p> <h4 id="hash-哈希"><a href="#hash-哈希" class="header-anchor">#</a> HASH（哈希）</h4> <blockquote><p>哈希索引就是采用一定的哈希算法，把存储的键的哈希指算出来，==使用哈希值代替键值存储==，检索时不需要类似B+树一样从根结点到叶子结点逐级查找，只需要执行一次哈希算法就可定位到相应的位置，速度非常快。Memory存储引擎使用的就是Hash索引</p></blockquote> <p><strong>细节</strong></p> <ul><li>==Hash索引就是将索引字段进行hash存储，整个hash索引的结构是Hash表+链表（因为会存在hash冲突）==</li> <li>哈希索引仅仅能满足<code>=</code>、<code>in</code>和<code>&lt;=&gt;</code>（&lt;==&gt;类似=，和=运算符不同的是，NULL的值是没有任何意义的。所以=号运算符不能把NULL作为有效的结果。此时可以使用&lt;=&gt;）查询，不能使用范围查询（大于小于），也不支持任何范围查询</li> <li>由于哈希索引比较的是进行哈希运算之后的Hash值，所以它只能用于等值的过滤，不能用于基于范围的过滤</li></ul> <p><strong>哈希和B+树的区别</strong></p> <ul><li>如果是等值查询，哈希索引占有绝对优势，因为只需要经过一次算法就可找到相应的键值；前提是所有的键值都是唯一的，如果键值不唯一，就需处理哈希冲突</li> <li>如果是范围查询，B+树占绝对优势，因为原先是有序的键值，经过哈希算法后，就可能变成不连续了，就没有办法再利用索引完成范围查询</li> <li>哈希索引也没有办法利用索引完成排序，以及<code>like</code>这样的迷糊查询（like本质上也是范围查询）</li> <li>哈希不支持多列联合索引的左右匹配规则</li> <li>B+树索引的关键字检索效率比较平均，不像B树那样波动幅度大。在有大量重复键值情况下，哈希索引因为存在哈希碰撞，效率也是极低的</li></ul> <h4 id="索引分类"><a href="#索引分类" class="header-anchor">#</a> 索引分类</h4> <blockquote><p>逻辑分类和物理分类</p></blockquote> <h5 id="逻辑分类"><a href="#逻辑分类" class="header-anchor">#</a> <strong>逻辑分类</strong></h5> <ul><li><p><strong>功能划分</strong></p> <p>1、<strong>主键索引</strong>，一张表只能有一个主键索引，不允许重复、不允许为 NULL</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2、<strong>唯一索引</strong>，数据列不允许重复，允许为 NULL 值，一张表可有多个唯一索引，但是一个唯一索引只能包含一列，比如身份证号码、卡号等都可以作为唯一索引</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> IndexName <span class="token keyword">ON</span> <span class="token punctuation">`</span>TableName<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>字段名<span class="token punctuation">`</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 或</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3、<strong>普通索引</strong>，一张表可以创建多个普通索引，一个普通索引可以包含多个字段，允许数据重复，允许 NULL 值插入</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> IndexName <span class="token keyword">ON</span> <span class="token punctuation">`</span>TableName<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>字段名<span class="token punctuation">`</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 或</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> IndexName<span class="token punctuation">(</span><span class="token punctuation">`</span>字段名<span class="token punctuation">`</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4、<strong>全文索引</strong>，查找的是文本中的关键词，主要用于全文检索</p> <p>5、<strong>空间索引</strong></p> <p>空间索引是对空间数据类型的字段建立的索引，MYSQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING、POLYGON。MYSQL使用SPATIAL关键字进行扩展，使得能够用于创建正规索引类型的语法创建空间索引。</p> <p>创建空间索引的列，必须将其声明为NOT NULL，空间索引只能在存储引擎为MYISAM的表中创建。空间索引一般是用不到了，了解即可。</p></li> <li><p><strong>按列划分</strong></p> <p>1、<strong>单列索引</strong>，一个索引只包含一个列，一个表可以有多个单例索引</p> <p>2、<strong>组合索引/复合索引</strong>，一个组合索引包含多个列。==查询的时候遵循 MySQL组合索引的 “最左前缀”原则==，从左到右匹配，即==查询条件要包含建立索引时最左边的字段==，索引才会生效。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建索引的基本语法</span>
<span class="token keyword">CREATE</span>  <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> <span class="token keyword">table</span><span class="token punctuation">(</span>column1<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>column2<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 例子 </span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_phone_name <span class="token keyword">ON</span> <span class="token keyword">user</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>最左前缀匹配原则</strong></p> <p>首先我们基于文首的这张表建立一个联合索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> idx_obj <span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">(</span>age <span class="token keyword">asc</span><span class="token punctuation">,</span>height <span class="token keyword">asc</span><span class="token punctuation">,</span>weight <span class="token keyword">asc</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们已经了解了索引的数据结构是一颗B+树，也了解了B+树优化查询效率的其中一个因素就是对数据进行了排序，那么我们在创建idx_obj这个索引的时候，也就相当于创建了一颗B+树索引，而这个索引就是<strong>依据联合索引的成员来进行排序</strong>，这里是age,height,weight</p> <p>InnoDB中只要有主键被定义，那么主键列被作为一个聚簇索引，而其它索引都将被作为非聚簇索引，所以，这个索引就会是一个非聚簇索引</p> <p>所以根据这些我们可以得出结论：</p> <ul><li>idx_obj这个索引会根据age,height,weight进行排序</li> <li>idx_obj这个索引是一个非聚簇索引，查询时需要回表</li></ul> <p>实际上在MySQL中，联合索引的排序有这么一个原则，从左往右依次比较大小，就拿刚才建立的索引举例子，他会先去比较age的大小，如果age的大小相同，那么比较height的大小，如果height也无法比较大小， 那么就比较weight的大小，最终对这个索引进行排序。==只要无法进行排序比较大小的，就无法走联合索引==</p> <p><strong>例子</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_innodb <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'zs'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_innodb <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'1234567890'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_innodb <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'1234567890'</span> <span class="token operator">and</span> name <span class="token operator">=</span> <span class="token string">'zs'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_innodb <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'zs'</span> <span class="token operator">and</span> phone <span class="token operator">=</span> <span class="token string">'1234567890'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>三条SQL只有 2 、 3、4能使用的到索引idx_phone_name，因为条件里面必须包含索引前面的字段才能够进行匹配。而3和4相比where条件的顺序不一样，为什么4可以用到索引呢？是因为MySQL本身就有一层SQL优化，他会根据SQL来识别出来该用哪个索引，我们可以理解为3和4在MySQL眼中是等价的</p> <p><strong>特点</strong></p> <p>a. 最左前缀匹配原则，MySQL会一直向右匹配直到遇到范围查询（&gt;、&lt;、between、like）就停止匹配，比如 a=3 and b=4 and c&gt;5 and d=6,如果建立(a,b,c,d)顺序的索引，d是无法使用索引的，如果建立(a,b,d,c)的索引则都可以使用到，a、b、d的顺序可以任意调整</p> <p>b. =和in可以乱序，比如 a=1 and b=2 and c=3 建立(a,b,c)索引可以任意顺序，MySQL的查询优化器会帮你优化成索引可以识别的形式</p></li></ul> <h5 id="物理分类"><a href="#物理分类" class="header-anchor">#</a> <strong>物理分类</strong></h5> <ul><li><p><strong>聚簇索引/主索引（Clustered Index）</strong></p> <ul><li><p>B+ 树叶子结点中包含数据表中行记录的话就是聚簇索引，即索引和数据是一体的</p></li> <li><p>叶子节点 data 域记录着完整的数据记录，这种索引方式被称为聚簇索引。因为无法把数据行存放在两个不同的地方，所以<strong>一个表只能有一个聚簇索引</strong>。</p></li> <li><p>聚簇索引就是按照每张表的主键构造一颗 B+ 树，同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引</p></li> <li><p>==聚簇索引也可理解为将数据存储与索引放到了一块，找到索引也就找到了数据==</p></li> <li><p>优点：</p> <p>1、数据访问更快，因为聚簇索引将索引和数据保存在同一个B+树中，因此从聚簇索引中获取数据比非聚簇索引更快</p> <p>2、聚簇索引对于主键的排序查找和范围查找速度非常快</p></li> <li><p>缺点：</p> <p>1、插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则将会出现页分裂，严重影响性能。因此，对于 Inno DB 表，我们一般都会定义一个自增的ID列为主键（主键列不要选没有意义的自增列，选经常查询的条件列才好，不然无法体现其主键索引性能）</p> <p>2、更新主键的代价很高，因为将会导致被更新的行移动。因此，对于 Inno DB 表，我们一般定义主键为不可更新</p> <p>3、二级索引访问需要两次索引查找，第一次找到主键值，第二次根据主键值找到行数据。</p></li></ul></li> <li><p><strong>非聚簇索引</strong>（辅助索引/二级索引）</p> <ul><li>叶子节点的 data 域记录着主键的值，因此在使用辅助索引进行查找时，需要先查找到主键值，然后再到聚簇索引中进行查找。一个表可以存在多个非聚簇索引</li> <li>辅助索引叶子结点存储的不再是行数据记录，而是主键值。首先通过辅助索引找到主键值，然后到主键索引树中通过主键值找到数据行</li> <li>==B+ 树叶子结点中没包含数据表中行记录的话就是非聚簇索引，即索引和数据是分开的==</li></ul> <p><img src="/assets/img/image-20210522200620369.f509f0e5.png" alt="image-20210522200620369"></p></li></ul> <h4 id="各存储引擎使用的索引"><a href="#各存储引擎使用的索引" class="header-anchor">#</a> 各存储引擎使用的索引</h4> <p><strong>InnoDB</strong>，InnoDB 的主键索引才是聚簇索引，InnoDB 中的辅助索使用的是非聚簇索引</p> <ul><li>InnoDB中主键不宜定义太大，因为辅助索引也会包含主键列，如果主键定义的比较大，其他索引也将很大。如果想在表上定义 、很多索引，则争取尽量把主键定义得小一些。InnoDB 不会压缩索引</li> <li>InnoDB中尽量不使用非单调字段作主键（不使用多列），因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用自增字段作为主键则是一个很好的选择</li></ul> <p><strong>MyISAM</strong>，非聚簇索引，MyISAM辅助索引也是非聚簇索引</p> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <blockquote><p>事务，是指一组SQL语句的集合，集合中的SQL语句可能是insert、update、select、delete，这些SQL语句的执行是一致的，作为一个整体执行，我们希望这些多个SQL语句都能成功执行或者都失败</p></blockquote> <h3 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h3> <blockquote><p>四个特性，ACID</p></blockquote> <ul><li><p><strong>原子性</strong>（Atomicity）</p> <p>事务要么全部提交成功，要么全部失败回滚，不能只执行其中一部分操作</p></li> <li><p><strong>一致性</strong>（Consistency）</p> <ul><li>操作前后总量不变，事务的执行不能破坏数据库的完整性和一致性，一个事务在执行之前和执行之后，数据库必须处于一致性状态</li> <li>如果数据库系统在运行过程中发生故障，有些事务尚未完成就被迫中断，这些未完成的事务对数据库所做的修改已有一部分写入物理数据库，这时数据库就处于一种不正确的状态，也就是不一致的状态</li></ul></li> <li><p><strong>隔离性</strong>（Isolation）</p> <p>事务的隔离性是指在并发环境中，并发的事务是相互隔离的，一个事务的执行不能被其他事务干扰。不同的事务并发操作相同的数据时，每个事务都有各自完成的数据空间，即一个事务内部的操作及使用的数据对其他事务是隔离的，并发执行的各个事务之间不能相互干扰</p></li> <li><p><strong>持久性</strong>（Durability）</p> <ul><li>事务提交之后，表发生的变化是永久的</li> <li>一旦事务提交，那么它对数据库中对应数据的状态的变更就会永久保存到数据库中，即使发生系统崩溃或者服务器宕机等故障，只要数据库能够重新启动，那么一定能将其恢复到事务成功的状态</li></ul></li></ul> <p><strong>隔离级别</strong></p> <p>1、<strong>读未提交</strong>（Read Uncommitted）</p> <ul><li><p>隔离级别最低，存在脏读、不可重复读、幻读</p></li> <li><p><strong>脏读</strong>，即当一个事务正在访问数据，对数据进行了修改，而这种修改还没有提交到数据库中，此时另外一个事务也访问这个数据，并且读取到了数据</p></li></ul> <p>2、<strong>读已提交</strong>（Read Committed）</p> <ul><li>读已提交只允许获取已经提交的数据，解决脏读，存在不可重复读、幻读</li> <li><strong>不可重复读</strong>，是指在一个事务内，多次读同一数据，得到的是不一样的结果。如事务A在读取某数据，同时事务B在修改该数据，事务A无法看到这个数据项在事务A操作过程中的中间值，只能看到修改的结果（不允许脏读）。在事务A还没有结束时，事务C也访问同一数据，并且进行修改，之后事务A再获取到的数据和第一次获取到的数据就是不一样的。在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的，称为不可重复读。</li> <li>==不可重复读的重点是修改==。同样的条件，读取过的数据，再次读取出来发现值不一样</li></ul> <p>3、<strong>可重复读</strong>（Repeatable Read）</p> <ul><li>可重复读就是保证在事务处理过程中，多次读取同一个数据时，其结果和事务开始时刻读取到的值是一致的。解决脏读和不可重复读，存在幻读</li> <li><strong>幻读</strong>，指同样的事务操作，在前后两个时间段内执行对同一个数据的读取，可能出现不一样的结果。如，第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样</li> <li>==幻读的重点在于新增或者删除==。同样的条件，第 1 次和第 2 次读出来的记录数不一样</li></ul> <p>4、<strong>串行化</strong></p> <p>最严格的事务隔离级别，它要求所有事务被串行化，即事务只能一个接着一个进行处理，不能并发执行。脏读、不可重复读、幻读都不会出现</p> <h3 id="事务的实现"><a href="#事务的实现" class="header-anchor">#</a> 事务的实现</h3> <h4 id="redo-log"><a href="#redo-log" class="header-anchor">#</a> redo log</h4> <blockquote><p>重做日志，用来<strong>实现事务的持久性</strong>。分为两部分：重做日志缓冲（redo log buffer）和重做日志文件（redo log），重做日志缓冲在内存中，重做日志文件在磁盘中。==当事务提交之后会把所有修改信息都存放到redo log中==</p></blockquote> <ul><li>MySQL为了提升性能不会每次都把修改操作实时同步到磁盘中，而是会先将修改操作放到缓冲池中，即重做日志缓冲，之后再使用后台线程去做缓冲池与磁盘之间的同步</li> <li>如果在同步之前发生了宕机，就会丢失部分已提交事务的修改信息。所以使用redo log来记录已成功提交事务的修改信息，并且把redo log文件持久化到磁盘上，系统重启之后再读取redo log恢复最新数据</li> <li>==redo log是用来恢复数据的，用于保障已提交事务的持久化特性==</li></ul> <h4 id="undo-log"><a href="#undo-log" class="header-anchor">#</a> undo log</h4> <blockquote><p>回滚日志，用于记录数据被修改前的信息。与redo log相反，重做日志记录数据被修改后的信息，回滚日志主要记录的是数据的逻辑变化，为了在发生错误时回滚之前的操作，需要将之前的操作都记录下来，然后在发生错误时才可以回滚，是<strong>实现事务的原子性</strong></p></blockquote> <ul><li>MySQL每次写入数据或者修改数据之前都会把修改信息记录到undo log中</li> <li>每条数据表更（insert/update/delete）操作都伴随着一条undo log的生成，并且必须==先将修改信息记录到回滚日志，再将数据持久化到磁盘上==。为何？因为有缓冲池的存在，不用同步持久化，可以异步持久化。先将数据保存到缓冲池中，再将缓冲池中的数据定期保存到磁盘中，降低磁盘IO频率，提高性能。</li> <li>undo log记录事务修改之前版本的数据信息，因此如果系统出现错误或者执行rollback操作的话，可以根据undo log的信息来进行回滚，回到修改前的状态。即根据回滚日志做逆向操作，insert逆向为delete，update还是update，delete变insert</li> <li>==undo log是用来回滚数据的，用于保障事务的原子性==</li></ul> <h4 id="读写锁"><a href="#读写锁" class="header-anchor">#</a> 读写锁</h4> <blockquote><p>共享锁，称为读锁；排他锁，称为写锁</p></blockquote> <ul><li>读锁是可以共享的，多个读请求可以共享一把锁读数据，不会造成阻塞</li> <li>写锁会排斥其他所有获取锁的请求，会一直阻塞，直到写操作完成，释放锁资源</li> <li>==通过读写锁可以做到读读并行，但是不能做到读写或者写写并行==</li> <li><strong>实现可重复读</strong></li></ul> <h4 id="mvcc"><a href="#mvcc" class="header-anchor">#</a> MVCC</h4> <blockquote><p>MultiVersion Concurrency Control，多版本并发控制，通过在每行记录的后面保存两个隐藏的列来实现的。两个列中，一个保存了行的创建时间，一个保存了行的过期时间，需要注意的是，存储的不是实际的时间值，而是版本号</p></blockquote> <ul><li><p>MVCC在MySQL中的实现需要依赖undo log和read view</p> <p>1、undo log，记录某行记录的多个版本的数据</p> <p>2、read view，用来判断当前版本数据的可见性</p></li> <li><p>==事务的隔离性是通过读写锁+MVCC来实现的==</p></li> <li><p>==事物的一致性是通过持久性+原子性+隔离性来实现的==</p></li></ul> <h2 id="mysql主从库配置"><a href="#mysql主从库配置" class="header-anchor">#</a> MySQL主从库配置</h2> <p><strong>主库写入，从库读取</strong></p> <p>使用docker版本mysql:5.7.28</p> <p>1、新建启动master库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d --name mysql-master -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> -v /mydata/mysql/master/log:/var/log/mysql -v /mydata/mysql/master/data:/var/lib/mysql -v /mydata/mysql/master/conf:/etc/mysql mysql:5.7.28
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2、在/mydata/mysql/master/conf目录下vim my.cnf，加入以下内容</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET collation_connection = utf8_unicode_ci'</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET NAMES utf8'</span>
character-set-server<span class="token operator">=</span>utf8
collation-server<span class="token operator">=</span>utf8_unicode_ci
skip-character-set-client-handshake
<span class="token comment">#skip-name-resolve	为了加快和mysql数据库的连接速度</span>
skip-name-resolve

<span class="token comment">#设置服务id</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#开启binlog</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">#关闭只读模式--&gt;master可写</span>
read-only<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#设置别的MySQL同步的库</span>
binlog-do-db<span class="token operator">=</span>gmall_ums
binlog-do-db<span class="token operator">=</span>gmall_pms
binlog-do-db<span class="token operator">=</span>gmall_oms
binlog-do-db<span class="token operator">=</span>gmall_sms
binlog-do-db<span class="token operator">=</span>gmall_cms

<span class="token comment">#设置别的MySQL忽略同步的库</span>
replicate-ignore-db<span class="token operator">=</span>mysql
replicate-ignore-db<span class="token operator">=</span>sys
replicate-ignore-db<span class="token operator">=</span>information_schema
replicate-ignore-db<span class="token operator">=</span>performance_schema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>3、重启master镜像</p> <p>4、新建启动slaver库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d --name mysql-slaver-01 -p <span class="token number">3316</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> -v /mydata/mysql/slaver/log:/var/log/mysql -v /mydata/mysql/slaver/data:/var/lib/mysql -v /mydata/mysql/slaver/conf:/etc/mysql mysql:5.7.28
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>5、同样新建编辑slaver的my.cnf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET collation_connection = utf8_unicode_ci'</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET NAMES utf8'</span>
character-set-server<span class="token operator">=</span>utf8
collation-server<span class="token operator">=</span>utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve

<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">2</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">#从库仅只读</span>
read-only<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#设置需要同步或者忽略库</span>
binlog-do-db<span class="token operator">=</span>gmall_ums
binlog-do-db<span class="token operator">=</span>gmall_pms
binlog-do-db<span class="token operator">=</span>gmall_oms
binlog-do-db<span class="token operator">=</span>gmall_sms
binlog-do-db<span class="token operator">=</span>gmall_cms


replicate-ignore-db<span class="token operator">=</span>mysql
replicate-ignore-db<span class="token operator">=</span>sys
replicate-ignore-db<span class="token operator">=</span>information_schema
replicate-ignore-db<span class="token operator">=</span>performance_schema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>6、进入mysql容器内部</p> <p>启动mysql</p> <p>1）授权root可以远程访问（ 主从都要配置，为了方便我们远程连接mysql）</p> <p>访问账号root，密码123456</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>grant all privileges on *.* to <span class="token string">'root'</span>@<span class="token string">'%'</span> identified by <span class="token string">'123456'</span> with grant option<span class="token punctuation">;</span>

flush privileges<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2）主库配置添加用来同步的用户</p> <p>在主库给从库分配一个连接主库的账号密码、账号名backup，密码123456</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GRANT REPLICATION SLAVE ON *.* to <span class="token string">'backup'</span>@<span class="token string">'%'</span> identified by <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3）查看master状态</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>show master status；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3-1）查看完整状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>show master status<span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>4）从库设置主库连接</p> <p>从库使用主库分配的账号密码连接主库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>change master to <span class="token assign-left variable">master_host</span><span class="token operator">=</span><span class="token string">'121.43.124.80'</span>,master_user<span class="token operator">=</span><span class="token string">'backup'</span>,master_password<span class="token operator">=</span><span class="token string">'123456'</span>,master_log_file<span class="token operator">=</span><span class="token string">'mysql-bin.000001'</span>,master_log_pos<span class="token operator">=</span><span class="token number">0</span>,master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>5）启动从库开始同步</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>start slave<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>6）查看从库状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>  show slave status<span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用MyCat或者在项目中引入sharding-jdbc依赖让项目读取到主从数据库</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/io.shardingjdbc/sharding-jdbc-core --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingjdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/26/2021, 9:40:23 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/database/Redis.html">
        Redis
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ef8f069f.js" defer></script><script src="/assets/js/2.81a6082a.js" defer></script><script src="/assets/js/5.728d53d9.js" defer></script>
  </body>
</html>
