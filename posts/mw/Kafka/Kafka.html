<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka | Gnl</title>
    <meta name="description" content="Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。">
    <link rel="preload stylesheet" href="/assets/style.dab0c050.css" as="style">
    
    <script type="module" src="/assets/app.8dec356f.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.519d889f.js">
    <link rel="modulepreload" href="/assets/chunks/theme.0e676aed.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-60acd026.1dd1e244.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-92806404.ce895bb2.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-6d4618e9.7065ecb6.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-9c70e2d1.107e931d.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-40ad929d.436cb271.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-adf6d212.0f31a81c.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-cf09b946.4cb42a78.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-cce2db57.0d9d2871.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-eaf6be26.6ba59b2f.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-85b81823.98af4da9.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-bdf860d6.a4f62229.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-90be091c.c3a5367a.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-0e94aa92.a3577f51.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-5699522c.83587abf.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-ab304aae.17856a0f.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-b8780ab9.3a25a09a.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-dda15a26.78d8164b.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-3970a277.87256d9f.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-82529010.e40e241e.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-35625031.57849d72.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-9588997f.4c0895cb.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.ade1a5ba.js">
    <link rel="modulepreload" href="/assets/chunks/giscus-2a044aea.497f0bd4.js">
    <link rel="modulepreload" href="/assets/posts_mw_Kafka_Kafka.md.9363d797.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-af5a5a9a data-v-ae5c84bb><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-5c56a737><div class="header" data-v-5c56a737><div class="title-wrapper" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i><span class="title" data-v-5c56a737></span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg><!--]--></i></div><!----><div class="footer content" data-v-5c56a737><!--[--><!--]--></div></div><div style="display:none;" class="theme-blog-popover-close" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ae5c84bb data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-transform.png" alt data-v-8426fc1a><!--]--><!--[-->Gnl<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-a0fd61f4 style="--54fbd49d:1;" data-v-bebd53ce><div class="nav-search-btn-wait" data-v-bebd53ce><svg width="14" height="14" viewBox="0 0 20 20" data-v-bebd53ce><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bebd53ce></path></svg><span class="search-tip" data-v-bebd53ce>Search</span><span class="metaKey" data-v-bebd53ce> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.html" data-v-43f1e123><!--[-->前端项目工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/JavaScript/JavaScript.html" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/TypeScript/TypeScript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/React/React.html" data-v-43f1e123><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/Vuejs/Vuejs.html" data-v-43f1e123><!--[-->Vue.js<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Java/Java.html" data-v-43f1e123><!--[-->Java<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Spring/Spring.html" data-v-43f1e123><!--[-->Spring<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringBoot/SpringBoot.html" data-v-43f1e123><!--[-->SpringBoot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringCloud/SpringCloud.html" data-v-43f1e123><!--[-->SpringCloud<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Dubbo/Dubbo.html" data-v-43f1e123><!--[-->Dubbo<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>数据库</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/MySQL/MySQL.html" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/PostgreSQL/PostgreSQL.html" data-v-43f1e123><!--[-->PostgreSQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/Redis/Redis.html" data-v-43f1e123><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>中间件</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Netty/Netty.html" data-v-43f1e123><!--[-->Netty<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/RocketMQ/RocketMQ/RocketMQ.html" data-v-43f1e123><!--[-->RocketMQ<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link active" href="/posts/mw/Kafka/Kafka.html" data-v-43f1e123><!--[-->Kafka<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Elesticsearch/Elesticsearch.html" data-v-43f1e123><!--[-->Elesticsearch<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>DevOps</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Docker/Docker.html" data-v-43f1e123><!--[-->Docker<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kubernetes/Kubernetes.html" data-v-43f1e123><!--[-->Kubernetes<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/GitLab/GitLab.html" data-v-43f1e123><!--[-->GitLab<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-ae5c84bb data-v-79c8c1df><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-ae5c84bb data-v-669faec9><div class="VPDoc has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _posts_mw_Kafka_Kafka" data-v-6b87e69f><div><h1 id="kafka" tabindex="-1">Kafka <a class="header-anchor" href="#kafka" aria-label="Permalink to &quot;Kafka&quot;">​</a></h1><br><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。</p><br><h2 id="基础架构" tabindex="-1">基础架构 <a class="header-anchor" href="#基础架构" aria-label="Permalink to &quot;基础架构&quot;">​</a></h2><p><img src="/assets/基础架构.1d9de240.png" alt="img"></p><br><h2 id="相关概念" tabindex="-1">相关概念 <a class="header-anchor" href="#相关概念" aria-label="Permalink to &quot;相关概念&quot;">​</a></h2><ul><li><p>Producer，消息生产者。</p></li><li><p>Consumer，消息消费者，从 Broker 拉取消息。</p></li><li><p><em>Consumer Group</em>，消费者组，组内每个消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费。所有的消费者都属于某个消费者组，消费者组是逻辑上的一个订阅者。</p><p><img src="/assets/consumer-groups.c8797fc8.png" alt="img"></p></li><li><p>Broker，一个 Kafka 服务就是一个 Broker，一个 Broker 可以容纳多个 Topic，一个集群由多个 Broker 组成。</p></li><li><p>Topic，Topic 可以分成多个分区存在于多个 Broker 上。</p></li><li><p>Partition，一个 Topic 可以分为多个 Partition，每个 Partition 是一个有序的队列。</p><blockquote><p>Topic 是逻辑上的概念，Partition 是物理上的概念。</p></blockquote><p><img src="/assets/streams-and-tables-p1_p4.ceaa828d.png" alt="img"></p></li></ul><br><h3 id="zookeeper-与-nameserver" tabindex="-1">Zookeeper 与 Nameserver <a class="header-anchor" href="#zookeeper-与-nameserver" aria-label="Permalink to &quot;Zookeeper 与 Nameserver&quot;">​</a></h3><blockquote><p>Kafka 中 Zookeeper 和 RocketMQ 的 Nameserver 功能相似，都是用来管理集群中的节点信息。但是它们的职责不完全相同：</p><ul><li>Zookeeper 用来管理分布式应用。主要作用是维护和管理分布式应用的配置、命名、分布式同步和群组服务等，同时它还具有分布式锁和分布式队列等功能。</li><li>Nameserver 是轻量级的命名服务，管理所有生产者和消费者信息，包括主题、队列、消费组等。Nameserver 通过将生产者和消费者注册到其管理的主题中，使得生产者和消费者能够互相发现和通信。</li></ul><br><table><thead><tr><th></th><th>Zookeeper</th><th>Nameserver</th></tr></thead><tbody><tr><td>功能</td><td>分布式协调和管理、数据存储、分布式锁和分布式队列</td><td>消费者和生产者管理、主题路由和自动化分区</td></tr><tr><td>数据存储</td><td>分层的命名空间、可靠的数据存储</td><td>内存数据库</td></tr><tr><td>一致性</td><td>原子/版本/事务保持一致性</td><td>集群中的主节点选举</td></tr><tr><td>可用性和容错</td><td>高度可用性和容错性</td><td>容错性较弱</td></tr><tr><td>应用场景</td><td>分布式应用程序</td><td>分布式消息系统</td></tr></tbody></table></blockquote><br><h3 id="消费模式" tabindex="-1">消费模式 <a class="header-anchor" href="#消费模式" aria-label="Permalink to &quot;消费模式&quot;">​</a></h3><ul><li>点对点。一对一，生产者生产消息发送到消息队列，消费者从队列中主动拉取并消费消息。消息消费后，队列中不再存储。一个消息队列支持多个消费者进行消费，但是一条消息只有一个消费者可以消费。</li><li>发布/订阅。一对多，消息被消费后不会被清除。消息生产者将消息发布到 Topic 中，同时可以有多个消费者订阅该 Topic。和点对点方式不同，发布到 Topic 的消息被消费后不会被清除，会被所有订阅者消费。</li></ul><br><h2 id="安装与启动" tabindex="-1">安装与启动 <a class="header-anchor" href="#安装与启动" aria-label="Permalink to &quot;安装与启动&quot;">​</a></h2><p><strong>Docker</strong></p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 先 build</span></span>
<span class="line"><span style="color:#6A737D;"># docker build -t kfk-docker .</span></span>
<span class="line"><span style="color:#6A737D;"># 再 run，run 之前需要修改 server.properties 中的 advertised.listeners</span></span>
<span class="line"><span style="color:#6A737D;"># docker run --name=kfk -d -v &quot;./server.properties:/opt/kafka/config/server.properties&quot; -p 9092:9092 kfk-docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用基础镜像</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> adoptopenjdk/openjdk8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 先下载 Kafka 并解压到当前目录，重命名为 kafka</span></span>
<span class="line"><span style="color:#6A737D;"># https://kafka.apache.org/documentation/#quickstart</span></span>
<span class="line"><span style="color:#6A737D;"># 复制本地的 Kafka</span></span>
<span class="line"><span style="color:#F97583;">COPY</span><span style="color:#E1E4E8;"> kafka /opt/kafka</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置工作目录</span></span>
<span class="line"><span style="color:#F97583;">WORKDIR</span><span style="color:#E1E4E8;"> /opt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置环境变量</span></span>
<span class="line"><span style="color:#F97583;">ENV</span><span style="color:#E1E4E8;"> KAFKA_HOME /opt/kafka</span></span>
<span class="line"><span style="color:#F97583;">ENV</span><span style="color:#E1E4E8;"> PATH $KAFKA_HOME/bin:$PATH</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 从当前目录 kafka 文件夹内复制 zookeeper.properties 和 server.properties 到当前文件夹，并配置好</span></span>
<span class="line"><span style="color:#6A737D;"># 这步可以省略</span></span>
<span class="line"><span style="color:#F97583;">COPY</span><span style="color:#E1E4E8;"> zookeeper.properties $KAFKA_HOME/config/zookeeper.properties</span></span>
<span class="line"><span style="color:#F97583;">COPY</span><span style="color:#E1E4E8;"> server.properties $KAFKA_HOME/config/server.properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 暴露 Kafka 和 ZooKeeper 端口</span></span>
<span class="line"><span style="color:#F97583;">EXPOSE</span><span style="color:#E1E4E8;"> 2181 9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动 ZooKeeper 和 Kafka</span></span>
<span class="line"><span style="color:#F97583;">CMD</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&quot;sh&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;$KAFKA_HOME/bin/zookeeper-server-start.sh $KAFKA_HOME/config/zookeeper.properties &amp; $KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 先 build</span></span>
<span class="line"><span style="color:#6A737D;"># docker build -t kfk-docker .</span></span>
<span class="line"><span style="color:#6A737D;"># 再 run，run 之前需要修改 server.properties 中的 advertised.listeners</span></span>
<span class="line"><span style="color:#6A737D;"># docker run --name=kfk -d -v &quot;./server.properties:/opt/kafka/config/server.properties&quot; -p 9092:9092 kfk-docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用基础镜像</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> adoptopenjdk/openjdk8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 先下载 Kafka 并解压到当前目录，重命名为 kafka</span></span>
<span class="line"><span style="color:#6A737D;"># https://kafka.apache.org/documentation/#quickstart</span></span>
<span class="line"><span style="color:#6A737D;"># 复制本地的 Kafka</span></span>
<span class="line"><span style="color:#D73A49;">COPY</span><span style="color:#24292E;"> kafka /opt/kafka</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置工作目录</span></span>
<span class="line"><span style="color:#D73A49;">WORKDIR</span><span style="color:#24292E;"> /opt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置环境变量</span></span>
<span class="line"><span style="color:#D73A49;">ENV</span><span style="color:#24292E;"> KAFKA_HOME /opt/kafka</span></span>
<span class="line"><span style="color:#D73A49;">ENV</span><span style="color:#24292E;"> PATH $KAFKA_HOME/bin:$PATH</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 从当前目录 kafka 文件夹内复制 zookeeper.properties 和 server.properties 到当前文件夹，并配置好</span></span>
<span class="line"><span style="color:#6A737D;"># 这步可以省略</span></span>
<span class="line"><span style="color:#D73A49;">COPY</span><span style="color:#24292E;"> zookeeper.properties $KAFKA_HOME/config/zookeeper.properties</span></span>
<span class="line"><span style="color:#D73A49;">COPY</span><span style="color:#24292E;"> server.properties $KAFKA_HOME/config/server.properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 暴露 Kafka 和 ZooKeeper 端口</span></span>
<span class="line"><span style="color:#D73A49;">EXPOSE</span><span style="color:#24292E;"> 2181 9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动 ZooKeeper 和 Kafka</span></span>
<span class="line"><span style="color:#D73A49;">CMD</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;$KAFKA_HOME/bin/zookeeper-server-start.sh $KAFKA_HOME/config/zookeeper.properties &amp; $KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties&quot;</span><span style="color:#24292E;">]</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># -e KAFKA_BROKER_ID=0 在 kafka 集群中，每个 kafka 都有一个 BROKER_ID 来区分</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_ZOOKEEPER_CONNECT=IP地址:2181 配置 zk</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://IP地址:9092 kafka 服务注册到 zk</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 配置 kafka 监听端口</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># -e KAFKA_BROKER_ID=0 在 kafka 集群中，每个 kafka 都有一个 BROKER_ID 来区分</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_ZOOKEEPER_CONNECT=IP地址:2181 配置 zk</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://IP地址:9092 kafka 服务注册到 zk</span></span>
<span class="line"><span style="color:#6A737D;"># -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 配置 kafka 监听端口</span></span></code></pre></div><br><h2 id="基本操作" tabindex="-1">基本操作 <a class="header-anchor" href="#基本操作" aria-label="Permalink to &quot;基本操作&quot;">​</a></h2><blockquote><p><a href="https://kafka.apachecn.org/documentation.html#operations" target="_blank" rel="noreferrer">operations</a></p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建 topic</span></span>
<span class="line"><span style="color:#6A737D;"># --topic 定义 topic 名</span></span>
<span class="line"><span style="color:#6A737D;"># --replication-factor 定义副本数</span></span>
<span class="line"><span style="color:#6A737D;"># --partitions 定义分区数</span></span>
<span class="line"><span style="color:#B392F0;">kafka-topics.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看所有 topic</span></span>
<span class="line"><span style="color:#B392F0;">kafka-topics.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--list</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"><span style="color:#6A737D;"># 除了自定义的 Topic，还有一个名为 __consumer_offsets 的 Topic，用于保存消费者的消费 Offset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 删除 topic</span></span>
<span class="line"><span style="color:#B392F0;">kafka-topics.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--delete</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"><span style="color:#6A737D;"># 需要 config/server.properties 中设置 delete.topic.enable=true 否则只是标记删除</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看某个 topic 的详情</span></span>
<span class="line"><span style="color:#B392F0;">kafka-topics.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--describe</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 修改 topic 分区数</span></span>
<span class="line"><span style="color:#B392F0;">kafka-topics.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--alter</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--partitions</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 消息生产</span></span>
<span class="line"><span style="color:#B392F0;">kafka-console-producer.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> the 1st message</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 消费消息</span></span>
<span class="line"><span style="color:#B392F0;">kafka-console-consumer.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--bootstrap-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9092</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--topic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topic_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--from-beginning</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建 topic</span></span>
<span class="line"><span style="color:#6A737D;"># --topic 定义 topic 名</span></span>
<span class="line"><span style="color:#6A737D;"># --replication-factor 定义副本数</span></span>
<span class="line"><span style="color:#6A737D;"># --partitions 定义分区数</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-topics.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看所有 topic</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-topics.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--list</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"><span style="color:#6A737D;"># 除了自定义的 Topic，还有一个名为 __consumer_offsets 的 Topic，用于保存消费者的消费 Offset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 删除 topic</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-topics.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--delete</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"><span style="color:#6A737D;"># 需要 config/server.properties 中设置 delete.topic.enable=true 否则只是标记删除</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看某个 topic 的详情</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-topics.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--describe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 修改 topic 分区数</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-topics.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--alter</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--partitions</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 消息生产</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-console-producer.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> the 1st message</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 消费消息</span></span>
<span class="line"><span style="color:#6F42C1;">kafka-console-consumer.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--bootstrap-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9092</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--topic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topic_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--from-beginning</span></span></code></pre></div><br><h2 id="消息生产" tabindex="-1">消息生产 <a class="header-anchor" href="#消息生产" aria-label="Permalink to &quot;消息生产&quot;">​</a></h2><br><h3 id="生产者-ack" tabindex="-1">生产者 ACK <a class="header-anchor" href="#生产者-ack" aria-label="Permalink to &quot;生产者 ACK&quot;">​</a></h3><p>为保证生产者发送的数据能可靠的发送到指定的 Topic，对应分区收到消息后会根据 ACK 策略向生产者发送 ACK。如果生产者收到 ACK，就会进行下一轮的发送，否则重新发送上一条消息。</p><p><strong>何时发送 ACK？</strong></p><p>确保有 Follower 与 Leader 同步完成，Leader 再发送 ACK。这样才能保证 Leader 故障后仍有完整的数据保存在 Follower 中，才能选举出新的 Leader。</p><p><strong>有多少个 Follower 同步完成发送 ACK？</strong></p><p>1、半数以上的 Follower 同步完成，可发送 ACK。</p><p>2、全部的 Follower 同步完成，才发送 ACK。</p><p><strong>Kafka 选用第二种方式</strong>。如果只要求半数副本成功就发送 ACK，存在以下问题：</p><ul><li>数据一致性：半数副本成功就发送 ACK，可能会导致不同副本之间的数据不一致</li><li>可用性：半数副本成功就发送 ACK，当出现副本故障或网络故障时，可能会导致消息丢失</li></ul><p>第二种方式缺点是增加了延迟，但是 Kafka 作为一个分布式系统，数据可靠才是最重要的。</p><br><p><strong>生产者 ISR</strong></p><blockquote><p>采用第二种方案之后，设想以下情景：Leader 收到数据，所有 Follower 都开始同步数据，但有一个 Follower 发生故障不能与 Leader 进行同步，Leader 就要一直等待，直到 Follower 完成同步，才能发送 ACK。<strong>这个问题怎么解决呢？</strong></p></blockquote><p>Leader 维护了一个动态的 ISR（<em>In-Sync Replica Set</em>），同步状态的备份的集合，表示和 Leader 保持同步的 Follower 集合。</p><p>当 ISR 中的 Follower 完成数据的同步之后，就会给 Leader 发送 ACK。如果 Follower 长时间（由 <code>replica.lag.time.max.ms</code> 参数设定）未向 Leader 同步数据，将其从 ISR 剔除。等待 Follower 恢复正常再重新加入 ISR。</p><blockquote><p>ISR 还有一个作用：当 Leader 发生故障，Kafka 就会从 ISR 中选举新的 Leader。</p></blockquote><br><p><strong>ACK 策略/级别</strong></p><p>对于不太重要的数据，对数据的可靠性要求不高，能够容忍数据少量丢失，不必等 ISR 中的 Follower 全部接收成功。Kafka 为用户提供了三种级别 ACK：</p><ul><li><p><code>ack=0</code></p><p>生产者不等 Broker 的 ACK，提供最低的延迟。Broker 接收消息到还没有写入磁盘就已经返回 ACK，Broker 故障时有可能丢失数据</p></li><li><p><code>ack=1</code></p><p>等到 Leader 落盘成功后返回 ACK。如果在 Follower 同步成功之前 Leader 故障，将会丢失数据</p></li><li><p><code>ack=-1（all）</code></p><p>等到 Leader 和 ISR 的 Follower 全部落盘成功后才返回 ACK。如果在 Follower 同步完成后，在 Broker 发送 ACK 之前 Leader 发生故障，会造成数据重复</p></li></ul><br><h3 id="生产者分区" tabindex="-1">生产者分区 <a class="header-anchor" href="#生产者分区" aria-label="Permalink to &quot;生产者分区&quot;">​</a></h3><blockquote><p><strong>原因</strong></p><ul><li>提高并发，以分区为单位读写，多个分区可以处理更多的读操作</li><li>方便在集群中扩展，每个分区可调整以适应它所在的机器</li></ul></blockquote><blockquote><p><strong>分区策略</strong></p><ol><li>指明分区的情况下，直接发送到对应的分区</li><li>没有指明分区，但有 key 时，将 key 的 hash 值与分区数进行取余操作，得到存储的分区号</li><li>既没有指明分区，又没有 key 时，第一次调用：随机生成一个整数（后面每次调用在这个整数上自增），将其与 Topic 可用的分区总数取余得到发送到的分区号，即 round-robin 算法</li></ol></blockquote><br><h2 id="消息消费" tabindex="-1">消息消费 <a class="header-anchor" href="#消息消费" aria-label="Permalink to &quot;消息消费&quot;">​</a></h2><h3 id="消费方式" tabindex="-1">消费方式 <a class="header-anchor" href="#消费方式" aria-label="Permalink to &quot;消费方式&quot;">​</a></h3><ul><li><p>拉模式</p><p>拉模式从 Broker 中读取数据。如果 Broker 没有数据，消费者可能会陷入循环中，一直返回空数据。针对这一点，Kafka 在拉模式消费中定义了一个超时参数。消费者拉取消息，如果有消息马上返回；如果没有消息，消费者等待直到超时，再次发起拉消息请求。拉模式可以根据 Consumer 的消费能力以适当的速率消费消息。</p></li><li><p>推模式</p><p>消息推送速率由 Broker 决定，Broker 尽可能以最快速度传递消息，但消费者消费速度可能跟不上。</p></li></ul><br><h3 id="消费者分区" tabindex="-1">消费者分区 <a class="header-anchor" href="#消费者分区" aria-label="Permalink to &quot;消费者分区&quot;">​</a></h3><p><strong>分区分配再平衡机制</strong></p><blockquote><p>分区分配再平衡指的是在消费者订阅的 Topic 发生变化时发生的一种分区重分配机制。一般有三种情况会触发再平衡：</p><ul><li>消费者组中的新增或删除某个消费者，导致其所消费的分区需要分配到组内其他的消费者上</li><li>消费者订阅的 Topic 发生变化，比如订阅的 Topic 采用的是正则表达式的形式，如 <code>topic-*</code>，此时如果有一个新建了一个 <code>topic-user</code>，这个 Topic 的所有分区也会自动分配给当前消费者</li><li>消费者所订阅的 Topic 发生了新增分区的行为，新增的分区就会分配给当前的消费者</li></ul></blockquote><blockquote><p><a href="https://zhuanlan.zhihu.com/p/86718818" target="_blank" rel="noreferrer">Kafka 再平衡机制详解</a></p></blockquote><br><p><strong>分区分配策略</strong></p><blockquote><p>一个消费者组中有多个消费者，一个 Topic 有多个分区，消费时需要确定哪个分区由哪个消费者来消费。有两种分配策略：</p><ul><li>round-robin 轮询</li><li>range</li></ul></blockquote><br><h3 id="消费-offset" tabindex="-1">消费 Offset <a class="header-anchor" href="#消费-offset" aria-label="Permalink to &quot;消费 Offset&quot;">​</a></h3><blockquote><p>消费者在出现故障恢复后，需要从故障前的位置的继续消费，所以消费者需要实时记录自己消费到了哪个 Offset，以便故障恢复后继续消费。</p><p>消费者默认将 Offset 保存在 Kafka 名为 <code>__consumer_offsets</code> 的内置 Topic 中。</p></blockquote><br><h2 id="消息操作" tabindex="-1">消息操作 <a class="header-anchor" href="#消息操作" aria-label="Permalink to &quot;消息操作&quot;">​</a></h2><h3 id="消息存储" tabindex="-1">消息存储 <a class="header-anchor" href="#消息存储" aria-label="Permalink to &quot;消息存储&quot;">​</a></h3><p>一个 Topic 可分为多个 Partition，生产者生产的消息会不断追加到不同分区中的 log 文件末尾。为防止 log 文件过大导致数据定位效率低下，Kafka 采取了<strong>分片</strong>和<strong>索引</strong>机制，将每个 Partition 分为多个 Segment。</p><p>每个 Segment 对应两个文件：<code>.index</code> 和 <code>.log</code> 文件。这些文件位于一个文件夹下，文件夹的命名规则为：<code>Topic 名称 + 分区序号</code>。例如，topic-first 有 3 个分区，则其对应的文件夹为 topic-first-0，topic-first-1，topic-first-2。</p><p>文件命名是以当前 Segment 的第一条消息的 Offset 命名，当文件大小达到配置的大小（默认 1G）时会根据新的 Offset 生成新的文件。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">00000000000000000000.index</span></span>
<span class="line"><span style="color:#e1e4e8;">00000000000000000000.log</span></span>
<span class="line"><span style="color:#e1e4e8;">00000000000000170410.index</span></span>
<span class="line"><span style="color:#e1e4e8;">00000000000000170410.log</span></span>
<span class="line"><span style="color:#e1e4e8;">00000000000000239430.index</span></span>
<span class="line"><span style="color:#e1e4e8;">00000000000000239430.log</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">00000000000000000000.index</span></span>
<span class="line"><span style="color:#24292e;">00000000000000000000.log</span></span>
<span class="line"><span style="color:#24292e;">00000000000000170410.index</span></span>
<span class="line"><span style="color:#24292e;">00000000000000170410.log</span></span>
<span class="line"><span style="color:#24292e;">00000000000000239430.index</span></span>
<span class="line"><span style="color:#24292e;">00000000000000239430.log</span></span></code></pre></div><p><img src="/assets/image-20210802170907770.d6e65451.png" alt="image-20210802170907770"></p><br><h3 id="消息日志删除" tabindex="-1">消息日志删除 <a class="header-anchor" href="#消息日志删除" aria-label="Permalink to &quot;消息日志删除&quot;">​</a></h3><p>由于不删除消息，硬盘有被占满的时刻，Kakfa 提供了几种策略解决：一是基于时间；二是基于起始偏移量；三是基于分区文件的大小。</p><ul><li>日志删除任务会检查当前日志文件中是否有保留时间超过设定的阈值来寻找可删除的日志分段文件集合</li><li>一般情况下，日志文件的起始偏移量 logStartOffset 等于第一个日志分段的 baseOffset。基于日志起始偏移量的保留策略的判断依据是某日志分段的起始偏移量 baseOffset 是否小于等于 logStartOffset，若是，则可以删除此日志分段</li><li>日志删除任务会检查当前日志的大小是否超过设定的阈值来寻找可删除的日志分段的文件集合</li></ul><br><h3 id="消息流向" tabindex="-1">消息流向 <a class="header-anchor" href="#消息流向" aria-label="Permalink to &quot;消息流向&quot;">​</a></h3><p>Kafka 中消息是以 Topic 进行分类的，消息的生产和消费都是面向 Topic 的。<strong>Topic 是逻辑上的概念，而 Partition 是物理上的概念</strong>。</p><p>每个 Partition 对应于一个 log 文件，该 log 文件中存储的就是生产者生产的数据（Topic = N partition，partition = log）。</p><p>Producer 生产的数据会被不断追加到该 log 文件末端，且每条数据都有自己的 Offset。消费者组中的每个消费者会实时记录自己消费到了哪个 Offset，以便出错恢复时从上次的位置继续消费。</p><blockquote><p>生产者 -&gt; Topic（实际上是 Partition Log File） -&gt; 消费者</p></blockquote><br><h2 id="高可用" tabindex="-1">高可用 <a class="header-anchor" href="#高可用" aria-label="Permalink to &quot;高可用&quot;">​</a></h2><p>一个 Topic 的每个 Partition 都有若干个副本，一个 Leader 和零个或若干个 Follower。</p><p><strong>Leader</strong></p><p>一个分区只有一个 Leader，领导一个或多个副本。一个 Partition 的数据只能由 Leader 来处理。生产者发送数据的对象，以及消费者消费数据的对象都是 Leader。</p><p><strong>Follower</strong></p><p>实时从 Leader 中同步数据，Leader 发生故障时，从 ISR 列表中的 Follower 中选出新的 Leader。</p><br><h2 id="数据一致性问题" tabindex="-1">数据一致性问题 <a class="header-anchor" href="#数据一致性问题" aria-label="Permalink to &quot;数据一致性问题&quot;">​</a></h2><blockquote><p>首先了解两个概念</p><ul><li><p>LEO（Log End Offset），每个副本的最后一个 Offset</p></li><li><p>HW（High Watermark）高水位，指的是消费者能见到的最大的 Offset，ISR 队列中最小的 LEO</p></li></ul></blockquote><p><img src="/assets/image-20210803102155773.64b77247.png" alt="image-20210803102155773"></p><p><strong>Follower 故障和 Leader 故障</strong></p><ul><li>Follower 故障：Follower 发生故障后会被<strong>临时</strong>踢出 ISR，待该 Follower 恢复后，Follower 会读取本地磁盘记录的上次的 HW，并将 log 文件高于 HW 的部分截取掉，从 HW 开始向 Leader 进行同步。等该Follower 的 HW 追上 Leader 之后，就可以重新加入 ISR</li><li>Leader 故障：会从 ISR 中选出一个新的 Leader，为保证多个副本之间的数据一致性， 其余的 Follower 会先将各自的 log 文件高于 HW 的部分截掉，然后从新的 Leader 同步数据</li></ul><blockquote><p><strong>注意</strong>：这只能保证副本之间的数据一致性，并不能保证数据不丢失或者不重复</p></blockquote><br><h2 id="exactlyonce" tabindex="-1">ExactlyOnce <a class="header-anchor" href="#exactlyonce" aria-label="Permalink to &quot;ExactlyOnce&quot;">​</a></h2><p><strong>消息发送语义</strong></p><ul><li>将 ACK 级别设置为 -1（all），可以保证生产者到 Broker 之间不会丢失数据，保证生产者消息至少发送一次，即 <em>At Least Once</em> 语义</li><li>将 ACK 级别设置为 0，可以保证生产者每条消息只会被发送一次，即 <em>At Most Once</em> 语义</li><li><strong>消息持久化幂等性</strong>。就是指生产者不论发送多少次重复数据，Broker 只会持久化一条。将生产者的参数 <code>enable.idempotence</code> 设置为 <code>true</code> 即可启用幂等性支持。Kafka 幂等性实现其实就是将原来下游需要做的去重放在了数据上游。</li></ul><br><p><strong>何时需要 ExactlyOnce？</strong></p><p><em>At Least Once</em> 可以保证数据不丢失，但是不能保证数据不重复；<em>At Most Once</em> 可以保证数据不重复，但是不能保证数据不丢失。但是对于一些非常重要的消息，比如说<strong>交易消息</strong>，要求数据既不重复也不丢失，即 <em>Exactly Once</em> 语义。</p><p>幂等性结合 <em>At Least Once</em> 语义，构成 Kafka 的 <em>Exactly Once</em> 语义。<code>At Least Once + 幂等性 = Exactly Once</code>。</p><br><p><strong>ExactlyOnce 不可跨分区跨会话</strong></p><p>开启幂等性的生产者在初始化时会被分配一个 PID，发往同一个分区的消息会附带 <em>Sequence Number</em>，Broker 会将 <code>&lt;PID, Partition, SeqNumber&gt;</code> 缓存起来当作主键。当具有相同主键的消息提交时，Broker 只会持久化一条。</p><p>但服务重启 PID 就会变化，不同的分区具有不同主键，所以幂等性无法保证跨分区跨会话的 <em>Exactly Once</em>。</p><br><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><blockquote><p>事务可以保证 Kafka 在 <em>Exactly Once</em> 语义基础上，生产和消费跨分区和会话要么全部成功，要么全部失败。</p></blockquote><p><strong>生产者事务</strong></p><blockquote><p>为了实现跨分区跨会话的事务，需要引入一个全局唯一的 <code>Transaction ID</code>，并将生产者的 PID 和 <em>Transaction ID</em> 绑定。生产者重启后就可以通过正在进行的 <em>Transaction ID</em> 获得原来的 PID。</p><p>为了管理事务，Kafka 引入了一个新的组件 <em>Transaction Coordinator</em>。生产者通过和 <em>Transaction Coordinator</em> 交互获得 <em>Transaction ID</em> 对应的任务状态。</p><p><em>Transaction Coordinator</em> 还负责将所有事务写入 Kafka 的一个内部 Topic，这样即使整个服务重启，进行中的事务状态依然可以恢复进行。</p></blockquote><p><strong>消费者事务</strong></p><blockquote><p>对于消费者而言，事务的保证就会相对较弱，尤其是无法保证 commit 的信息被精确消费。这是因为消费者可以通过 Offset 访问任意信息，而且不同的 Segment File 生命周期不同，同一事务的消息可能会出现重启后被删除的情况。</p></blockquote><br><h2 id="高效读写" tabindex="-1">高效读写 <a class="header-anchor" href="#高效读写" aria-label="Permalink to &quot;高效读写&quot;">​</a></h2><br><h3 id="顺序写磁盘" tabindex="-1">顺序写磁盘 <a class="header-anchor" href="#顺序写磁盘" aria-label="Permalink to &quot;顺序写磁盘&quot;">​</a></h3><blockquote><p>Kafka 的生产者生产数据，会写入到 log 文件中，写的过程是一直追加到文件末端，为顺序写。顺序写<strong>省去了大量磁头寻址的时间</strong>。</p><p>实际上不管是内存还是磁盘，快或慢关键在于寻址的方式。磁盘分为顺序读写与随机读写，内存也一样分为顺序读写与随机读写。顺序读写性能高于随机读写。</p></blockquote><blockquote><p>收到生产者消息后 Kafka 会把数据写入文件末尾，这种方法有一个缺陷：无法删除某条数据。所以 Kafka 会把所有的数据都保留下来，每个消费者对每个 Topic 都有一个 Offset 用来表示 读取到了第几条数据。</p></blockquote><br><h3 id="page-cache" tabindex="-1">Page Cache <a class="header-anchor" href="#page-cache" aria-label="Permalink to &quot;Page Cache&quot;">​</a></h3><blockquote><p>为了优化读写性能，Kafka 利用了操作系统本身的 <em>Page Cache</em>，用于缓存磁盘上的消息：</p><ul><li>避免 Object 消耗，如果是使用 Java 堆，Java 对象的内存消耗比较大，通常是所存储数据的两倍甚至更多</li><li>避免 GC 问题，随着 JVM 中数据不断增多，垃圾回收会变得复杂/缓慢，使用系统缓存就不会存在 GC 问题</li></ul><p>Kafka 将消息写入磁盘时，也会将其缓存在 <em>Page Cache</em> 中。当应用程序需要访问这些消息时，<em>Page Cache</em> 会将它们从磁盘加载到内存中，以便更快读取。</p><p>相比于使用 JVM 或 <em>In-Memory Cache</em> 等，利用操作系统的 <em>Page Cache</em> 更加简单可靠：</p><ul><li><p>操作系统层面的缓存利用率会更高，存储的都是紧凑的字节结构而不是独立的对象</p></li><li><p>操作系统本身对 <em>Page Cache</em> 做了优化，提供 <em>write-behind/read-ahead/flush</em> 等多种机制</p></li><li><p>即使服务进程重启，系统缓存依然存在，避免 <em>In-Process Cache</em> 重建缓存的过程</p></li></ul></blockquote><br><h3 id="零拷贝技术" tabindex="-1">零拷贝技术 <a class="header-anchor" href="#零拷贝技术" aria-label="Permalink to &quot;零拷贝技术&quot;">​</a></h3><blockquote><p>Linux 操作系统零拷贝机制使用了 sendfile 方法，允许操作系统将数据从 <em>Page Cache</em> 直接发送到网络。只需要最后一步的 copy 操作将数据复制到 NIC（<em>Network Interface Controller</em>） 网络接口控制器缓冲区， 避免重新复制数据。通过零拷贝机制，<em>Page Cache</em> 结合 sendfile 方法，Kafka 消费端的性能也大幅提升。</p><p><img src="/assets/14.2ec8d68e.png" alt="零复制技术"></p><p>从 File =&gt; PageCache =&gt; ApplicationCache =&gt; SocketCache =&gt; NIC，</p><p>变成 File =&gt; PageCache =&gt; NIC</p></blockquote><br><p>当 Kafka 客户端从服务器读取数据时，如果不使用零拷贝技术，那么大致需要经历这样的一个过程：</p><ol><li>操作系统将数据从磁盘上读入到内核空间的读缓冲区中</li><li>应用程序（也就是 Kafka）从内核空间的读缓冲区将数据拷贝到用户空间的缓冲区中</li><li>应用程序将数据从用户空间的缓冲区再写回到内核空间的 socket 缓冲区中</li><li>操作系统将 socket 缓冲区中的数据拷贝到 NIC 缓冲区中，然后通过网络发送给客户端</li></ol><p>数据在内核空间和用户空间之间穿梭了两次，能否避免这个多余的过程呢？</p><p>Kafka 使用了零拷贝技术，直接将数据从内核空间的读缓冲区直接拷贝到内核空间的 socket 缓冲区，再写入到 NIC 缓冲区，避免了在内核空间和用户空间之间穿梭。</p><blockquote><p><em>注意：这里的零拷贝并非指一次拷贝都没有，而是避免了在内核空间和用户空间之间的拷贝</em></p></blockquote><br><h3 id="分区分段-索引" tabindex="-1">分区分段 + 索引 <a class="header-anchor" href="#分区分段-索引" aria-label="Permalink to &quot;分区分段 + 索引&quot;">​</a></h3><blockquote><p>Topic =&gt; Partition =&gt; Segment</p><p>通过这种分区分段的设计，Kafka 的消息实际上是分布式存储在一个个的 Segment 中的，每次文件操作也是直接操作的 Segment。</p><p>为了进一步的查询优化，Kafka 默认为分段后的数据文件建立了索引文件，就是 <code>.index</code> 文件。这种分区分段+索引的设计，提升了数据读取的效率，也提高了数据操作的并行度。</p></blockquote><br><h3 id="批量读写" tabindex="-1">批量读写 <a class="header-anchor" href="#批量读写" aria-label="Permalink to &quot;批量读写&quot;">​</a></h3><blockquote><p>Kafka 数据读写是批量的而不是单个的。在向 Kafka 写入数据时，启用批次写入可以避免在网络上频繁传输单个消息带来的延迟和带宽开销。</p></blockquote><br><h3 id="批量压缩" tabindex="-1">批量压缩 <a class="header-anchor" href="#批量压缩" aria-label="Permalink to &quot;批量压缩&quot;">​</a></h3><blockquote><p>在很多情况下，系统的瓶颈不是 CPU 或磁盘，而是网络 IO。可以考虑进行数据压缩，虽然会消耗少量的 CPU 资源，不过对于 Kafka 而言，网络 IO 更应该需要考虑：</p><ol><li>如果每个消息都压缩，但是压缩率相对很低，Kafka 使用了批量压缩，多个消息一起压缩</li><li>Kafka 允许使用递归的消息集合，批量的消息可以通过压缩的形式传输并且在日志中也可以保持压缩格式，直到被消费者解压</li><li>Kafka 支持多种压缩协议，包括 Gzip 和 Snappy 压缩协议</li></ol></blockquote><br><h2 id="zookeeper-的作用" tabindex="-1">Zookeeper 的作用 <a class="header-anchor" href="#zookeeper-的作用" aria-label="Permalink to &quot;Zookeeper 的作用&quot;">​</a></h2><blockquote><p>Kafka 集群中有一个 Broker 会被选举为 Controller，负责管理集群 Broker 的上下线，所有 Topic 的分区副本分配和 Leader 选举等工作。Controller 的管理工作都是依赖于 Zookeeper 进行的。</p><p><img src="/assets/15.7ee6be58.png" alt="Leader选举流程"></p></blockquote><br><h2 id="api-操作" tabindex="-1">API 操作 <a class="header-anchor" href="#api-操作" aria-label="Permalink to &quot;API 操作&quot;">​</a></h2><h3 id="生产者" tabindex="-1">生产者 <a class="header-anchor" href="#生产者" aria-label="Permalink to &quot;生产者&quot;">​</a></h3><br><h4 id="异步生产者" tabindex="-1">异步生产者 <a class="header-anchor" href="#异步生产者" aria-label="Permalink to &quot;异步生产者&quot;">​</a></h4><h5 id="普通生产者" tabindex="-1">普通生产者 <a class="header-anchor" href="#普通生产者" aria-label="Permalink to &quot;普通生产者&quot;">​</a></h5><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;org.apache.kafka&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;kafka-clients&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;latest&lt;/</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.apache.kafka&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;kafka-clients&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;latest&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Properties props </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Properties</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, </span><span style="color:#9ECBFF;">&quot;localhost:9092&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.ACKS_CONFIG, </span><span style="color:#9ECBFF;">&quot;all&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// ack 级别 all</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.RETRIES_CONFIG, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 重试次数</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.LINGER_MS_CONFIG, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 等待时间</span></span>
<span class="line"><span style="color:#6A737D;">// 消息 k-v 序列化器</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, </span><span style="color:#9ECBFF;">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, </span><span style="color:#9ECBFF;">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Producer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; producer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaProducer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> ProducerRecord&lt;&gt;(</span><span style="color:#9ECBFF;">&quot;test-topic&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;test-key&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;test-value&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Properties props </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Properties</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, </span><span style="color:#032F62;">&quot;localhost:9092&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.ACKS_CONFIG, </span><span style="color:#032F62;">&quot;all&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// ack 级别 all</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.RETRIES_CONFIG, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 重试次数</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.LINGER_MS_CONFIG, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 等待时间</span></span>
<span class="line"><span style="color:#6A737D;">// 消息 k-v 序列化器</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, </span><span style="color:#032F62;">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, </span><span style="color:#032F62;">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Producer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; producer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaProducer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ProducerRecord&lt;&gt;(</span><span style="color:#032F62;">&quot;test-topic&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;test-key&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;test-value&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span></code></pre></div><br><h5 id="带回调函数生产者" tabindex="-1">带回调函数生产者 <a class="header-anchor" href="#带回调函数生产者" aria-label="Permalink to &quot;带回调函数生产者&quot;">​</a></h5><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 消费者配置列表 https://kafka.apache.org/documentation.html#consumerconfigs</span></span>
<span class="line"><span style="color:#E1E4E8;">Properties props </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Properties</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// set props 设置生产者配置</span></span>
<span class="line"><span style="color:#E1E4E8;">Producer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; producer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaProducer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> ProducerRecord&lt;&gt;(</span><span style="color:#9ECBFF;">&quot;test-cb-topic&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;test-key-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;callback-test-value-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i), </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Callback</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 回调函数，在 Producer 收到 ack 时调用</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onCompletion</span><span style="color:#E1E4E8;">(RecordMetadata </span><span style="color:#FFAB70;">metadata</span><span style="color:#E1E4E8;">, Exception </span><span style="color:#FFAB70;">exception</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> exception) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(metadata.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            exception.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 消费者配置列表 https://kafka.apache.org/documentation.html#consumerconfigs</span></span>
<span class="line"><span style="color:#24292E;">Properties props </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Properties</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// set props 设置生产者配置</span></span>
<span class="line"><span style="color:#24292E;">Producer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; producer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaProducer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ProducerRecord&lt;&gt;(</span><span style="color:#032F62;">&quot;test-cb-topic&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;test-key-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;callback-test-value-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i), </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Callback</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 回调函数，在 Producer 收到 ack 时调用</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onCompletion</span><span style="color:#24292E;">(RecordMetadata </span><span style="color:#E36209;">metadata</span><span style="color:#24292E;">, Exception </span><span style="color:#E36209;">exception</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> exception) {</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(metadata.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            exception.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span></code></pre></div><br><h5 id="自定义分区生产者" tabindex="-1">自定义分区生产者 <a class="header-anchor" href="#自定义分区生产者" aria-label="Permalink to &quot;自定义分区生产者&quot;">​</a></h5><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 具体内容填写可参考默认分区器 DefaultPartitioner</span></span>
<span class="line"><span style="color:#6A737D;">// 生产者配置中注册 props.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, MyPartitioner.class);</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyPartitioner</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Partitioner</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">partition</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">topic</span><span style="color:#E1E4E8;">, Object </span><span style="color:#FFAB70;">key</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">keyBytes</span><span style="color:#E1E4E8;">, Object </span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">valueBytes</span><span style="color:#E1E4E8;">, Cluster </span><span style="color:#FFAB70;">cluster</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 返回结果就是自定义分区数</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">configure</span><span style="color:#E1E4E8;">(Map&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#FFAB70;">configs</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 具体内容填写可参考默认分区器 DefaultPartitioner</span></span>
<span class="line"><span style="color:#6A737D;">// 生产者配置中注册 props.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, MyPartitioner.class);</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyPartitioner</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Partitioner</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">partition</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">topic</span><span style="color:#24292E;">, Object </span><span style="color:#E36209;">key</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">keyBytes</span><span style="color:#24292E;">, Object </span><span style="color:#E36209;">value</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">valueBytes</span><span style="color:#24292E;">, Cluster </span><span style="color:#E36209;">cluster</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// 返回结果就是自定义分区数</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">configure</span><span style="color:#24292E;">(Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">?</span><span style="color:#24292E;">&gt; </span><span style="color:#E36209;">configs</span><span style="color:#24292E;">) {}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h4 id="同步生产者" tabindex="-1">同步生产者 <a class="header-anchor" href="#同步生产者" aria-label="Permalink to &quot;同步生产者&quot;">​</a></h4><blockquote><p>消息发送之后，会阻塞当前线程，直至返回 ack。由于 send 方法返回的是一个 Future 对象，根据 Futrue 对象的特点，也可以实现同步发送的效果，只需再调用 Future 对象的 get 方法即可</p></blockquote><br><h4 id="生产拦截器" tabindex="-1">生产拦截器 <a class="header-anchor" href="#生产拦截器" aria-label="Permalink to &quot;生产拦截器&quot;">​</a></h4><blockquote><p>生产者拦截器主要用于实现客户端的定制化控制逻辑</p></blockquote><p>生产拦截器能在消息发送前，以及生产者回调逻辑执行前，能对消息做一些定制化需求。比如修改消息内容、校验消息等。生产者允许指定多个拦截器，拦截器可以按序作用于同一条消息从而形成一个拦截链（<em>Interceptor Chain</em>）。</p><p>Intercetpor 的实现接口是 <code>ProducerInterceptor</code>，其定义的方法包括</p><ul><li>configure() 获取配置信息和初始化数据</li><li>onSend(ProducerRecord) 该方法由 KafkaProducer#send 进行调用，运行在用户主线程中。 生产者确保<strong>在消息被序列化以及计算分区前</strong>调用该方法。用户可以在该方法中对消息做任何操作，但最好不要修改消息所属的 Topic 和分区，否则会影响目标分区的计算</li><li>onAcknowledgement(RecordMetadata, Exception) 方法会在消息从 RecordAccumulator 成功发送到 Broker 后在发送过程中失败时调用。并且通常都是在生产者回调逻辑触发之前。onAcknowledgement 运行在生产者的 IO 线程中，不要在该方法中添加复杂的业务处理逻辑，否则会拖慢生产者的消息发送效率</li><li>close 方法关闭拦截器，主要用于执行<strong>资源清理</strong>工作</li></ul><p>生产拦截器可能被运行在多个线程中，因此在具体实现时需要确保线程安全。若指定了多个拦截器，生产者将按照指定顺序调用。</p><blockquote><p><em>注意：生产者仅捕获每个拦截器可能抛出的异常并记录到错误日志中，不会向上传递。</em></p></blockquote><br><h3 id="消费者" tabindex="-1">消费者 <a class="header-anchor" href="#消费者" aria-label="Permalink to &quot;消费者&quot;">​</a></h3><h4 id="普通消费者" tabindex="-1">普通消费者 <a class="header-anchor" href="#普通消费者" aria-label="Permalink to &quot;普通消费者&quot;">​</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Properties props </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Properties</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;bootstrap.servers&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;127.0.0.1:9092&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;group.id&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;aaa&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 自动提交 offset 功能</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;auto.commit.interval.ms&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;1000&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 自动提交 offset 时间间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;key.deserializer&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;value.deserializer&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">KafkaConsumer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 设置订阅的 topic</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">(Arrays.</span><span style="color:#B392F0;">asList</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;test-topic&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    ConsumerRecords&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; records </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">poll</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (ConsumerRecord&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; record </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// do something with record</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Properties props </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Properties</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;bootstrap.servers&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;127.0.0.1:9092&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;group.id&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;aaa&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;enable.auto.commit&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;true&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 自动提交 offset 功能</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;auto.commit.interval.ms&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;1000&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 自动提交 offset 时间间隔</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;key.deserializer&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;value.deserializer&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">KafkaConsumer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 设置订阅的 topic</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">(Arrays.</span><span style="color:#6F42C1;">asList</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;test-topic&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    ConsumerRecords&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; records </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">poll</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (ConsumerRecord&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; record </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> records) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// do something with record</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h4 id="offset-提交" tabindex="-1">Offset 提交 <a class="header-anchor" href="#offset-提交" aria-label="Permalink to &quot;Offset 提交&quot;">​</a></h4><blockquote><p>消费者消费数据时的可靠性是很容易保证的，因为在 Kafka 中数据是持久化保存的，不用担心数据丢失.</p></blockquote><p>因为消费者在消费过程中可能会出现故障，恢复后需要从故障前的位置的继续消费，所以消费者需要实时记录自己的消费 Offset，以便恢复后继续消费。Offset 的维护是消费者必须考虑的问题。</p><br><h5 id="自动提交-offset" tabindex="-1">自动提交 Offset <a class="header-anchor" href="#自动提交-offset" aria-label="Permalink to &quot;自动提交 Offset&quot;">​</a></h5><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 自动重置 Offset</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> String AUTO_OFFSET_RESET_CONFIG </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;auto.offset.reset&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">Properties props </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Properties</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, </span><span style="color:#9ECBFF;">&quot;earliest&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;group.id&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;abcd&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">KafkaConsumer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaConsumer&lt;&gt;(props);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 自动重置 Offset</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> String AUTO_OFFSET_RESET_CONFIG </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;auto.offset.reset&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">Properties props </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Properties</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, </span><span style="color:#032F62;">&quot;earliest&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;group.id&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;abcd&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">KafkaConsumer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaConsumer&lt;&gt;(props);</span></span></code></pre></div><br><h5 id="手动提交-offset" tabindex="-1">手动提交 Offset <a class="header-anchor" href="#手动提交-offset" aria-label="Permalink to &quot;手动提交 Offset&quot;">​</a></h5><blockquote><p>自动提交 Offset 是基于时间提交，难以把握 Offset 提交的时机。因此 Kafka 还提供了手动提交 Offset 的方法。</p></blockquote><p><strong>手动提交 Offset 的方法有两种</strong></p><ol><li>commitSync，同步提交</li><li>commitAsync，异步提交</li></ol><p>两者的<strong>相同点</strong>是，都会将本次 poll 的一批数据最高的 Offset 提交</p><p><strong>不同点</strong>是，commitSync 会阻塞当前线程，直到提交成功，并且会自动失败重试；而 commitAsync 没有失败重试机制，有可能提交 Offset 失败。</p><br><p><strong>同步提交 Offset</strong></p><blockquote><p>同步提交 Offset 有失败重试机制，更加可靠。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">//关闭自动提交 offset</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">KafkaConsumer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">(Arrays.</span><span style="color:#B392F0;">asList</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;first-topic&quot;</span><span style="color:#E1E4E8;">)); </span><span style="color:#6A737D;">//消费者订阅主题</span></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  ConsumerRecords&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; records </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">    consumer.</span><span style="color:#B392F0;">poll</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (ConsumerRecord&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; record </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    	</span><span style="color:#6A737D;">// handle message record</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 同步提交，当前线程会阻塞直到 offset 提交成功</span></span>
<span class="line"><span style="color:#E1E4E8;">  consumer.</span><span style="color:#B392F0;">commitSync</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;enable.auto.commit&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">//关闭自动提交 offset</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">KafkaConsumer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">(Arrays.</span><span style="color:#6F42C1;">asList</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;first-topic&quot;</span><span style="color:#24292E;">)); </span><span style="color:#6A737D;">//消费者订阅主题</span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#24292E;">  ConsumerRecords&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; records </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">    consumer.</span><span style="color:#6F42C1;">poll</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (ConsumerRecord&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; record </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> records) {</span></span>
<span class="line"><span style="color:#24292E;">    	</span><span style="color:#6A737D;">// handle message record</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 同步提交，当前线程会阻塞直到 offset 提交成功</span></span>
<span class="line"><span style="color:#24292E;">  consumer.</span><span style="color:#6F42C1;">commitSync</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><p><strong>异步提交 Offset</strong></p><blockquote><p>虽然同步提交 Offset 更可靠，但是会阻塞当前线程，吞吐量会受到很大的影响。更多情况下，会选用异步提交 Offset 的方式。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 关闭自动提交 offset</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">KafkaConsumer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">(Arrays.</span><span style="color:#B392F0;">asList</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;first-topic&quot;</span><span style="color:#E1E4E8;">)); </span><span style="color:#6A737D;">// 消费者订阅主题</span></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  ConsumerRecords&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; records </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">poll</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (ConsumerRecord&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; record </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    	</span><span style="color:#6A737D;">// handle message record</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 异步提交</span></span>
<span class="line"><span style="color:#E1E4E8;">  consumer.</span><span style="color:#B392F0;">commitAsync</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">OffsetCommitCallback</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onComplete</span><span style="color:#E1E4E8;">(Map&lt;</span><span style="color:#F97583;">TopicPartition</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">OffsetAndMetadata</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#FFAB70;">offsets</span><span style="color:#E1E4E8;">, Exception </span><span style="color:#FFAB70;">exception</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (exception </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.err.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Commit failed for&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> offsets);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;enable.auto.commit&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 关闭自动提交 offset</span></span>
<span class="line"><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">KafkaConsumer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">(Arrays.</span><span style="color:#6F42C1;">asList</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;first-topic&quot;</span><span style="color:#24292E;">)); </span><span style="color:#6A737D;">// 消费者订阅主题</span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  ConsumerRecords&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; records </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">poll</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (ConsumerRecord&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; record </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> records) {</span></span>
<span class="line"><span style="color:#24292E;">    	</span><span style="color:#6A737D;">// handle message record</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 异步提交</span></span>
<span class="line"><span style="color:#24292E;">  consumer.</span><span style="color:#6F42C1;">commitAsync</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">OffsetCommitCallback</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onComplete</span><span style="color:#24292E;">(Map&lt;</span><span style="color:#D73A49;">TopicPartition</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">OffsetAndMetadata</span><span style="color:#24292E;">&gt; </span><span style="color:#E36209;">offsets</span><span style="color:#24292E;">, Exception </span><span style="color:#E36209;">exception</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (exception </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.err.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Commit failed for&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> offsets);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h4 id="offset-存储" tabindex="-1">Offset 存储 <a class="header-anchor" href="#offset-存储" aria-label="Permalink to &quot;Offset 存储&quot;">​</a></h4><p>Kafka 默认将 Offset 存储在 Kafka 的一个内置的 Topic 中。Kafka 还可以选择自定义存储 Offset。Offset 的维护是相当繁琐的，因为需要考虑到消费者的再平衡（Rebalace）。</p><p>当有新的消费者加入消费者组、已有的消费者退出消费者组或订阅主题的分区发生变化，就会触发分区的重新分配，重新分配的过程叫做 Rebalance。</p><p>消费者发生 Rebalance 之后，每个消费者消费的分区就会发生变化。因此消费者首先要获取到自己被重新分配到的分区，并且定位到每个分区最近提交的 Offset 位置继续消费。要实现自定义存储 Offset，需要借助 ConsumerRebalanceListener。</p><p>以下为示例代码，其中提交和获取 Offset 的方法，需要根据所选的 Offset 存储系统自行实现(可存入数据库)。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CustomSaveOffset</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> Map&lt;</span><span style="color:#F97583;">TopicPartition</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">Long</span><span style="color:#E1E4E8;">&gt; currentOffset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">		Properties props </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Properties</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">		props.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 关闭自动提交 offset</span></span>
<span class="line"><span style="color:#E1E4E8;">		KafkaConsumer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span></span>
<span class="line"><span style="color:#E1E4E8;">		consumer.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">(Arrays.</span><span style="color:#B392F0;">asList</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;first&quot;</span><span style="color:#E1E4E8;">), </span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#6A737D;">//&lt;-------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ConsumerRebalanceListener</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#6A737D;">// 在 Rebalance 之前调用</span></span>
<span class="line"><span style="color:#E1E4E8;">			@</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onPartitionsRevoked</span><span style="color:#E1E4E8;">(Collection&lt;</span><span style="color:#F97583;">TopicPartition</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#FFAB70;">partitions</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">commitOffset</span><span style="color:#E1E4E8;">(currentOffset);</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#6A737D;">// 在 Rebalance 之后调用</span></span>
<span class="line"><span style="color:#E1E4E8;">			@</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onPartitionsAssigned</span><span style="color:#E1E4E8;">(Collection&lt;</span><span style="color:#F97583;">TopicPartition</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#FFAB70;">partitions</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">				currentOffset.</span><span style="color:#B392F0;">clear</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (TopicPartition partition </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> partitions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">					consumer.</span><span style="color:#B392F0;">seek</span><span style="color:#E1E4E8;">(partition, </span><span style="color:#B392F0;">getOffset</span><span style="color:#E1E4E8;">(partition));</span><span style="color:#6A737D;">// 定位到最近提交的 offset 位置继续消费</span></span>
<span class="line"><span style="color:#E1E4E8;">				}</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">		});</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">			ConsumerRecords&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; records </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">poll</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">);</span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (ConsumerRecord&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; record </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="color:#E1E4E8;">				System.out.</span><span style="color:#B392F0;">printf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;offset = %d, key = %s, value = %s%n&quot;</span><span style="color:#E1E4E8;">, record.</span><span style="color:#B392F0;">offset</span><span style="color:#E1E4E8;">(), record.</span><span style="color:#B392F0;">key</span><span style="color:#E1E4E8;">(), record.</span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">				currentOffset.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TopicPartition</span><span style="color:#E1E4E8;">(record.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(), record.</span><span style="color:#B392F0;">partition</span><span style="color:#E1E4E8;">()), record.</span><span style="color:#B392F0;">offset</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">commitOffset</span><span style="color:#E1E4E8;">(currentOffset);</span><span style="color:#6A737D;">// 异步提交</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// 获取某分区的最新 offset</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getOffset</span><span style="color:#E1E4E8;">(TopicPartition </span><span style="color:#FFAB70;">partition</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// 提交该消费者所有分区的 offset</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">commitOffset</span><span style="color:#E1E4E8;">(Map&lt;</span><span style="color:#F97583;">TopicPartition</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">Long</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#FFAB70;">currentOffset</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CustomSaveOffset</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Map&lt;</span><span style="color:#D73A49;">TopicPartition</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Long</span><span style="color:#24292E;">&gt; currentOffset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> HashMap&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">		Properties props </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Properties</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">		props.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;enable.auto.commit&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 关闭自动提交 offset</span></span>
<span class="line"><span style="color:#24292E;">		KafkaConsumer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> KafkaConsumer&lt;&gt;(props);</span></span>
<span class="line"><span style="color:#24292E;">		</span></span>
<span class="line"><span style="color:#24292E;">		consumer.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">(Arrays.</span><span style="color:#6F42C1;">asList</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;first&quot;</span><span style="color:#24292E;">), </span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6A737D;">//&lt;-------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ConsumerRebalanceListener</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6A737D;">// 在 Rebalance 之前调用</span></span>
<span class="line"><span style="color:#24292E;">			@</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onPartitionsRevoked</span><span style="color:#24292E;">(Collection&lt;</span><span style="color:#D73A49;">TopicPartition</span><span style="color:#24292E;">&gt; </span><span style="color:#E36209;">partitions</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">commitOffset</span><span style="color:#24292E;">(currentOffset);</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6A737D;">// 在 Rebalance 之后调用</span></span>
<span class="line"><span style="color:#24292E;">			@</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onPartitionsAssigned</span><span style="color:#24292E;">(Collection&lt;</span><span style="color:#D73A49;">TopicPartition</span><span style="color:#24292E;">&gt; </span><span style="color:#E36209;">partitions</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">				currentOffset.</span><span style="color:#6F42C1;">clear</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (TopicPartition partition </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> partitions) {</span></span>
<span class="line"><span style="color:#24292E;">					consumer.</span><span style="color:#6F42C1;">seek</span><span style="color:#24292E;">(partition, </span><span style="color:#6F42C1;">getOffset</span><span style="color:#24292E;">(partition));</span><span style="color:#6A737D;">// 定位到最近提交的 offset 位置继续消费</span></span>
<span class="line"><span style="color:#24292E;">				}</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">		});</span></span>
<span class="line"><span style="color:#24292E;">		</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">			ConsumerRecords&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; records </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">poll</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">);</span><span style="color:#6A737D;">// 消费者拉取数据</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (ConsumerRecord&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; record </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> records) {</span></span>
<span class="line"><span style="color:#24292E;">				System.out.</span><span style="color:#6F42C1;">printf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;offset = %d, key = %s, value = %s%n&quot;</span><span style="color:#24292E;">, record.</span><span style="color:#6F42C1;">offset</span><span style="color:#24292E;">(), record.</span><span style="color:#6F42C1;">key</span><span style="color:#24292E;">(), record.</span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">				currentOffset.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TopicPartition</span><span style="color:#24292E;">(record.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(), record.</span><span style="color:#6F42C1;">partition</span><span style="color:#24292E;">()), record.</span><span style="color:#6F42C1;">offset</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">commitOffset</span><span style="color:#24292E;">(currentOffset);</span><span style="color:#6A737D;">// 异步提交</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// 获取某分区的最新 offset</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getOffset</span><span style="color:#24292E;">(TopicPartition </span><span style="color:#E36209;">partition</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// 提交该消费者所有分区的 offset</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">commitOffset</span><span style="color:#24292E;">(Map&lt;</span><span style="color:#D73A49;">TopicPartition</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Long</span><span style="color:#24292E;">&gt; </span><span style="color:#E36209;">currentOffset</span><span style="color:#24292E;">) {}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h4 id="遗漏消费和重复消费" tabindex="-1">遗漏消费和重复消费 <a class="header-anchor" href="#遗漏消费和重复消费" aria-label="Permalink to &quot;遗漏消费和重复消费&quot;">​</a></h4><p>无论是同步提交还是异步提交 Offset，都有可能会造成数据的漏消费或者重复消费</p><ul><li>先提交 Offset 后消费，有可能造成数据的漏消费</li><li>先消费后提交 Offset，有可能会造成数据的重复消费</li></ul><br><h2 id="springboot-集成" tabindex="-1">SpringBoot 集成 <a class="header-anchor" href="#springboot-集成" aria-label="Permalink to &quot;SpringBoot 集成&quot;">​</a></h2><p><strong>依赖</strong></p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;org.springframework.kafka&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;spring-kafka&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.kafka&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-kafka&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p><strong>生产者配置</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kafka</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">producer</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">client-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">boot-kafka-producer</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">bootstrap-servers</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># key-serializer: 默认使用 StringSerializer.class</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># value-serializer: 默认使用 StringSerializer.class</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">acks</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">-1</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">retries</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kafka</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">producer</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">client-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">boot-kafka-producer</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">bootstrap-servers</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># key-serializer: 默认使用 StringSerializer.class</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># value-serializer: 默认使用 StringSerializer.class</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">acks</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">-1</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">retries</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span></code></pre></div><p><strong>消费者配置</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kafka</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">consumer</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">group-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;group-test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">bootstrap-servers</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localhost:9092</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">client-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">boot-kafka-consumer</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">auto-offset-reset</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">earliest</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">auto-commit-interval</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">enable-auto-commit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># key-deserializer: 默认 StringDeserializer.class;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># value-deserializer:</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kafka</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">consumer</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">group-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;group-test&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">bootstrap-servers</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost:9092</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">client-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">boot-kafka-consumer</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">auto-offset-reset</span><span style="color:#24292E;">: </span><span style="color:#032F62;">earliest</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">auto-commit-interval</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">enable-auto-commit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># key-deserializer: 默认 StringDeserializer.class;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># value-deserializer:</span></span></code></pre></div><p><strong>生产者实现</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SpringBootApplication</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">RestController</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">KafkaProducerMain</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        SpringApplication.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(KafkaProducerMain.class, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Autowired</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> KafkaTemplate&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">Object</span><span style="color:#E1E4E8;">&gt; kafka;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">GetMapping</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/send/{data}&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> String </span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(@</span><span style="color:#F97583;">PathVariable</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">) String </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        kafka.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;topic-test&quot;</span><span style="color:#E1E4E8;">, data);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;send &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> data </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot; success&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SpringBootApplication</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RestController</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">KafkaProducerMain</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        SpringApplication.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(KafkaProducerMain.class, args);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> KafkaTemplate&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">&gt; kafka;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/send/{data}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">PathVariable</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">) String </span><span style="color:#E36209;">data</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        kafka.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;topic-test&quot;</span><span style="color:#24292E;">, data);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;send &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> data </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot; success&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>消费者实现</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SpringBootApplication</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">KafkaConsumerMain</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        SpringApplication.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(KafkaConsumerMain.class, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">KafkaListener</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">topics</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;topic-test&quot;</span><span style="color:#E1E4E8;">}, </span><span style="color:#79B8FF;">groupId</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;group-test&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">message</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[received] &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> message);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SpringBootApplication</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">KafkaConsumerMain</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        SpringApplication.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(KafkaConsumerMain.class, args);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">KafkaListener</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">topics</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;topic-test&quot;</span><span style="color:#24292E;">}, </span><span style="color:#005CC5;">groupId</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;group-test&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">message</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[received] &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> message);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h2 id="图形界面" tabindex="-1">图形界面 <a class="header-anchor" href="#图形界面" aria-label="Permalink to &quot;图形界面&quot;">​</a></h2><blockquote><p>Kafka Eagle 略</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">docker pull nickzurich/kafka-eagle:latest</span></span>
<span class="line"><span style="color:#e1e4e8;">docker run --name eagle -p 8048:8048 -e EFAK_CLUSTER_ZK_LIST=localhost:2181 -d nickzurich/kafka-eagle:latest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">docker pull nickzurich/kafka-eagle:latest</span></span>
<span class="line"><span style="color:#24292e;">docker run --name eagle -p 8048:8048 -e EFAK_CLUSTER_ZK_LIST=localhost:2181 -d nickzurich/kafka-eagle:latest</span></span></code></pre></div><br><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><p><a href="https://my.oschina.net/jallenkwong/blog/4449224" target="_blank" rel="noreferrer">Kafka学习笔记</a></p><p><a href="https://mp.weixin.qq.com/s/QIK1N-ePm6DQE4tMQ9N3Gw" target="_blank" rel="noreferrer">Kafka为什么吞吐量大、速度快？</a></p><p><a href="https://cloud.tencent.com/developer/article/1804041" target="_blank" rel="noreferrer">Kafka 提供哪些日志清理策略？</a></p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>上次更新: <time datetime="2023-11-06T09:18:33.000Z" data-v-7e05ebdb></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><!--[--><!--]--><div id="giscus-comment" class="comment" data-pagefind-ignore="all" data-v-af5a5a9a data-v-3db7ae48><div class="el-affix comment-btn" style="height:;width:;" data-v-3db7ae48><div class="" style=""><!--[--><button ariadisabled="false" type="button" class="el-button el-button--primary is-plain" style="" data-v-3db7ae48><i class="el-icon" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M736 504a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zM128 128v640h192v160l224-160h352V128H128z"></path></svg><!--]--></i><span class=""><!--[--> 评论 <!--]--></span></button><!--]--></div></div><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"a44f9f69\",\"posts_be_java_java lang_java lang.md\":\"22efd43e\",\"posts_algorithm_常见算法.md\":\"cb736894\",\"about.md\":\"36b6fce9\",\"posts_algorithm_位运算.md\":\"0d86b2dc\",\"posts_article_文章整理.md\":\"dc32b219\",\"posts_be_dubbo_dubbo.md\":\"54d58d63\",\"posts_be_jvm_jvm.md\":\"137ae100\",\"posts_be_java_java io_java io.md\":\"2eaeb3c8\",\"posts_be_java_java juc_java juc.md\":\"706ca2c9\",\"posts_be_java_java 基础_java 基础.md\":\"2c38aac0\",\"posts_be_java_java 线程池_java 线程池.md\":\"879c1ea3\",\"posts_be_java_java 进阶_java 进阶.md\":\"f3b1ca14\",\"posts_be_java_walkthroughjava.md\":\"671746de\",\"posts_be_java_java 多线程_java 多线程.md\":\"03bce840\",\"posts_be_java_java 反射_范型_java.md\":\"fdcef675\",\"posts_be_java_java 集合_java 集合.md\":\"ad9ad223\",\"posts_be_maven_maven.md\":\"644d3975\",\"posts_be_mybitis_mybatis.md\":\"a151f219\",\"posts_be_spring_ioc_事务_ioc_事务.md\":\"d8006616\",\"posts_be_mybitis_mybatis-plus-generator.md\":\"d4859293\",\"posts_be_spring_spring.md\":\"ddfaf286\",\"posts_be_springcloud_index.md\":\"801a1da1\",\"posts_be_springboot_thinkinspringboot_index.md\":\"3abed1fa\",\"posts_be_spring_ioc_di_ioc_di.md\":\"a20e9766\",\"posts_be_springsecurity_springsecurity.md\":\"485f583e\",\"posts_be_springboot_springboot_springboot.md\":\"68ef93c1\",\"posts_db_clickhouse_clickhouse.md\":\"4abcf063\",\"posts_be_springweb_springmvc_springmvc.md\":\"3a8724ec\",\"posts_db_mysql_mysql.md\":\"491ee135\",\"posts_db_mysql_thinkinmysql.md\":\"03972f1c\",\"posts_devops_docker_docker.md\":\"41dbe1f2\",\"posts_devops_kubernetes_k8s.md\":\"c5184f72\",\"posts_db_redis_redis 配置详解.md\":\"559e08b6\",\"posts_db_timescaledb_timescaledb.md\":\"c0096337\",\"posts_devops_grafana_grafana.md\":\"72f7e547\",\"posts_db_redis_redis 数据类型.md\":\"96411a8e\",\"posts_devops_nginx_nginx.md\":\"2e016a84\",\"posts_fe_node.js_node.js.md\":\"63b91152\",\"posts_fe_react_react typescript.md\":\"bd6e2a75\",\"posts_fe_css_css.md\":\"f6ad44e3\",\"posts_fe_nextjs_next.js.md\":\"91daecde\",\"posts_db_postgresql_postgresql.md\":\"5b98d31f\",\"posts_linux_安装配置_manjora 安装配置.md\":\"e394ae39\",\"posts_linux_安装配置_ubuntu 安装配置.md\":\"e96cc7c0\",\"posts_mw_activemq_index.md\":\"ba3e51ac\",\"posts_math_math.md\":\"7a85ef1b\",\"posts_linux_安装配置_centos 配置.md\":\"5527f59a\",\"posts_linux_linux.md\":\"03e3cf7b\",\"posts_db_redis_redis.md\":\"7c3ed40b\",\"posts_mw_elasticsearch_elasticsearch.md\":\"235f63dc\",\"posts_fe_react_react.md\":\"0419a072\",\"posts_fe_typescript_typescript.md\":\"e317ab4e\",\"posts_mw_rocketmq_rocketmq source_rocketmq source.md\":\"7b37261c\",\"posts_设计模式_设计模式.md\":\"881ba8de\",\"posts_fe_项目配置.md\":\"4feee680\",\"posts_fe_vuejs_vuejs.md\":\"42818bf6\",\"posts_mw_rocketmq_rocketmq model_rocketmq model.md\":\"35536e89\",\"posts_devops_kubernetes_kubernetes.md\":\"77d96964\",\"posts_python_python.md\":\"3ec32aff\",\"posts_工具_ffmpeg.md\":\"44627ec5\",\"posts_devops_gitlab_gitlab.md\":\"a334ce4a\",\"posts_计算机网络_计算机网络.md\":\"fc0f76e5\",\"posts_math_latex.md\":\"91e5b39b\",\"posts_mw_kafka_kafkasource.md\":\"1160388c\",\"posts_数据结构_数据结构.md\":\"fb0161ff\",\"posts_mw_netty_netty.md\":\"f263104d\",\"posts_mw_kafka_kafka.md\":\"9363d797\",\"posts_mw_rocketmq_rocketmq_rocketmq.md\":\"3832b133\",\"posts_fe_javascript_javascript.md\":\"ade666ee\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Gnl\",\"description\":\"Gnl's blog\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/about\",\"meta\":{\"sidebar\":false,\"title\":\"关于我\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"description\":\"\\n> gnl0ATqq.com\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/位运算\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"位运算基础以及常见用法\",\"title\":\"位运算\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/常见算法\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"常见算法思想汇总；分治、动态规划、贪心、回溯、分支界限\",\"title\":\"常见算法\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/article/文章整理\",\"meta\":{\"description\":\"文章推荐\",\"title\":\"文章整理\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/fe/项目配置\",\"meta\":{\"description\":\"前端项目配置\",\"tag\":[\"前端\"],\"title\":\"前端项目配置\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/linux/Linux\",\"meta\":{\"description\":\"Linux 笔记\",\"tag\":[\"Linux\"],\"title\":\"Linux\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/math/Latex\",\"meta\":{\"description\":\"LateX 常用语法\",\"tag\":[\"LateX\"],\"title\":\"LateX\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/math/Math\",\"meta\":{\"description\":\"基础数学函数\",\"title\":\"Math\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/python/Python\",\"meta\":{\"description\":\"Python 笔记\",\"tag\":[\"Python\"],\"title\":\"Python\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/工具/ffmpeg\",\"meta\":{\"description\":\"ffmpeg 常用命令\",\"tag\":[\"ffmpeg\"],\"title\":\"ffmpeg\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/数据结构/数据结构\",\"meta\":{\"description\":\"算法与数据结构笔记\",\"tag\":[\"算法\",\"数据结构\"],\"title\":\"算法与数据结构\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"https://img2018.cnblogs.com/blog/1648163/201909/1648163-20190919085122774-376085378.png\"}},{\"route\":\"/posts/计算机网络/计算机网络\",\"meta\":{\"description\":\"计算机网络笔记\",\"title\":\"计算机网络\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/设计模式/设计模式\",\"meta\":{\"description\":\"Java 设计模式笔记\",\"tag\":[\"设计模式\",\"Java\"],\"title\":\"设计模式\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Dubbo/Dubbo\",\"meta\":{\"description\":\"Apache Dubbo 是一款 RPC 服务开发框架，用于解决微服务架构下的服务治理与通信问题。\",\"tag\":[\"微服务\",\"Dubbo\",\"后端\"],\"title\":\"Dubbo\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/JVM/JVM\",\"meta\":{\"description\":\"JVM 详解，包括 JVM 体系结构、垃圾回收算法等\",\"tag\":[\"Java\",\"JVM\",\"后端\"],\"title\":\"JVM\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/WalkThroughJava\",\"meta\":{\"title\":\"Walk Though Java\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"description\":\" 多线程\\n 多线程异常处理方案\\n在使用 try-catch 的时候有一个条件通常会被忽略：try-catch 只能处理当前线程抛出的异常，在多线程情况下是无法 catch 到其他线程抛出的异常的。\\n看\",\"cover\":\"\"}},{\"route\":\"/posts/be/Maven/Maven\",\"meta\":{\"description\":\"Maven 笔记\",\"tag\":[\"后端\"],\"title\":\"Maven\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/MyBatis\",\"meta\":{\"description\":\"MyBatis 详解\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"MyBatis\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/mybatis-plus-generator\",\"meta\":{\"description\":\"MyBatis 代码生成器\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"mybatis-plus-generator\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/Spring\",\"meta\":{\"description\":\"Spring 框架详解\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringCloud/index\",\"meta\":{\"description\":\"SpringCloud 详解\",\"tag\":[\"SpringCloud\",\"后端\",\"微服务\"],\"title\":\"SpringCloud\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringSecurity/SpringSecurity\",\"meta\":{\"description\":\"SpringSecurity 笔记\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring Security\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/ClickHouse/ClickHouse\",\"meta\":{\"description\":\"ClickHouse 笔记\",\"tag\":[\"数据库\"],\"title\":\"ClickHouse\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/MySQL\",\"meta\":{\"description\":\"MySQL 详解\",\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"MySQL\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/ThinkInMySQL\",\"meta\":{\"description\":\"在使用 MySQL 的过程中的一些思考\",\"sticky\":true,\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"Think In MySQL\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PostgreSQL\",\"meta\":{\"description\":\"PostgreSQL 详解，包含基础内容、高可用架构等\",\"top\":1,\"sticky\":true,\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PostgreSQL\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 数据类型\",\"meta\":{\"description\":\"Redis 数据类型详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 数据类型\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 配置详解\",\"meta\":{\"description\":\"Redis 配置详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 配置详解\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis\",\"meta\":{\"description\":\"Redis 详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/db/TimescaleDB/TimescaleDB\",\"meta\":{\"description\":\"TimescaleDB 详解\",\"top\":5,\"sticky\":true,\"tag\":[\"TimescaleDB\",\"时序数据库\",\"数据库\"],\"title\":\"TimescaleDB\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Docker/Docker\",\"meta\":{\"description\":\"Docker 详解\",\"tag\":[\"Docker\",\"DevOps\"],\"title\":\"Docker\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/devops/GitLab/GitLab\",\"meta\":{\"description\":\"GitLab 私服搭建\",\"top\":3,\"tag\":[\"GitLab\"],\"title\":\"GitLab\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Grafana/Grafana\",\"meta\":{\"description\":\"Grafana 监控搭建\",\"top\":2,\"tag\":[\"Grafana\",\"DevOps\"],\"title\":\"Grafana\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/K8S\",\"meta\":{\"title\":\"Kubernetes\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"description\":\" 虚拟化容器\\n Docker\\nDocker 与传统虚拟化方式的不同之处：Docker 容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，没有进行硬件虚拟；而传统虚拟机技术是虚拟出一套硬件后，\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/Kubernetes\",\"meta\":{\"description\":\"K8s 详解\",\"top\":4,\"sticky\":true,\"tag\":[\"K8s\",\"DevOps\"],\"title\":\"K8s\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg\"}},{\"route\":\"/posts/devops/Nginx/Nginx\",\"meta\":{\"description\":\"Nginx 详解\",\"tag\":[\"Nginx\"],\"title\":\"Nginx\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/CSS/CSS\",\"meta\":{\"description\":\"CSS 详解\",\"tag\":[\"前端\"],\"title\":\"CSS\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/JavaScript/JavaScript\",\"meta\":{\"description\":\"JavaScript 详解\",\"outline\":[2,3],\"tag\":[\"JavaScript\",\"前端\"],\"title\":\"JavaScript\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Nextjs/Next.js\",\"meta\":{\"description\":\"Next.js 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"Next.js\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Node.js/Node.js\",\"meta\":{\"description\":\"Node.js 笔记\",\"tag\":[\"前端\"],\"title\":\"Node.js\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React TypeScript\",\"meta\":{\"description\":\"React + TypeScript 笔记\",\"tag\":[\"React\",\"TypeScript\",\"前端\"],\"title\":\"React + TypeScript\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React\",\"meta\":{\"description\":\"React 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"React\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/TypeScript/TypeScript\",\"meta\":{\"description\":\"TypeScript 笔记\",\"tag\":[\"TypeScript\",\"前端\"],\"title\":\"TypeScript\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Vuejs/Vuejs\",\"meta\":{\"description\":\"Vue.js 笔记\",\"tag\":[\"Vue.js\",\"前端\"],\"title\":\"Vue.js\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/CentOS 配置\",\"meta\":{\"description\":\"CentOS 笔记\",\"tag\":[\"Linux\"],\"title\":\"CentOS 笔记\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Manjora 安装配置\",\"meta\":{\"description\":\"Manjora 笔记\",\"tag\":[\"Linux\"],\"title\":\"Manjora 安装\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Ubuntu 安装配置\",\"meta\":{\"description\":\"Ubuntu 安装\",\"tag\":[\"Linux\"],\"title\":\"Ubuntu 安装\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/ActiveMQ/index\",\"meta\":{\"description\":\"ActiveMQ 详解\",\"tag\":[\"MQ\",\"中间件\"],\"title\":\"ActiveMQ\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Elasticsearch/Elasticsearch\",\"meta\":{\"description\":\"Elasticsearch 详解\",\"outline\":[2,3],\"tag\":[\"Elasticsearch\",\"中间件\"],\"title\":\"Elasticsearch\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/Kafka\",\"meta\":{\"description\":\"Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/KafkaSource\",\"meta\":{\"description\":\"Kafka 源码深入\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka Source\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Netty/Netty\",\"meta\":{\"description\":\"基于 Java NIO 封装的网络框架\",\"tag\":[\"Netty\"],\"title\":\"Netty\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java IO/Java IO\",\"meta\":{\"description\":\"Java 中的 IO 操作，包括 BIO 和 NIO\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java IO\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java JUC/Java JUC\",\"meta\":{\"description\":\"JUC 指的是 `java.util.concurrent` 包及其子包下用于并发场景的类\",\"tag\":[\"Java\",\"后端\"],\"title\":\"JUC\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java lang/Java lang\",\"meta\":{\"title\":\"Java lang\",\"date\":\"2023-11-06 09:18:33\",\"tag\":[],\"description\":\"\\n Runtime\\n每一个 Java 程序都有一个单实例的 Runtime 对象，它允许正在运行的 Java 程序能够获取到运行环境信息。\\n一些常用的方法如下：\\n* `getRuntime()`\\n* \",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 反射+范型/Java\",\"meta\":{\"description\":\"Java 反射和泛型详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 反射和泛型\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 基础/Java 基础\",\"meta\":{\"description\":\"Java 基础内容\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 基础内容\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 多线程/Java 多线程\",\"meta\":{\"description\":\"Java 多线程详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 多线程\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 线程池/Java 线程池\",\"meta\":{\"description\":\"线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 线程池\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 进阶/Java 进阶\",\"meta\":{\"description\":\"Java 进阶内容，包括: SPI、JNDI\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 进阶\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 集合/Java 集合\",\"meta\":{\"description\":\"Java 集合部分详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 集合\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&DI/IOC&DI\",\"meta\":{\"description\":\"Spring IOC&DI\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&事务/IOC&事务\",\"meta\":{\"description\":\"Spring IOC & 事务\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/SpringBoot/SpringBoot\",\"meta\":{\"description\":\"SpringBoot 详解\",\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"SpringBoot\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/ThinkInSpringBoot/index\",\"meta\":{\"description\":\"深入 SpringBoot 源码与一点思考\",\"sticky\":true,\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"Think-in-Springboot\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringWeb/SpringMVC/SpringMVC\",\"meta\":{\"description\":\"Spring Web MVC 是建立在 Servlet API 上的 Web 框架\",\"tag\":[\"SpringMVC\",\"后端\"],\"title\":\"Spring MVC\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\",\"meta\":{\"description\":\"RocketMQ 是一个分布式的中间件服务，采用异步通信模型和发布/订阅消息传输模型。\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Model/RocketMQ Model\",\"meta\":{\"description\":\"RocketMQ 领域模型\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 领域模型\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Source/RocketMQ Source\",\"meta\":{\"description\":\"RocketMQ 源码解析\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 源码解析\",\"date\":\"2023-11-06 09:18:33\",\"cover\":\"\"}}],\"hotArticle\":{\"title\":\"Pinned\",\"nextText\":\"换一组\",\"pageSize\":5,\"empty\":\"暂无内容\"},\"recommend\":false,\"footer\":{\"copyright\":\"2023-Present | Gnl\",\"version\":false},\"themeColor\":\"el-green\",\"author\":\"Gnl\",\"comment\":{\"repo\":\"gnl00/gnl00.github.io\",\"repoId\":\"R_kgDOGR5o6w\",\"category\":\"Announcements\",\"categoryId\":\"DIC_kwDOGR5o684CatYO\"},\"mermaid\":true},\"lastUpdatedText\":\"上次更新\",\"logo\":\"/logo-transform.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"前端项目工程化\",\"link\":\"/posts/fe/项目配置\"},{\"text\":\"JavaScript\",\"link\":\"/posts/fe/JavaScript/JavaScript\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/TypeScript/TypeScript\"},{\"text\":\"React\",\"link\":\"/posts/fe/React/React\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/Vuejs/Vuejs\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"Java\",\"link\":\"/posts/be/Java/Java\"},{\"text\":\"Spring\",\"link\":\"/posts/be/Spring/Spring\"},{\"text\":\"SpringBoot\",\"link\":\"/posts/be/SpringBoot/SpringBoot\"},{\"text\":\"SpringCloud\",\"link\":\"/posts/be/SpringCloud/SpringCloud\"},{\"text\":\"Dubbo\",\"link\":\"/posts/be/Dubbo/Dubbo\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/posts/db/MySQL/MySQL\"},{\"text\":\"PostgreSQL\",\"link\":\"/posts/db/PostgreSQL/PostgreSQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/Redis/Redis\"}]},{\"text\":\"中间件\",\"items\":[{\"text\":\"Netty\",\"link\":\"/posts/mw/Netty/Netty\"},{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/Kafka/Kafka\"},{\"text\":\"Elesticsearch\",\"link\":\"/posts/mw/Elesticsearch/Elesticsearch\"}]},{\"text\":\"DevOps\",\"items\":[{\"text\":\"Docker\",\"link\":\"/posts/mw/Docker/Docker\"},{\"text\":\"Kubernetes\",\"link\":\"/posts/mw/Kubernetes/Kubernetes\"},{\"text\":\"GitLab\",\"link\":\"/posts/mw/GitLab/GitLab\"}]},{\"text\":\"关于\",\"link\":\"/about\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>