<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java 线程池 | Gnl</title>
    <meta name="description" content="线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率">
    <link rel="preload stylesheet" href="/assets/style.8602ee05.css" as="style">
    
    <script type="module" src="/assets/app.851cf235.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.b41230ea.js">
    <link rel="modulepreload" href="/assets/chunks/theme.acdb1ba8.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-a837419f.5f328ebe.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-34ebe643.90bb043d.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-9362ca72.f8843e7e.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-e232339a.ce9b7042.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-007f5bf9.ea357a08.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-bb8de4b5.ef0454e5.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-761fef4a.eee9cc7d.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-8e129bc0.d1199189.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-525ea6f2.635181ef.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-585325ee.2735ea0e.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-eaee51ba.814bc3ef.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-8025bb1f.7b164bba.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-d706aa6d.286b266d.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-ad81aaa2.906594a5.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-c61244fe.7fa4d744.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-93a053d8.6d846fdd.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-654feea8.87368d2f.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-725b2045.be37b41a.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-6075699d.9ab75cd8.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-f7375806.e4de4d66.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-5b3884e4.0732e9ce.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.ade1a5ba.js">
    <link rel="modulepreload" href="/assets/chunks/giscus-2a044aea.497f0bd4.js">
    <link rel="modulepreload" href="/assets/posts_be_Java_Java 线程池_Java 线程池.md.6c10bf73.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-af5a5a9a data-v-ae5c84bb><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-5c56a737><div class="header" data-v-5c56a737><div class="title-wrapper" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i><span class="title" data-v-5c56a737></span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg><!--]--></i></div><!----><div class="footer content" data-v-5c56a737><!--[--><!--]--></div></div><div style="display:none;" class="theme-blog-popover-close" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ae5c84bb data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-transform.png" alt data-v-8426fc1a><!--]--><!--[-->Gnl<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-a0fd61f4 style="--54fbd49d:1;" data-v-bebd53ce><div class="nav-search-btn-wait" data-v-bebd53ce><svg width="14" height="14" viewBox="0 0 20 20" data-v-bebd53ce><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bebd53ce></path></svg><span class="search-tip" data-v-bebd53ce>Search</span><span class="metaKey" data-v-bebd53ce> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.html" data-v-43f1e123><!--[-->前端项目工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/JavaScript/JavaScript.html" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/TypeScript/TypeScript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/React/React.html" data-v-43f1e123><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/Vuejs/Vuejs.html" data-v-43f1e123><!--[-->Vue.js<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Java/Java.html" data-v-43f1e123><!--[-->Java<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Spring/Spring.html" data-v-43f1e123><!--[-->Spring<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringBoot/SpringBoot.html" data-v-43f1e123><!--[-->SpringBoot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringCloud/SpringCloud.html" data-v-43f1e123><!--[-->SpringCloud<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Dubbo/Dubbo.html" data-v-43f1e123><!--[-->Dubbo<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>数据库</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/MySQL/MySQL.html" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/PostgreSQL/PostgreSQL.html" data-v-43f1e123><!--[-->PostgreSQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/Redis/Redis.html" data-v-43f1e123><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>中间件</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Netty/Netty.html" data-v-43f1e123><!--[-->Netty<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/RocketMQ/RocketMQ/RocketMQ.html" data-v-43f1e123><!--[-->RocketMQ<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kafka/Kafka.html" data-v-43f1e123><!--[-->Kafka<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Elesticsearch/Elesticsearch.html" data-v-43f1e123><!--[-->Elesticsearch<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>DevOps</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Docker/Docker.html" data-v-43f1e123><!--[-->Docker<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kubernetes/Kubernetes.html" data-v-43f1e123><!--[-->Kubernetes<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/GitLab/GitLab.html" data-v-43f1e123><!--[-->GitLab<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-ae5c84bb data-v-79c8c1df><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-ae5c84bb data-v-669faec9><div class="VPDoc has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _posts_be_Java_Java%20%E7%BA%BF%E7%A8%8B%E6%B1%A0_Java%20%E7%BA%BF%E7%A8%8B%E6%B1%A0" data-v-6b87e69f><div><h1 id="java-线程池" tabindex="-1">Java 线程池 <a class="header-anchor" href="#java-线程池" aria-label="Permalink to &quot;Java 线程池&quot;">​</a></h1><blockquote><p>线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率</p></blockquote><br><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p><strong>线程池特点</strong></p><p>1、线程复用，降低资源消耗，通过复用已创建的线程降低线程创建销毁引起的消耗</p><p>2、管理线程，线程是稀缺资源，如果无限创建，不仅会消耗系统资源，还会降低系统稳定性，使用线程池可以进行统一的分配</p><p>3、提高响应速度，当任务到达时线程就可执行，减少了线程创建的时间</p><br><h2 id="接口与类" tabindex="-1">接口与类 <a class="header-anchor" href="#接口与类" aria-label="Permalink to &quot;接口与类&quot;">​</a></h2><h3 id="executor" tabindex="-1">Executor <a class="header-anchor" href="#executor" aria-label="Permalink to &quot;Executor&quot;">​</a></h3><blockquote><p>Executor 是线程池操作最顶层的类，用于运行提交的线程任务。此接口将线程任务的提交和运行机制进行解耦，包括线程任务的使用和调度等细节</p><p>通常使用 Executor 而不是显式创建线程，相比于遍历线程集合运行每一个任务，更常用的方法如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Executor executor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> anExecutor;</span></span>
<span class="line"><span style="color:#E1E4E8;">executor.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RunnableTask1</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">executor.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RunnableTask2</span><span style="color:#E1E4E8;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Executor executor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> anExecutor;</span></span>
<span class="line"><span style="color:#24292E;">executor.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RunnableTask1</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">executor.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RunnableTask2</span><span style="color:#24292E;">());</span></span></code></pre></div><br> Executor 接口并不严格要求执行必须是异步的，Executor 可以立即在调用者的线程中运行提交的任务： <div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DirectExecutor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Executor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(Runnable </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    		r.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  	}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DirectExecutor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Executor</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(Runnable </span><span style="color:#E36209;">r</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    		r.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br> 通常情况下，任务是在调用者线程之外的某个线程中执行的： <div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPerTaskExecutor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Executor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(Runnable </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">       	</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(r).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPerTaskExecutor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Executor</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(Runnable </span><span style="color:#E36209;">r</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">       	</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(r).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></blockquote><br><blockquote><p><strong>内置方法</strong></p><ul><li>execute，运行线程任务，无返回值</li></ul></blockquote><br><blockquote><p><strong>子类与实现类</strong></p><ul><li><p>ExecutorService</p><p>Java 提供的线程池都实现了 ExecutorService 接口，相对 Executor 它的扩展性更强</p></li><li><p>ThreadPoolExecutor</p><p>提供了一个可扩展的线程池实现</p></li><li><p>Executors</p><p>提供方便线程池创建的工厂方法</p></li></ul></blockquote><br><blockquote><p><strong>内存一致性原则</strong></p><p>将 Runnable 对象（线程任务）提交给 Executor 的操作 happens-before 线程任务执行开始</p></blockquote><br><h3 id="executorservice" tabindex="-1">ExecutorService <a class="header-anchor" href="#executorservice" aria-label="Permalink to &quot;ExecutorService&quot;">​</a></h3><blockquote><p>提供线程池的提交/管理/运行/中止方法，还可以创建用于跟踪一个或多个异步任务进度的 <a href="#Future">Future</a></p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ExecutorService</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Executor</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ExecutorService</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Executor</span></span></code></pre></div><br><blockquote><p><strong>内置方法</strong></p><ul><li><p>submit</p><p>可以看成 Executor.execute(Runnable) 方法的一个扩展，返回的 Future 可用于线程任务取消/等待完成。</p></li><li><p>invokeAny/invokeAll</p><p>批量执行线程任务，等待至少一个/全部任务完成</p></li><li><p>shutdown</p><p>拒绝新任务，允许任务队列中的所有任务都执行完毕再关闭线程池</p></li><li><p>shutdownNow</p><p>拒绝新任务，直接关闭线程池</p></li></ul></blockquote><br><blockquote><p><strong>内存一致性原则</strong></p><p>线程任务的提交 happens-before 线程任务的执行；线程任务执行完成 happens-before Future#get</p></blockquote><br><h3 id="abstractexecutorservice" tabindex="-1">AbstractExecutorService <a class="header-anchor" href="#abstractexecutorservice" aria-label="Permalink to &quot;AbstractExecutorService&quot;">​</a></h3><blockquote><p>使用 <a href="#RunnableFuture">RunnableFuture</a> 实现了 submit/invokeAny/invokeAll 方法</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">abstract</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AbstractExecutorService</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ExecutorService</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AbstractExecutorService</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ExecutorService</span></span></code></pre></div><br><h3 id="threadpoolexecutor" tabindex="-1">ThreadPoolExecutor <a class="header-anchor" href="#threadpoolexecutor" aria-label="Permalink to &quot;ThreadPoolExecutor&quot;">​</a></h3><blockquote><p>Thread pools address two different problems</p><ul><li>线程池在执行大量的异步任务时，可以减少每个任务执行时的开销，拥有更高的性能</li><li>线程池可以更好的管理和约束资源，包括线程在执行一系列任务时的开销</li></ul><br><p>ThreadPoolExecutor 是 Java 线程池的核心实现类，维护基础的线程池信息，如线程池的核心线程数/最大工作线程数/非核心线程空闲存活时间/线程工厂/线程工作队列/队列拒绝策略等。</p><br><p>However, programmers are urged to use the more convenient Executors factory methods</p><ul><li>Executors.newCachedThreadPool (unbounded thread pool, with automatic thread reclamation)</li><li>Executors.newFixedThreadPool (fixed size thread pool)</li><li>Executors.newSingleThreadExecutor (single background thread)</li><li>Executors.newSingleThreadScheduledExecutor (run after a given delay, or to execute periodically)</li></ul><br><p>Otherwise, use the following guide when manually configuring and tuning this class</p><ul><li>Core and maximum pool sizes</li><li>On-demand construction</li><li>Creating new threads</li><li>Keep-alive times</li><li>Queuing</li><li>Queue maintenance</li><li>Rejected tasks</li><li>Hook methods</li><li>Finalization</li></ul></blockquote><blockquote><p><strong>Core and maximum pool sizes</strong></p><p>A ThreadPoolExecutor will automatically adjust the pool size according to the bounds set by corePoolSize and maximumPoolSize.</p><ul><li><p>新任务提交时，如果当前存活的线程数小于 corePoolSize，即使存活的其他线程是空闲的，也会创建新线程处理新提交的任务</p></li><li><p>新任务提交时，如果当前存活线程数大于 corePoolSize 但是小于 maximumPoolSize，只有线程等待队列满了的时候才会创建新线程</p></li></ul><br><p>如果 corePoolSize 与 maximumPoolSize 相等，则相当于 fixed-size 的线程池；如果将 maximumPoolSize 设置成无限大，如 Integer.MAX_VALUE，就表示线程池允许同时运行任意数量的线程。</p><br><p>通常来说，corePoolSize 和 maximumPoolSize 只会在构建线程池时指定，但也可以通过 setCorePoolSize 和 setMaximumPoolSize 方法进行动态更改</p><br><p>实际上在创建线程时，并没有给线程做标记，因此无法区分核心线程与非核心线程，主要根据当前线程的数量来处理。只要当前的运行线程数小于 corePoolSize，就认为存活的线程都是核心线程。线程池根据当前线程数量判断是否退出线程，而不是根据是否是核心线程。</p></blockquote><blockquote><p><strong>On-demand construction</strong></p><p>执行线程按需创建，默认情况下，即使是核心线程，只有当任务提交的时候才会创建。但是可以使用 prestartCoreThread 或 prestartAllCoreThreads 方法来预先启动核心线程</p></blockquote><blockquote><p><strong>Creating new threads</strong></p><ul><li>新线程会使用 ThreadFactory 线程工厂来创建，如果没有特别说明，则使用 Executors.defaultThreadFactory</li><li>默认线程工厂创建的线程都在同一个 ThreadGroup 中，有着同样的 NORM_PRIORITY 优先级，并且都是非守护线程</li><li>可以通过使用自定义的 ThreadFactory 修改新创建的线程的基本信息，如线程名、线程组、线程优先级、是否是守护线程等</li><li>如果 ThreadFactory 创建线程时返回 null，线程创建失败。线程池会继续执行，但是可能不能执行任何任务</li><li>线程应拥有“修改线程”运行时权限，如果工作线程或其他使用该池的线程不具备此权限，服务可能会降低。配置变化可能不会及时生效，而且关闭的线程池可能保持在一个可能终止但没有完成的状态中</li></ul></blockquote><blockquote><p><strong>Keep-alive times</strong></p><ul><li><p>如果当前池中的线程数大于 corePoolSize 多余的线程在空闲时间超过 keepAliveTime 后将被终止</p></li><li><p>默认情况下，只有当线程数大于 corePoolSize 时才会应用 keep-alive 策略。但可以使用 allowCoreThreadTimeOut(boolean) 方法将超时策略应用到核心线程上，前提是 keepAliveTime 值不为零</p></li></ul></blockquote><blockquote><p><strong>Queuing</strong></p><p>任何 BlockingQueue 都可以用来维护提交的任务</p><ul><li>如果运行的线程少于 corePoolSize，线程池总是倾向于创建新的线程而不是入队</li><li>如果运行的线程大于等于 corePoolSize，线程池总是倾向于入队，而不是创建新线程</li><li>如果一个任务请求无法入队，则会创建新的线程来处理，除非线程数即将超过 maximumPoolSize。此时将触发拒绝策略</li></ul><br><p>There are three general strategies for queuing:</p><ul><li><p>Direct handoffs</p><p>同步队列 SynchronousQueue，将任务交给线程，不持有任何任务。如果没有线程可以立即运行任务，尝试入队的任务将会入队失败，此时将会创建新的线程来处理。通常需要无界的 maximumPoolSizes 才能避免对新提交的任务的拒绝，但这会导致无限的线程增长</p></li><li><p>Unbounded queues</p><p>无界队列，比如 LinkedBlockingQueue，新任务在所有 corePoolSize 线程都忙时直接入队，创建的线程数永远不会超过 corePoolSize，此时 maximumPoolSize 将无效。</p><p>当每个任务都是独立的时候，这种队列可能是合适的。但是如果两个任务之间有关联，一个在队列头，一个在队列尾，将会导致头任务阻塞很长一段时间等待尾任务完成。</p><p>Java 内置的线程池默认使用 LinkedBlockingQueue 队列来维护任务。</p></li><li><p>Bounded queues</p><p>有界队列，如 ArrayBlockingQueue，如果存在大量任务，可能会经常阻塞。但是可以防止资源耗尽</p></li></ul><br><p>线程池可容纳的最大任务数 <code>maxTaskSize = maximumPoolSize + workQueue.size()</code>，超过能容纳的最大任务树就会触发拒绝策略，抛出 RejectedExecutionException</p></blockquote><blockquote><p><strong>Rejected tasks</strong></p><ul><li>线程池关闭后，新提交的任务将会被拒绝</li><li>如果线程池使用的是有界队列，正在运行的线程数大于 maximumPoolSize，并且队列已满，会触发拒绝策略</li><li>如果任务在执行中主动调用 RejectedExecutionHandler.rejectedExecution 方法，会拒绝执行任务，抛出未受检查的异常 RejectedExecutionException</li></ul><br><p><strong>拒绝策略</strong></p><ul><li><p>ThreadPoolExecutor.AbortPolicy</p><p>默认拒绝策略，在拒绝执行时抛出 RejectedExecutionException 异常，线程池正常运行</p></li><li><p>ThreadPoolExecutor.CallerRunsPolicy</p><p>调用 execute 方法的线程自己执行任务，提供了一个简单的反馈控制机制，但是会减缓新任务的提交速度</p></li><li><p>ThreadPoolExecutor.DiscardPolicy</p><p>不能执行的任务会被直接放弃</p></li><li><p>ThreadPoolExecutor.DiscardOldestPolicy</p><p>丢弃队列头的任务，再将当前任务入队</p></li></ul><br><p>可以实现 RejectedExecutionHandler 接口自定义和使用其他类型的 RejectedExecutionHandler</p></blockquote><blockquote><p><strong>Hook methods</strong></p><p>ThreadPoolExecutor 还提供任务执行前后的勾子方法</p><ul><li>beforeExecute(Thread, Runnable)</li><li>afterExecute(Runnable, Throwable)</li><li>terminated()</li></ul><br><p>勾子函数可用作线程执行环境的检查/初始化 ThreadLocal/日志操作等。线程 terminated 方法也可以被重写，用作中止前后进行清理操作等。如果勾子函数或回调方法抛出异常，内部工作线程可能反过来失败并突然终止</p></blockquote><blockquote><p><strong>Queue maintenance</strong></p><ul><li><p>可以通过 getQueue 方法获取到工作队列，进行监控或者 debug 等操作，不鼓励进行除此之外的其他操作</p></li><li><p>remove(Runnable) 和 purge 方法能够协助进行工作队列内存回收</p></li></ul></blockquote><blockquote><p><strong>Finalization</strong></p><ul><li>不被引用并且没有剩余线程的池将被自动关闭</li><li>如果想要确保未被引用的线程池不调用 shutdown 方法也会被回收，必须通过设置适当的 keep-alive 时间、使用零个核心线程的下限，或者设置 allowCoreThreadTimeOut(boolean) 来使得未使用的线程最终被回收</li></ul></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AbstractExecutorService</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AbstractExecutorService</span></span></code></pre></div><br><h4 id="线程池状态" tabindex="-1">线程池状态 <a class="header-anchor" href="#线程池状态" aria-label="Permalink to &quot;线程池状态&quot;">​</a></h4><ul><li><p>RUNNING 运行状态，接受新任务，持续处理任务队列里的任务</p></li><li><p>SHUTDOWN 调用 shutdown 方法会进入 SHUTDOWN 状态，不再接受新任务，但要处理任务队列里的任务。shutdown 方法会等待线程都执行完毕之后再关闭</p></li><li><p>STOP 调用 shutdownNow 方法，不再接受新任务，不再处理任务队列里的任务，中断正在进行中的任务。shutdownNow 方法相当于调用每个线程的 interrupt 方法</p></li><li><p>TIDYING 表示线程池正在进行清理工作，中止所有任务，销毁所有工作线程</p></li><li><p>TERMINATED 表示线程池已停止运作，所有工作线程已被销毁，所有任务已被清空或执行完毕</p></li></ul><br><h4 id="线程池种类" tabindex="-1">线程池种类 <a class="header-anchor" href="#线程池种类" aria-label="Permalink to &quot;线程池种类&quot;">​</a></h4><blockquote><p>Executors 类中预定义了几种常用的线程池</p><ul><li><p>预定义的线程池都是 ThreadPoolExecutor 的实例，只是在构造函数中传入的参数不同</p></li><li><p>线程池执行 execute() 提交不需要返回值的任务，无法判断是否执行成功；线程池执行 submit() 提交有返回值的任务。返回 Future 对象，可以判断任务是否执行成功。</p></li></ul></blockquote><ul><li><p>FixedThreadPool</p><p>线程数量固定的线程池，可控制线程最大并发数，超出的线程会在队列中等待</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newFixedThreadPool</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> nThreads) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(nThreads, nThreads,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#79B8FF;">0L</span><span style="color:#E1E4E8;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> LinkedBlockingQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;());</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newFixedThreadPool</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> nThreads) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(nThreads, nThreads,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#005CC5;">0L</span><span style="color:#24292E;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedBlockingQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p>CacheThreadPool</p><p>可缓存/扩展的线程池，可灵活回收空闲线程，若无可回收，则新建线程</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newCachedThreadPool</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, Integer.MAX_VALUE,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#79B8FF;">60L</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> SynchronousQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;());</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newCachedThreadPool</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, Integer.MAX_VALUE,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#005CC5;">60L</span><span style="color:#24292E;">, TimeUnit.SECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> SynchronousQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p>ScheduledThreadPool</p><p>支持定时及周期性任务执行的线程池</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ScheduledExecutorService </span><span style="color:#B392F0;">newScheduledThreadPool</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> corePoolSize) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ScheduledThreadPoolExecutor</span><span style="color:#E1E4E8;">(corePoolSize);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ScheduledThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> corePoolSize) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">(corePoolSize, Integer.MAX_VALUE, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, NANOSECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DelayedWorkQueue</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ScheduledExecutorService </span><span style="color:#6F42C1;">newScheduledThreadPool</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> corePoolSize) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ScheduledThreadPoolExecutor</span><span style="color:#24292E;">(corePoolSize);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ScheduledThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> corePoolSize) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(corePoolSize, Integer.MAX_VALUE, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, NANOSECONDS,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DelayedWorkQueue</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p>SingleThreadPool</p><p>单一线程化的线程池，用唯一的线程来执行任务，保证所有任务按照顺序执行</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newSingleThreadExecutor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> FinalizableDelegatedExecutorService</span></span>
<span class="line"><span style="color:#E1E4E8;">        (</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                </span><span style="color:#79B8FF;">0L</span><span style="color:#E1E4E8;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> LinkedBlockingQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;()));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newSingleThreadExecutor</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> FinalizableDelegatedExecutorService</span></span>
<span class="line"><span style="color:#24292E;">        (</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                </span><span style="color:#005CC5;">0L</span><span style="color:#24292E;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedBlockingQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;()));</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li></ul><br><h4 id="自定义线程池" tabindex="-1">自定义线程池 <a class="header-anchor" href="#自定义线程池" aria-label="Permalink to &quot;自定义线程池&quot;">​</a></h4><blockquote><p>不推荐使用 Executors 定义的线程池，推荐通过 ThreadPoolExecutor 来创建自定义线程池</p><ul><li>FixedThreadPool 和 SingleThreadPool 工作队列最大长度为 Integer.MAX_VALUE，可能会堆积大量任务请求，导致 OOM</li><li>CacheThreadPool 和 ScheduleThreadPool 允许创建的最大线程数量为 Integer.MAX_VALUE，可能会创建大量的线程，导致 OOM</li></ul></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 一般根据 CPU 核心数设置 corePoolSize = Runtime.getRuntime().availableProcessors() * 2</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> corePoolSize,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> maximumPoolSize,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> keepAliveTime,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          TimeUnit unit,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          BlockingQueue</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">Runnable</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> workQueue,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          ThreadFactory threadFactory,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          RejectedExecutionHandler handler) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (corePoolSize </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">        maximumPoolSize </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">        maximumPoolSize </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> corePoolSize </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">        keepAliveTime </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IllegalArgumentException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (workQueue </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> threadFactory </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> handler </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NullPointerException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.acc </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> System.</span><span style="color:#B392F0;">getSecurityManager</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            AccessController.</span><span style="color:#B392F0;">getContext</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.corePoolSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> corePoolSize;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.maximumPoolSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> maximumPoolSize;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.workQueue </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> workQueue;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.keepAliveTime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> unit.</span><span style="color:#B392F0;">toNanos</span><span style="color:#E1E4E8;">(keepAliveTime);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.threadFactory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> threadFactory;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handler </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> handler;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 一般根据 CPU 核心数设置 corePoolSize = Runtime.getRuntime().availableProcessors() * 2</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> corePoolSize,</span></span>
<span class="line"><span style="color:#24292E;">                          </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> maximumPoolSize,</span></span>
<span class="line"><span style="color:#24292E;">                          </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> keepAliveTime,</span></span>
<span class="line"><span style="color:#24292E;">                          TimeUnit unit,</span></span>
<span class="line"><span style="color:#24292E;">                          BlockingQueue</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">Runnable</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> workQueue,</span></span>
<span class="line"><span style="color:#24292E;">                          ThreadFactory threadFactory,</span></span>
<span class="line"><span style="color:#24292E;">                          RejectedExecutionHandler handler) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (corePoolSize </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">        maximumPoolSize </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">        maximumPoolSize </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> corePoolSize </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">        keepAliveTime </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IllegalArgumentException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (workQueue </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> threadFactory </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> handler </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NullPointerException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.acc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> System.</span><span style="color:#6F42C1;">getSecurityManager</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">            AccessController.</span><span style="color:#6F42C1;">getContext</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.corePoolSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> corePoolSize;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.maximumPoolSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> maximumPoolSize;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.workQueue </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> workQueue;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.keepAliveTime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> unit.</span><span style="color:#6F42C1;">toNanos</span><span style="color:#24292E;">(keepAliveTime);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.threadFactory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> threadFactory;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handler </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> handler;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h4 id="线程池工作流程" tabindex="-1">线程池工作流程 <a class="header-anchor" href="#线程池工作流程" aria-label="Permalink to &quot;线程池工作流程&quot;">​</a></h4><blockquote><p>1、线程池被创建之后，开始等待任务请求</p><p>2、当调用 execute 方法添加请求时</p><ul><li><p>正在运行的线程数小于 corePoolSize，立即创建线程执行任务</p></li><li><p>正在运行的线程数大于等于 corePoolSize，任务入队等待</p></li><li><p>队列已满，且正在运行的线程数量小于 maximumPoolSize，立刻创建线程执行新请求的任务</p></li><li><p>正在运行的线程数大于 maximumPoolSize 且阻塞队列已满，触发拒绝策略</p></li></ul><p>3、当一个线程完成任务，它就会从队列中取出下一个任务执行</p><p>4、当一个线程空闲时间超过 keepAliveTime，线程就会判断：当前运行的线程数是否大于 corePoolSize，是的话这个线程就会被关闭</p><p>5、线程池的所有任务完成后，线程数会保持在 corePoolSize</p></blockquote><p><img src="/assets/31bad766983e212431077ca8da92762050214.022770a9.png" alt="任务调度流程"></p><br><h3 id="future" tabindex="-1">Future <a class="header-anchor" href="#future" aria-label="Permalink to &quot;Future&quot;">​</a></h3><blockquote><p>Future 表示异步任务的结果，任务完成后，可使用 get 方法获取；如果未完成，get 方法将会阻塞。还额外提供有检查任务是否完成和是否取消的方法。任务的取消可以使用 cancel 方法，如果任务已完成就不可被取消。</p><p>如果使用 Future 仅仅是为了获得可取消的任务，不需要返回值，可以使用 <code>Future&lt;?&gt;</code> 在任务执行完后，返回 null 作为结果。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Future</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Future</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><blockquote><p><strong>内置方法</strong></p><ul><li>get</li><li>cancel</li><li>isDone</li><li>isCancelled</li></ul></blockquote><p><strong>Usage</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ArchiveSearcher</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    String </span><span style="color:#B392F0;">search</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">target</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">App</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    ExecutorService executor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ...</span></span>
<span class="line"><span style="color:#E1E4E8;">    ArchiveSearcher searcher </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">showSearch</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> String target) throws InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Future&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; future </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> executor.</span><span style="color:#B392F0;">submit</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> Callable&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt;() {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> String </span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> searcher.</span><span style="color:#B392F0;">search</span><span style="color:#E1E4E8;">(target);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">displayOtherThings</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">// do other things while searching</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">displayText</span><span style="color:#E1E4E8;">(future.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">()); </span><span style="color:#6A737D;">// use future</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (ExecutionException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cleanup</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ArchiveSearcher</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    String </span><span style="color:#6F42C1;">search</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">target</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">App</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    ExecutorService executor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ...</span></span>
<span class="line"><span style="color:#24292E;">    ArchiveSearcher searcher </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">showSearch</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> String target) throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">        Future&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; future </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> executor.</span><span style="color:#6F42C1;">submit</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> Callable&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt;() {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">call</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> searcher.</span><span style="color:#6F42C1;">search</span><span style="color:#24292E;">(target);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">displayOtherThings</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">// do other things while searching</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">displayText</span><span style="color:#24292E;">(future.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">()); </span><span style="color:#6A737D;">// use future</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (ExecutionException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cleanup</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><br><h3 id="runnablefuture" tabindex="-1">RunnableFuture <a class="header-anchor" href="#runnablefuture" aria-label="Permalink to &quot;RunnableFuture&quot;">​</a></h3><blockquote><p>A Future that is Runnable. 可执行的 Future，run 方法执行成功后可以通过 Future 自身的 get 方法获取到返回值。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RunnableFuture</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Runnable</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Future</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RunnableFuture</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Runnable</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">Future</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><br><h3 id="futuretask" tabindex="-1">FutureTask <a class="header-anchor" href="#futuretask" aria-label="Permalink to &quot;FutureTask&quot;">​</a></h3><blockquote><p>一个可取消的异步操作。这个类提供了 Future 的一个简单实现，实现了：开始/取消/获取结果/检查是否完成方。只有操作完成之后才能获取到返回结果，否则会一直阻塞 get 方法的执行；操作结束之后不能被 restart 或者 cancelled（存在例外：runAndReset 方法）。</p><p>可以将 Callable 或者 Runnable 对象传递到 FutureTask 的构造函数，来创建 一个 FutureTask。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FutureTask</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RunnableFuture</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FutureTask</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RunnableFuture</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><br><h3 id="completablefuture" tabindex="-1">CompletableFuture <a class="header-anchor" href="#completablefuture" aria-label="Permalink to &quot;CompletableFuture&quot;">​</a></h3><blockquote><p>一个明确会在将来完成的 Future。实现了 CompletionStage 接口，用于在异步任务进行时针对不同阶段进行不同操作。</p></blockquote><blockquote><p><strong>内部方法</strong></p><ul><li>complete</li><li>completeExceptionally</li><li>cancel</li></ul><p>当存在多个线程同时执行以上三个方法时，只有一个能执行成功。</p></blockquote><blockquote><p><strong>Overview</strong></p><p>CompletableFuture 中可能会存在依赖于结果完成的动作，CompletableFuture 通过对结果字段的 CAS 操作来自动完成这一系列动作。</p><p>返回的结果字段非空，说明 CompletableFuture 操作完成。CompletableFuture 使用一个 AltResult 来包装 null 值结果，同时也是使用 AltResult 来保存异常。</p></blockquote><br><h2 id="forkjoin-框架" tabindex="-1">ForkJoin 框架 <a class="header-anchor" href="#forkjoin-框架" aria-label="Permalink to &quot;ForkJoin 框架&quot;">​</a></h2><h3 id="forkjoinpool" tabindex="-1">ForkJoinPool <a class="header-anchor" href="#forkjoinpool" aria-label="Permalink to &quot;ForkJoinPool&quot;">​</a></h3><blockquote><p>本质上是一个 ExecutorService，是一个专门用来运行 ForkJoinTask 的线程池。同样提供了对于 Non-ForkJoinTask 的线程池运行入口、管理和监控的操作。</p><p>与其他 ExecutorService 不同的是，ForkJoinPool 支持一种叫做 ”work-stealing“ 的工作模式：线程池中的所有线程都会尝试去找到并执行<u>所有被提交到线程池中的任务（或者是被其他活跃任务创建的任务）</u>。这种工作模式在会有很多子任务产生的情况下，或者有很多小人物会被从外部客户端提交到线程池中运行时是很高效的。</p><p>ForkJoinPool 提供一个静态的 commonPool() 方法，适用于绝大多数应用，可以被任何一个 ForkJoinTask 使用。使用 commonPool 还能够减少资源的使用（线程不活跃的时候会被慢慢回收，使用的时候自动恢复）。</p></blockquote><blockquote><p><strong>三种运行方式</strong></p><table><thead><tr><th></th><th>Call from non-fork/join clients</th><th>Call from within fork/join computations</th></tr></thead><tbody><tr><td>Arrange async execution</td><td>execute(ForkJoinTask)</td><td>ForkJoinTask.fork</td></tr><tr><td>Await and obtain result</td><td>invoke(ForkJoinTask)</td><td>ForkJoinTask.invoke</td></tr><tr><td>Arrange exec and obtain Future</td><td>submit(ForkJoinTask)</td><td>ForkJoinTask.fork (ForkJoinTasks are Futures)</td></tr></tbody></table></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ForkJoinPool</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AbstractExecutorService</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ForkJoinPool</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AbstractExecutorService</span></span></code></pre></div><br><p>内部类 <em>WorkQueue</em> 维护一个 <em>work-stealing queues</em>，是 <em>Deques</em> 的一个变种，只支持 3 个操作：push，pop 和 poll（也叫做 steal）。push 和 pop 只能由线程本身调用，一个线程的 poll 操作可能会被其他外部线程调用。</p><p><em>work-stealing queue</em> 内部的用到了 CAS 来获取下一个 task 进行执行。</p><blockquote><p>关于 <em>work-stealing queue</em> 可以看看 <a href="http://research.sun.com/scalable/pubs/index.html" target="_blank" rel="noreferrer">Dynamic Circular Work-Stealing Deque</a> 和 <a href="http://research.sun.com/scalable/pubs/index.html" target="_blank" rel="noreferrer">Idempotent work stealing</a>。</p></blockquote><br><h3 id="forkjointask" tabindex="-1">ForkJoinTask <a class="header-anchor" href="#forkjointask" aria-label="Permalink to &quot;ForkJoinTask&quot;">​</a></h3><blockquote><p>运行在 ForkJoinPool 中的的任务的抽象任务类，ForkJoinTask 是一种轻量级的 Future。</p><p>ForkJoinTask 线程比普通线程更加轻量，在可用资源受到限制的时候，在 ForkJoinPool 中使用少量的线程即可完成大量的 ForkJoinTask 任务。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">abstract</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ForkJoinTask</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Future</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">V</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">Serializable</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ForkJoinTask</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Future</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">V</span><span style="color:#24292E;">&gt;, </span><span style="color:#6F42C1;">Serializable</span></span></code></pre></div><br><p>ForkJoinTask 是一个抽象类，所以需要继承它的一系列子类来完成需要的功能。下面测试一下使用和不使用 ForJoinTask 的区别：</p><p>1、不使用 ForJoinTask。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">noThread</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> start </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> System.</span><span style="color:#B392F0;">currentTimeMillis</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000000000</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> i;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(sum);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> end </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> System.</span><span style="color:#B392F0;">currentTimeMillis</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;total time spent ===&gt; &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (end </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> start));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">noThread</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> start </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> System.</span><span style="color:#6F42C1;">currentTimeMillis</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000000000</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        sum </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> i;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(sum);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> end </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> System.</span><span style="color:#6F42C1;">currentTimeMillis</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;total time spent ===&gt; &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (end </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> start));</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">executing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">==</span><span style="color:#E1E4E8;">=</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noThread</span></span>
<span class="line"><span style="color:#B392F0;">500000000500000000</span></span>
<span class="line"><span style="color:#B392F0;">total</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">spent</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">==</span><span style="color:#E1E4E8;">=</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">352</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">executing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">==</span><span style="color:#24292E;">=</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noThread</span></span>
<span class="line"><span style="color:#6F42C1;">500000000500000000</span></span>
<span class="line"><span style="color:#6F42C1;">total</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time</span><span style="color:#24292E;"> </span><span style="color:#032F62;">spent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">==</span><span style="color:#24292E;">=</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">352</span></span></code></pre></div><p>2、使用 ForJoinTask。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinTask</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RecursiveTask</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">Long</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> from;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> to;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> maxRange;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinTask</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">from</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">to</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">maxRange</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.from </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> from;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.to </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> to;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.maxRange </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> maxRange;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> Long </span><span style="color:#B392F0;">compute</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> range </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> to </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> from;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (range </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> maxRange) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> mid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (from </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> to) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            MyForkJoinTask left </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinTask</span><span style="color:#E1E4E8;">(from, mid, maxRange);</span></span>
<span class="line"><span style="color:#E1E4E8;">            MyForkJoinTask right </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinTask</span><span style="color:#E1E4E8;">(mid </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, to, maxRange);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// fork() asynchronously, execute this task in the pool the current task is running in</span></span>
<span class="line"><span style="color:#E1E4E8;">            left.</span><span style="color:#B392F0;">fork</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            right.</span><span style="color:#B392F0;">fork</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// join() Returns the result of the computation when it is done</span></span>
<span class="line"><span style="color:#E1E4E8;">            sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> left.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> right.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (; from </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> to ; from</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> from;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> sum;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinTask</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RecursiveTask</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">Long</span><span style="color:#24292E;">&gt; {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> from;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> to;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> maxRange;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinTask</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> </span><span style="color:#E36209;">from</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> </span><span style="color:#E36209;">to</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> </span><span style="color:#E36209;">maxRange</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.from </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> from;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.to </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> to;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.maxRange </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> maxRange;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> Long </span><span style="color:#6F42C1;">compute</span><span style="color:#24292E;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> range </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> to </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> from;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (range </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> maxRange) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> mid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (from </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> to) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            MyForkJoinTask left </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinTask</span><span style="color:#24292E;">(from, mid, maxRange);</span></span>
<span class="line"><span style="color:#24292E;">            MyForkJoinTask right </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinTask</span><span style="color:#24292E;">(mid </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, to, maxRange);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// fork() asynchronously, execute this task in the pool the current task is running in</span></span>
<span class="line"><span style="color:#24292E;">            left.</span><span style="color:#6F42C1;">fork</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            right.</span><span style="color:#6F42C1;">fork</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// join() Returns the result of the computation when it is done</span></span>
<span class="line"><span style="color:#24292E;">            sum </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> left.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            sum </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> right.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (; from </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> to ; from</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                sum </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> from;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> sum;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinPool</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> ExecutionException, InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        ForkJoinPool fjp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ForkJoinPool.</span><span style="color:#B392F0;">commonPool</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> start </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> System.</span><span style="color:#B392F0;">currentTimeMillis</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        MyForkJoinTask task </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyForkJoinTask</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1000000000</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">100000000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ForkJoinTask&lt;</span><span style="color:#F97583;">Long</span><span style="color:#E1E4E8;">&gt; resp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fjp.</span><span style="color:#B392F0;">submit</span><span style="color:#E1E4E8;">(task);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(resp.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> end </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> System.</span><span style="color:#B392F0;">currentTimeMillis</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;cost time ==&gt; &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (end </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> start));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinPool</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> ExecutionException, InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">        ForkJoinPool fjp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ForkJoinPool.</span><span style="color:#6F42C1;">commonPool</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> start </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> System.</span><span style="color:#6F42C1;">currentTimeMillis</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        MyForkJoinTask task </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyForkJoinTask</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1000000000</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">100000000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ForkJoinTask&lt;</span><span style="color:#D73A49;">Long</span><span style="color:#24292E;">&gt; resp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fjp.</span><span style="color:#6F42C1;">submit</span><span style="color:#24292E;">(task);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(resp.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> end </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> System.</span><span style="color:#6F42C1;">currentTimeMillis</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;cost time ==&gt; &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (end </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> start));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">500000000500000000</span></span>
<span class="line"><span style="color:#B392F0;">cost</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;">=</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">90</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">500000000500000000</span></span>
<span class="line"><span style="color:#6F42C1;">cost</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;">=</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">90</span></span></code></pre></div><p>计算所需要的时间只需要原先的四分之一。</p><blockquote><p>在测试中发现，使用多线程来计算时间花费得更少：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">withThread</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    AtomicLong globalSum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AtomicLong</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> from </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> max </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000000000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> span </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> max</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 10 threads</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> finalFrom </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> from; </span><span style="color:#6A737D;">// 0          1000000001</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> to </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> span </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> i; </span><span style="color:#6A737D;">// 1000000000 2000000000</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> finalFrom; j </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> to; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> j;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;sum now: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> sum);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> gs </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> globalSum.</span><span style="color:#B392F0;">addAndGet</span><span style="color:#E1E4E8;">(sum);</span></span>
<span class="line"><span style="color:#E1E4E8;">            System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;global sum now: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> gs);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        from </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> to </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">withThread</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    AtomicLong globalSum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AtomicLong</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> from </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> max </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000000000</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> span </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> max</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 10 threads</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> finalFrom </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> from; </span><span style="color:#6A737D;">// 0          1000000001</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> to </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> span </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> i; </span><span style="color:#6A737D;">// 1000000000 2000000000</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> j </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> finalFrom; j </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> to; j</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                sum </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> j;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sum now: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> sum);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> gs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> globalSum.</span><span style="color:#6F42C1;">addAndGet</span><span style="color:#24292E;">(sum);</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;global sum now: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> gs);</span></span>
<span class="line"><span style="color:#24292E;">        }).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        from </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> to </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">executing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">==</span><span style="color:#E1E4E8;">=</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">withThread</span></span>
<span class="line"><span style="color:#B392F0;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">now:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">500000000500000000</span></span>
<span class="line"><span style="color:#B392F0;">total</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">spent</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">==</span><span style="color:#E1E4E8;">=</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">42</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">executing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">==</span><span style="color:#24292E;">=</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">withThread</span></span>
<span class="line"><span style="color:#6F42C1;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">now:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">500000000500000000</span></span>
<span class="line"><span style="color:#6F42C1;">total</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time</span><span style="color:#24292E;"> </span><span style="color:#032F62;">spent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">==</span><span style="color:#24292E;">=</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">42</span></span></code></pre></div><p>甚至只需要原先的九分之一的时间就可以完成计算。</p></blockquote><br><h3 id="forkjoinworkerthread" tabindex="-1">ForkJoinWorkerThread <a class="header-anchor" href="#forkjoinworkerthread" aria-label="Permalink to &quot;ForkJoinWorkerThread&quot;">​</a></h3><blockquote><p>由 ForkJoinPool 管理的线程，用来处理 ForkJoinTask 任务。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ForkJoinWorkerThread</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ForkJoinWorkerThread</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span></span></code></pre></div><p>在 ForkJoinPool 中有说明：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;"> * Creating workers. To create a worker, we pre-increment total</span></span>
<span class="line"><span style="color:#6A737D;"> * count (serving as a reservation), and attempt to construct a</span></span>
<span class="line"><span style="color:#6A737D;"> * ForkJoinWorkerThread via its factory. Upon construction, the</span></span>
<span class="line"><span style="color:#6A737D;"> * new thread invokes registerWorker, where it constructs a</span></span>
<span class="line"><span style="color:#6A737D;"> * WorkQueue and is assigned an index in the workQueues array</span></span>
<span class="line"><span style="color:#6A737D;"> * (expanding the array if necessary). The thread is then</span></span>
<span class="line"><span style="color:#6A737D;"> * started. </span></span>
<span class="line"><span style="color:#6A737D;"> * Upon any exception across these steps, or null return</span></span>
<span class="line"><span style="color:#6A737D;"> * from factory, deregisterWorker adjusts counts and records</span></span>
<span class="line"><span style="color:#6A737D;"> * accordingly.  If a null return, the pool continues running with</span></span>
<span class="line"><span style="color:#6A737D;"> * fewer than the target number workers. If exceptional, the</span></span>
<span class="line"><span style="color:#6A737D;"> * exception is propagated, generally to some external caller.</span></span>
<span class="line"><span style="color:#6A737D;"> * Worker index assignment avoids the bias in scanning that would</span></span>
<span class="line"><span style="color:#6A737D;"> * occur if entries were sequentially packed starting at the front</span></span>
<span class="line"><span style="color:#6A737D;"> * of the workQueues array. We treat the array as a simple</span></span>
<span class="line"><span style="color:#6A737D;"> * power-of-two hash table, expanding as needed. The seedIndex</span></span>
<span class="line"><span style="color:#6A737D;"> * increment ensures no collisions until a resize is needed or a</span></span>
<span class="line"><span style="color:#6A737D;"> * worker is deregistered and replaced, and thereafter keeps</span></span>
<span class="line"><span style="color:#6A737D;"> * probability of collision low. We cannot use</span></span>
<span class="line"><span style="color:#6A737D;"> * ThreadLocalRandom.getProbe() for similar purposes here because</span></span>
<span class="line"><span style="color:#6A737D;"> * the thread has not started yet, but do so for creating</span></span>
<span class="line"><span style="color:#6A737D;"> * submission queues for existing external threads.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;"> * Creating workers. To create a worker, we pre-increment total</span></span>
<span class="line"><span style="color:#6A737D;"> * count (serving as a reservation), and attempt to construct a</span></span>
<span class="line"><span style="color:#6A737D;"> * ForkJoinWorkerThread via its factory. Upon construction, the</span></span>
<span class="line"><span style="color:#6A737D;"> * new thread invokes registerWorker, where it constructs a</span></span>
<span class="line"><span style="color:#6A737D;"> * WorkQueue and is assigned an index in the workQueues array</span></span>
<span class="line"><span style="color:#6A737D;"> * (expanding the array if necessary). The thread is then</span></span>
<span class="line"><span style="color:#6A737D;"> * started. </span></span>
<span class="line"><span style="color:#6A737D;"> * Upon any exception across these steps, or null return</span></span>
<span class="line"><span style="color:#6A737D;"> * from factory, deregisterWorker adjusts counts and records</span></span>
<span class="line"><span style="color:#6A737D;"> * accordingly.  If a null return, the pool continues running with</span></span>
<span class="line"><span style="color:#6A737D;"> * fewer than the target number workers. If exceptional, the</span></span>
<span class="line"><span style="color:#6A737D;"> * exception is propagated, generally to some external caller.</span></span>
<span class="line"><span style="color:#6A737D;"> * Worker index assignment avoids the bias in scanning that would</span></span>
<span class="line"><span style="color:#6A737D;"> * occur if entries were sequentially packed starting at the front</span></span>
<span class="line"><span style="color:#6A737D;"> * of the workQueues array. We treat the array as a simple</span></span>
<span class="line"><span style="color:#6A737D;"> * power-of-two hash table, expanding as needed. The seedIndex</span></span>
<span class="line"><span style="color:#6A737D;"> * increment ensures no collisions until a resize is needed or a</span></span>
<span class="line"><span style="color:#6A737D;"> * worker is deregistered and replaced, and thereafter keeps</span></span>
<span class="line"><span style="color:#6A737D;"> * probability of collision low. We cannot use</span></span>
<span class="line"><span style="color:#6A737D;"> * ThreadLocalRandom.getProbe() for similar purposes here because</span></span>
<span class="line"><span style="color:#6A737D;"> * the thread has not started yet, but do so for creating</span></span>
<span class="line"><span style="color:#6A737D;"> * submission queues for existing external threads.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span></code></pre></div><blockquote><p>在创建 worker 时，ForkJoinPool 会提前新增线程总数，并尝试通过 ForkJoinWorkerThread 工厂来创建 ForkJoinWorkerThread。</p><p>在创建时，新线程通过调用 ForkJoinPool#registerWorker 创建一个 WorkQueue，并将 WorkQueue 添加到 WorkQueue 数组中，表示线程启动完毕。 如果在这过程中出现了异常或者 ForkJoinWorkerThread 工厂返回了 null 值：</p><ul><li>调用 ForkJoinPool#deregisterWorker 调整线程数量，并进行相应的记录；</li><li>如果返回了 null 值，ForkJoinPool 会继续运行；</li><li>如果出现异常，通常会被抛出给外部调用者处理。</li></ul></blockquote><br><h2 id="文章" tabindex="-1">文章 <a class="header-anchor" href="#文章" aria-label="Permalink to &quot;文章&quot;">​</a></h2><ul><li><a href="https://mp.weixin.qq.com/s/7jU0ci2tn5TwCvOyxdX6dA" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/s/7jU0ci2tn5TwCvOyxdX6dA</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>上次更新: <time datetime="2023-11-23T06:52:41.000Z" data-v-7e05ebdb></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><!--[--><!--]--><div id="giscus-comment" class="comment" data-pagefind-ignore="all" data-v-af5a5a9a data-v-3db7ae48><div class="el-affix comment-btn" style="height:;width:;" data-v-3db7ae48><div class="" style=""><!--[--><button ariadisabled="false" type="button" class="el-button el-button--primary is-plain" style="" data-v-3db7ae48><i class="el-icon" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M736 504a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zM128 128v640h192v160l224-160h352V128H128z"></path></svg><!--]--></i><span class=""><!--[--> 评论 <!--]--></span></button><!--]--></div></div><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"posts_algorithm_位运算.md\":\"0afe147e\",\"index.md\":\"888fd875\",\"posts_algorithm_常见算法.md\":\"fd4d3441\",\"posts_be_java_java lang_java lang.md\":\"e77850c4\",\"posts_be_springcloud_index.md\":\"60b92c70\",\"posts_article_文章整理.md\":\"04d9c5cb\",\"posts_be_java_java 多线程_java 多线程.md\":\"ef89bf4a\",\"about.md\":\"50e5a4ef\",\"posts_be_java_java 进阶_java 进阶.md\":\"f0f00772\",\"posts_be_mybitis_mybatis-plus-generator.md\":\"78ea1cbb\",\"posts_be_springweb_springmvc_springmvc.md\":\"88680b93\",\"posts_be_java_java 线程池_java 线程池.md\":\"6c10bf73\",\"posts_be_java_java io_java io.md\":\"c02ec610\",\"posts_be_dubbo_dubbo.md\":\"607928dc\",\"posts_be_java_walkthroughjava.md\":\"ff1f3524\",\"posts_be_spring_ioc_事务_ioc_事务.md\":\"dd0ccf49\",\"posts_be_java_java juc_java juc.md\":\"98b9461a\",\"posts_be_springboot_thinkinspringboot_index.md\":\"7ec8b442\",\"posts_be_netty_netty.md\":\"8bc5ced2\",\"posts_be_mybitis_mybatis.md\":\"7399d903\",\"posts_db_clickhouse_clickhouse.md\":\"3583290b\",\"posts_be_springsecurity_springsecurity.md\":\"7d403510\",\"posts_be_spring_ioc_di_ioc_di.md\":\"d359f291\",\"posts_be_java_java 反射_范型_java.md\":\"649c17e0\",\"posts_be_jvm_jvm.md\":\"e33dae6a\",\"posts_fe_css_css.md\":\"a48f7dd5\",\"posts_fe_nextjs_next.js.md\":\"726744ca\",\"posts_mw_kafka_kafkasource.md\":\"fe44e0d0\",\"posts_be_java_java 集合_java 集合.md\":\"7109b90b\",\"posts_be_maven_maven.md\":\"58c64129\",\"posts_工具_ffmpeg.md\":\"00828e25\",\"posts_db_mysql_mysql.md\":\"615c7762\",\"posts_be_springboot_springboot_springboot.md\":\"3654b7db\",\"posts_计算机网络_计算机网络.md\":\"35f345bb\",\"posts_mw_rocketmq_rocketmq model_rocketmq model.md\":\"be31331a\",\"posts_数据结构_数据结构.md\":\"ef43d941\",\"posts_mw_activemq_index.md\":\"57bf836b\",\"posts_be_java_java 基础_java 基础.md\":\"cb4f8698\",\"posts_be_spring_spring.md\":\"fe399f2b\",\"posts_devops_nginx_nginx.md\":\"4d00b8f1\",\"posts_mw_rocketmq_rocketmq source_rocketmq source.md\":\"be3a1a19\",\"posts_python_python.md\":\"28e1ad53\",\"posts_db_mysql_thinkinmysql.md\":\"e60b5a95\",\"posts_db_postgresql_pg 语句分析.md\":\"c50b7a9a\",\"posts_fe_react_react.md\":\"24535a3d\",\"posts_mw_elasticsearch_elasticsearch.md\":\"67cdd62e\",\"posts_设计模式_设计模式.md\":\"5cba33fa\",\"posts_devops_kubernetes_kubernetes.md\":\"05bdf0b6\",\"posts_db_redis_redis 配置详解.md\":\"647fc9da\",\"posts_db_redis_redis.md\":\"972d53b0\",\"posts_db_timescaledb_timescaledb.md\":\"9be440dc\",\"posts_devops_docker_docker.md\":\"5dcda033\",\"posts_devops_gitlab_gitlab.md\":\"5af474d2\",\"posts_devops_grafana_grafana.md\":\"c16533fa\",\"posts_devops_kubernetes_k8s.md\":\"49ac24fd\",\"posts_linux_linux.md\":\"d2642e20\",\"posts_fe_node.js_node.js.md\":\"67c006db\",\"posts_fe_react_react typescript.md\":\"8da32bf6\",\"posts_fe_typescript_typescript.md\":\"98287af5\",\"posts_mw_kafka_kafka.md\":\"60714ff2\",\"posts_fe_vuejs_vuejs.md\":\"6042096e\",\"posts_fe_项目配置.md\":\"72af3df7\",\"posts_linux_安装配置_centos 配置.md\":\"9384bdb9\",\"posts_linux_安装配置_manjora 安装配置.md\":\"35c701e6\",\"posts_math_math.md\":\"ee43ab3b\",\"posts_math_latex.md\":\"8f66f157\",\"posts_db_redis_redis 数据类型.md\":\"9a6c078f\",\"posts_linux_安装配置_ubuntu 安装配置.md\":\"51b1aedf\",\"posts_db_postgresql_postgresql.md\":\"708eb156\",\"posts_mw_rocketmq_rocketmq_rocketmq.md\":\"f57af8cb\",\"posts_fe_javascript_javascript.md\":\"3141d58c\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Gnl\",\"description\":\"Gnl's blog\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/about\",\"meta\":{\"sidebar\":false,\"title\":\"关于我\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"description\":\"\\n> gnl0ATqq.com\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/位运算\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"位运算基础以及常见用法\",\"title\":\"位运算\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/常见算法\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"常见算法思想汇总；分治、动态规划、贪心、回溯、分支界限\",\"title\":\"常见算法\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/article/文章整理\",\"meta\":{\"description\":\"文章推荐\",\"title\":\"文章整理\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/fe/项目配置\",\"meta\":{\"description\":\"前端项目配置\",\"tag\":[\"前端\"],\"title\":\"前端项目配置\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/linux/Linux\",\"meta\":{\"description\":\"Linux 笔记\",\"tag\":[\"Linux\"],\"title\":\"Linux\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/math/Latex\",\"meta\":{\"description\":\"LateX 常用语法\",\"tag\":[\"LateX\"],\"title\":\"LateX\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/math/Math\",\"meta\":{\"description\":\"基础数学函数\",\"title\":\"Math\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/python/Python\",\"meta\":{\"description\":\"Python 笔记\",\"tag\":[\"Python\"],\"title\":\"Python\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/工具/ffmpeg\",\"meta\":{\"description\":\"ffmpeg 常用命令\",\"tag\":[\"ffmpeg\"],\"title\":\"ffmpeg\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/数据结构/数据结构\",\"meta\":{\"description\":\"算法与数据结构笔记\",\"tag\":[\"算法\",\"数据结构\"],\"title\":\"算法与数据结构\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"https://img2018.cnblogs.com/blog/1648163/201909/1648163-20190919085122774-376085378.png\"}},{\"route\":\"/posts/计算机网络/计算机网络\",\"meta\":{\"description\":\"计算机网络笔记\",\"title\":\"计算机网络\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/设计模式/设计模式\",\"meta\":{\"description\":\"Java 设计模式笔记\",\"tag\":[\"设计模式\",\"Java\"],\"title\":\"设计模式\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Dubbo/Dubbo\",\"meta\":{\"description\":\"Apache Dubbo 是一款 RPC 服务开发框架，用于解决微服务架构下的服务治理与通信问题。\",\"tag\":[\"微服务\",\"Dubbo\",\"后端\"],\"title\":\"Dubbo\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/JVM/JVM\",\"meta\":{\"description\":\"JVM 详解，包括 JVM 体系结构、垃圾回收算法等\",\"tag\":[\"Java\",\"JVM\",\"后端\"],\"title\":\"JVM\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/WalkThroughJava\",\"meta\":{\"title\":\"Walk Though Java\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"description\":\" 多线程\\n 多线程异常处理方案\\n在使用 try-catch 的时候有一个条件通常会被忽略：try-catch 只能处理当前线程抛出的异常，在多线程情况下是无法 catch 到其他线程抛出的异常的。\\n看\",\"cover\":\"\"}},{\"route\":\"/posts/be/Maven/Maven\",\"meta\":{\"description\":\"Maven 笔记\",\"tag\":[\"后端\"],\"title\":\"Maven\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/MyBatis\",\"meta\":{\"description\":\"MyBatis 详解\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"MyBatis\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/mybatis-plus-generator\",\"meta\":{\"description\":\"MyBatis 代码生成器\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"mybatis-plus-generator\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Netty/Netty\",\"meta\":{\"description\":\"基于 Java NIO 封装的网络框架\",\"tag\":[\"Netty\",\"后端\"],\"title\":\"Netty\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/Spring\",\"meta\":{\"description\":\"Spring 框架详解\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringCloud/index\",\"meta\":{\"description\":\"SpringCloud 详解\",\"tag\":[\"SpringCloud\",\"后端\",\"微服务\"],\"title\":\"SpringCloud\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringSecurity/SpringSecurity\",\"meta\":{\"description\":\"SpringSecurity 笔记\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring Security\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/ClickHouse/ClickHouse\",\"meta\":{\"description\":\"ClickHouse 笔记\",\"tag\":[\"数据库\"],\"title\":\"ClickHouse\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/MySQL\",\"meta\":{\"description\":\"MySQL 详解\",\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"MySQL\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/ThinkInMySQL\",\"meta\":{\"description\":\"在使用 MySQL 的过程中的一些思考\",\"sticky\":true,\"top\":6,\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"Think In MySQL\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PG 语句分析\",\"meta\":{\"description\":\"记录 PostgreSQL 使用过程中 SQL 语句分析的历程\",\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PG 语句分析\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PostgreSQL\",\"meta\":{\"description\":\"PostgreSQL 详解，包含基础内容、高可用架构等\",\"top\":1,\"sticky\":true,\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PostgreSQL\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 数据类型\",\"meta\":{\"description\":\"Redis 数据类型详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 数据类型\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 配置详解\",\"meta\":{\"description\":\"Redis 配置详解\",\"top\":7,\"sticky\":true,\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 配置详解\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis\",\"meta\":{\"description\":\"Redis 详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/db/TimescaleDB/TimescaleDB\",\"meta\":{\"description\":\"TimescaleDB 详解\",\"top\":5,\"sticky\":true,\"tag\":[\"TimescaleDB\",\"时序数据库\",\"数据库\"],\"title\":\"TimescaleDB\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Docker/Docker\",\"meta\":{\"description\":\"Docker 详解\",\"tag\":[\"Docker\",\"DevOps\"],\"title\":\"Docker\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/devops/GitLab/GitLab\",\"meta\":{\"description\":\"GitLab 私服搭建\",\"top\":3,\"tag\":[\"GitLab\"],\"title\":\"GitLab\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Grafana/Grafana\",\"meta\":{\"description\":\"Grafana 监控搭建\",\"top\":2,\"tag\":[\"Grafana\",\"DevOps\"],\"title\":\"Grafana\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/K8S\",\"meta\":{\"isPublish\":false,\"title\":\"Kubernetes\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"description\":\" 虚拟化容器\\n Docker\\nDocker 与传统虚拟化方式的不同之处：Docker 容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，没有进行硬件虚拟；而传统虚拟机技术是虚拟出一套硬件后，\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/Kubernetes\",\"meta\":{\"description\":\"K8s 详解\",\"top\":4,\"sticky\":true,\"tag\":[\"K8s\",\"DevOps\"],\"title\":\"K8s\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg\"}},{\"route\":\"/posts/devops/Nginx/Nginx\",\"meta\":{\"description\":\"Nginx 详解\",\"tag\":[\"Nginx\"],\"title\":\"Nginx\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/CSS/CSS\",\"meta\":{\"description\":\"CSS 详解\",\"tag\":[\"前端\"],\"title\":\"CSS\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/JavaScript/JavaScript\",\"meta\":{\"description\":\"JavaScript 详解\",\"outline\":[2,3],\"tag\":[\"JavaScript\",\"前端\"],\"title\":\"JavaScript\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Nextjs/Next.js\",\"meta\":{\"description\":\"Next.js 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"Next.js\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Node.js/Node.js\",\"meta\":{\"description\":\"Node.js 笔记\",\"tag\":[\"前端\"],\"title\":\"Node.js\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React TypeScript\",\"meta\":{\"description\":\"React + TypeScript 笔记\",\"tag\":[\"React\",\"TypeScript\",\"前端\"],\"title\":\"React + TypeScript\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React\",\"meta\":{\"description\":\"React 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"React\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/TypeScript/TypeScript\",\"meta\":{\"description\":\"TypeScript 笔记\",\"tag\":[\"TypeScript\",\"前端\"],\"title\":\"TypeScript\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Vuejs/Vuejs\",\"meta\":{\"description\":\"Vue.js 笔记\",\"tag\":[\"Vue.js\",\"前端\"],\"title\":\"Vue.js\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/CentOS 配置\",\"meta\":{\"description\":\"CentOS 笔记\",\"tag\":[\"Linux\"],\"title\":\"CentOS 笔记\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Manjora 安装配置\",\"meta\":{\"description\":\"Manjora 笔记\",\"tag\":[\"Linux\"],\"title\":\"Manjora 安装\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Ubuntu 安装配置\",\"meta\":{\"description\":\"Ubuntu 安装\",\"tag\":[\"Linux\"],\"title\":\"Ubuntu 安装\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/ActiveMQ/index\",\"meta\":{\"description\":\"ActiveMQ 详解\",\"tag\":[\"MQ\",\"中间件\"],\"title\":\"ActiveMQ\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Elasticsearch/Elasticsearch\",\"meta\":{\"description\":\"Elasticsearch 详解\",\"outline\":[2,3],\"tag\":[\"Elasticsearch\",\"中间件\"],\"title\":\"Elasticsearch\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/Kafka\",\"meta\":{\"description\":\"Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/KafkaSource\",\"meta\":{\"description\":\"Kafka 源码深入\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka Source\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java IO/Java IO\",\"meta\":{\"description\":\"Java 中的 IO 操作，包括 BIO 和 NIO\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java IO\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java JUC/Java JUC\",\"meta\":{\"description\":\"JUC 指的是 `java.util.concurrent` 包及其子包下用于并发场景的类\",\"tag\":[\"Java\",\"后端\"],\"title\":\"JUC\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java lang/Java lang\",\"meta\":{\"title\":\"Java lang\",\"date\":\"2023-11-23 06:52:41\",\"tag\":[],\"description\":\"\\n Runtime\\n每一个 Java 程序都有一个单实例的 Runtime 对象，它允许正在运行的 Java 程序能够获取到运行环境信息。\\n一些常用的方法如下：\\n* `getRuntime()`\\n* \",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 反射+范型/Java\",\"meta\":{\"description\":\"Java 反射和泛型详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 反射和泛型\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 基础/Java 基础\",\"meta\":{\"description\":\"Java 基础内容\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 基础内容\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 多线程/Java 多线程\",\"meta\":{\"description\":\"Java 多线程详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 多线程\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 线程池/Java 线程池\",\"meta\":{\"description\":\"线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 线程池\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 进阶/Java 进阶\",\"meta\":{\"description\":\"Java 进阶内容，包括: SPI、JNDI\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 进阶\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 集合/Java 集合\",\"meta\":{\"description\":\"Java 集合部分详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 集合\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&DI/IOC&DI\",\"meta\":{\"description\":\"Spring IOC&DI\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&事务/IOC&事务\",\"meta\":{\"description\":\"Spring IOC & 事务\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/SpringBoot/SpringBoot\",\"meta\":{\"description\":\"SpringBoot 详解\",\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"SpringBoot\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/ThinkInSpringBoot/index\",\"meta\":{\"description\":\"深入 SpringBoot 源码与一点思考\",\"sticky\":true,\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"Think-in-Springboot\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringWeb/SpringMVC/SpringMVC\",\"meta\":{\"description\":\"Spring Web MVC 是建立在 Servlet API 上的 Web 框架\",\"tag\":[\"SpringMVC\",\"后端\"],\"title\":\"Spring MVC\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\",\"meta\":{\"description\":\"RocketMQ 是一个分布式的中间件服务，采用异步通信模型和发布/订阅消息传输模型。\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Model/RocketMQ Model\",\"meta\":{\"description\":\"RocketMQ 领域模型\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 领域模型\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Source/RocketMQ Source\",\"meta\":{\"description\":\"RocketMQ 源码解析\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 源码解析\",\"date\":\"2023-11-23 06:52:41\",\"cover\":\"\"}}],\"hotArticle\":{\"title\":\"Pinned\",\"nextText\":\"换一组\",\"pageSize\":5,\"empty\":\"暂无内容\"},\"recommend\":false,\"footer\":{\"copyright\":\"2023-Present | Gnl\",\"version\":false},\"themeColor\":\"el-green\",\"author\":\"Gnl\",\"comment\":{\"repo\":\"gnl00/gnl00.github.io\",\"repoId\":\"R_kgDOGR5o6w\",\"category\":\"Announcements\",\"categoryId\":\"DIC_kwDOGR5o684CatYO\"},\"mermaid\":true},\"lastUpdatedText\":\"上次更新\",\"logo\":\"/logo-transform.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"前端项目工程化\",\"link\":\"/posts/fe/项目配置\"},{\"text\":\"JavaScript\",\"link\":\"/posts/fe/JavaScript/JavaScript\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/TypeScript/TypeScript\"},{\"text\":\"React\",\"link\":\"/posts/fe/React/React\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/Vuejs/Vuejs\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"Java\",\"link\":\"/posts/be/Java/Java\"},{\"text\":\"Spring\",\"link\":\"/posts/be/Spring/Spring\"},{\"text\":\"SpringBoot\",\"link\":\"/posts/be/SpringBoot/SpringBoot\"},{\"text\":\"SpringCloud\",\"link\":\"/posts/be/SpringCloud/SpringCloud\"},{\"text\":\"Dubbo\",\"link\":\"/posts/be/Dubbo/Dubbo\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/posts/db/MySQL/MySQL\"},{\"text\":\"PostgreSQL\",\"link\":\"/posts/db/PostgreSQL/PostgreSQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/Redis/Redis\"}]},{\"text\":\"中间件\",\"items\":[{\"text\":\"Netty\",\"link\":\"/posts/mw/Netty/Netty\"},{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/Kafka/Kafka\"},{\"text\":\"Elesticsearch\",\"link\":\"/posts/mw/Elesticsearch/Elesticsearch\"}]},{\"text\":\"DevOps\",\"items\":[{\"text\":\"Docker\",\"link\":\"/posts/mw/Docker/Docker\"},{\"text\":\"Kubernetes\",\"link\":\"/posts/mw/Kubernetes/Kubernetes\"},{\"text\":\"GitLab\",\"link\":\"/posts/mw/GitLab/GitLab\"}]},{\"text\":\"关于\",\"link\":\"/about\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>