<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring | Gnl</title>
    <meta name="description" content="Spring IOC&DI">
    <link rel="preload stylesheet" href="/assets/style.8602ee05.css" as="style">
    
    <script type="module" src="/assets/app.10ab34f6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.b41230ea.js">
    <link rel="modulepreload" href="/assets/chunks/theme.80eede78.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-a837419f.908b30f0.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-34ebe643.cf616d16.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-9362ca72.6f3739a4.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-e232339a.d58edc84.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-007f5bf9.8898d963.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-bb8de4b5.11ac8dab.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-761fef4a.18f35b4f.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-8e129bc0.c1866605.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-525ea6f2.e536ede5.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-585325ee.02bf0b3c.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-eaee51ba.c1488b6e.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-8025bb1f.b111c2c5.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-d706aa6d.a15162d5.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-ad81aaa2.64333dca.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-c61244fe.a18b01a1.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-93a053d8.6c2bb354.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-654feea8.93773dd6.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-725b2045.84dadc0c.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-6075699d.8b32fb75.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-f7375806.8d247901.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-5b3884e4.4781f6c7.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.ade1a5ba.js">
    <link rel="modulepreload" href="/assets/chunks/giscus-2a044aea.497f0bd4.js">
    <link rel="modulepreload" href="/assets/posts_be_Spring_IOC_DI_IOC_DI.md.219dcd35.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-af5a5a9a data-v-ae5c84bb><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-5c56a737><div class="header" data-v-5c56a737><div class="title-wrapper" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i><span class="title" data-v-5c56a737></span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg><!--]--></i></div><!----><div class="footer content" data-v-5c56a737><!--[--><!--]--></div></div><div style="display:none;" class="theme-blog-popover-close" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ae5c84bb data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-transform.png" alt data-v-8426fc1a><!--]--><!--[-->Gnl<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-a0fd61f4 style="--54fbd49d:1;" data-v-bebd53ce><div class="nav-search-btn-wait" data-v-bebd53ce><svg width="14" height="14" viewBox="0 0 20 20" data-v-bebd53ce><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bebd53ce></path></svg><span class="search-tip" data-v-bebd53ce>Search</span><span class="metaKey" data-v-bebd53ce> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.html" data-v-43f1e123><!--[-->前端项目工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/JavaScript/JavaScript.html" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/TypeScript/TypeScript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/React/React.html" data-v-43f1e123><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/Vuejs/Vuejs.html" data-v-43f1e123><!--[-->Vue.js<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Java/Java.html" data-v-43f1e123><!--[-->Java<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Spring/Spring.html" data-v-43f1e123><!--[-->Spring<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringBoot/SpringBoot.html" data-v-43f1e123><!--[-->SpringBoot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringCloud/SpringCloud.html" data-v-43f1e123><!--[-->SpringCloud<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Dubbo/Dubbo.html" data-v-43f1e123><!--[-->Dubbo<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>数据库</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/MySQL/MySQL.html" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/PostgreSQL/PostgreSQL.html" data-v-43f1e123><!--[-->PostgreSQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/Redis/Redis.html" data-v-43f1e123><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>中间件</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Netty/Netty.html" data-v-43f1e123><!--[-->Netty<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/RocketMQ/RocketMQ/RocketMQ.html" data-v-43f1e123><!--[-->RocketMQ<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kafka/Kafka.html" data-v-43f1e123><!--[-->Kafka<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Elesticsearch/Elesticsearch.html" data-v-43f1e123><!--[-->Elesticsearch<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>DevOps</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Docker/Docker.html" data-v-43f1e123><!--[-->Docker<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kubernetes/Kubernetes.html" data-v-43f1e123><!--[-->Kubernetes<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/GitLab/GitLab.html" data-v-43f1e123><!--[-->GitLab<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-ae5c84bb data-v-79c8c1df><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-ae5c84bb data-v-669faec9><div class="VPDoc has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _posts_be_Spring_IOC&amp;DI_IOC&amp;DI" data-v-6b87e69f><div><h1 id="spring" tabindex="-1">Spring <a class="header-anchor" href="#spring" aria-label="Permalink to &quot;Spring&quot;">​</a></h1><h2 id="ioc" tabindex="-1">IOC <a class="header-anchor" href="#ioc" aria-label="Permalink to &quot;IOC&quot;">​</a></h2><p><strong>IOC的底层实际上是很多个不同的 map，BeanFacroty 负责创建 bean，之后存到相应的 map 中，下次再需要某个 bean 时，直接从 map 中获取即可。</strong></p><p>例如，单例非懒加载的 bean 在第一次创建完成之后都存储在同一个类型为 CurrentHashMap 的 map 中交由 spring 管理，之后每次需要只要从 map 中获取即可。</p><p>默认加在 IOC 容器的组件，容器启动的时候就会调用无参构造器创建对象，再进行初始化赋值等操作。</p><h3 id="xml配置" tabindex="-1">XML配置 <a class="header-anchor" href="#xml配置" aria-label="Permalink to &quot;XML配置&quot;">​</a></h3><h4 id="context-annotation-config" tabindex="-1">context:annotation-config <a class="header-anchor" href="#context-annotation-config" aria-label="Permalink to &quot;context:annotation-config&quot;">​</a></h4><p><strong>&lt; context:annotation-config&gt; 是用于激活那些已经在spring容器里注册过的bean上面的注解</strong>。并且使用&lt;context:annotation- config/&gt;即隐式地向 Spring容器注册<code>AutowiredAnnotationBeanPostProcessor</code>、<code>RequiredAnnotationBeanPostProcessor</code>、<code>CommonAnnotationBeanPostProcessor</code>以及<code>PersistenceAnnotationBeanPostProcessor</code>、<code>ConfigurationClassPostProcessor</code>这5个BeanPostProcessor。注册这5个BeanPostProcessor的作用，就是<strong>为了让你的系统能够识别相应的注解</strong>（@Required、@Autowired、@PostConstruct,、@PreDestroy and @Resource）。BeanPostProcessor就是处理注解的处理器。</p><p><strong>&lt; context:annotation-config &gt;仅能够在已经在已经注册过的bean上面起作用。对于没有在spring容器中注册的bean，它并不能执行任何操作。</strong></p><h4 id="context-component-scan" tabindex="-1">context:component-scan <a class="header-anchor" href="#context-component-scan" aria-label="Permalink to &quot;context:component-scan&quot;">​</a></h4><p><strong>&lt; context:annotation-config &gt;的简化配置</strong></p><p>除了<strong>具有&lt; context:annotation-config &gt;的功能</strong>之外，&lt; context:component-scan &gt;还可以在指定的package下扫描以及注册java bean 。还<strong>具有自动将带有@component，@service，@Repository等注解的对象注册到spring容器中的功能。</strong></p><p><strong>因此当使用 context:component-scan 后，就可以将 context:annotation-config移除。</strong></p><h3 id="注解配置" tabindex="-1">注解配置 <a class="header-anchor" href="#注解配置" aria-label="Permalink to &quot;注解配置&quot;">​</a></h3><p><strong>在配置类上标注@Configuration注解即可</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">* 配置类 == 以前的xml配置</span></span>
<span class="line"><span style="color:#6A737D;">* */</span></span>
<span class="line"><span style="color:#6A737D;">//告诉spring这是一个配置类</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Configuration</span></span>
<span class="line"><span style="color:#6A737D;">/*配置包扫描 == component-scan</span></span>
<span class="line"><span style="color:#6A737D;">Filter[] includeFilters 扫描时只要扫描哪些被包含在内的组件</span></span>
<span class="line"><span style="color:#6A737D;">excludeFilters = Filter[] 扫描的时候要排除哪些注解组件，配置内容和xml文件一致</span></span>
<span class="line"><span style="color:#6A737D;">@ComponentScan(value = &quot;com.demo.spring&quot;,excludeFilters = {</span></span>
<span class="line"><span style="color:#6A737D;">        @ComponentScan.Filter(type = FilterType.ANNOTATION,classes = {</span></span>
<span class="line"><span style="color:#6A737D;">                Controller.class, Service.class</span></span>
<span class="line"><span style="color:#6A737D;">        })</span></span>
<span class="line"><span style="color:#6A737D;">})*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ComponentScan</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">basePackages</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;com.demo.spring&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MainConfig</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * 给容器中注册组件：</span></span>
<span class="line"><span style="color:#6A737D;">    *   1）、包扫描+组件标注解【自己写的类】</span></span>
<span class="line"><span style="color:#6A737D;">    *   2）、@Bean【导入第三方包里的组件】</span></span>
<span class="line"><span style="color:#6A737D;">    *   3）、@Import【快速给容器中注册组件】</span></span>
<span class="line"><span style="color:#6A737D;">    *       1）、@Import({要导入到容器中的组件})；@Import({Color.class})容器中就会自动注册这个					组件，id默认是全类名</span></span>
<span class="line"><span style="color:#6A737D;">    *       2）、实现ImportSelector接口，返回需要导入的组件的全类名数组；</span></span>
<span class="line"><span style="color:#6A737D;">    *       3）、实现ImportBeanDefinitionRegistrar接口，手动注册bean</span></span>
<span class="line"><span style="color:#6A737D;">    *   4）、使用Spring提供的FactoryBean</span></span>
<span class="line"><span style="color:#6A737D;">    *       1）、默认获取到的是FactoryBean调用getObject创建的对像</span></span>
<span class="line"><span style="color:#6A737D;">    *               获取FactoryBean创建的bean对象</span></span>
<span class="line"><span style="color:#6A737D;">                    Object o = applicationContext.getBean(&quot;colorFactoryBean&quot;);</span></span>
<span class="line"><span style="color:#6A737D;">    *       2）、要获取FactoryBean本身需要给id前面加一个&amp;colorFactoryBean</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Bean</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> ColorFactoryBean </span><span style="color:#B392F0;">colorFactoryBean</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ColorFactoryBean</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">* 配置类 == 以前的xml配置</span></span>
<span class="line"><span style="color:#6A737D;">* */</span></span>
<span class="line"><span style="color:#6A737D;">//告诉spring这是一个配置类</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Configuration</span></span>
<span class="line"><span style="color:#6A737D;">/*配置包扫描 == component-scan</span></span>
<span class="line"><span style="color:#6A737D;">Filter[] includeFilters 扫描时只要扫描哪些被包含在内的组件</span></span>
<span class="line"><span style="color:#6A737D;">excludeFilters = Filter[] 扫描的时候要排除哪些注解组件，配置内容和xml文件一致</span></span>
<span class="line"><span style="color:#6A737D;">@ComponentScan(value = &quot;com.demo.spring&quot;,excludeFilters = {</span></span>
<span class="line"><span style="color:#6A737D;">        @ComponentScan.Filter(type = FilterType.ANNOTATION,classes = {</span></span>
<span class="line"><span style="color:#6A737D;">                Controller.class, Service.class</span></span>
<span class="line"><span style="color:#6A737D;">        })</span></span>
<span class="line"><span style="color:#6A737D;">})*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ComponentScan</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">basePackages</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;com.demo.spring&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainConfig</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * 给容器中注册组件：</span></span>
<span class="line"><span style="color:#6A737D;">    *   1）、包扫描+组件标注解【自己写的类】</span></span>
<span class="line"><span style="color:#6A737D;">    *   2）、@Bean【导入第三方包里的组件】</span></span>
<span class="line"><span style="color:#6A737D;">    *   3）、@Import【快速给容器中注册组件】</span></span>
<span class="line"><span style="color:#6A737D;">    *       1）、@Import({要导入到容器中的组件})；@Import({Color.class})容器中就会自动注册这个					组件，id默认是全类名</span></span>
<span class="line"><span style="color:#6A737D;">    *       2）、实现ImportSelector接口，返回需要导入的组件的全类名数组；</span></span>
<span class="line"><span style="color:#6A737D;">    *       3）、实现ImportBeanDefinitionRegistrar接口，手动注册bean</span></span>
<span class="line"><span style="color:#6A737D;">    *   4）、使用Spring提供的FactoryBean</span></span>
<span class="line"><span style="color:#6A737D;">    *       1）、默认获取到的是FactoryBean调用getObject创建的对像</span></span>
<span class="line"><span style="color:#6A737D;">    *               获取FactoryBean创建的bean对象</span></span>
<span class="line"><span style="color:#6A737D;">                    Object o = applicationContext.getBean(&quot;colorFactoryBean&quot;);</span></span>
<span class="line"><span style="color:#6A737D;">    *       2）、要获取FactoryBean本身需要给id前面加一个&amp;colorFactoryBean</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Bean</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> ColorFactoryBean </span><span style="color:#6F42C1;">colorFactoryBean</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ColorFactoryBean</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="bean注册" tabindex="-1">Bean注册 <a class="header-anchor" href="#bean注册" aria-label="Permalink to &quot;Bean注册&quot;">​</a></h3><ol><li><p><strong>xml</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">bean id</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;person&quot;</span><span style="color:#E1E4E8;"> class</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.entity.Person&quot;</span><span style="color:#E1E4E8;"> scope</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> init</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">method</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> destroy</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">method</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">property name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> value</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">bean</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">bean id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;person&quot;</span><span style="color:#24292E;"> class</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;com.demo.spring.entity.Person&quot;</span><span style="color:#24292E;"> scope</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> init</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">method</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> destroy</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">method</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">property name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> value</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">bean</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p><strong>特点</strong></p><ul><li><p>IOC 会根据 xml 中 bean 配置的顺序创建 bean，bean 销毁的顺序和创建的顺序相反。</p><p>可以通过调整bean之间的依赖来控制bean创建的顺序。</p><blockquote><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">depends-on=&quot;ccc,bbb&quot;：表示aaa创建依赖ccc和bbb</span></span>
<span class="line"><span style="color:#E1E4E8;">创建顺序为ccc  -&gt;  bbb -&gt;  aaa</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;aaa&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">depends-on</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;ccc,bbb&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;bbb&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;ccc&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">depends-on=&quot;ccc,bbb&quot;：表示aaa创建依赖ccc和bbb</span></span>
<span class="line"><span style="color:#24292E;">创建顺序为ccc  -&gt;  bbb -&gt;  aaa</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;aaa&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">depends-on</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;ccc,bbb&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;bbb&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;ccc&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></blockquote></li><li><p>默认为单例，跟随着容器启动而创建并保存到IOC容器中。可以修改scope属性为单例或原型（多实例）。原型对象不随着容器的启动创建，直到获取对象的时候才会创建。任何时候获取到的单例对象都是同一个，任何时候获取多实例对象都会创建新对象。</p></li><li><p>bean的赋值</p><ul><li><p>Setter设置</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- property name=&quot;userDao&quot; 其中的属性名由getter/setter方法决定，即去掉get/set后的属性名 --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;userDao&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ref</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;userDao&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    关于property标签的赋值</span></span>
<span class="line"><span style="color:#6A737D;">    设置null值</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;property name=&quot;register&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;null&gt;&lt;/null&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    为关联对象赋值</span></span>
<span class="line"><span style="color:#6A737D;">      ①引用</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;bean id=&quot;xxx&quot; class=&quot;xxx&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;property /&gt;...</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;property /&gt;...</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property name=&quot;register&quot; ref=&quot;xxx&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      ②在property内嵌套bean标签赋值</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      内部bean的id只能用作标识不能被引用，不能根据此id通过getBean创建对象</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;bean id=&quot;xxx&quot; /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      级联赋值：为引用对象的属性赋值</span></span>
<span class="line"><span style="color:#6A737D;">      User中关联Car对象</span></span>
<span class="line"><span style="color:#6A737D;">      注意：级联赋值后原来的bean属性可能也会被修改</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;property name=&quot;car.name&quot; value=&quot;xxx&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--关于bean的赋值</span></span>
<span class="line"><span style="color:#6A737D;">    为List&lt;Object&gt;赋值 ==》 为List赋值</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;list&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;bean /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;ref /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/list</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    为Map赋值</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;map&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            基本属性</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;entry key=&quot;&quot; value=&quot;&quot;&gt;&lt;/entry&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            对象</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;entry key=&quot;&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                &lt;bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                    &lt;property /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                &lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;/entry&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/map&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    为properties赋值</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;props&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        也是key=value类型数据，k=v都是String</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;prop key=&quot;&quot; &gt;value&lt;/prop&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/props&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    通过继承实现bean配置信息可重用，与Java中的继承类似</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;parentId&quot; class=&quot;&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;childId&quot; parent=&quot;parentId&quot; class=&quot;此处class可以省略&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    通过abstract创建一个模板（抽象）bean，不能通过getBean()获取实例，只能被继承</span></span>
<span class="line"><span style="color:#6A737D;">    与Java中的abstract类似</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;beanId&quot; class=&quot;&quot; abstract=&quot;true&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- property name=&quot;userDao&quot; 其中的属性名由getter/setter方法决定，即去掉get/set后的属性名 --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;userDao&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ref</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;userDao&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    关于property标签的赋值</span></span>
<span class="line"><span style="color:#6A737D;">    设置null值</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;property name=&quot;register&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;null&gt;&lt;/null&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    为关联对象赋值</span></span>
<span class="line"><span style="color:#6A737D;">      ①引用</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;bean id=&quot;xxx&quot; class=&quot;xxx&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;property /&gt;...</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;property /&gt;...</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property name=&quot;register&quot; ref=&quot;xxx&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      ②在property内嵌套bean标签赋值</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      内部bean的id只能用作标识不能被引用，不能根据此id通过getBean创建对象</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;bean id=&quot;xxx&quot; /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      级联赋值：为引用对象的属性赋值</span></span>
<span class="line"><span style="color:#6A737D;">      User中关联Car对象</span></span>
<span class="line"><span style="color:#6A737D;">      注意：级联赋值后原来的bean属性可能也会被修改</span></span>
<span class="line"><span style="color:#6A737D;">      &lt;property name=&quot;car.name&quot; value=&quot;xxx&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--关于bean的赋值</span></span>
<span class="line"><span style="color:#6A737D;">    为List&lt;Object&gt;赋值 ==》 为List赋值</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;list&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;bean /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;ref /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/list</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    为Map赋值</span></span>
<span class="line"><span style="color:#6A737D;">     &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;map&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            基本属性</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;entry key=&quot;&quot; value=&quot;&quot;&gt;&lt;/entry&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            对象</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;entry key=&quot;&quot;&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                &lt;bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                    &lt;property /&gt;</span></span>
<span class="line"><span style="color:#6A737D;">                &lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;/entry&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/map&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    为properties赋值</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;property&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;props&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        也是key=value类型数据，k=v都是String</span></span>
<span class="line"><span style="color:#6A737D;">            &lt;prop key=&quot;&quot; &gt;value&lt;/prop&gt;</span></span>
<span class="line"><span style="color:#6A737D;">        &lt;/props&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    通过继承实现bean配置信息可重用，与Java中的继承类似</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;parentId&quot; class=&quot;&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;childId&quot; parent=&quot;parentId&quot; class=&quot;此处class可以省略&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    通过abstract创建一个模板（抽象）bean，不能通过getBean()获取实例，只能被继承</span></span>
<span class="line"><span style="color:#6A737D;">    与Java中的abstract类似</span></span>
<span class="line"><span style="color:#6A737D;">    &lt;bean id=&quot;beanId&quot; class=&quot;&quot; abstract=&quot;true&quot;&gt;&lt;/bean&gt;</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span></code></pre></div></li><li><p>构造函数设置</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;userService2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.service.impl.UserServiceImpl2&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--调用有参构造器创建对象并赋值</span></span>
<span class="line"><span style="color:#6A737D;">        若有多个参数则要用到多条&lt;constructor-arg /&gt;标签</span></span>
<span class="line"><span style="color:#6A737D;">        同时在赋值的时候可以省略属性名（但是必须按照构造方法中参数的顺序赋值）</span></span>
<span class="line"><span style="color:#6A737D;">        若要赋值顺序不一致，则要将&lt;constructor-arg /&gt;标签中index的值设为与构造方法中参数位置对应的数值</span></span>
<span class="line"><span style="color:#6A737D;">        除了index还可以设置type参数，对应类型的参数才会被赋值</span></span>
<span class="line"><span style="color:#6A737D;">    --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--通过构造方法注入userDao--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">constructor-arg</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;userDao&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ref</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;userDao&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">index</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--name的值需要和构造方法中形参名一致--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">constructor-arg</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;isRegister&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;userService2&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.service.impl.UserServiceImpl2&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--调用有参构造器创建对象并赋值</span></span>
<span class="line"><span style="color:#6A737D;">        若有多个参数则要用到多条&lt;constructor-arg /&gt;标签</span></span>
<span class="line"><span style="color:#6A737D;">        同时在赋值的时候可以省略属性名（但是必须按照构造方法中参数的顺序赋值）</span></span>
<span class="line"><span style="color:#6A737D;">        若要赋值顺序不一致，则要将&lt;constructor-arg /&gt;标签中index的值设为与构造方法中参数位置对应的数值</span></span>
<span class="line"><span style="color:#6A737D;">        除了index还可以设置type参数，对应类型的参数才会被赋值</span></span>
<span class="line"><span style="color:#6A737D;">    --&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--通过构造方法注入userDao--&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">constructor-arg</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;userDao&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ref</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;userDao&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">index</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--name的值需要和构造方法中形参名一致--&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">constructor-arg</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;isRegister&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;true&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></li></ul></li></ul></li><li><p><strong>使用注解</strong></p><p>@Component、@Configuration或者@Bean</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Component</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Dog</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Dog</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Dog...Construct&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// JSR205引入，对象创建并赋值之后调用，相当于init-method</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PostConstruct</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Dog...init&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// JSR205引入，对象移除之前调用，相当于destroy-method</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PreDestroy</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Dog...destroy&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Dog</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Dog</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Dog...Construct&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// JSR205引入，对象创建并赋值之后调用，相当于init-method</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PostConstruct</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Dog...init&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// JSR205引入，对象移除之前调用，相当于destroy-method</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PreDestroy</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Dog...destroy&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * @Description 生命周期配置类</span></span>
<span class="line"><span style="color:#6A737D;"> * @Author Gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * @Time 2020/3/21 12:16</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/*配置包扫描 == component-scan</span></span>
<span class="line"><span style="color:#6A737D;">Filter[] includeFilters 扫描时只要扫描哪些被包含在内的组件</span></span>
<span class="line"><span style="color:#6A737D;">excludeFilters = Filter[] 扫描的时候要排除哪些注解组件，配置内容和xml文件一致</span></span>
<span class="line"><span style="color:#6A737D;">@ComponentScan(value = &quot;com.demo.spring&quot;,excludeFilters = {</span></span>
<span class="line"><span style="color:#6A737D;">        @ComponentScan.Filter(type = FilterType.ANNOTATION,classes = {</span></span>
<span class="line"><span style="color:#6A737D;">                Controller.class, Service.class</span></span>
<span class="line"><span style="color:#6A737D;">        })</span></span>
<span class="line"><span style="color:#6A737D;">})*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ComponentScans</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        @</span><span style="color:#F97583;">ComponentScan</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;com.demo.spring.bean&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">        @</span><span style="color:#F97583;">ComponentScan</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;com.demo.spring.utils&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#6A737D;">//使用@PropertySource读取外部配置文件中的k-v保存到运行环境变量中；</span></span>
<span class="line"><span style="color:#6A737D;">// 加载完外部配置文件后在pojo类中使用@Value(&quot;${k}&quot;)取值</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">PropertySource</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;classpath:person.properties&quot;</span><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#6A737D;">//@Profile(value = {&quot;dev&quot;})  写在配置类上，只有指定环境的时候整个配置类中的配置才会生效</span></span>
<span class="line"><span style="color:#6A737D;">// -Dspring.profiles.active=test</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Configuration</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">LifeCycleConfig</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * bean的生命周期</span></span>
<span class="line"><span style="color:#6A737D;">    	创建 -- 初始化 -- 销毁</span></span>
<span class="line"><span style="color:#6A737D;">    * 1）、指定初始化和销毁方法 @Bean(initMethod = &quot;&quot;,destroyMethod = &quot;&quot;)</span></span>
<span class="line"><span style="color:#6A737D;">    		也可使用@PostConstruct和@PreDestroy，若两种方式都存在，只会执行一次初始化			  方法和销毁方法</span></span>
<span class="line"><span style="color:#6A737D;">    *   构造（对象创建）</span></span>
<span class="line"><span style="color:#6A737D;">    *       单实例：在容器启动的时候创建对象</span></span>
<span class="line"><span style="color:#6A737D;">    *       多实例：在每次获取实例的时候都重新创建对象</span></span>
<span class="line"><span style="color:#6A737D;">    *   初始化：</span></span>
<span class="line"><span style="color:#6A737D;">    *       对象创建完成，并赋值好，调用初始化方法。</span></span>
<span class="line"><span style="color:#6A737D;">    *   销毁：</span></span>
<span class="line"><span style="color:#6A737D;">    *       单例：容器关闭的时候销毁</span></span>
<span class="line"><span style="color:#6A737D;">    *       原型：容器不会管理这个原型bean，容器关闭的时候不会调用销毁方法</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  2）、通过让bean实现InitializingBean接口（实现初始化逻辑）</span></span>
<span class="line"><span style="color:#6A737D;">    *                 实现DisposableBean接口（实现销毁逻辑）</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  3）、可以使用JSR250</span></span>
<span class="line"><span style="color:#6A737D;">    *           @PostConstruct : 在bean完成创建并且属性赋值完成；来执行初始化方法。</span></span>
<span class="line"><span style="color:#6A737D;">    *           @PreDestroy：在容器销毁bean之前通知我们进行清理工作</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  4）、实现BeanPostProcessor : bean的后置处理器</span></span>
<span class="line"><span style="color:#6A737D;">    *           在bean初始化前后进行一些处理工作</span></span>
<span class="line"><span style="color:#6A737D;">    *           postProcessBeforeInitialization：在初始化工作之前</span></span>
<span class="line"><span style="color:#6A737D;">    *           postProcessAfterInitialization：在初始化工作之后</span></span>
<span class="line"><span style="color:#6A737D;">    使用InitializingBean和@PostConstruct和@PreDestroy需要修改代码，不适用与第三方引用	 	包</span></span>
<span class="line"><span style="color:#6A737D;">    * */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * 标上Profile注解，只有在指定的环境下才注册比被标识的bean，</span></span>
<span class="line"><span style="color:#6A737D;">     *       默认环境为default</span></span>
<span class="line"><span style="color:#6A737D;">     * */</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Profile</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;dev&quot;</span><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Conditional</span><span style="color:#E1E4E8;">({WinCondition.class})</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    @Conditional()</span></span>
<span class="line"><span style="color:#6A737D;">        可以标在类上和方法上</span></span>
<span class="line"><span style="color:#6A737D;">        类上：满足当前条件，这个类中配置的所有bean注册才能生效</span></span>
<span class="line"><span style="color:#6A737D;">       方法上：满足当前条件，这个方法上的@Bean才生效</span></span>
<span class="line"><span style="color:#6A737D;">        按照条件给容器中注册bean</span></span>
<span class="line"><span style="color:#6A737D;">        value必须是实现了Condition的类</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//给容器中注册一个bean；类型为返回值类型，id默认就是方法名</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//默认注册的组件为单例模式</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//@Lazy懒加载</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//@Scope(&quot;singleton&quot;)修改生命周期</span></span>
<span class="line"><span style="color:#E1E4E8;">    	</span><span style="color:#6A737D;">//singleton : 跟随容器的启动创建</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//prototype： 不跟随容器的启动创建，获取的时候才创建,每次获取都创建一个新的对象</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//session： 同一个请求创建一个实例</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//request： 同一个session创建一个实例</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//@Bean(initMethod = &quot;init&quot;,destroyMethod = &quot;destroy&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Car </span><span style="color:#B392F0;">car</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Car</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * @Description 生命周期配置类</span></span>
<span class="line"><span style="color:#6A737D;"> * @Author Gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * @Time 2020/3/21 12:16</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/*配置包扫描 == component-scan</span></span>
<span class="line"><span style="color:#6A737D;">Filter[] includeFilters 扫描时只要扫描哪些被包含在内的组件</span></span>
<span class="line"><span style="color:#6A737D;">excludeFilters = Filter[] 扫描的时候要排除哪些注解组件，配置内容和xml文件一致</span></span>
<span class="line"><span style="color:#6A737D;">@ComponentScan(value = &quot;com.demo.spring&quot;,excludeFilters = {</span></span>
<span class="line"><span style="color:#6A737D;">        @ComponentScan.Filter(type = FilterType.ANNOTATION,classes = {</span></span>
<span class="line"><span style="color:#6A737D;">                Controller.class, Service.class</span></span>
<span class="line"><span style="color:#6A737D;">        })</span></span>
<span class="line"><span style="color:#6A737D;">})*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ComponentScans</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        @</span><span style="color:#D73A49;">ComponentScan</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;com.demo.spring.bean&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">        @</span><span style="color:#D73A49;">ComponentScan</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;com.demo.spring.utils&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#6A737D;">//使用@PropertySource读取外部配置文件中的k-v保存到运行环境变量中；</span></span>
<span class="line"><span style="color:#6A737D;">// 加载完外部配置文件后在pojo类中使用@Value(&quot;${k}&quot;)取值</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">PropertySource</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;classpath:person.properties&quot;</span><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#6A737D;">//@Profile(value = {&quot;dev&quot;})  写在配置类上，只有指定环境的时候整个配置类中的配置才会生效</span></span>
<span class="line"><span style="color:#6A737D;">// -Dspring.profiles.active=test</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Configuration</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">LifeCycleConfig</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * bean的生命周期</span></span>
<span class="line"><span style="color:#6A737D;">    	创建 -- 初始化 -- 销毁</span></span>
<span class="line"><span style="color:#6A737D;">    * 1）、指定初始化和销毁方法 @Bean(initMethod = &quot;&quot;,destroyMethod = &quot;&quot;)</span></span>
<span class="line"><span style="color:#6A737D;">    		也可使用@PostConstruct和@PreDestroy，若两种方式都存在，只会执行一次初始化			  方法和销毁方法</span></span>
<span class="line"><span style="color:#6A737D;">    *   构造（对象创建）</span></span>
<span class="line"><span style="color:#6A737D;">    *       单实例：在容器启动的时候创建对象</span></span>
<span class="line"><span style="color:#6A737D;">    *       多实例：在每次获取实例的时候都重新创建对象</span></span>
<span class="line"><span style="color:#6A737D;">    *   初始化：</span></span>
<span class="line"><span style="color:#6A737D;">    *       对象创建完成，并赋值好，调用初始化方法。</span></span>
<span class="line"><span style="color:#6A737D;">    *   销毁：</span></span>
<span class="line"><span style="color:#6A737D;">    *       单例：容器关闭的时候销毁</span></span>
<span class="line"><span style="color:#6A737D;">    *       原型：容器不会管理这个原型bean，容器关闭的时候不会调用销毁方法</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  2）、通过让bean实现InitializingBean接口（实现初始化逻辑）</span></span>
<span class="line"><span style="color:#6A737D;">    *                 实现DisposableBean接口（实现销毁逻辑）</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  3）、可以使用JSR250</span></span>
<span class="line"><span style="color:#6A737D;">    *           @PostConstruct : 在bean完成创建并且属性赋值完成；来执行初始化方法。</span></span>
<span class="line"><span style="color:#6A737D;">    *           @PreDestroy：在容器销毁bean之前通知我们进行清理工作</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    *  4）、实现BeanPostProcessor : bean的后置处理器</span></span>
<span class="line"><span style="color:#6A737D;">    *           在bean初始化前后进行一些处理工作</span></span>
<span class="line"><span style="color:#6A737D;">    *           postProcessBeforeInitialization：在初始化工作之前</span></span>
<span class="line"><span style="color:#6A737D;">    *           postProcessAfterInitialization：在初始化工作之后</span></span>
<span class="line"><span style="color:#6A737D;">    使用InitializingBean和@PostConstruct和@PreDestroy需要修改代码，不适用与第三方引用	 	包</span></span>
<span class="line"><span style="color:#6A737D;">    * */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * 标上Profile注解，只有在指定的环境下才注册比被标识的bean，</span></span>
<span class="line"><span style="color:#6A737D;">     *       默认环境为default</span></span>
<span class="line"><span style="color:#6A737D;">     * */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Profile</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;dev&quot;</span><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Conditional</span><span style="color:#24292E;">({WinCondition.class})</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    @Conditional()</span></span>
<span class="line"><span style="color:#6A737D;">        可以标在类上和方法上</span></span>
<span class="line"><span style="color:#6A737D;">        类上：满足当前条件，这个类中配置的所有bean注册才能生效</span></span>
<span class="line"><span style="color:#6A737D;">       方法上：满足当前条件，这个方法上的@Bean才生效</span></span>
<span class="line"><span style="color:#6A737D;">        按照条件给容器中注册bean</span></span>
<span class="line"><span style="color:#6A737D;">        value必须是实现了Condition的类</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//给容器中注册一个bean；类型为返回值类型，id默认就是方法名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//默认注册的组件为单例模式</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//@Lazy懒加载</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//@Scope(&quot;singleton&quot;)修改生命周期</span></span>
<span class="line"><span style="color:#24292E;">    	</span><span style="color:#6A737D;">//singleton : 跟随容器的启动创建</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//prototype： 不跟随容器的启动创建，获取的时候才创建,每次获取都创建一个新的对象</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//session： 同一个请求创建一个实例</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//request： 同一个session创建一个实例</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//@Bean(initMethod = &quot;init&quot;,destroyMethod = &quot;destroy&quot;)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Car </span><span style="color:#6F42C1;">car</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Car</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WinCondition</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Condition</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * ConditionContext context 判断条件能使用的上下文</span></span>
<span class="line"><span style="color:#6A737D;">    * AnnotatedTypeMetadata：注释信息</span></span>
<span class="line"><span style="color:#6A737D;">    * */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">matches</span><span style="color:#E1E4E8;">(ConditionContext </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">, AnnotatedTypeMetadata </span><span style="color:#FFAB70;">metadata</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        String osName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">getEnvironment</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getProperty</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;os.name&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 获取到bean定义的注册类</span></span>
<span class="line"><span style="color:#E1E4E8;">        BeanDefinitionRegistry registry </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">getRegistry</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//可以判断容器中bean注册的情况，也可以给容器中注册bean</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> person </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> registry.</span><span style="color:#B392F0;">containsBeanDefinition</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// person为true即为已经注册</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (osName.</span><span style="color:#B392F0;">toLowerCase</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">contains</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;windows&quot;</span><span style="color:#E1E4E8;">)){</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WinCondition</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Condition</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    * ConditionContext context 判断条件能使用的上下文</span></span>
<span class="line"><span style="color:#6A737D;">    * AnnotatedTypeMetadata：注释信息</span></span>
<span class="line"><span style="color:#6A737D;">    * */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">matches</span><span style="color:#24292E;">(ConditionContext </span><span style="color:#E36209;">context</span><span style="color:#24292E;">, AnnotatedTypeMetadata </span><span style="color:#E36209;">metadata</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String osName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> context.</span><span style="color:#6F42C1;">getEnvironment</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getProperty</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;os.name&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 获取到bean定义的注册类</span></span>
<span class="line"><span style="color:#24292E;">        BeanDefinitionRegistry registry </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> context.</span><span style="color:#6F42C1;">getRegistry</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//可以判断容器中bean注册的情况，也可以给容器中注册bean</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> person </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> registry.</span><span style="color:#6F42C1;">containsBeanDefinition</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// person为true即为已经注册</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (osName.</span><span style="color:#6F42C1;">toLowerCase</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">contains</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;windows&quot;</span><span style="color:#24292E;">)){</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p><strong>@Import</strong>，快速给容器中注册组件。</p><p><strong>使用</strong></p><ol><li><p>创建MyImportSelector类</p><ul><li>实现ImportSelectorXXX接口，返回需要导入的组件的全类名数组</li><li>实现ImportBeanDefinitionRegistrar接口，手动注册bean</li></ul></li><li><p>@Import({要导入到容器中的组件})；</p><p>@Import({Color.class})容器中就会自动注册这个组件，id默认是全类名</p></li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyImportSelector</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ImportSelector</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * @Description:  返回值就是要注册到容器中的组件的全类名</span></span>
<span class="line"><span style="color:#6A737D;">     * @Author: Gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * @Time: 2020/3/20 19:40</span></span>
<span class="line"><span style="color:#6A737D;">     * @param AnnotationMetadata importingClassMetadata ： 当前标注@Import注解类的所有注解信息</span></span>
<span class="line"><span style="color:#6A737D;">     * @return: java.lang.String[]</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#B392F0;">selectImports</span><span style="color:#E1E4E8;">(AnnotationMetadata </span><span style="color:#FFAB70;">importingClassMetadata</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">//        MergedAnnotations annotations = importingClassMetadata.getAnnotations();</span></span>
<span class="line"><span style="color:#6A737D;">//        for (MergedAnnotation&lt;Annotation&gt; annotation : annotations) {</span></span>
<span class="line"><span style="color:#6A737D;">//            System.out.println(annotation);</span></span>
<span class="line"><span style="color:#6A737D;">//        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;"> [] strings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;com.demo.spring.bean.Green&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;com.demo.spring.bean.Red&quot;</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//方法不要返回null值，否则会空指针异常</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> strings;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyImportSelector</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ImportSelector</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * @Description:  返回值就是要注册到容器中的组件的全类名</span></span>
<span class="line"><span style="color:#6A737D;">     * @Author: Gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * @Time: 2020/3/20 19:40</span></span>
<span class="line"><span style="color:#6A737D;">     * @param AnnotationMetadata importingClassMetadata ： 当前标注@Import注解类的所有注解信息</span></span>
<span class="line"><span style="color:#6A737D;">     * @return: java.lang.String[]</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#6F42C1;">selectImports</span><span style="color:#24292E;">(AnnotationMetadata </span><span style="color:#E36209;">importingClassMetadata</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#6A737D;">//        MergedAnnotations annotations = importingClassMetadata.getAnnotations();</span></span>
<span class="line"><span style="color:#6A737D;">//        for (MergedAnnotation&lt;Annotation&gt; annotation : annotations) {</span></span>
<span class="line"><span style="color:#6A737D;">//            System.out.println(annotation);</span></span>
<span class="line"><span style="color:#6A737D;">//        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">String</span><span style="color:#24292E;"> [] strings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;com.demo.spring.bean.Green&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;com.demo.spring.bean.Red&quot;</span><span style="color:#24292E;">};</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//方法不要返回null值，否则会空指针异常</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> strings;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyImportBeanDefinitionRegistrar</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ImportBeanDefinitionRegistrar</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * @Description</span></span>
<span class="line"><span style="color:#6A737D;">     * @Author: Gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * @Time: 2020/3/20 19:41</span></span>
<span class="line"><span style="color:#6A737D;">     * @param importingClassMetadata 当前类的注解信息</span></span>
<span class="line"><span style="color:#6A737D;">     * @param registry ： BeanDefinition 注册类</span></span>
<span class="line"><span style="color:#6A737D;">     *      把所有需要添加到容器中的bean：</span></span>
<span class="line"><span style="color:#6A737D;">     *          调用BeanDefinitionRegistry.registerBeanDefinition手动注册进来</span></span>
<span class="line"><span style="color:#6A737D;">     * @return: void </span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">registerBeanDefinitions</span><span style="color:#E1E4E8;">(AnnotationMetadata </span><span style="color:#FFAB70;">importingClassMetadata</span><span style="color:#E1E4E8;">, BeanDefinitionRegistry </span><span style="color:#FFAB70;">registry</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> red </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> registry.</span><span style="color:#B392F0;">containsBeanDefinition</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;com.demo.spring.bean.Red&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> green </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> registry.</span><span style="color:#B392F0;">containsBeanDefinition</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;com.demo.spring.bean.Green&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 若容器中已经注册了com.demo.spring.bean.Red和com.demo.spring.bean.Green，则手动注册一个id叫rainBow的bean</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (red </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> green) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 指定bean的信息；bean的类型</span></span>
<span class="line"><span style="color:#E1E4E8;">            RootBeanDefinition beanDefinition </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RootBeanDefinition</span><span style="color:#E1E4E8;">(RainBow.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 指定bean名</span></span>
<span class="line"><span style="color:#E1E4E8;">            registry.</span><span style="color:#B392F0;">registerBeanDefinition</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;rainBow&quot;</span><span style="color:#E1E4E8;">,beanDefinition);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyImportBeanDefinitionRegistrar</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ImportBeanDefinitionRegistrar</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * @Description</span></span>
<span class="line"><span style="color:#6A737D;">     * @Author: Gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * @Time: 2020/3/20 19:41</span></span>
<span class="line"><span style="color:#6A737D;">     * @param importingClassMetadata 当前类的注解信息</span></span>
<span class="line"><span style="color:#6A737D;">     * @param registry ： BeanDefinition 注册类</span></span>
<span class="line"><span style="color:#6A737D;">     *      把所有需要添加到容器中的bean：</span></span>
<span class="line"><span style="color:#6A737D;">     *          调用BeanDefinitionRegistry.registerBeanDefinition手动注册进来</span></span>
<span class="line"><span style="color:#6A737D;">     * @return: void </span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">registerBeanDefinitions</span><span style="color:#24292E;">(AnnotationMetadata </span><span style="color:#E36209;">importingClassMetadata</span><span style="color:#24292E;">, BeanDefinitionRegistry </span><span style="color:#E36209;">registry</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> red </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> registry.</span><span style="color:#6F42C1;">containsBeanDefinition</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;com.demo.spring.bean.Red&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> green </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> registry.</span><span style="color:#6F42C1;">containsBeanDefinition</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;com.demo.spring.bean.Green&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 若容器中已经注册了com.demo.spring.bean.Red和com.demo.spring.bean.Green，则手动注册一个id叫rainBow的bean</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (red </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> green) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 指定bean的信息；bean的类型</span></span>
<span class="line"><span style="color:#24292E;">            RootBeanDefinition beanDefinition </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RootBeanDefinition</span><span style="color:#24292E;">(RainBow.class);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 指定bean名</span></span>
<span class="line"><span style="color:#24292E;">            registry.</span><span style="color:#6F42C1;">registerBeanDefinition</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;rainBow&quot;</span><span style="color:#24292E;">,beanDefinition);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p><strong>静态工厂</strong>。工厂本身不用创建对象，通过调用工厂的静态方法，对象 = 工厂.工厂方法名。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">StaticFactory</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> UserService </span><span style="color:#B392F0;">createUserService</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        UserDao userDao </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserDaoImpl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        UserServiceImpl userService </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserServiceImpl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        userService.</span><span style="color:#B392F0;">setUserDao</span><span style="color:#E1E4E8;">(userDao);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> userService;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">StaticFactory</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> UserService </span><span style="color:#6F42C1;">createUserService</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        UserDao userDao </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserDaoImpl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        UserServiceImpl userService </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserServiceImpl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        userService.</span><span style="color:#6F42C1;">setUserDao</span><span style="color:#24292E;">(userDao);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> userService;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!--静态工厂</span></span>
<span class="line"><span style="color:#6A737D;">    class指定为静态工厂的全类名</span></span>
<span class="line"><span style="color:#6A737D;">    factory-method指定哪个方法是工厂方法</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;staticFactory&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.util.StaticFactory&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">factory-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;createUserService&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--若factory-method中指定的方法需要传参，使用&lt;constructor-arg /&gt;设置参数--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!--静态工厂</span></span>
<span class="line"><span style="color:#6A737D;">    class指定为静态工厂的全类名</span></span>
<span class="line"><span style="color:#6A737D;">    factory-method指定哪个方法是工厂方法</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;staticFactory&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.util.StaticFactory&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">factory-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;createUserService&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--若factory-method中指定的方法需要传参，使用&lt;constructor-arg /&gt;设置参数--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></li><li><p><strong>实例工厂</strong>。工厂本身需要创建对象</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">InstanceFactory</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> UserService </span><span style="color:#B392F0;">createUserService</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        UserDaoImpl userDao </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserDaoImpl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        UserServiceImpl userService </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserServiceImpl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        userService.</span><span style="color:#B392F0;">setUserDao</span><span style="color:#E1E4E8;">(userDao);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> userService;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InstanceFactory</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> UserService </span><span style="color:#6F42C1;">createUserService</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        UserDaoImpl userDao </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserDaoImpl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        UserServiceImpl userService </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserServiceImpl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        userService.</span><span style="color:#6F42C1;">setUserDao</span><span style="color:#24292E;">(userDao);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> userService;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!--实例工厂--&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--首先创建一个实例工厂的对象--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;instanceFactory&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.util.InstanceFactory&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    配置要创建的对象使用哪个工厂创建</span></span>
<span class="line"><span style="color:#6A737D;">        factory-bean指定使用的工厂实例</span></span>
<span class="line"><span style="color:#6A737D;">        factory-method指定使用的工厂方法</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;factoryUserService&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">factory-bean</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;instanceFactory&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">factory-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;createUserService&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!--实例工厂--&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--首先创建一个实例工厂的对象--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;instanceFactory&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.util.InstanceFactory&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--</span></span>
<span class="line"><span style="color:#6A737D;">    配置要创建的对象使用哪个工厂创建</span></span>
<span class="line"><span style="color:#6A737D;">        factory-bean指定使用的工厂实例</span></span>
<span class="line"><span style="color:#6A737D;">        factory-method指定使用的工厂方法</span></span>
<span class="line"><span style="color:#6A737D;">--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;factoryUserService&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">factory-bean</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;instanceFactory&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">factory-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;createUserService&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></li><li><p><strong>FactoryBean</strong></p><p>IOC 容器启动的时候不会创建实例，不管是单例还是原型模式都只是在使用的时候才创建</p><ul><li><p>默认获取到的是FactoryBean调用getObject创建的对像</p><p>获取FactoryBean创建的bean对象</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Object o </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> applicationContext.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;colorFactoryBean&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Object o </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> applicationContext.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;colorFactoryBean&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div></li><li><p>要获取FactoryBean本身需要给id前面加一个&quot;&amp;&quot;，即<code>&amp;colorFactoryBean</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Object factoryBean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> applicationContext.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&amp;colorFactoryBean&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Object factoryBean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> applicationContext.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&amp;colorFactoryBean&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div></li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyFactoryBean</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FactoryBean</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">getObject</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;使用MyFactoryBean来创建Bean&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        UserServiceImpl userService </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserServiceImpl</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        userService.</span><span style="color:#B392F0;">setUserDao</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserDaoImpl</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> userService;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Class&lt;</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#B392F0;">getObjectType</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> UserService.class;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyFactoryBean</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FactoryBean</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">getObject</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;使用MyFactoryBean来创建Bean&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        UserServiceImpl userService </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserServiceImpl</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        userService.</span><span style="color:#6F42C1;">setUserDao</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserDaoImpl</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> userService;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Class&lt;</span><span style="color:#D73A49;">?</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">getObjectType</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> UserService.class;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--FactoryBean--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!--默认单例</span></span>
<span class="line"><span style="color:#6A737D;">        IOC容器启动的时候不会创建实例</span></span>
<span class="line"><span style="color:#6A737D;">        不管是单例还是原型模式都只是在使用的时候才创建</span></span>
<span class="line"><span style="color:#6A737D;">    --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;myFactoryService&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.util.MyFactoryBean&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--FactoryBean--&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!--默认单例</span></span>
<span class="line"><span style="color:#6A737D;">        IOC容器启动的时候不会创建实例</span></span>
<span class="line"><span style="color:#6A737D;">        不管是单例还是原型模式都只是在使用的时候才创建</span></span>
<span class="line"><span style="color:#6A737D;">    --&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;myFactoryService&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.util.MyFactoryBean&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></li></ol><h3 id="bean创建流程" tabindex="-1">Bean创建流程 <a class="header-anchor" href="#bean创建流程" aria-label="Permalink to &quot;Bean创建流程&quot;">​</a></h3><p><strong>代码验证</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ClassPathXmlApplicationContext ac </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ClassPathXmlApplicationContext</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;classpath:spring/spring-context.xml&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.ClassPathXmlApplicationContext.java</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ClassPathXmlApplicationContext</span><span style="color:#E1E4E8;">(String configLocation) throws BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] {configLocation}, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ClassPathXmlApplicationContext</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] configLocations, </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> refresh, @</span><span style="color:#F97583;">Nullable</span><span style="color:#E1E4E8;"> ApplicationContext parent)</span></span>
<span class="line"><span style="color:#E1E4E8;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">(parent);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setConfigLocations</span><span style="color:#E1E4E8;">(configLocations);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (refresh) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">refresh</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.AbstractApplicationContext.java</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">refresh</span><span style="color:#E1E4E8;">() throws BeansException, IllegalStateException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 此处同步锁保证多线程情况下 IOC 容器指只会被创建一次</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.startupShutdownMonitor) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Prepare this context for refreshing.</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">prepareRefresh</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 获取BeanFactory，spring解析xml文件，将xml文件中bean的配置信息保存起来</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Tell the subclass to refresh the internal bean factory.</span></span>
<span class="line"><span style="color:#E1E4E8;">        ConfigurableListableBeanFactory beanFactory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">obtainFreshBeanFactory</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 准备BeanFactory</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Prepare the bean factory for use in this context.</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">prepareBeanFactory</span><span style="color:#E1E4E8;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Allows post-processing of the bean factory in context subclasses.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">postProcessBeanFactory</span><span style="color:#E1E4E8;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 调用在上下文中注册为bean的工厂处理器</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Invoke factory processors registered as beans in the context.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">invokeBeanFactoryPostProcessors</span><span style="color:#E1E4E8;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 注册spring自家的BeanPostProcessor（Bean后置处理器）</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Register bean processors that intercept bean creation.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">registerBeanPostProcessors</span><span style="color:#E1E4E8;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 支持国际化功能</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Initialize message source for this context.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">initMessageSource</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Initialize event multicaster for this context.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">initApplicationEventMulticaster</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 在特定上下文子类中初始化其他特殊bean</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Initialize other special beans in specific context subclasses.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">onRefresh</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Check for listener beans and register them.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">registerListeners</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 完成beanFacroty的初始化</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Instantiate all remaining (non-lazy-init) singletons.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">finishBeanFactoryInitialization</span><span style="color:#E1E4E8;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Last step: publish corresponding event.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">finishRefresh</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (BeansException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isWarnEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                logger.</span><span style="color:#B392F0;">warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Exception encountered during context initialization - &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#9ECBFF;">&quot;cancelling refresh attempt: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Destroy already created singletons to avoid dangling resources.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">destroyBeans</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Reset &#39;active&#39; flag.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cancelRefresh</span><span style="color:#E1E4E8;">(ex);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Propagate exception to caller.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Reset common introspection caches in Spring&#39;s core, since we</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// might not ever need metadata for singleton beans anymore...</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">resetCommonCaches</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.AbstractApplicationContext.java</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 完成此上下文的bean工厂的初始化，初始化所有剩余的单例bean</span></span>
<span class="line"><span style="color:#6A737D;"> * Finish the initialization of this context&#39;s bean factory,</span></span>
<span class="line"><span style="color:#6A737D;"> * initializing all remaining singleton beans.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">finishBeanFactoryInitialization</span><span style="color:#E1E4E8;">(ConfigurableListableBeanFactory beanFactory) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 为此上下文初始化转换服务</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Initialize conversion service for this context.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (beanFactory.</span><span style="color:#B392F0;">containsBean</span><span style="color:#E1E4E8;">(CONVERSION_SERVICE_BEAN_NAME) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#E1E4E8;">        beanFactory.</span><span style="color:#B392F0;">isTypeMatch</span><span style="color:#E1E4E8;">(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        beanFactory.</span><span style="color:#B392F0;">setConversionService</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">            beanFactory.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 如果之前没有任何bean后处理器（例如PropertyPlaceholderConfigurer bean）之前进行过注册，	 // 请注册一个默认的嵌入式值解析器，主要用于注释属性值的解析。</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Register a default embedded value resolver if no bean post-processor</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// at this point, primarily for resolution in annotation attribute values.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">beanFactory.</span><span style="color:#B392F0;">hasEmbeddedValueResolver</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        beanFactory.</span><span style="color:#B392F0;">addEmbeddedValueResolver</span><span style="color:#E1E4E8;">(strVal </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getEnvironment</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">resolvePlaceholders</span><span style="color:#E1E4E8;">(strVal));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 尽早初始化LoadTimeWeaverAware Bean，以便尽早注册其转换器。</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] weaverAwareNames </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> beanFactory.</span><span style="color:#B392F0;">getBeanNamesForType</span><span style="color:#E1E4E8;">(LoadTimeWeaverAware.class, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (String weaverAwareName </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> weaverAwareNames) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(weaverAwareName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 停止使用临时ClassLoader进行类型匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Stop using the temporary ClassLoader for type matching.</span></span>
<span class="line"><span style="color:#E1E4E8;">    beanFactory.</span><span style="color:#B392F0;">setTempClassLoader</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 冻结bean配置，不允许再对其进行修改</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 允许缓存所有bean定义元数据，不希望有进一步的更改</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Allow for caching all bean definition metadata, not expecting further changes.</span></span>
<span class="line"><span style="color:#E1E4E8;">    beanFactory.</span><span style="color:#B392F0;">freezeConfiguration</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Instantiate all remaining (non-lazy-init) singletons.</span></span>
<span class="line"><span style="color:#E1E4E8;">    beanFactory.</span><span style="color:#B392F0;">preInstantiateSingletons</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultListableBeanFactory.java</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">preInstantiateSingletons</span><span style="color:#E1E4E8;">() throws BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isTraceEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Pre-instantiating singletons in &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 遍历beanDefinitionNames拿到所有要创建的bean名</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span></span>
<span class="line"><span style="color:#E1E4E8;">    List&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; beanNames </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> ArrayList&lt;&gt;(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.beanDefinitionNames);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 开始按照xml中配置的顺序初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Trigger initialization of all non-lazy singleton beans...</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (String beanName </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> beanNames) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 根据bean的id获取xml中bean的定义信息</span></span>
<span class="line"><span style="color:#E1E4E8;">        RootBeanDefinition bd </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getMergedLocalBeanDefinition</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 判断bean是否是抽象，非懒加载的单例bean</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">bd.</span><span style="color:#B392F0;">isAbstract</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> bd.</span><span style="color:#B392F0;">isSingleton</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">bd.</span><span style="color:#B392F0;">isLazyInit</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 判断是否是工厂bean</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isFactoryBean</span><span style="color:#E1E4E8;">(beanName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                Object bean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(FACTORY_BEAN_PREFIX </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (bean </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> FactoryBean) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> FactoryBean&lt;</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">&gt; factory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (FactoryBean</span><span style="color:#F97583;">&lt;?&gt;</span><span style="color:#E1E4E8;">) bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> isEagerInit;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (System.</span><span style="color:#B392F0;">getSecurityManager</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> factory </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> SmartFactoryBean) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        isEagerInit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> AccessController.</span><span style="color:#B392F0;">doPrivileged</span><span style="color:#E1E4E8;">((PrivilegedAction</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">Boolean</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                                    ((SmartFactoryBean</span><span style="color:#F97583;">&lt;?&gt;</span><span style="color:#E1E4E8;">) factory)</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">isEagerInit,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                                    </span><span style="color:#B392F0;">getAccessControlContext</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        isEagerInit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (factory </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> SmartFactoryBean </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                       ((SmartFactoryBean</span><span style="color:#F97583;">&lt;?&gt;</span><span style="color:#E1E4E8;">) factory).</span><span style="color:#B392F0;">isEagerInit</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (isEagerInit) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 获取bean</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Trigger post-initialization callback for all applicable beans...</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (String beanName </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> beanNames) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Object singletonInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getSingleton</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (singletonInstance </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> SmartInitializingSingleton) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> SmartInitializingSingleton smartSingleton </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (SmartInitializingSingleton) singletonInstance;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (System.</span><span style="color:#B392F0;">getSecurityManager</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                AccessController.</span><span style="color:#B392F0;">doPrivileged</span><span style="color:#E1E4E8;">((PrivilegedAction</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">Object</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">) () </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    smartSingleton.</span><span style="color:#B392F0;">afterSingletonsInstantiated</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }, </span><span style="color:#B392F0;">getAccessControlContext</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                smartSingleton.</span><span style="color:#B392F0;">afterSingletonsInstantiated</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.AbstractBeanFactory.java</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(String name) throws BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 所有的getBean()方法都是调用doGetBean()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">doGetBean</span><span style="color:#E1E4E8;">(name, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.AbstractBeanFactory.java</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 返回可以与指定bean共享或独立的实例</span></span>
<span class="line"><span style="color:#6A737D;"> * Return an instance, which may be shared or independent, of the specified bean.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SuppressWarnings</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;unchecked&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">T</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> T </span><span style="color:#B392F0;">doGetBean</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> String name, @</span><span style="color:#F97583;">Nullable</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> Class</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">T</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> requiredType,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          @</span><span style="color:#F97583;">Nullable</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">Object</span><span style="color:#E1E4E8;">[] args, </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> typeCheckOnly) throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> String beanName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">transformedBeanName</span><span style="color:#E1E4E8;">(name);</span></span>
<span class="line"><span style="color:#E1E4E8;">    Object bean;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 先在注册过的单实例bean缓存中检查是否有已经手动注册过的单例bean</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Eagerly check singleton cache for manually registered singletons.</span></span>
<span class="line"><span style="color:#E1E4E8;">    Object sharedInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getSingleton</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (sharedInstance </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> args </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isTraceEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isSingletonCurrentlyInCreation</span><span style="color:#E1E4E8;">(beanName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Returning eagerly cached instance of singleton bean &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                             </span><span style="color:#9ECBFF;">&quot;&#39; that is not fully initialized yet - a consequence of a circular reference&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Returning cached instance of singleton bean &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        bean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getObjectForBeanInstance</span><span style="color:#E1E4E8;">(sharedInstance, name, beanName, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 如果已经在创建这个bean实例，则失败，抛出异常</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Fail if we&#39;re already creating this bean instance:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// We&#39;re assumably within a circular reference.</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isPrototypeCurrentlyInCreation</span><span style="color:#E1E4E8;">(beanName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanCurrentlyInCreationException</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Check if bean definition exists in this factory.</span></span>
<span class="line"><span style="color:#E1E4E8;">        BeanFactory parentBeanFactory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getParentBeanFactory</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (parentBeanFactory </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">containsBeanDefinition</span><span style="color:#E1E4E8;">(beanName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Not found -&gt; check parent.</span></span>
<span class="line"><span style="color:#E1E4E8;">            String nameToLookup </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">originalBeanName</span><span style="color:#E1E4E8;">(name);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (parentBeanFactory </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> AbstractBeanFactory) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> ((AbstractBeanFactory) parentBeanFactory).</span><span style="color:#B392F0;">doGetBean</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">                    nameToLookup, requiredType, args, typeCheckOnly);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (args </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// Delegation to parent with explicit args.</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (T) parentBeanFactory.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(nameToLookup, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (requiredType </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// No args -&gt; delegate to standard getBean method.</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> parentBeanFactory.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(nameToLookup, requiredType);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (T) parentBeanFactory.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(nameToLookup);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">typeCheckOnly) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 将bean标记为已创建，保证多线程下的单实例</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">markBeanAsCreated</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> RootBeanDefinition mbd </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getMergedLocalBeanDefinition</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">checkMergedBeanDefinition</span><span style="color:#E1E4E8;">(mbd, beanName, args);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 确保当前bean依赖的bean的初始化</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Guarantee initialization of beans that the current bean depends on.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] dependsOn </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> mbd.</span><span style="color:#B392F0;">getDependsOn</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 如果当前的bean依赖其他bean，则先初始化依赖的bean（depends-on属性）</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (dependsOn </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (String dep </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> dependsOn) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;">// 判断当前的bean和所依赖的bean之间是否形成了循环依赖，是则报异常</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isDependent</span><span style="color:#E1E4E8;">(beanName, dep)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanCreationException</span><span style="color:#E1E4E8;">(mbd.</span><span style="color:#B392F0;">getResourceDescription</span><span style="color:#E1E4E8;">(), beanName,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                        </span><span style="color:#9ECBFF;">&quot;Circular depends-on relationship between &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39; and &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dep </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">registerDependentBean</span><span style="color:#E1E4E8;">(dep, beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(dep);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (NoSuchBeanDefinitionException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanCreationException</span><span style="color:#E1E4E8;">(mbd.</span><span style="color:#B392F0;">getResourceDescription</span><span style="color:#E1E4E8;">(), beanName,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                        </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39; depends on missing bean &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dep </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">, ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 如果bean是单例的，则创建bean实例</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// Create bean instance.</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (mbd.</span><span style="color:#B392F0;">isSingleton</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                sharedInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getSingleton</span><span style="color:#E1E4E8;">(beanName, () </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createBean</span><span style="color:#E1E4E8;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (BeansException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;">// Explicitly remove instance from singleton cache: It might have been put there</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;">// eagerly by the creation process, to allow for circular reference resolution.</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;">// Also remove any beans that received a temporary reference to the bean.</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">destroySingleton</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                });</span></span>
<span class="line"><span style="color:#E1E4E8;">                bean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getObjectForBeanInstance</span><span style="color:#E1E4E8;">(sharedInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (mbd.</span><span style="color:#B392F0;">isPrototype</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// It&#39;s a prototype -&gt; create a new instance.</span></span>
<span class="line"><span style="color:#E1E4E8;">                Object prototypeInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">beforePrototypeCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    prototypeInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createBean</span><span style="color:#E1E4E8;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">afterPrototypeCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                bean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getObjectForBeanInstance</span><span style="color:#E1E4E8;">(prototypeInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                String scopeName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> mbd.</span><span style="color:#B392F0;">getScope</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> Scope scope </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.scopes.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(scopeName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (scope </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IllegalStateException</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;No Scope registered for scope name &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> scopeName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    Object scopedInstance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> scope.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(beanName, () </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">beforePrototypeCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createBean</span><span style="color:#E1E4E8;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">afterPrototypeCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    });</span></span>
<span class="line"><span style="color:#E1E4E8;">                    bean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getObjectForBeanInstance</span><span style="color:#E1E4E8;">(scopedInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (IllegalStateException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanCreationException</span><span style="color:#E1E4E8;">(beanName,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                    </span><span style="color:#9ECBFF;">&quot;Scope &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> scopeName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39; is not active for the current thread; consider &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                    </span><span style="color:#9ECBFF;">&quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                    ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (BeansException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cleanupAfterBeanCreationFailure</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Check if required type matches the type of the actual bean instance.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (requiredType </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">requiredType.</span><span style="color:#B392F0;">isInstance</span><span style="color:#E1E4E8;">(bean)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            T convertedBean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getTypeConverter</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">convertIfNecessary</span><span style="color:#E1E4E8;">(bean, requiredType);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (convertedBean </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanNotOfRequiredTypeException</span><span style="color:#E1E4E8;">(name, requiredType, bean.</span><span style="color:#B392F0;">getClass</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> convertedBean;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (TypeMismatchException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isTraceEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Failed to convert bean &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> name </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39; to required type &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                             ClassUtils.</span><span style="color:#B392F0;">getQualifiedName</span><span style="color:#E1E4E8;">(requiredType) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">, ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanNotOfRequiredTypeException</span><span style="color:#E1E4E8;">(name, requiredType, bean.</span><span style="color:#B392F0;">getClass</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (T) bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 返回以给定名称注册的（原始）单例对象，如果尚未注册，则创建并注册一个新对象。</span></span>
<span class="line"><span style="color:#6A737D;"> * Return the (raw) singleton object registered under the given name,</span></span>
<span class="line"><span style="color:#6A737D;"> * creating and registering a new one if none registered yet.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">getSingleton</span><span style="color:#E1E4E8;">(String beanName, ObjectFactory</span><span style="color:#F97583;">&lt;?&gt;</span><span style="color:#E1E4E8;"> singletonFactory) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    Assert.</span><span style="color:#B392F0;">notNull</span><span style="color:#E1E4E8;">(beanName, </span><span style="color:#9ECBFF;">&quot;Bean name must not be null&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonObjects) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 将bean从singletonObjects中get出来</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// singletonObjects：IOC容器之一。仅用来保存单实例bean。</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 用来缓存单例对象，将单例对象保存到一个map中，key==beanName，value==beanInstance</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#6A737D;">// private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);</span></span>
<span class="line"><span style="color:#E1E4E8;">        Object singletonObject </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonObjects.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (singletonObject </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonsCurrentlyInDestruction) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanCreationNotAllowedException</span><span style="color:#E1E4E8;">(beanName,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                          </span><span style="color:#9ECBFF;">&quot;Singleton bean creation not allowed while singletons of this factory are in destruction &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                          </span><span style="color:#9ECBFF;">&quot;(Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isDebugEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                logger.</span><span style="color:#B392F0;">debug</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Creating shared instance of singleton bean &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> beanName </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">beforeSingletonCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> newSingleton </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> recordSuppressedExceptions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.suppressedExceptions </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.suppressedExceptions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> LinkedHashSet&lt;&gt;();</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 创建bean</span></span>
<span class="line"><span style="color:#E1E4E8;">                singletonObject </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> singletonFactory.</span><span style="color:#B392F0;">getObject</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                newSingleton </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (IllegalStateException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// Has the singleton object implicitly appeared in the meantime -&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// if yes, proceed with it since the exception indicates that state.</span></span>
<span class="line"><span style="color:#E1E4E8;">                singletonObject </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonObjects.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (singletonObject </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (BeanCreationException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (Exception suppressedException </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.suppressedExceptions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        ex.</span><span style="color:#B392F0;">addRelatedCause</span><span style="color:#E1E4E8;">(suppressedException);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.suppressedExceptions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">afterSingletonCreation</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (newSingleton) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 添加创建的bean</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">addSingleton</span><span style="color:#E1E4E8;">(beanName, singletonObject);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> singletonObject;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 将给定的单例对象添加到该工厂的单例缓存中</span></span>
<span class="line"><span style="color:#6A737D;"> * 即将创建好的单例bean添加到singletonObject这个map中，以后从容器中获取bean只要从这个map中获取即可。</span></span>
<span class="line"><span style="color:#6A737D;"> * Add the given singleton object to the singleton cache of this factory.</span></span>
<span class="line"><span style="color:#6A737D;"> * &lt;p&gt;To be called for eager registration of singletons.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">addSingleton</span><span style="color:#E1E4E8;">(String beanName, Object singletonObject) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonObjects) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonObjects.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(beanName, singletonObject);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.singletonFactories.</span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.earlySingletonObjects.</span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.registeredSingletons.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ClassPathXmlApplicationContext ac </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ClassPathXmlApplicationContext</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;classpath:spring/spring-context.xml&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.ClassPathXmlApplicationContext.java</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ClassPathXmlApplicationContext</span><span style="color:#24292E;">(String configLocation) throws BeansException {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] {configLocation}, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ClassPathXmlApplicationContext</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] configLocations, </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> refresh, @</span><span style="color:#D73A49;">Nullable</span><span style="color:#24292E;"> ApplicationContext parent)</span></span>
<span class="line"><span style="color:#24292E;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(parent);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setConfigLocations</span><span style="color:#24292E;">(configLocations);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (refresh) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">refresh</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.AbstractApplicationContext.java</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">refresh</span><span style="color:#24292E;">() throws BeansException, IllegalStateException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 此处同步锁保证多线程情况下 IOC 容器指只会被创建一次</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.startupShutdownMonitor) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Prepare this context for refreshing.</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">prepareRefresh</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 获取BeanFactory，spring解析xml文件，将xml文件中bean的配置信息保存起来</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Tell the subclass to refresh the internal bean factory.</span></span>
<span class="line"><span style="color:#24292E;">        ConfigurableListableBeanFactory beanFactory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">obtainFreshBeanFactory</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 准备BeanFactory</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Prepare the bean factory for use in this context.</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">prepareBeanFactory</span><span style="color:#24292E;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Allows post-processing of the bean factory in context subclasses.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">postProcessBeanFactory</span><span style="color:#24292E;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 调用在上下文中注册为bean的工厂处理器</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Invoke factory processors registered as beans in the context.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">invokeBeanFactoryPostProcessors</span><span style="color:#24292E;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 注册spring自家的BeanPostProcessor（Bean后置处理器）</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Register bean processors that intercept bean creation.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">registerBeanPostProcessors</span><span style="color:#24292E;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 支持国际化功能</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Initialize message source for this context.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">initMessageSource</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Initialize event multicaster for this context.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">initApplicationEventMulticaster</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 在特定上下文子类中初始化其他特殊bean</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Initialize other special beans in specific context subclasses.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">onRefresh</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Check for listener beans and register them.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">registerListeners</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 完成beanFacroty的初始化</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Instantiate all remaining (non-lazy-init) singletons.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">finishBeanFactoryInitialization</span><span style="color:#24292E;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Last step: publish corresponding event.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">finishRefresh</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (BeansException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isWarnEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                logger.</span><span style="color:#6F42C1;">warn</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Exception encountered during context initialization - &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#032F62;">&quot;cancelling refresh attempt: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> ex);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Destroy already created singletons to avoid dangling resources.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">destroyBeans</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Reset &#39;active&#39; flag.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cancelRefresh</span><span style="color:#24292E;">(ex);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Propagate exception to caller.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Reset common introspection caches in Spring&#39;s core, since we</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// might not ever need metadata for singleton beans anymore...</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">resetCommonCaches</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.context.support.AbstractApplicationContext.java</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 完成此上下文的bean工厂的初始化，初始化所有剩余的单例bean</span></span>
<span class="line"><span style="color:#6A737D;"> * Finish the initialization of this context&#39;s bean factory,</span></span>
<span class="line"><span style="color:#6A737D;"> * initializing all remaining singleton beans.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">finishBeanFactoryInitialization</span><span style="color:#24292E;">(ConfigurableListableBeanFactory beanFactory) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 为此上下文初始化转换服务</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Initialize conversion service for this context.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (beanFactory.</span><span style="color:#6F42C1;">containsBean</span><span style="color:#24292E;">(CONVERSION_SERVICE_BEAN_NAME) </span><span style="color:#D73A49;">&amp;&amp;</span></span>
<span class="line"><span style="color:#24292E;">        beanFactory.</span><span style="color:#6F42C1;">isTypeMatch</span><span style="color:#24292E;">(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) {</span></span>
<span class="line"><span style="color:#24292E;">        beanFactory.</span><span style="color:#6F42C1;">setConversionService</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">            beanFactory.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 如果之前没有任何bean后处理器（例如PropertyPlaceholderConfigurer bean）之前进行过注册，	 // 请注册一个默认的嵌入式值解析器，主要用于注释属性值的解析。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Register a default embedded value resolver if no bean post-processor</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// at this point, primarily for resolution in annotation attribute values.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">beanFactory.</span><span style="color:#6F42C1;">hasEmbeddedValueResolver</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">        beanFactory.</span><span style="color:#6F42C1;">addEmbeddedValueResolver</span><span style="color:#24292E;">(strVal </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getEnvironment</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">resolvePlaceholders</span><span style="color:#24292E;">(strVal));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 尽早初始化LoadTimeWeaverAware Bean，以便尽早注册其转换器。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] weaverAwareNames </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> beanFactory.</span><span style="color:#6F42C1;">getBeanNamesForType</span><span style="color:#24292E;">(LoadTimeWeaverAware.class, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (String weaverAwareName </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> weaverAwareNames) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(weaverAwareName);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 停止使用临时ClassLoader进行类型匹配</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Stop using the temporary ClassLoader for type matching.</span></span>
<span class="line"><span style="color:#24292E;">    beanFactory.</span><span style="color:#6F42C1;">setTempClassLoader</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 冻结bean配置，不允许再对其进行修改</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 允许缓存所有bean定义元数据，不希望有进一步的更改</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Allow for caching all bean definition metadata, not expecting further changes.</span></span>
<span class="line"><span style="color:#24292E;">    beanFactory.</span><span style="color:#6F42C1;">freezeConfiguration</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Instantiate all remaining (non-lazy-init) singletons.</span></span>
<span class="line"><span style="color:#24292E;">    beanFactory.</span><span style="color:#6F42C1;">preInstantiateSingletons</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultListableBeanFactory.java</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">preInstantiateSingletons</span><span style="color:#24292E;">() throws BeansException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isTraceEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">        logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Pre-instantiating singletons in &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 遍历beanDefinitionNames拿到所有要创建的bean名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span></span>
<span class="line"><span style="color:#24292E;">    List&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; beanNames </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;&gt;(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.beanDefinitionNames);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 开始按照xml中配置的顺序初始化所有非懒加载的单实例bean</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Trigger initialization of all non-lazy singleton beans...</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (String beanName </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> beanNames) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 根据bean的id获取xml中bean的定义信息</span></span>
<span class="line"><span style="color:#24292E;">        RootBeanDefinition bd </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getMergedLocalBeanDefinition</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 判断bean是否是抽象，非懒加载的单例bean</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">bd.</span><span style="color:#6F42C1;">isAbstract</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> bd.</span><span style="color:#6F42C1;">isSingleton</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">bd.</span><span style="color:#6F42C1;">isLazyInit</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 判断是否是工厂bean</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isFactoryBean</span><span style="color:#24292E;">(beanName)) {</span></span>
<span class="line"><span style="color:#24292E;">                Object bean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(FACTORY_BEAN_PREFIX </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName);</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (bean </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> FactoryBean) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> FactoryBean&lt;</span><span style="color:#D73A49;">?</span><span style="color:#24292E;">&gt; factory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (FactoryBean</span><span style="color:#D73A49;">&lt;?&gt;</span><span style="color:#24292E;">) bean;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> isEagerInit;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (System.</span><span style="color:#6F42C1;">getSecurityManager</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> factory </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> SmartFactoryBean) {</span></span>
<span class="line"><span style="color:#24292E;">                        isEagerInit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> AccessController.</span><span style="color:#6F42C1;">doPrivileged</span><span style="color:#24292E;">((PrivilegedAction</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">Boolean</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                                                                    ((SmartFactoryBean</span><span style="color:#D73A49;">&lt;?&gt;</span><span style="color:#24292E;">) factory)</span><span style="color:#D73A49;">::</span><span style="color:#24292E;">isEagerInit,</span></span>
<span class="line"><span style="color:#24292E;">                                                                    </span><span style="color:#6F42C1;">getAccessControlContext</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        isEagerInit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (factory </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> SmartFactoryBean </span><span style="color:#D73A49;">&amp;&amp;</span></span>
<span class="line"><span style="color:#24292E;">                                       ((SmartFactoryBean</span><span style="color:#D73A49;">&lt;?&gt;</span><span style="color:#24292E;">) factory).</span><span style="color:#6F42C1;">isEagerInit</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (isEagerInit) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 获取bean</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Trigger post-initialization callback for all applicable beans...</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (String beanName </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> beanNames) {</span></span>
<span class="line"><span style="color:#24292E;">        Object singletonInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getSingleton</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (singletonInstance </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> SmartInitializingSingleton) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> SmartInitializingSingleton smartSingleton </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (SmartInitializingSingleton) singletonInstance;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (System.</span><span style="color:#6F42C1;">getSecurityManager</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                AccessController.</span><span style="color:#6F42C1;">doPrivileged</span><span style="color:#24292E;">((PrivilegedAction</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">Object</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">) () </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    smartSingleton.</span><span style="color:#6F42C1;">afterSingletonsInstantiated</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                }, </span><span style="color:#6F42C1;">getAccessControlContext</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                smartSingleton.</span><span style="color:#6F42C1;">afterSingletonsInstantiated</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.AbstractBeanFactory.java</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(String name) throws BeansException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 所有的getBean()方法都是调用doGetBean()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">doGetBean</span><span style="color:#24292E;">(name, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.AbstractBeanFactory.java</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 返回可以与指定bean共享或独立的实例</span></span>
<span class="line"><span style="color:#6A737D;"> * Return an instance, which may be shared or independent, of the specified bean.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SuppressWarnings</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;unchecked&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">T</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> T </span><span style="color:#6F42C1;">doGetBean</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> String name, @</span><span style="color:#D73A49;">Nullable</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> Class</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">T</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> requiredType,</span></span>
<span class="line"><span style="color:#24292E;">                          @</span><span style="color:#D73A49;">Nullable</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">[] args, </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> typeCheckOnly) throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> String beanName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">transformedBeanName</span><span style="color:#24292E;">(name);</span></span>
<span class="line"><span style="color:#24292E;">    Object bean;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 先在注册过的单实例bean缓存中检查是否有已经手动注册过的单例bean</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Eagerly check singleton cache for manually registered singletons.</span></span>
<span class="line"><span style="color:#24292E;">    Object sharedInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getSingleton</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (sharedInstance </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> args </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isTraceEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isSingletonCurrentlyInCreation</span><span style="color:#24292E;">(beanName)) {</span></span>
<span class="line"><span style="color:#24292E;">                logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Returning eagerly cached instance of singleton bean &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                             </span><span style="color:#032F62;">&quot;&#39; that is not fully initialized yet - a consequence of a circular reference&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Returning cached instance of singleton bean &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        bean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getObjectForBeanInstance</span><span style="color:#24292E;">(sharedInstance, name, beanName, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 如果已经在创建这个bean实例，则失败，抛出异常</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Fail if we&#39;re already creating this bean instance:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// We&#39;re assumably within a circular reference.</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isPrototypeCurrentlyInCreation</span><span style="color:#24292E;">(beanName)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanCurrentlyInCreationException</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Check if bean definition exists in this factory.</span></span>
<span class="line"><span style="color:#24292E;">        BeanFactory parentBeanFactory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getParentBeanFactory</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (parentBeanFactory </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">containsBeanDefinition</span><span style="color:#24292E;">(beanName)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Not found -&gt; check parent.</span></span>
<span class="line"><span style="color:#24292E;">            String nameToLookup </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">originalBeanName</span><span style="color:#24292E;">(name);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (parentBeanFactory </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> AbstractBeanFactory) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ((AbstractBeanFactory) parentBeanFactory).</span><span style="color:#6F42C1;">doGetBean</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">                    nameToLookup, requiredType, args, typeCheckOnly);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (args </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// Delegation to parent with explicit args.</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (T) parentBeanFactory.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(nameToLookup, args);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (requiredType </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// No args -&gt; delegate to standard getBean method.</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> parentBeanFactory.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(nameToLookup, requiredType);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (T) parentBeanFactory.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(nameToLookup);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">typeCheckOnly) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 将bean标记为已创建，保证多线程下的单实例</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">markBeanAsCreated</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> RootBeanDefinition mbd </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getMergedLocalBeanDefinition</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">checkMergedBeanDefinition</span><span style="color:#24292E;">(mbd, beanName, args);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 确保当前bean依赖的bean的初始化</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Guarantee initialization of beans that the current bean depends on.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] dependsOn </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> mbd.</span><span style="color:#6F42C1;">getDependsOn</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 如果当前的bean依赖其他bean，则先初始化依赖的bean（depends-on属性）</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (dependsOn </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (String dep </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> dependsOn) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// 判断当前的bean和所依赖的bean之间是否形成了循环依赖，是则报异常</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isDependent</span><span style="color:#24292E;">(beanName, dep)) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanCreationException</span><span style="color:#24292E;">(mbd.</span><span style="color:#6F42C1;">getResourceDescription</span><span style="color:#24292E;">(), beanName,</span></span>
<span class="line"><span style="color:#24292E;">                                                        </span><span style="color:#032F62;">&quot;Circular depends-on relationship between &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39; and &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> dep </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">registerDependentBean</span><span style="color:#24292E;">(dep, beanName);</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(dep);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (NoSuchBeanDefinitionException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanCreationException</span><span style="color:#24292E;">(mbd.</span><span style="color:#6F42C1;">getResourceDescription</span><span style="color:#24292E;">(), beanName,</span></span>
<span class="line"><span style="color:#24292E;">                                                        </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39; depends on missing bean &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> dep </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">, ex);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 如果bean是单例的，则创建bean实例</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Create bean instance.</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (mbd.</span><span style="color:#6F42C1;">isSingleton</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                sharedInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getSingleton</span><span style="color:#24292E;">(beanName, () </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createBean</span><span style="color:#24292E;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (BeansException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6A737D;">// Explicitly remove instance from singleton cache: It might have been put there</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6A737D;">// eagerly by the creation process, to allow for circular reference resolution.</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6A737D;">// Also remove any beans that received a temporary reference to the bean.</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">destroySingleton</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                });</span></span>
<span class="line"><span style="color:#24292E;">                bean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getObjectForBeanInstance</span><span style="color:#24292E;">(sharedInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (mbd.</span><span style="color:#6F42C1;">isPrototype</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// It&#39;s a prototype -&gt; create a new instance.</span></span>
<span class="line"><span style="color:#24292E;">                Object prototypeInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">beforePrototypeCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                    prototypeInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createBean</span><span style="color:#24292E;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">afterPrototypeCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                bean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getObjectForBeanInstance</span><span style="color:#24292E;">(prototypeInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                String scopeName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> mbd.</span><span style="color:#6F42C1;">getScope</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> Scope scope </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.scopes.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(scopeName);</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (scope </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IllegalStateException</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;No Scope registered for scope name &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> scopeName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    Object scopedInstance </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> scope.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(beanName, () </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">beforePrototypeCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createBean</span><span style="color:#24292E;">(beanName, mbd, args);</span></span>
<span class="line"><span style="color:#24292E;">                        }</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">afterPrototypeCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                        }</span></span>
<span class="line"><span style="color:#24292E;">                    });</span></span>
<span class="line"><span style="color:#24292E;">                    bean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getObjectForBeanInstance</span><span style="color:#24292E;">(scopedInstance, name, beanName, mbd);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (IllegalStateException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanCreationException</span><span style="color:#24292E;">(beanName,</span></span>
<span class="line"><span style="color:#24292E;">                                                    </span><span style="color:#032F62;">&quot;Scope &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> scopeName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39; is not active for the current thread; consider &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                                                    </span><span style="color:#032F62;">&quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                                    ex);</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (BeansException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cleanupAfterBeanCreationFailure</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Check if required type matches the type of the actual bean instance.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (requiredType </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">requiredType.</span><span style="color:#6F42C1;">isInstance</span><span style="color:#24292E;">(bean)) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            T convertedBean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getTypeConverter</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">convertIfNecessary</span><span style="color:#24292E;">(bean, requiredType);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (convertedBean </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanNotOfRequiredTypeException</span><span style="color:#24292E;">(name, requiredType, bean.</span><span style="color:#6F42C1;">getClass</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> convertedBean;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (TypeMismatchException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isTraceEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Failed to convert bean &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> name </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39; to required type &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                             ClassUtils.</span><span style="color:#6F42C1;">getQualifiedName</span><span style="color:#24292E;">(requiredType) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">, ex);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanNotOfRequiredTypeException</span><span style="color:#24292E;">(name, requiredType, bean.</span><span style="color:#6F42C1;">getClass</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (T) bean;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 返回以给定名称注册的（原始）单例对象，如果尚未注册，则创建并注册一个新对象。</span></span>
<span class="line"><span style="color:#6A737D;"> * Return the (raw) singleton object registered under the given name,</span></span>
<span class="line"><span style="color:#6A737D;"> * creating and registering a new one if none registered yet.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">getSingleton</span><span style="color:#24292E;">(String beanName, ObjectFactory</span><span style="color:#D73A49;">&lt;?&gt;</span><span style="color:#24292E;"> singletonFactory) {</span></span>
<span class="line"><span style="color:#24292E;">    Assert.</span><span style="color:#6F42C1;">notNull</span><span style="color:#24292E;">(beanName, </span><span style="color:#032F62;">&quot;Bean name must not be null&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonObjects) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 将bean从singletonObjects中get出来</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// singletonObjects：IOC容器之一。仅用来保存单实例bean。</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 用来缓存单例对象，将单例对象保存到一个map中，key==beanName，value==beanInstance</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6A737D;">// private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);</span></span>
<span class="line"><span style="color:#24292E;">        Object singletonObject </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonObjects.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (singletonObject </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonsCurrentlyInDestruction) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanCreationNotAllowedException</span><span style="color:#24292E;">(beanName,</span></span>
<span class="line"><span style="color:#24292E;">                                                          </span><span style="color:#032F62;">&quot;Singleton bean creation not allowed while singletons of this factory are in destruction &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                                                          </span><span style="color:#032F62;">&quot;(Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isDebugEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                logger.</span><span style="color:#6F42C1;">debug</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Creating shared instance of singleton bean &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> beanName </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">beforeSingletonCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> newSingleton </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> recordSuppressedExceptions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.suppressedExceptions </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.suppressedExceptions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedHashSet&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 创建bean</span></span>
<span class="line"><span style="color:#24292E;">                singletonObject </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> singletonFactory.</span><span style="color:#6F42C1;">getObject</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                newSingleton </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (IllegalStateException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// Has the singleton object implicitly appeared in the meantime -&gt;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// if yes, proceed with it since the exception indicates that state.</span></span>
<span class="line"><span style="color:#24292E;">                singletonObject </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonObjects.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (singletonObject </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (BeanCreationException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (Exception suppressedException </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.suppressedExceptions) {</span></span>
<span class="line"><span style="color:#24292E;">                        ex.</span><span style="color:#6F42C1;">addRelatedCause</span><span style="color:#24292E;">(suppressedException);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.suppressedExceptions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">afterSingletonCreation</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (newSingleton) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 添加创建的bean</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">addSingleton</span><span style="color:#24292E;">(beanName, singletonObject);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> singletonObject;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//**********************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 将给定的单例对象添加到该工厂的单例缓存中</span></span>
<span class="line"><span style="color:#6A737D;"> * 即将创建好的单例bean添加到singletonObject这个map中，以后从容器中获取bean只要从这个map中获取即可。</span></span>
<span class="line"><span style="color:#6A737D;"> * Add the given singleton object to the singleton cache of this factory.</span></span>
<span class="line"><span style="color:#6A737D;"> * &lt;p&gt;To be called for eager registration of singletons.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">addSingleton</span><span style="color:#24292E;">(String beanName, Object singletonObject) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonObjects) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonObjects.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(beanName, singletonObject);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.singletonFactories.</span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.earlySingletonObjects.</span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.registeredSingletons.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(beanName);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><img src="/assets/bean创建流程.ae169a58.png" alt="bean创建流程"></p><h3 id="bean装配" tabindex="-1">Bean装配 <a class="header-anchor" href="#bean装配" aria-label="Permalink to &quot;Bean装配&quot;">​</a></h3><h4 id="定义初始化和销毁逻辑" tabindex="-1">定义初始化和销毁逻辑 <a class="header-anchor" href="#定义初始化和销毁逻辑" aria-label="Permalink to &quot;定义初始化和销毁逻辑&quot;">​</a></h4><h5 id="bean的初始化和销毁方法" tabindex="-1">bean的初始化和销毁方法 <a class="header-anchor" href="#bean的初始化和销毁方法" aria-label="Permalink to &quot;bean的初始化和销毁方法&quot;">​</a></h5><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- xml配置 --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> &gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- xml配置 --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> &gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Bean</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">initMethod</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">destroyMethod</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">或</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">PostConstruct和</span><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">PreDestroy</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Bean</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">initMethod</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">destroyMethod</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">或</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">PostConstruct和</span><span style="color:#24292E;">@</span><span style="color:#D73A49;">PreDestroy</span></span></code></pre></div><h5 id="initializingbean-disposablebean" tabindex="-1">InitializingBean&amp;DisposableBean <a class="header-anchor" href="#initializingbean-disposablebean" aria-label="Permalink to &quot;InitializingBean&amp;DisposableBean&quot;">​</a></h5><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Person</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">InitializingBean</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">DisposableBean</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Person</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...NoArgsConstructor&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setAge</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">age</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...setAge&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.age </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PostConstruct</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">initMethod</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...initMethod&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PreDestroy</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroyMethod</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...destroyMethod&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">afterPropertiesSet</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...InitializingBean...afterPropertiesSet&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...DisposableBean...destroy&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Person</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InitializingBean</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">DisposableBean</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String name;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Person</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...NoArgsConstructor&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setAge</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">age</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...setAge&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.age </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> age;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PostConstruct</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">initMethod</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...initMethod&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PreDestroy</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroyMethod</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...destroyMethod&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">afterPropertiesSet</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...InitializingBean...afterPropertiesSet&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...DisposableBean...destroy&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h5 id="beanpostprocessor" tabindex="-1">BeanPostProcessor <a class="header-anchor" href="#beanpostprocessor" aria-label="Permalink to &quot;BeanPostProcessor&quot;">​</a></h5><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 为了了让Bean后置处理器工作，需要将它加入到容器中</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@since</span><span style="color:#6A737D;"> 2020-05-05 16:09</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Component</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyBeanPostProcessor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanPostProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">postProcessBeforeInitialization</span><span style="color:#E1E4E8;">(Object </span><span style="color:#FFAB70;">bean</span><span style="color:#E1E4E8;">, String </span><span style="color:#FFAB70;">beanName</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(beanName</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;...BeanPostProcessor...postProcessBeforeInitialization&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">postProcessAfterInitialization</span><span style="color:#E1E4E8;">(Object </span><span style="color:#FFAB70;">bean</span><span style="color:#E1E4E8;">, String </span><span style="color:#FFAB70;">beanName</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(beanName</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;...BeanPostProcessor...postProcessAfterInitialization&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 为了了让Bean后置处理器工作，需要将它加入到容器中</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@since</span><span style="color:#6A737D;"> 2020-05-05 16:09</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyBeanPostProcessor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanPostProcessor</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">postProcessBeforeInitialization</span><span style="color:#24292E;">(Object </span><span style="color:#E36209;">bean</span><span style="color:#24292E;">, String </span><span style="color:#E36209;">beanName</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(beanName</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;...BeanPostProcessor...postProcessBeforeInitialization&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> bean;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">postProcessAfterInitialization</span><span style="color:#24292E;">(Object </span><span style="color:#E36209;">bean</span><span style="color:#24292E;">, String </span><span style="color:#E36209;">beanName</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(beanName</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;...BeanPostProcessor...postProcessAfterInitialization&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> bean;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>源码解析</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">populateBean</span><span style="color:#E1E4E8;">(beanName, mbd, instanceWrapper); </span><span style="color:#6A737D;">//设置当前bean属性值</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">populateBean</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">mbd.</span><span style="color:#B392F0;">isSynthetic</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">hasInstantiationAwareBeanPostProcessors</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (BeanPostProcessor bp </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getBeanPostProcessors</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (bp </span><span style="color:#F97583;">instanceof</span><span style="color:#E1E4E8;"> InstantiationAwareBeanPostProcessor) {</span></span>
<span class="line"><span style="color:#E1E4E8;">					InstantiationAwareBeanPostProcessor ibp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (InstantiationAwareBeanPostProcessor) bp;</span></span>
<span class="line"><span style="color:#E1E4E8;">					</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">ibp.</span><span style="color:#B392F0;">postProcessAfterInstantiation</span><span style="color:#E1E4E8;">(bw.</span><span style="color:#B392F0;">getWrappedInstance</span><span style="color:#E1E4E8;">(), beanName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">						</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">					}</span></span>
<span class="line"><span style="color:#E1E4E8;">				}</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 赋值完成后开始初始化</span></span>
<span class="line"><span style="color:#E1E4E8;">exposedObject </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">initializeBean</span><span style="color:#E1E4E8;">(beanName, exposedObject, mbd);</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">initializeBean</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">    wrappedBean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">applyBeanPostProcessorsBeforeInitialization</span><span style="color:#E1E4E8;">(wrappedBean, beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">invokeInitMethods</span><span style="color:#E1E4E8;">(beanName, wrappedBean, mbd); </span><span style="color:#6A737D;">// 执行初始化方法</span></span>
<span class="line"><span style="color:#E1E4E8;">    wrappedBean </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">applyBeanPostProcessorsAfterInitialization</span><span style="color:#E1E4E8;">(wrappedBean, beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">applyBeanPostProcessorsBeforeInitialization</span><span style="color:#E1E4E8;">(Object existingBean, String beanName)</span></span>
<span class="line"><span style="color:#E1E4E8;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    Object result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> existingBean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 循环遍历得到容器中所有的bean后置处理器，挨个执行postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (BeanPostProcessor processor </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getBeanPostProcessors</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Object current </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> processor.</span><span style="color:#B392F0;">postProcessBeforeInitialization</span><span style="color:#E1E4E8;">(result, beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 一旦返回null，跳出循环，后面的bean后置处理器都不会执行</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (current </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> result;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> current;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> result;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">applyBeanPostProcessorsAfterInitialization</span><span style="color:#E1E4E8;">(Object existingBean, String beanName)</span></span>
<span class="line"><span style="color:#E1E4E8;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    Object result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> existingBean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 循环遍历得到容器中所有的bean后置处理器，挨个执行postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (BeanPostProcessor processor </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getBeanPostProcessors</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Object current </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> processor.</span><span style="color:#B392F0;">postProcessAfterInitialization</span><span style="color:#E1E4E8;">(result, beanName);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (current </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> result;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> current;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> result;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">populateBean</span><span style="color:#24292E;">(beanName, mbd, instanceWrapper); </span><span style="color:#6A737D;">//设置当前bean属性值</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">populateBean</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">mbd.</span><span style="color:#6F42C1;">isSynthetic</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">hasInstantiationAwareBeanPostProcessors</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (BeanPostProcessor bp </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getBeanPostProcessors</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (bp </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> InstantiationAwareBeanPostProcessor) {</span></span>
<span class="line"><span style="color:#24292E;">					InstantiationAwareBeanPostProcessor ibp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (InstantiationAwareBeanPostProcessor) bp;</span></span>
<span class="line"><span style="color:#24292E;">					</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">ibp.</span><span style="color:#6F42C1;">postProcessAfterInstantiation</span><span style="color:#24292E;">(bw.</span><span style="color:#6F42C1;">getWrappedInstance</span><span style="color:#24292E;">(), beanName)) {</span></span>
<span class="line"><span style="color:#24292E;">						</span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">					}</span></span>
<span class="line"><span style="color:#24292E;">				}</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 赋值完成后开始初始化</span></span>
<span class="line"><span style="color:#24292E;">exposedObject </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">initializeBean</span><span style="color:#24292E;">(beanName, exposedObject, mbd);</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">initializeBean</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">    wrappedBean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">applyBeanPostProcessorsBeforeInitialization</span><span style="color:#24292E;">(wrappedBean, beanName);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">invokeInitMethods</span><span style="color:#24292E;">(beanName, wrappedBean, mbd); </span><span style="color:#6A737D;">// 执行初始化方法</span></span>
<span class="line"><span style="color:#24292E;">    wrappedBean </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">applyBeanPostProcessorsAfterInitialization</span><span style="color:#24292E;">(wrappedBean, beanName);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">applyBeanPostProcessorsBeforeInitialization</span><span style="color:#24292E;">(Object existingBean, String beanName)</span></span>
<span class="line"><span style="color:#24292E;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    Object result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> existingBean;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 循环遍历得到容器中所有的bean后置处理器，挨个执行postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (BeanPostProcessor processor </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getBeanPostProcessors</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">        Object current </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processor.</span><span style="color:#6F42C1;">postProcessBeforeInitialization</span><span style="color:#24292E;">(result, beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 一旦返回null，跳出循环，后面的bean后置处理器都不会执行</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (current </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> current;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">applyBeanPostProcessorsAfterInitialization</span><span style="color:#24292E;">(Object existingBean, String beanName)</span></span>
<span class="line"><span style="color:#24292E;">    throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    Object result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> existingBean;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 循环遍历得到容器中所有的bean后置处理器，挨个执行postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (BeanPostProcessor processor </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getBeanPostProcessors</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">        Object current </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processor.</span><span style="color:#6F42C1;">postProcessAfterInitialization</span><span style="color:#24292E;">(result, beanName);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (current </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> current;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="装配流程" tabindex="-1">装配流程 <a class="header-anchor" href="#装配流程" aria-label="Permalink to &quot;装配流程&quot;">​</a></h4><p><strong>代码验证</strong></p><p>spring-context.xml</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;?</span><span style="color:#85E89D;">xml</span><span style="color:#B392F0;"> version</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;1.0&quot;</span><span style="color:#B392F0;"> encoding</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;UTF-8&quot;</span><span style="color:#E1E4E8;">?&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">beans</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">xmlns</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">xmlns:xsi</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">xmlns:context</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">xsi:schemaLocation</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">context:component-scan</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base-package</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;person&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.entity.Person&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;initMethod&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy-method</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;destroyMethod&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;z3&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;age&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;20&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;postProcessor&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.demo.spring.util.MyBeanPostProcessor&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">bean</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--    &lt;bean id=&quot;myFactoryBean&quot; class=&quot;com.demo.spring.util.MyFactoryBean&quot; &gt;&lt;/bean&gt;--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">beans</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;?</span><span style="color:#22863A;">xml</span><span style="color:#6F42C1;"> version</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;1.0&quot;</span><span style="color:#6F42C1;"> encoding</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;UTF-8&quot;</span><span style="color:#24292E;">?&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">beans</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">xmlns</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">xmlns:xsi</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">xmlns:context</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">xsi:schemaLocation</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">context:component-scan</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base-package</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;person&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.entity.Person&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;initMethod&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy-method</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;destroyMethod&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;z3&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;age&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;20&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">bean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;postProcessor&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.demo.spring.util.MyBeanPostProcessor&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">bean</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">&lt;!--    &lt;bean id=&quot;myFactoryBean&quot; class=&quot;com.demo.spring.util.MyFactoryBean&quot; &gt;&lt;/bean&gt;--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">beans</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>com.demo.spring.entity.Person.java</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.demo.spring.entity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> lombok.AllArgsConstructor;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> lombok.Data;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> lombok.experimental.Accessors;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.beans.BeansException;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.beans.factory.</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.context.ApplicationContext;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.context.ApplicationContextAware;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * TODO</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@since</span><span style="color:#6A737D;"> 2020-05-04 18:57</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Accessors</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Person</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanNameAware</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">BeanFactoryAware</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">ApplicationContextAware</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">InitializingBean</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">DisposableBean</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Person</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...NoArgsConstructor&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setAge</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">age</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...setAge&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.age </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * 设置bean在ioc容器中的名字</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#FFAB70;">name</span><span style="color:#6A737D;"> 即为xml中配置的id的值，若使用注解的方式注入，默认即为@Bean的方法名</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@return</span><span style="color:#6A737D;"> void</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setBeanName</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">name</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...BeanNameAware...setBeanName...&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">name);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setBeanFactory</span><span style="color:#E1E4E8;">(BeanFactory </span><span style="color:#FFAB70;">beanFactory</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...BeanFactoryAware...setBeanFactory...&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">beanFactory);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setApplicationContext</span><span style="color:#E1E4E8;">(ApplicationContext </span><span style="color:#FFAB70;">applicationContext</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...ApplicationContextAware...setApplicationContext...&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">applicationContext);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">initMethod</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...initMethod&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroyMethod</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...destroyMethod&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">afterPropertiesSet</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...InitializingBean...afterPropertiesSet&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;person...DisposableBean...destroy&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.demo.spring.entity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> lombok.AllArgsConstructor;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> lombok.Data;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> lombok.experimental.Accessors;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.beans.BeansException;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.beans.factory.</span><span style="color:#005CC5;">*</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.context.ApplicationContext;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.context.ApplicationContextAware;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * TODO</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@since</span><span style="color:#6A737D;"> 2020-05-04 18:57</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Accessors</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Person</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanNameAware</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">BeanFactoryAware</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">ApplicationContextAware</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">InitializingBean</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">DisposableBean</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String name;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Person</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...NoArgsConstructor&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setAge</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">age</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...setAge&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.age </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> age;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * 设置bean在ioc容器中的名字</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">name</span><span style="color:#6A737D;"> 即为xml中配置的id的值，若使用注解的方式注入，默认即为@Bean的方法名</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@return</span><span style="color:#6A737D;"> void</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setBeanName</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">name</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...BeanNameAware...setBeanName...&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">name);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setBeanFactory</span><span style="color:#24292E;">(BeanFactory </span><span style="color:#E36209;">beanFactory</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...BeanFactoryAware...setBeanFactory...&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">beanFactory);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setApplicationContext</span><span style="color:#24292E;">(ApplicationContext </span><span style="color:#E36209;">applicationContext</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...ApplicationContextAware...setApplicationContext...&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">applicationContext);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">initMethod</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...initMethod&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroyMethod</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...destroyMethod&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">afterPropertiesSet</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...InitializingBean...afterPropertiesSet&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;person...DisposableBean...destroy&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>MyBeanPostProcessor.java</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.demo.spring.util;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.beans.BeansException;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.beans.factory.config.BeanPostProcessor;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 为了了让Bean后置处理器工作，需要将它加入到容器中</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@since</span><span style="color:#6A737D;"> 2020-05-05 16:09</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MyBeanPostProcessor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BeanPostProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">postProcessBeforeInitialization</span><span style="color:#E1E4E8;">(Object </span><span style="color:#FFAB70;">bean</span><span style="color:#E1E4E8;">, String </span><span style="color:#FFAB70;">beanName</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(beanName</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;...BeanPostProcessor...postProcessBeforeInitialization&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">postProcessAfterInitialization</span><span style="color:#E1E4E8;">(Object </span><span style="color:#FFAB70;">bean</span><span style="color:#E1E4E8;">, String </span><span style="color:#FFAB70;">beanName</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(beanName</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;...BeanPostProcessor...postProcessAfterInitialization&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> bean;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.demo.spring.util;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.beans.BeansException;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.beans.factory.config.BeanPostProcessor;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 为了了让Bean后置处理器工作，需要将它加入到容器中</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@since</span><span style="color:#6A737D;"> 2020-05-05 16:09</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyBeanPostProcessor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BeanPostProcessor</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">postProcessBeforeInitialization</span><span style="color:#24292E;">(Object </span><span style="color:#E36209;">bean</span><span style="color:#24292E;">, String </span><span style="color:#E36209;">beanName</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(beanName</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;...BeanPostProcessor...postProcessBeforeInitialization&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> bean;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">postProcessAfterInitialization</span><span style="color:#24292E;">(Object </span><span style="color:#E36209;">bean</span><span style="color:#24292E;">, String </span><span style="color:#E36209;">beanName</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(beanName</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;...BeanPostProcessor...postProcessAfterInitialization&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> bean;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>MainApplication.java</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.demo.spring;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> com.demo.spring.entity.Person;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.springframework.context.support.ClassPathXmlApplicationContext;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * TODO</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@since</span><span style="color:#6A737D;"> 2020-05-04 20:04</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MainApplication</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        ClassPathXmlApplicationContext ac </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ClassPathXmlApplicationContext</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;classpath:spring/spring-context.xml&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ac..getBean&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        Person person </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ac.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(Person.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;================================================&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(person);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;================================================&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ac...关闭&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ac.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.demo.spring;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> com.demo.spring.entity.Person;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.context.support.ClassPathXmlApplicationContext;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * TODO</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> gnl</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@since</span><span style="color:#6A737D;"> 2020-05-04 20:04</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainApplication</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        ClassPathXmlApplicationContext ac </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ClassPathXmlApplicationContext</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;classpath:spring/spring-context.xml&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ac..getBean&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        Person person </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ac.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(Person.class);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;================================================&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(person);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;================================================&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ac...关闭&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ac.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>输出结果</strong></p><p>bean为单例时</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">person...NoArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">person...setAge</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanNameAware...setBeanName...person</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanFactoryAware...setBeanFactory</span></span>
<span class="line"><span style="color:#E1E4E8;">person...ApplicationContextAware...setApplicationContext</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanPostProcessor...postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#E1E4E8;">person...InitializingBean...afterPropertiesSet</span></span>
<span class="line"><span style="color:#E1E4E8;">person...initMethod</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanPostProcessor...postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#E1E4E8;">ac..getBean</span></span>
<span class="line"><span style="color:#F97583;">================================================</span></span>
<span class="line"><span style="color:#E1E4E8;">Person(name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">z3</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> age</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">================================================</span></span>
<span class="line"><span style="color:#E1E4E8;">ac...关闭</span></span>
<span class="line"><span style="color:#E1E4E8;">person...DisposableBean...destroy</span></span>
<span class="line"><span style="color:#E1E4E8;">person...destroyMethod</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">person...NoArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">person...setAge</span></span>
<span class="line"><span style="color:#24292E;">person...BeanNameAware...setBeanName...person</span></span>
<span class="line"><span style="color:#24292E;">person...BeanFactoryAware...setBeanFactory</span></span>
<span class="line"><span style="color:#24292E;">person...ApplicationContextAware...setApplicationContext</span></span>
<span class="line"><span style="color:#24292E;">person...BeanPostProcessor...postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#24292E;">person...InitializingBean...afterPropertiesSet</span></span>
<span class="line"><span style="color:#24292E;">person...initMethod</span></span>
<span class="line"><span style="color:#24292E;">person...BeanPostProcessor...postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#24292E;">ac..getBean</span></span>
<span class="line"><span style="color:#D73A49;">================================================</span></span>
<span class="line"><span style="color:#24292E;">Person(name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">z3</span><span style="color:#D73A49;">,</span><span style="color:#24292E;"> age</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">20</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">================================================</span></span>
<span class="line"><span style="color:#24292E;">ac...关闭</span></span>
<span class="line"><span style="color:#24292E;">person...DisposableBean...destroy</span></span>
<span class="line"><span style="color:#24292E;">person...destroyMethod</span></span></code></pre></div><p>若bean为单例懒加载或原型</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ac..getBean</span></span>
<span class="line"><span style="color:#E1E4E8;">person...NoArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">person...setAge</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanNameAware...setBeanName...person</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanFactoryAware...setBeanFactory</span></span>
<span class="line"><span style="color:#E1E4E8;">person...ApplicationContextAware...setApplicationContext</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanPostProcessor...postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#E1E4E8;">person...InitializingBean...afterPropertiesSet</span></span>
<span class="line"><span style="color:#E1E4E8;">person...initMethod</span></span>
<span class="line"><span style="color:#E1E4E8;">person...BeanPostProcessor...postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#F97583;">================================================</span></span>
<span class="line"><span style="color:#E1E4E8;">Person(name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">z3</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> age</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">================================================</span></span>
<span class="line"><span style="color:#E1E4E8;">ac...关闭</span></span>
<span class="line"><span style="color:#E1E4E8;">person...DisposableBean...destroy</span></span>
<span class="line"><span style="color:#E1E4E8;">person...destroyMethod</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ac..getBean</span></span>
<span class="line"><span style="color:#24292E;">person...NoArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">person...setAge</span></span>
<span class="line"><span style="color:#24292E;">person...BeanNameAware...setBeanName...person</span></span>
<span class="line"><span style="color:#24292E;">person...BeanFactoryAware...setBeanFactory</span></span>
<span class="line"><span style="color:#24292E;">person...ApplicationContextAware...setApplicationContext</span></span>
<span class="line"><span style="color:#24292E;">person...BeanPostProcessor...postProcessBeforeInitialization</span></span>
<span class="line"><span style="color:#24292E;">person...InitializingBean...afterPropertiesSet</span></span>
<span class="line"><span style="color:#24292E;">person...initMethod</span></span>
<span class="line"><span style="color:#24292E;">person...BeanPostProcessor...postProcessAfterInitialization</span></span>
<span class="line"><span style="color:#D73A49;">================================================</span></span>
<span class="line"><span style="color:#24292E;">Person(name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">z3</span><span style="color:#D73A49;">,</span><span style="color:#24292E;"> age</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">20</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">================================================</span></span>
<span class="line"><span style="color:#24292E;">ac...关闭</span></span>
<span class="line"><span style="color:#24292E;">person...DisposableBean...destroy</span></span>
<span class="line"><span style="color:#24292E;">person...destroyMethod</span></span></code></pre></div><p><strong>容器启动</strong></p><ol><li><p><strong>构造方法</strong></p></li><li><p><strong>设置属性值</strong></p></li><li><p>如果实现了BeanNameAware接口，调用<strong>setBeanName</strong>设置Bean的ID或者Name</p></li><li><p>如果实现BeanFactoryAware接口，调用<strong>setBeanFactory</strong> 设置BeanFactory</p></li><li><p>如果实现ApplicationContextAware，调用<strong>setApplicationContext</strong>，为组件注入IOC容器</p></li><li><p>调用BeanPostProcessor的postProcess<strong>BeforeInitialization</strong>方法，在任何初始化方法之前调用</p></li><li><p>调用InitializingBean的**afterPropertiesSet()**方法，定义初始化逻辑</p></li><li><p>调用定制<strong>init-method</strong>方法</p></li><li><p>调用BeanPostProcessor的postProcess<strong>AfterInitialization</strong>方法，在任何初始化方法之后调用</p></li></ol><p><strong>容器关闭</strong></p><ol start="10"><li>调用DisposableBean的<strong>destroy()</strong>，定义销毁逻辑</li><li>调用定制的<strong>destroy-method</strong>方法</li></ol><p><img src="/assets/image-20200505171612265.12893bb9.png" alt="image-20200505171612265"></p><h2 id="di" tabindex="-1">DI <a class="header-anchor" href="#di" aria-label="Permalink to &quot;DI&quot;">​</a></h2><p>依赖注入</p><p><strong>@Autowired 自动装配</strong>，Spring 会到容器中找到这个属性对应的组件，自动为属性赋值。</p><p>可以标在构造函数，方法，参数，属性上，都是从IOC容器中获取相应的组件值注入。</p><blockquote><p>@Resource 的作用相当于 @Autowired，只不过 @Autowired 按 byType 自动注入，而 @Resource 默认按 byName 自动注入罢了</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Autowired</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> BookService bookService;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">）、先按照类型去容器中找相应组件, </span></span>
<span class="line"><span style="color:#E1E4E8;">		bookService </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> applicationContext.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(BookService.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)、没找到则抛异常</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">）、找到多个？</span></span>
<span class="line"><span style="color:#E1E4E8;">        按照变量名作为id继续匹配，</span></span>
<span class="line"><span style="color:#E1E4E8;">		bookService </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> applicationContext.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;bookService&quot;</span><span style="color:#E1E4E8;">,BookService.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">        可以使用@</span><span style="color:#F97583;">Qualifier修改id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Autowired</span><span style="color:#E1E4E8;">、@</span><span style="color:#F97583;">Resource</span><span style="color:#E1E4E8;">、@</span><span style="color:#F97583;">Inject这三个注解都能实现自动注入</span></span>
<span class="line"><span style="color:#E1E4E8;">	@</span><span style="color:#F97583;">Autowired</span><span style="color:#E1E4E8;">：最强大，Spring自己的注解</span></span>
<span class="line"><span style="color:#E1E4E8;">	@</span><span style="color:#F97583;">Resource</span><span style="color:#E1E4E8;">：j2ee、Java的标准、扩展性强</span></span>
<span class="line"><span style="color:#E1E4E8;">	@</span><span style="color:#F97583;">Inject</span><span style="color:#E1E4E8;">：EJB</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 方法上有@Autowired的话</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * 1）、spring容器创建当前对象的时候就会调用方法，完成赋值。</span></span>
<span class="line"><span style="color:#6A737D;">     * 2）、这个方法上的每一个参数都会从ioc中获取并自动注入</span></span>
<span class="line"><span style="color:#6A737D;">     * 3）、方法自动装配顺序与上面一致</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Autowired</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ha</span><span style="color:#E1E4E8;">(BookDao bookDao){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(bookDao);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// 标在造器方法上，构造方法中需要用的组件都会从容器中获取。</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// 如果类中只有一个有参构造器，@Autowired可以省略，参数位置的组件还是可以从容器中获取。</span></span>
<span class="line"><span style="color:#E1E4E8;">	@</span><span style="color:#F97583;">Autowired</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Person</span><span style="color:#E1E4E8;">(Car car) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.car </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> car;</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(car);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> BookService bookService;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">）、先按照类型去容器中找相应组件, </span></span>
<span class="line"><span style="color:#24292E;">		bookService </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> applicationContext.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(BookService.class);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)、没找到则抛异常</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">）、找到多个？</span></span>
<span class="line"><span style="color:#24292E;">        按照变量名作为id继续匹配，</span></span>
<span class="line"><span style="color:#24292E;">		bookService </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> applicationContext.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;bookService&quot;</span><span style="color:#24292E;">,BookService.class);</span></span>
<span class="line"><span style="color:#24292E;">        可以使用@</span><span style="color:#D73A49;">Qualifier修改id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Autowired</span><span style="color:#24292E;">、@</span><span style="color:#D73A49;">Resource</span><span style="color:#24292E;">、@</span><span style="color:#D73A49;">Inject这三个注解都能实现自动注入</span></span>
<span class="line"><span style="color:#24292E;">	@</span><span style="color:#D73A49;">Autowired</span><span style="color:#24292E;">：最强大，Spring自己的注解</span></span>
<span class="line"><span style="color:#24292E;">	@</span><span style="color:#D73A49;">Resource</span><span style="color:#24292E;">：j2ee、Java的标准、扩展性强</span></span>
<span class="line"><span style="color:#24292E;">	@</span><span style="color:#D73A49;">Inject</span><span style="color:#24292E;">：EJB</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 方法上有@Autowired的话</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">     * 1）、spring容器创建当前对象的时候就会调用方法，完成赋值。</span></span>
<span class="line"><span style="color:#6A737D;">     * 2）、这个方法上的每一个参数都会从ioc中获取并自动注入</span></span>
<span class="line"><span style="color:#6A737D;">     * 3）、方法自动装配顺序与上面一致</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ha</span><span style="color:#24292E;">(BookDao bookDao){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(bookDao);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// 标在造器方法上，构造方法中需要用的组件都会从容器中获取。</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// 如果类中只有一个有参构造器，@Autowired可以省略，参数位置的组件还是可以从容器中获取。</span></span>
<span class="line"><span style="color:#24292E;">	@</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Person</span><span style="color:#24292E;">(Car car) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.car </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> car;</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(car);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span></code></pre></div><p><strong>自定义组件使用Spring底层组件</strong>，例如<code>ApplicationContextAware</code>，<code>BeanFactory</code></p><p>自定义组件只需要实现<code>XXXAware</code>接口，在创建对象的时候，会调用接口规定的方法注入相关组件。</p><p>把spring底层的组件注入到自定义的bean中。</p><p><code>XXXAware</code>底层的实现都是<code>XXXProcessor</code>：<code>ApplicationContextAware</code> =&gt; <code>ApplicationContextAwareProcessor</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Accessors</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Component</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ApplicationContextAware</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">BeanNameAware</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">EmbeddedValueResolverAware</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> ApplicationContext applicationContext;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...NoArgsConstructor&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">name</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">age</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> name;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.age </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> age;</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...AllArgsConstructor&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PostConstruct</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...init-method&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">PreDestroy</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">destroy</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...destroy-method&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setApplicationContext</span><span style="color:#E1E4E8;">(ApplicationContext </span><span style="color:#FFAB70;">applicationContext</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">throws</span><span style="color:#E1E4E8;"> BeansException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.applicationContext </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> applicationContext;</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...applicationContext: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> applicationContext);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setBeanName</span><span style="color:#E1E4E8;">(String </span><span style="color:#FFAB70;">name</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;user...beanName: &quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> name);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setEmbeddedValueResolver</span><span style="color:#E1E4E8;">(StringValueResolver </span><span style="color:#FFAB70;">resolver</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        String value </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> resolver.</span><span style="color:#B392F0;">resolveStringValue</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;${os.name}...#{20*10}&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;字符串解析的值: &quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">value);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Accessors</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApplicationContextAware</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">BeanNameAware</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">EmbeddedValueResolverAware</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String name;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> ApplicationContext applicationContext;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...NoArgsConstructor&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">name</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">age</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> name;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.age </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> age;</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...AllArgsConstructor&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PostConstruct</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...init-method&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">PreDestroy</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">destroy</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...destroy-method&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setApplicationContext</span><span style="color:#24292E;">(ApplicationContext </span><span style="color:#E36209;">applicationContext</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> BeansException {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.applicationContext </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> applicationContext;</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...applicationContext: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> applicationContext);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setBeanName</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">name</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;user...beanName: &quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> name);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setEmbeddedValueResolver</span><span style="color:#24292E;">(StringValueResolver </span><span style="color:#E36209;">resolver</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String value </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> resolver.</span><span style="color:#6F42C1;">resolveStringValue</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;${os.name}...#{20*10}&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;字符串解析的值: &quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">value);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>上次更新: <time datetime="2023-11-23T07:01:38.000Z" data-v-7e05ebdb></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><!--[--><!--]--><div id="giscus-comment" class="comment" data-pagefind-ignore="all" data-v-af5a5a9a data-v-3db7ae48><div class="el-affix comment-btn" style="height:;width:;" data-v-3db7ae48><div class="" style=""><!--[--><button ariadisabled="false" type="button" class="el-button el-button--primary is-plain" style="" data-v-3db7ae48><i class="el-icon" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M736 504a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zM128 128v640h192v160l224-160h352V128H128z"></path></svg><!--]--></i><span class=""><!--[--> 评论 <!--]--></span></button><!--]--></div></div><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"7748ce86\",\"posts_article_文章整理.md\":\"4900a6b3\",\"about.md\":\"fdf33c45\",\"posts_algorithm_常见算法.md\":\"53cd5241\",\"posts_be_java_java lang_java lang.md\":\"4ce84bb5\",\"posts_be_dubbo_dubbo.md\":\"2af19342\",\"posts_be_jvm_jvm.md\":\"2da9864b\",\"posts_algorithm_位运算.md\":\"48f9a671\",\"posts_be_spring_ioc_事务_ioc_事务.md\":\"fba84f71\",\"posts_be_java_java 线程池_java 线程池.md\":\"1ebbcfa9\",\"posts_be_maven_maven.md\":\"28c8b6d0\",\"posts_be_java_java io_java io.md\":\"34caf8f1\",\"posts_be_spring_ioc_di_ioc_di.md\":\"219dcd35\",\"posts_be_java_java 多线程_java 多线程.md\":\"fde28d4e\",\"posts_be_springcloud_index.md\":\"661d2f48\",\"posts_be_spring_spring.md\":\"5b47e8f3\",\"posts_be_java_java 进阶_java 进阶.md\":\"094237e6\",\"posts_be_springsecurity_springsecurity.md\":\"139439b5\",\"posts_be_springboot_thinkinspringboot_index.md\":\"017db498\",\"posts_be_springweb_springmvc_springmvc.md\":\"92fde17e\",\"posts_fe_node.js_node.js.md\":\"d9536650\",\"posts_fe_react_react typescript.md\":\"6fb7e948\",\"posts_devops_nginx_nginx.md\":\"18076169\",\"posts_fe_css_css.md\":\"908ef920\",\"posts_fe_nextjs_next.js.md\":\"5e300ca3\",\"posts_linux_linux.md\":\"dafbc11d\",\"posts_fe_项目配置.md\":\"a5b8ad67\",\"posts_db_clickhouse_clickhouse.md\":\"ac56dbb2\",\"posts_db_mysql_thinkinmysql.md\":\"2a9ed36a\",\"posts_数据结构_数据结构.md\":\"579e2fe5\",\"posts_计算机网络_计算机网络.md\":\"66f5f327\",\"posts_db_redis_redis 数据类型.md\":\"0691cdb0\",\"posts_db_postgresql_pg 语句分析.md\":\"cc1c346d\",\"posts_db_redis_redis 配置详解.md\":\"89b1350a\",\"posts_db_redis_redis.md\":\"b4018c62\",\"posts_devops_grafana_grafana.md\":\"13827f42\",\"posts_devops_docker_docker.md\":\"7347d5cb\",\"posts_devops_gitlab_gitlab.md\":\"234f737e\",\"posts_devops_kubernetes_k8s.md\":\"4413d84b\",\"posts_be_mybitis_mybatis.md\":\"c043ed00\",\"posts_be_mybitis_mybatis-plus-generator.md\":\"fbeebfed\",\"posts_设计模式_设计模式.md\":\"fda6a57f\",\"posts_db_postgresql_postgresql.md\":\"100dbdb3\",\"posts_fe_vuejs_vuejs.md\":\"06d9601d\",\"posts_linux_安装配置_centos 配置.md\":\"b3c4f3f2\",\"posts_linux_安装配置_manjora 安装配置.md\":\"9cedb9f5\",\"posts_be_java_walkthroughjava.md\":\"8943465f\",\"posts_be_java_java 集合_java 集合.md\":\"40adb9e0\",\"posts_math_latex.md\":\"fc03b43c\",\"posts_mw_rocketmq_rocketmq model_rocketmq model.md\":\"6a37be44\",\"posts_be_netty_netty.md\":\"9016777b\",\"posts_math_math.md\":\"b6fc95a4\",\"posts_fe_react_react.md\":\"799dfdee\",\"posts_mw_activemq_index.md\":\"affb2bc1\",\"posts_be_java_java 基础_java 基础.md\":\"61e4e6d8\",\"posts_mw_rocketmq_rocketmq_rocketmq.md\":\"b5a9a64c\",\"posts_be_java_java 反射_范型_java.md\":\"ccffef49\",\"posts_mw_elasticsearch_elasticsearch.md\":\"145c9f5b\",\"posts_mw_kafka_kafka.md\":\"25bed381\",\"posts_devops_kubernetes_kubernetes.md\":\"11f1faf8\",\"posts_db_timescaledb_timescaledb.md\":\"50d3cc99\",\"posts_mw_kafka_kafkasource.md\":\"22523e19\",\"posts_linux_安装配置_ubuntu 安装配置.md\":\"9a3e1675\",\"posts_db_mysql_mysql.md\":\"d9b195cf\",\"posts_be_java_java juc_java juc.md\":\"b439a13b\",\"posts_fe_typescript_typescript.md\":\"4171fc5f\",\"posts_mw_rocketmq_rocketmq source_rocketmq source.md\":\"11eda4de\",\"posts_工具_ffmpeg.md\":\"bae9b4ef\",\"posts_python_python.md\":\"868034da\",\"posts_be_springboot_springboot_springboot.md\":\"40d8f96d\",\"posts_fe_javascript_javascript.md\":\"fd62f8c9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Gnl\",\"description\":\"Gnl's blog\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/about\",\"meta\":{\"sidebar\":false,\"title\":\"关于我\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\"\\n> gnl0ATqq.com\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/位运算\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"位运算基础以及常见用法\",\"title\":\"位运算\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/常见算法\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"常见算法思想汇总；分治、动态规划、贪心、回溯、分支界限\",\"title\":\"常见算法\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/article/文章整理\",\"meta\":{\"description\":\"文章推荐\",\"title\":\"文章整理\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/fe/项目配置\",\"meta\":{\"description\":\"前端项目配置\",\"tag\":[\"前端\"],\"title\":\"前端项目配置\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/Linux\",\"meta\":{\"description\":\"Linux 笔记\",\"tag\":[\"Linux\"],\"title\":\"Linux\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/math/Latex\",\"meta\":{\"description\":\"LateX 常用语法\",\"tag\":[\"LateX\"],\"title\":\"LateX\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/math/Math\",\"meta\":{\"description\":\"基础数学函数\",\"title\":\"Math\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/python/Python\",\"meta\":{\"description\":\"Python 笔记\",\"tag\":[\"Python\"],\"title\":\"Python\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/工具/ffmpeg\",\"meta\":{\"description\":\"ffmpeg 常用命令\",\"tag\":[\"ffmpeg\"],\"title\":\"ffmpeg\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/数据结构/数据结构\",\"meta\":{\"description\":\"算法与数据结构笔记\",\"tag\":[\"算法\",\"数据结构\"],\"title\":\"算法与数据结构\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"https://img2018.cnblogs.com/blog/1648163/201909/1648163-20190919085122774-376085378.png\"}},{\"route\":\"/posts/计算机网络/计算机网络\",\"meta\":{\"description\":\"计算机网络笔记\",\"title\":\"计算机网络\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/设计模式/设计模式\",\"meta\":{\"description\":\"Java 设计模式笔记\",\"tag\":[\"设计模式\",\"Java\"],\"title\":\"设计模式\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Dubbo/Dubbo\",\"meta\":{\"description\":\"Apache Dubbo 是一款 RPC 服务开发框架，用于解决微服务架构下的服务治理与通信问题。\",\"tag\":[\"微服务\",\"Dubbo\",\"后端\"],\"title\":\"Dubbo\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/JVM/JVM\",\"meta\":{\"description\":\"JVM 详解，包括 JVM 体系结构、垃圾回收算法等\",\"tag\":[\"Java\",\"JVM\",\"后端\"],\"title\":\"JVM\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/WalkThroughJava\",\"meta\":{\"title\":\"Walk Though Java\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\" 多线程\\n 多线程异常处理方案\\n在使用 try-catch 的时候有一个条件通常会被忽略：try-catch 只能处理当前线程抛出的异常，在多线程情况下是无法 catch 到其他线程抛出的异常的。\\n看\",\"cover\":\"\"}},{\"route\":\"/posts/be/Maven/Maven\",\"meta\":{\"description\":\"Maven 笔记\",\"tag\":[\"后端\"],\"title\":\"Maven\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/MyBatis\",\"meta\":{\"description\":\"MyBatis 详解\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"MyBatis\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/mybatis-plus-generator\",\"meta\":{\"description\":\"MyBatis 代码生成器\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"mybatis-plus-generator\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Netty/Netty\",\"meta\":{\"description\":\"基于 Java NIO 封装的网络框架\",\"tag\":[\"Netty\",\"后端\"],\"title\":\"Netty\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/Spring\",\"meta\":{\"description\":\"Spring 框架详解\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringCloud/index\",\"meta\":{\"description\":\"SpringCloud 详解\",\"tag\":[\"SpringCloud\",\"后端\",\"微服务\"],\"title\":\"SpringCloud\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringSecurity/SpringSecurity\",\"meta\":{\"description\":\"SpringSecurity 笔记\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring Security\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/ClickHouse/ClickHouse\",\"meta\":{\"description\":\"ClickHouse 笔记\",\"tag\":[\"数据库\"],\"title\":\"ClickHouse\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/MySQL\",\"meta\":{\"description\":\"MySQL 详解\",\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"MySQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/ThinkInMySQL\",\"meta\":{\"description\":\"在使用 MySQL 的过程中的一些思考\",\"sticky\":true,\"top\":6,\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"Think In MySQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PG 语句分析\",\"meta\":{\"description\":\"记录 PostgreSQL 使用过程中 SQL 语句分析的历程\",\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PG 语句分析\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PostgreSQL\",\"meta\":{\"description\":\"PostgreSQL 详解，包含基础内容、高可用架构等\",\"top\":1,\"sticky\":true,\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PostgreSQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 数据类型\",\"meta\":{\"description\":\"Redis 数据类型详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 数据类型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 配置详解\",\"meta\":{\"description\":\"Redis 配置详解\",\"top\":7,\"sticky\":true,\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 配置详解\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis\",\"meta\":{\"description\":\"Redis 详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/TimescaleDB/TimescaleDB\",\"meta\":{\"description\":\"TimescaleDB 详解\",\"top\":5,\"sticky\":true,\"tag\":[\"TimescaleDB\",\"时序数据库\",\"数据库\"],\"title\":\"TimescaleDB\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Docker/Docker\",\"meta\":{\"description\":\"Docker 详解\",\"tag\":[\"Docker\",\"DevOps\"],\"title\":\"Docker\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/GitLab/GitLab\",\"meta\":{\"description\":\"GitLab 私服搭建\",\"top\":3,\"tag\":[\"GitLab\"],\"title\":\"GitLab\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Grafana/Grafana\",\"meta\":{\"description\":\"Grafana 监控搭建\",\"top\":2,\"tag\":[\"Grafana\",\"DevOps\"],\"title\":\"Grafana\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/K8S\",\"meta\":{\"isPublish\":false,\"title\":\"Kubernetes\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\" 虚拟化容器\\n Docker\\nDocker 与传统虚拟化方式的不同之处：Docker 容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，没有进行硬件虚拟；而传统虚拟机技术是虚拟出一套硬件后，\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/Kubernetes\",\"meta\":{\"description\":\"K8s 详解\",\"top\":4,\"sticky\":true,\"tag\":[\"K8s\",\"DevOps\"],\"title\":\"K8s\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg\"}},{\"route\":\"/posts/devops/Nginx/Nginx\",\"meta\":{\"description\":\"Nginx 详解\",\"tag\":[\"Nginx\"],\"title\":\"Nginx\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/CSS/CSS\",\"meta\":{\"description\":\"CSS 详解\",\"tag\":[\"前端\"],\"title\":\"CSS\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/JavaScript/JavaScript\",\"meta\":{\"description\":\"JavaScript 详解\",\"outline\":[2,3],\"tag\":[\"JavaScript\",\"前端\"],\"title\":\"JavaScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Nextjs/Next.js\",\"meta\":{\"description\":\"Next.js 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"Next.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Node.js/Node.js\",\"meta\":{\"description\":\"Node.js 笔记\",\"tag\":[\"前端\"],\"title\":\"Node.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React TypeScript\",\"meta\":{\"description\":\"React + TypeScript 笔记\",\"tag\":[\"React\",\"TypeScript\",\"前端\"],\"title\":\"React + TypeScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React\",\"meta\":{\"description\":\"React 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"React\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/TypeScript/TypeScript\",\"meta\":{\"description\":\"TypeScript 笔记\",\"tag\":[\"TypeScript\",\"前端\"],\"title\":\"TypeScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Vuejs/Vuejs\",\"meta\":{\"description\":\"Vue.js 笔记\",\"tag\":[\"Vue.js\",\"前端\"],\"title\":\"Vue.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/CentOS 配置\",\"meta\":{\"description\":\"CentOS 笔记\",\"tag\":[\"Linux\"],\"title\":\"CentOS 笔记\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Manjora 安装配置\",\"meta\":{\"description\":\"Manjora 笔记\",\"tag\":[\"Linux\"],\"title\":\"Manjora 安装\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Ubuntu 安装配置\",\"meta\":{\"description\":\"Ubuntu 安装\",\"tag\":[\"Linux\"],\"title\":\"Ubuntu 安装\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/ActiveMQ/index\",\"meta\":{\"description\":\"ActiveMQ 详解\",\"tag\":[\"MQ\",\"中间件\"],\"title\":\"ActiveMQ\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Elasticsearch/Elasticsearch\",\"meta\":{\"description\":\"Elasticsearch 详解\",\"outline\":[2,3],\"tag\":[\"Elasticsearch\",\"中间件\"],\"title\":\"Elasticsearch\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/Kafka\",\"meta\":{\"description\":\"Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/KafkaSource\",\"meta\":{\"description\":\"Kafka 源码深入\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka Source\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java IO/Java IO\",\"meta\":{\"description\":\"Java 中的 IO 操作，包括 BIO 和 NIO\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java IO\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java JUC/Java JUC\",\"meta\":{\"description\":\"JUC 指的是 `java.util.concurrent` 包及其子包下用于并发场景的类\",\"tag\":[\"Java\",\"后端\"],\"title\":\"JUC\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java lang/Java lang\",\"meta\":{\"title\":\"Java lang\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\"\\n Runtime\\n每一个 Java 程序都有一个单实例的 Runtime 对象，它允许正在运行的 Java 程序能够获取到运行环境信息。\\n一些常用的方法如下：\\n* `getRuntime()`\\n* \",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 反射+范型/Java\",\"meta\":{\"description\":\"Java 反射和泛型详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 反射和泛型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 基础/Java 基础\",\"meta\":{\"description\":\"Java 基础内容\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 基础内容\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 多线程/Java 多线程\",\"meta\":{\"description\":\"Java 多线程详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 多线程\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 线程池/Java 线程池\",\"meta\":{\"description\":\"线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 线程池\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 进阶/Java 进阶\",\"meta\":{\"description\":\"Java 进阶内容，包括: SPI、JNDI\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 进阶\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 集合/Java 集合\",\"meta\":{\"description\":\"Java 集合部分详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 集合\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&DI/IOC&DI\",\"meta\":{\"description\":\"Spring IOC&DI\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&事务/IOC&事务\",\"meta\":{\"description\":\"Spring IOC & 事务\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/SpringBoot/SpringBoot\",\"meta\":{\"description\":\"SpringBoot 详解\",\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"SpringBoot\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/ThinkInSpringBoot/index\",\"meta\":{\"description\":\"深入 SpringBoot 源码与一点思考\",\"sticky\":true,\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"Think-in-Springboot\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringWeb/SpringMVC/SpringMVC\",\"meta\":{\"description\":\"Spring Web MVC 是建立在 Servlet API 上的 Web 框架\",\"tag\":[\"SpringMVC\",\"后端\"],\"title\":\"Spring MVC\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\",\"meta\":{\"description\":\"RocketMQ 是一个分布式的中间件服务，采用异步通信模型和发布/订阅消息传输模型。\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Model/RocketMQ Model\",\"meta\":{\"description\":\"RocketMQ 领域模型\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 领域模型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Source/RocketMQ Source\",\"meta\":{\"description\":\"RocketMQ 源码解析\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 源码解析\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}}],\"hotArticle\":{\"title\":\"Pinned\",\"nextText\":\"换一组\",\"pageSize\":5,\"empty\":\"暂无内容\"},\"recommend\":false,\"footer\":{\"copyright\":\"2023-Present | Gnl\",\"version\":false},\"themeColor\":\"el-green\",\"author\":\"Gnl\",\"comment\":{\"repo\":\"gnl00/gnl00.github.io\",\"repoId\":\"R_kgDOGR5o6w\",\"category\":\"Announcements\",\"categoryId\":\"DIC_kwDOGR5o684CatYO\"},\"mermaid\":true},\"lastUpdatedText\":\"上次更新\",\"logo\":\"/logo-transform.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"前端项目工程化\",\"link\":\"/posts/fe/项目配置\"},{\"text\":\"JavaScript\",\"link\":\"/posts/fe/JavaScript/JavaScript\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/TypeScript/TypeScript\"},{\"text\":\"React\",\"link\":\"/posts/fe/React/React\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/Vuejs/Vuejs\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"Java\",\"link\":\"/posts/be/Java/Java\"},{\"text\":\"Spring\",\"link\":\"/posts/be/Spring/Spring\"},{\"text\":\"SpringBoot\",\"link\":\"/posts/be/SpringBoot/SpringBoot\"},{\"text\":\"SpringCloud\",\"link\":\"/posts/be/SpringCloud/SpringCloud\"},{\"text\":\"Dubbo\",\"link\":\"/posts/be/Dubbo/Dubbo\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/posts/db/MySQL/MySQL\"},{\"text\":\"PostgreSQL\",\"link\":\"/posts/db/PostgreSQL/PostgreSQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/Redis/Redis\"}]},{\"text\":\"中间件\",\"items\":[{\"text\":\"Netty\",\"link\":\"/posts/mw/Netty/Netty\"},{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/Kafka/Kafka\"},{\"text\":\"Elesticsearch\",\"link\":\"/posts/mw/Elesticsearch/Elesticsearch\"}]},{\"text\":\"DevOps\",\"items\":[{\"text\":\"Docker\",\"link\":\"/posts/mw/Docker/Docker\"},{\"text\":\"Kubernetes\",\"link\":\"/posts/mw/Kubernetes/Kubernetes\"},{\"text\":\"GitLab\",\"link\":\"/posts/mw/GitLab/GitLab\"}]},{\"text\":\"关于\",\"link\":\"/about\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>