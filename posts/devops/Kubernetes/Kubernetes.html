<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K8s | Gnl</title>
    <meta name="description" content="K8s 详解">
    <link rel="preload stylesheet" href="/assets/style.8602ee05.css" as="style">
    
    <script type="module" src="/assets/app.10ab34f6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.b41230ea.js">
    <link rel="modulepreload" href="/assets/chunks/theme.80eede78.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-a837419f.908b30f0.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-34ebe643.cf616d16.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-9362ca72.6f3739a4.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-e232339a.d58edc84.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-007f5bf9.8898d963.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-bb8de4b5.11ac8dab.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-761fef4a.18f35b4f.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-8e129bc0.c1866605.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-525ea6f2.e536ede5.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-585325ee.02bf0b3c.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-eaee51ba.c1488b6e.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-8025bb1f.b111c2c5.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-d706aa6d.a15162d5.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-ad81aaa2.64333dca.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-c61244fe.a18b01a1.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-93a053d8.6c2bb354.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-654feea8.93773dd6.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-725b2045.84dadc0c.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-6075699d.8b32fb75.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-f7375806.8d247901.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-5b3884e4.4781f6c7.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.ade1a5ba.js">
    <link rel="modulepreload" href="/assets/chunks/giscus-2a044aea.497f0bd4.js">
    <link rel="modulepreload" href="/assets/posts_devops_Kubernetes_Kubernetes.md.11f1faf8.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-af5a5a9a data-v-ae5c84bb><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-5c56a737><div class="header" data-v-5c56a737><div class="title-wrapper" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i><span class="title" data-v-5c56a737></span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg><!--]--></i></div><!----><div class="footer content" data-v-5c56a737><!--[--><!--]--></div></div><div style="display:none;" class="theme-blog-popover-close" data-v-5c56a737><i class="el-icon" style="font-size:20px;" data-v-5c56a737><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-5c56a737><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ae5c84bb data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-transform.png" alt data-v-8426fc1a><!--]--><!--[-->Gnl<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-a0fd61f4 style="--54fbd49d:1;" data-v-bebd53ce><div class="nav-search-btn-wait" data-v-bebd53ce><svg width="14" height="14" viewBox="0 0 20 20" data-v-bebd53ce><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bebd53ce></path></svg><span class="search-tip" data-v-bebd53ce>Search</span><span class="metaKey" data-v-bebd53ce> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.html" data-v-43f1e123><!--[-->前端项目工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/JavaScript/JavaScript.html" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/TypeScript/TypeScript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/React/React.html" data-v-43f1e123><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/Vuejs/Vuejs.html" data-v-43f1e123><!--[-->Vue.js<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Java/Java.html" data-v-43f1e123><!--[-->Java<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Spring/Spring.html" data-v-43f1e123><!--[-->Spring<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringBoot/SpringBoot.html" data-v-43f1e123><!--[-->SpringBoot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/SpringCloud/SpringCloud.html" data-v-43f1e123><!--[-->SpringCloud<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/Dubbo/Dubbo.html" data-v-43f1e123><!--[-->Dubbo<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>数据库</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/MySQL/MySQL.html" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/PostgreSQL/PostgreSQL.html" data-v-43f1e123><!--[-->PostgreSQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/Redis/Redis.html" data-v-43f1e123><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>中间件</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Netty/Netty.html" data-v-43f1e123><!--[-->Netty<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/RocketMQ/RocketMQ/RocketMQ.html" data-v-43f1e123><!--[-->RocketMQ<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kafka/Kafka.html" data-v-43f1e123><!--[-->Kafka<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Elesticsearch/Elesticsearch.html" data-v-43f1e123><!--[-->Elesticsearch<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>DevOps</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Docker/Docker.html" data-v-43f1e123><!--[-->Docker<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/Kubernetes/Kubernetes.html" data-v-43f1e123><!--[-->Kubernetes<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/GitLab/GitLab.html" data-v-43f1e123><!--[-->GitLab<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-ae5c84bb data-v-79c8c1df><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-ae5c84bb data-v-669faec9><div class="VPDoc has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _posts_devops_Kubernetes_Kubernetes" data-v-6b87e69f><div><h1 id="k8s" tabindex="-1">K8s <a class="header-anchor" href="#k8s" aria-label="Permalink to &quot;K8s&quot;">​</a></h1><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>使用 Docker 时可能会出现这样几个问题：</p><ul><li>如何协调和调度在 Docker 容器内以及不同容器之间运行的服务？</li><li>如何保证在升级应用程序时不会中断服务？</li><li>如何监视应用程序的运行状况？</li><li>如何批量重启容器里的程序？</li><li>…</li></ul><p>我们需要对容器内的应用服务进行编排、管理和调度，由此催生出 K8s。K8s 主要围绕 Pod 进行工作，Pod 是 K8s 中的最小调度单位，可以包含一个或多个容器。</p><blockquote><p><a href="https://www.v2ex.com/t/780960" target="_blank" rel="noreferrer">是否真的需要 K8s？</a></p></blockquote><h2 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to &quot;架构&quot;">​</a></h2><p>K8s 一般都是以集群的形式出现的，一个 K8s 集群主要包括：master 节点（主节点）和 node 节点（工作节点）。</p><p><img src="/assets/architecture.8a9d0868.png" alt="architecture"></p><blockquote><ul><li><p>K8s 组件：<a href="https://kubernetes.io/docs/concepts/overview/components/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/concepts/overview/components/</a></p></li><li><p>K8s 架构：<a href="http://docs.kubernetes.org.cn/251.html" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/251.html</a></p></li></ul></blockquote><h3 id="节点" tabindex="-1">节点 <a class="header-anchor" href="#节点" aria-label="Permalink to &quot;节点&quot;">​</a></h3><h4 id="master-节点" tabindex="-1">Master 节点 <a class="header-anchor" href="#master-节点" aria-label="Permalink to &quot;Master 节点&quot;">​</a></h4><p><img src="/assets/14791969222306.cb30ae09.png" alt="img"></p><p>Master 节点如上图，包括：</p><ul><li><em>API Server</em>，整个 K8s 服务对外的接口，供客户端和其他组件调用。</li><li><em>Controller Manager</em>，负责维护集群的状态，比如副本数量、故障检测、自动扩展、滚动更新等。</li><li>Scheduler，负责对集群内部的资源进行调度，按照调度策略将 Pod 调度到对应的机器上。</li><li>etcd，键值数据库，负责保存 K8s 集群的所有数据。</li></ul><h4 id="node-节点" tabindex="-1">Node 节点 <a class="header-anchor" href="#node-节点" aria-label="Permalink to &quot;Node 节点&quot;">​</a></h4><p><img src="/assets/14791969311297.9ce2c785.png" alt="img"></p><p>Node 节点包括以下内容：</p><ul><li><p>Kubelet，负责维护 node 状态并和 master 节点通信。</p></li><li><p>Kube-Proxy，负责实现集群网络服务，为 Service 提供集群内部的服务发现和负载均衡。</p></li><li><p>Pod，K8s 中部署的最小单位，可以包含一个或多个容器。</p></li></ul><blockquote><p>除非容器之间的服务紧密耦合，否则通常都是一个 Pod 中只有一个容器，方便管理、并易于扩展。</p></blockquote><br><h4 id="插件" tabindex="-1">插件 <a class="header-anchor" href="#插件" aria-label="Permalink to &quot;插件&quot;">​</a></h4><p>除了以上核心组件还有其他插件：</p><ul><li>CoreDNS，负责未整个集群提供 DNS 服务。</li><li><em>Ingress Controller</em>，可以认为是类似 nginx 的代理服务，为 K8s 集群内的服务提供外网入口。</li><li>Prometheus，提供资源监控。</li><li>Federation，提供跨区可用的集群。</li></ul><h3 id="集群" tabindex="-1">集群 <a class="header-anchor" href="#集群" aria-label="Permalink to &quot;集群&quot;">​</a></h3><p>K8s 的 master 节点和多个 node 工作节点组成 K8s 集群。</p><p><img src="https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg" alt="K8s-cluster"></p><p>Master 负责集群的管理，协调集群中的所有行为/活动，例如应用的运行、修改、更新等；Node 节点作为工作节点，Node 可以是 VM 虚拟机，也可以是物理机。</p><h2 id="单机部署" tabindex="-1">单机部署 <a class="header-anchor" href="#单机部署" aria-label="Permalink to &quot;单机部署&quot;">​</a></h2><p>使用单机 K8s 需要部署以下组件：</p><ul><li>Docker；</li><li>K8s 的命令行客户端 kubectl；</li><li>K8s 运行环境，比如 minikube；</li></ul><p><strong>开始</strong></p><p>1、<a href="https://kubernetes.io/docs/tasks/tools/#kubectl" target="_blank" rel="noreferrer">下载并安装 kubectl</a></p><p>2、<a href="https://minikube.sigs.K8s.io/docs/start/" target="_blank" rel="noreferrer">安装 minikube</a></p><p>3、启动 minicube</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span></span></code></pre></div><h2 id="kubectl" tabindex="-1">kubectl <a class="header-anchor" href="#kubectl" aria-label="Permalink to &quot;kubectl&quot;">​</a></h2><p>kubectl 命令管理工具常见的命令如下：</p><ul><li><code>kubectl create &lt;deployment|namespace|xxx&gt; &lt;create-name&gt;</code> 创建资源。</li><li><code>kubectl get &lt;deployments | pods | services | rs&gt;</code>，获取资源。</li><li><code>kubectl describe &lt;pods | nodes | services&gt;</code>，显示资源的详细信息。</li><li><code>kubectl logs</code>，打印 pod 中的容器日志。</li><li><code>kubectl exec</code>，运行 pod 中容器内部的命令。</li><li><code>kubectl delete &lt;pod|deployment|service|ingress|namspace&gt; &lt;name-to-delete&gt;</code> 删除某个资源。</li></ul><blockquote><p>删除指定状态的 pod：</p><ul><li><code>kubectl delete pod --field-selector=&quot;status.phase==Failed&quot;</code> 删除默认命名空间中所有状态为 <code>evicted</code> 的 pod</li><li><code>kubectl delete pod -A --field-selector=&quot;status.phase==Failed&quot;</code> 删除所有命名空间中状态为 <code>evicted</code> 的 pod</li></ul><p>参考: <a href="https://gist.github.com/ipedrazas/9c622404fb41f2343a0db85b3821275d?permalink_comment_id=3417466#gistcomment-3417466" target="_blank" rel="noreferrer">https://gist.github.com/ipedrazas/9c622404fb41f2343a0db85b3821275d?permalink_comment_id=3417466#gistcomment-3417466</a></p></blockquote><h2 id="上手" tabindex="-1">上手 <a class="header-anchor" href="#上手" aria-label="Permalink to &quot;上手&quot;">​</a></h2><blockquote><p>这里有一个快速指南还不错：<a href="https://zhuanlan.zhihu.com/p/39937913" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/39937913</a></p></blockquote><h3 id="创建-deployment" tabindex="-1">创建 Deployment <a class="header-anchor" href="#创建-deployment" aria-label="Permalink to &quot;创建 Deployment&quot;">​</a></h3><p>0、镜像 kubernetes-bootcamp 在部署之后能通过 <a href="http://host:8001/version" target="_blank" rel="noreferrer">http://host:8001/version</a> 访问到它的版本信息</p><p>1、使用 kubectl 拉取镜像并创建 Deployment</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image=gcr.io/google-samples/kubernetes-bootcamp:v1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=gcr.io/google-samples/kubernetes-bootcamp:v1</span></span></code></pre></div><blockquote><p>当你创建了一个 Deployment，K8s 会创建一个 Pod 实例。Deployment 可以看成是 Pod 的部署、管理工具，可以进行 Pod 更新，控制副本数量，回滚，重启等操作。</p></blockquote><p>2、查看已创建的资源</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 查看所有 deployments</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看所有 Pod</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-A</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 显示 K8s 系统级别的 Pod</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查看所有 deployments</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看所有 Pod</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-A</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 显示 K8s 系统级别的 Pod</span></span></code></pre></div><p>Pod 已经部署好了，但是此时请求 <a href="http://host:8001/version" target="_blank" rel="noreferrer">http://host:8001/version</a> 会发现无法访问到该容器。为什么？</p><p>因为：</p><blockquote><p>Pods that are running inside Kubernetes are running on a private, isolated network. By default they are visible from other pods and services within the same kubernetes cluster, but not outside that network.</p></blockquote><p>运行在 K8s 内部的 Pod 是使用的是 K8s 私有的、与外部环境相互隔离的网络。默认情况下，Pod 的网络服务只对同一个 K8s 集群环境中的其他 Pod 可见，对外部环境不可见。</p><p>因此，我们需要使用代理，让外部的网络请能达到 K8s 集群内部的私有网络。</p><p>3、打开新的终端窗口，创建对 K8s 内部网络的代理。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proxy</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proxy</span></span></code></pre></div><blockquote><p>In order for the new Deployment to be accessible without using the proxy, a Service is required.</p><p>除了使用代理还可以使用 Service 来暴露服务，后续会介绍。</p></blockquote><p>4、访问测试</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:8001/version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:8001/version</span></span></code></pre></div><p>返回结果大概如下：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;major&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;minor&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;27&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;gitVersion&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;v1.27.3&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;gitCommit&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;25b4e43193bcda6c7328a6d147b1fb73a33f1598&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;gitTreeState&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;clean&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;buildDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2023-06-14T09:47:40Z&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;goVersion&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;go1.20.5&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;compiler&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;gc&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;platform&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;linux/amd64&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;major&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;minor&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;27&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;gitVersion&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;v1.27.3&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;gitCommit&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;25b4e43193bcda6c7328a6d147b1fb73a33f1598&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;gitTreeState&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;clean&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;buildDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2023-06-14T09:47:40Z&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;goVersion&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;go1.20.5&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;compiler&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;gc&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;platform&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;linux/amd64&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>至此，一个简单的上手 demo 就完成了。</p><h3 id="什么是-pod" tabindex="-1">什么是 Pod <a class="header-anchor" href="#什么是-pod" aria-label="Permalink to &quot;什么是 Pod&quot;">​</a></h3><p>Pod 是 K8s 上的最小的可操作单元。当我们在 K8s 上创建 Deployment 的时候，Deployment 会创建具有一个或多个容器的 Pod。可以将 Deployment 看成是 Pod 的控制器/管理器，用来管理 Pod 的创建、扩展、销毁。</p><p><img src="https://d33wubrfki0l68.cloudfront.net/fe03f68d8ede9815184852ca2a4fd30325e5d15a/98064/docs/tutorials/kubernetes-basics/public/images/module_03_pods.svg" alt="pods overview"></p><p>Pod 是一个抽象（逻辑）概念，可以包括一个或者多个容器，比如，一个 Pod 中可以有 Web 后端服务和前端服务两个容器。</p><p>同时还 Pod 包含了容器之间共享资源，包括：</p><ul><li>共享的存储，以 Volume 的形式表示；</li><li>网络，同一个 Pod 中的容器 IP 地址相同，共享同一片端口区域；</li><li>每个容器的运行信息，比如容器镜像版本、容器使用的端口等信息。</li></ul><blockquote><p>Pod 是 K8s 集群中所有业务类型的基础，可以看作运行在 K8s 集群中的小机器人，不同类型的业务就需要不同类型的小机器人去执行。目前 K8s 中的业务主要可以分为长期伺服型（long-running）、批处理型（batch）、节点后台支撑型（node-daemon）和有状态应用型（stateful application）；分别对应的小机器人控制器为 Deployment、Job、DaemonSet 和 PetSet。</p></blockquote><h3 id="pod-如何运行" tabindex="-1">Pod 如何运行 <a class="header-anchor" href="#pod-如何运行" aria-label="Permalink to &quot;Pod 如何运行&quot;">​</a></h3><p><img src="https://d33wubrfki0l68.cloudfront.net/5cb72d407cbe2755e581b6de757e0d81760d5b86/a9df9/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg" alt="node overview"></p><p>Pod 在 Node 上运行，每个 Pod 都会被绑定到 Node 节点上，直到被终止或删除。Node 由 K8s 的控制面板（<em>Control Panel</em>）进行管理。</p><blockquote><p><em>Control Panel</em> 实际上就是 Master 节点。</p></blockquote><p>一个 Node 可以包含多个 Pod，K8s 通过 Master 中的 Scheduler 组件来自动管理和调度 Pod 到指定的 Node 上。</p><p>每个 Node 上至少运行以下内容：</p><ul><li>Kubelet，管理 Master 和 Node 节点之间的通信；管理机器上运行的 Pod。</li><li><em>Container Runtime</em>，负责镜像管理以及 Pod 和容器的运行，例如 Docker。</li></ul><blockquote><p>Pod 是有生命周期的。当一个 Node 工作节点销毁时，节点上运行的 Pod 也会销毁。</p></blockquote><h3 id="pod-重启" tabindex="-1">Pod 重启 <a class="header-anchor" href="#pod-重启" aria-label="Permalink to &quot;Pod 重启&quot;">​</a></h3><p>1、<code>kubectl rollout restart</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">deployment_nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">deployment_nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">namespac</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>2、<code>kubectl scale</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=10</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">namespac</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">namespac</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=10</span></span></code></pre></div><br><h2 id="服务访问暴露" tabindex="-1">服务访问暴露 <a class="header-anchor" href="#服务访问暴露" aria-label="Permalink to &quot;服务访问暴露&quot;">​</a></h2><p><img src="https://d33wubrfki0l68.cloudfront.net/cc38b0f3c0fd94e66495e3a4198f2096cdecd3d5/ace10/docs/tutorials/kubernetes-basics/public/images/module_04_services.svg" alt="service"></p><p>Service 是一个抽象的概念，它定义了 Pod 的逻辑分组和访问策略。</p><blockquote><p>A Service in Kubernetes is an abstraction which defines a logical set of Pods and a policy by which to access them.</p></blockquote><p>尽管每个 Pod 都有唯一的 IP，但是没有 Service 的控制， Pod 的 IP 地址都不会从 K8s 内部暴露出去。</p><p>可以通过 Service 指定不同的方式将内部服务暴露：</p><ul><li>ClusterIP，默认值，IP 只暴露在集群内部。</li><li>NodePort，将 Node 中的对应端口暴露，外部可以通过 <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code> 来访问集群内的服务。</li><li>LoadBalancer，通过云服务提供商的负载均衡器（如果支持）像外部暴露服务。</li><li>ExternalName，通过返回 CNAME 和它的值，将服务映射到 ExternalName 字段（和 DNS 有关）。</li></ul><br><p>Service 通过 <em>label selector</em> 匹配 Pod，以对 K8s 中的一组对象进行逻辑分组。Label 是一个 key/value 键值对，主要用来描述以下几个内容的对象：</p><ul><li>区分生产、开发、测试环境；</li><li>对 Pod 进行分类；</li><li>对 Pod 版本进行标记。</li></ul><p>Label 可以在 Pod 创建时指定，也可以在任何时间进行修改。</p><p><img src="https://d33wubrfki0l68.cloudfront.net/7a13fe12acc9ea0728460c482c67e0eb31ff5303/2c8a7/docs/tutorials/kubernetes-basics/public/images/module_04_labels.svg" alt="services and labels"></p><h3 id="创建-service" tabindex="-1">创建 Service <a class="header-anchor" href="#创建-service" aria-label="Permalink to &quot;创建 Service&quot;">​</a></h3><p>1、检查是否存在 Service</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">services</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">services</span></span></code></pre></div><p>2、将之前的 <a href="#上手">Deploment</a> 通过 Service 暴露</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># deployment/kubernetes-bootcamp 将名为 kubernetes-bootcamp 的 deployment 从 K8s 内部暴露</span></span>
<span class="line"><span style="color:#6A737D;"># --type=&quot;NodePort&quot; 暴露的方式时 NodePort</span></span>
<span class="line"><span style="color:#6A737D;"># --port 8080 指定服务端口为 8080，表示外部请求通过公开端口进入 K8s 内部后被转发到 Pod 的 8080 端口</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">expose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--type=</span><span style="color:#9ECBFF;">&quot;NodePort&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># deployment/kubernetes-bootcamp 将名为 kubernetes-bootcamp 的 deployment 从 K8s 内部暴露</span></span>
<span class="line"><span style="color:#6A737D;"># --type=&quot;NodePort&quot; 暴露的方式时 NodePort</span></span>
<span class="line"><span style="color:#6A737D;"># --port 8080 指定服务端口为 8080，表示外部请求通过公开端口进入 K8s 内部后被转发到 Pod 的 8080 端口</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type=</span><span style="color:#032F62;">&quot;NodePort&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span></span></code></pre></div><p>再次执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">services</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">services</span></span></code></pre></div><p>结果如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)          </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">NodePort</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">10.100</span><span style="color:#9ECBFF;">.174.206</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:30201/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">m59s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)          </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp</span><span style="color:#24292E;">   </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10.100</span><span style="color:#032F62;">.174.206</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:30201/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">m59s</span></span></code></pre></div><p>可以看到现在有了一个 Service，名叫 kubernetes-bootcamp，并将 30201 端口暴露了出去。</p><p>此外还可以通过下面的命令，查看 Pod 描述，查看哪个端口被暴露</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">services/kubernetes-bootcamp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">services/kubernetes-bootcamp</span></span></code></pre></div><p>得到以下结果：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Selector:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">NodePort</span></span>
<span class="line"><span style="color:#B392F0;">IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Family</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Policy:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">SingleStack</span></span>
<span class="line"><span style="color:#B392F0;">IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Families:</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">IPv4</span></span>
<span class="line"><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">                       </span><span style="color:#79B8FF;">10.100</span><span style="color:#9ECBFF;">.174.206</span></span>
<span class="line"><span style="color:#B392F0;">IPs:</span><span style="color:#E1E4E8;">                      </span><span style="color:#79B8FF;">10.100</span><span style="color:#9ECBFF;">.174.206</span></span>
<span class="line"><span style="color:#B392F0;">Port:</span><span style="color:#E1E4E8;">                     </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">unse</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">/TCP</span></span>
<span class="line"><span style="color:#B392F0;">TargetPort:</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">/TCP</span></span>
<span class="line"><span style="color:#B392F0;">NodePort:</span><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">unse</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">30201</span><span style="color:#9ECBFF;">/TCP</span></span>
<span class="line"><span style="color:#B392F0;">Endpoints:</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.5:8080</span></span>
<span class="line"><span style="color:#B392F0;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Affinity:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#B392F0;">External</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Traffic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Policy:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Cluster</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">                   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">                </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Selector:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">NodePort</span></span>
<span class="line"><span style="color:#6F42C1;">IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Family</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Policy:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">SingleStack</span></span>
<span class="line"><span style="color:#6F42C1;">IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Families:</span><span style="color:#24292E;">              </span><span style="color:#032F62;">IPv4</span></span>
<span class="line"><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">                       </span><span style="color:#005CC5;">10.100</span><span style="color:#032F62;">.174.206</span></span>
<span class="line"><span style="color:#6F42C1;">IPs:</span><span style="color:#24292E;">                      </span><span style="color:#005CC5;">10.100</span><span style="color:#032F62;">.174.206</span></span>
<span class="line"><span style="color:#6F42C1;">Port:</span><span style="color:#24292E;">                     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">unse</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">/TCP</span></span>
<span class="line"><span style="color:#6F42C1;">TargetPort:</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">/TCP</span></span>
<span class="line"><span style="color:#6F42C1;">NodePort:</span><span style="color:#24292E;">                 </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">unse</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">30201</span><span style="color:#032F62;">/TCP</span></span>
<span class="line"><span style="color:#6F42C1;">Endpoints:</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.5:8080</span></span>
<span class="line"><span style="color:#6F42C1;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Affinity:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#6F42C1;">External</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Traffic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Policy:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Cluster</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">                   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>可以看到，30201 端口被暴露出去了。如果使用的是 K3s/K8s 现在就可以通过 <code>&lt;NodeIP&gt;:&lt;exposePort&gt;</code> 来访问到暴露出来的服务了。使用 MiniKube 还需要进行端口转发操作：</p><p>3、获取 Minukube 的 IP</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">minikube ip</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">minikube ip</span></span></code></pre></div><p>4、接下来只要通过 <code>&lt;Minikube IP&gt;:&lt;暴露出来的端口&gt;</code> 即可访问目标服务</p><p>在这里<mark>踩 Minikube 的坑</mark>：通过 <code>minikube ip</code> 获取到 IP 后发现无法 ping 通该 IP。</p><p>查看 Minikube 文档，发现在 Minikube 中创建一个 service 并暴露网络的流程如下：</p><blockquote><p>The easiest way to access this service is to let minikube launch a web browser for you:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hello-minikube</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hello-minikube</span></span></code></pre></div><p>Alternatively, use kubectl to forward the port:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port-forward</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service/hello-minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7080</span><span style="color:#9ECBFF;">:8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port-forward</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service/hello-minikube</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7080</span><span style="color:#032F62;">:8080</span></span></code></pre></div><p>Tada! Your application is now available at <a href="http://host:7080/" target="_blank" rel="noreferrer">http://host:7080/</a>.</p></blockquote><p>执行命令：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp</span></span></code></pre></div><p>显示内容大概长这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NAMESPACE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TARGET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">8080</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">http://192.168.49.2:30201</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">🏃</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Starting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tunnel</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp.</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NAMESPACE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TARGET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">http://127.0.0.1:38451</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">-----------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">---------------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">-------------</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">------------------------</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">🎉</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Opening</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">browser...</span></span>
<span class="line"><span style="color:#B392F0;">👉</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">http://127.0.0.1:38451</span></span>
<span class="line"><span style="color:#B392F0;">❗</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Because</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">driver</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">linux,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terminal</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">needs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">open</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">it.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NAMESPACE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TARGET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">            </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">default</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">8080</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">http://192.168.49.2:30201</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">🏃</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Starting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tunnel</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp.</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NAMESPACE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TARGET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">          </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">default</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">http://127.0.0.1:38451</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-----------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">---------------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">-------------</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">------------------------</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">🎉</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Opening</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">browser...</span></span>
<span class="line"><span style="color:#6F42C1;">👉</span><span style="color:#24292E;">  </span><span style="color:#032F62;">http://127.0.0.1:38451</span></span>
<span class="line"><span style="color:#6F42C1;">❗</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Because</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">driver</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">linux,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terminal</span><span style="color:#24292E;"> </span><span style="color:#032F62;">needs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">open</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">it.</span></span></code></pre></div><p>Minikube 会将外部的请求转发到对应的端口上。然后就可以通过 <a href="http://127.0.0.1:38451" target="_blank" rel="noreferrer">http://127.0.0.1:38451</a> 来访问内部服务了。</p><h3 id="使用-label" tabindex="-1">使用 Label <a class="header-anchor" href="#使用-label" aria-label="Permalink to &quot;使用 Label&quot;">​</a></h3><p>1、查看 Label</p><p>在我们使用 <code>kubectl create deploment</code> 创建服务的时候，Deploment 会帮我们的 Pod 自动创建一个 Label，可以通过下面的命令查看：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span></span></code></pre></div><p>显示内容大概如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Name:                   kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#e1e4e8;">Namespace:              default</span></span>
<span class="line"><span style="color:#e1e4e8;">CreationTimestamp:      Thu, 20 Jul 2023 11:58:00 +0800</span></span>
<span class="line"><span style="color:#e1e4e8;">Labels:                 app=kubernetes-bootcamp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Name:                   kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#24292e;">Namespace:              default</span></span>
<span class="line"><span style="color:#24292e;">CreationTimestamp:      Thu, 20 Jul 2023 11:58:00 +0800</span></span>
<span class="line"><span style="color:#24292e;">Labels:                 app=kubernetes-bootcamp</span></span></code></pre></div><p>2、手动创建 Label</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 在 &lt;your-pod-name&gt;  这个 pod 上创建一个 label：version=v1</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">your-pod-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version=v1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 在 &lt;your-pod-name&gt;  这个 pod 上创建一个 label：version=v1</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">your-pod-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version=v1</span></span></code></pre></div><p>3、查看创建的 Label</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl describe pods &lt;your-pod-name&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl describe pods &lt;your-pod-name&gt;</span></span></code></pre></div><p>返回结果如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">kubernetes-bootcamp-855d5cc575-w7xxs</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Priority:</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Account:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Node:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">minikube/192.168.49.2</span></span>
<span class="line"><span style="color:#B392F0;">Start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Time:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Thu,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2023</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:58:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#E1E4E8;">                  pod-template-hash</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">855</span><span style="color:#9ECBFF;">d5cc575</span></span>
<span class="line"><span style="color:#E1E4E8;">                  version</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">v1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">kubernetes-bootcamp-855d5cc575-w7xxs</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Priority:</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Account:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Node:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">minikube/192.168.49.2</span></span>
<span class="line"><span style="color:#6F42C1;">Start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Time:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Thu,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2023</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:58:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#24292E;">                  pod-template-hash</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">855</span><span style="color:#032F62;">d5cc575</span></span>
<span class="line"><span style="color:#24292E;">                  version</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">v1</span></span></code></pre></div><p>4、可以看到新创建的 Label 生效了。接下来就可以使用这个 Label 了：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version=v1</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6A737D;"># or</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">services</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6A737D;"># or</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;environment in (production),tier in (frontend)&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version=v1</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6A737D;"># or</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">services</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6A737D;"># or</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;environment in (production),tier in (frontend)&#39;</span></span></code></pre></div><h3 id="删除-service" tabindex="-1">删除 Service <a class="header-anchor" href="#删除-service" aria-label="Permalink to &quot;删除 Service&quot;">​</a></h3><blockquote><p>To delete Services you can use the <code>delete service</code> subcommand. Labels can be used also here:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span></code></pre></div></blockquote><h2 id="k8s-中的对象" tabindex="-1">K8s 中的对象 <a class="header-anchor" href="#k8s-中的对象" aria-label="Permalink to &quot;K8s 中的对象&quot;">​</a></h2><blockquote><p>操作暂时告一段落，关于上面提到的 deployment/pod/service 都是 K8s 中的 API 资源对象。K8s 常用的资源对象如下：</p><ul><li>Pod</li><li>Deployment</li><li>Service</li><li>NameSpace 命名空间</li><li><em>Replication Controller</em>，RC 复制控制器</li><li><em>Replica Set</em>，RS 副本集（新一代的 RC）</li><li>Ingress，Ingress 是允许入站连接到达后端定义的端点的规则集合。</li></ul></blockquote><h3 id="对象概念" tabindex="-1">对象概念 <a class="header-anchor" href="#对象概念" aria-label="Permalink to &quot;对象概念&quot;">​</a></h3><p>API 对象是 K8s 集群中的管理操作单元，K8s 集群系统每支持一项新功能，引入一项新技术，一定会新引入对应的 API 对象，用来对该功能的管理操作提供支持。例如副本集 <em>Replica Set</em> 对应的 API 对象是 RS。</p><p>在 K8s 中一旦创建了对象，K8s 系统就会确保对象存在。可以通过创建对象告诉 K8s 你希望集群的是如何工作的，比如：</p><ul><li>应用如何运行，在哪些节点上运行；</li><li>应用可用资源；</li><li>应用运行策略、重启策略、升级和容错策略。</li></ul><h3 id="对象属性" tabindex="-1">对象属性 <a class="header-anchor" href="#对象属性" aria-label="Permalink to &quot;对象属性&quot;">​</a></h3><p>每个 API 对象都有 3 大类属性：</p><ul><li>metadata 元数据；</li><li>spec 规范；</li><li>status 状态。</li></ul><p>元数据是用来标识 API 对象的，每个对象都至少有 1 个 name 元数据。除此以外还有各种各样的标签 labels 用来标识和匹配不同的对象。例如：用户可以用标签 env 来标识区分不同的服务部署环境，分别用 env=dev、env=testing、env=production 来标识开发、测试、生产的不同服务。</p><p>spec 规范描述了用户期望 K8s 集群中的分布式系统达到的理想状态，例如，用户可以通过 RC/RS 设置期望的 Pod 副本数为 3。</p><p>K8s 中所有的配置都是通过 API 对象的 spec 去设置的，用户配置好理想状态，系统则根据用户配置来运行。</p><blockquote><p>这是 K8s 重要设计理念之一，所有的操作都是声明式（Declarative）的而不是命令式（Imperative）的。</p></blockquote><p>Status 描述了系统实际当前达到的状态，例如系统当前实际的 Pod 副本数为 2；那么 RC/RS 当前的逻辑就是自动启动新的 Pod，争取达到副本数为 3。</p><h3 id="常见的对象" tabindex="-1">常见的对象 <a class="header-anchor" href="#常见的对象" aria-label="Permalink to &quot;常见的对象&quot;">​</a></h3><ul><li><p>Deployment</p></li><li><p>Service</p></li><li><p>RC 是 K8s 集群中最早的保证 Pod 高可用的 API 对象。</p></li><li><p>RS，新一代 RC。</p></li><li><p>Namespace，命名空间，为 K8s 集群提供虚拟的隔离作用，可以通过创建新的命名空间来满足开发/测试/部署需要。K8s 集群初始有两个名字空间，分别是 default 和系统 kube-system。</p></li><li><p>Job，Job 是 K8s 用来控制批处理型任务的 API 对象。批处理业务与长期伺服业务的主要区别是批处理业务的运行有头有尾，而长期伺服业务在用户不停止的情况下会永远运行；Job 管理的 Pod 根据用户的设置把任务成功完成就自动退出了。</p></li><li><p>DaemonSet，长期伺服型服务（后台支撑服务）集合，典型的后台支撑型服务包括，存储，日志和监控等。</p></li><li><p>PetSet，有状态服务集。</p><p>在云原生应用的体系里，有下面两组近义词：第一组是无状态（stateless）、牲畜（cattle）、无名（nameless）、可丢弃（disposable）；第二组是有状态（stateful）、宠物（pet）、有名（having name）、不可丢弃（non-disposable）。</p><p>RC/RS 主要是控制提供无状态服务的，其所控制的 Pod 的名字是随机设置的，一个 Pod 出故障了就被丢弃掉，在另一个地方重启一个新的 Pod，名字变了、名字和启动在哪儿都不重要，重要的只是 Pod 总数；而 PetSet 是用来控制有状态服务，PetSet 中的每个 Pod 的名字都是事先确定的，不能更改。</p><p>此外，对于 RC/RS 中的 Pod，一般不挂载存储或者挂载共享存储，保存的是所有 Pod 共享的状态；而 PetSet 中的 Pod，每个 Pod 挂载自己独立的存储，如果一个 Pod 出现故障，从其他节点启动一个同样名字的 Pod，要挂载上原来 Pod 的存储继续以它的状态提供服务。</p><blockquote><p><strong>应用场景</strong>：</p><p>1、适合于 PetSet 的业务包括数据库服务 MySQL/PostgreSQL，集群化管理服务 Zookeeper、etcd 等有状态服务。</p><p>2、PetSet 的另一种典型应用场景是作为一种比普通容器更稳定可靠的模拟虚拟机的机制。传统的虚拟机正是一种有状态的宠物，运维人员需要不断地维护它，容器刚开始流行时，我们用容器来模拟虚拟机使用，所有状态都保存在容器里，而这已被证明是非常不安全、不可靠的。使用 PetSet，Pod 仍然可以通过漂移到不同节点提供高可用，而存储也可以通过外挂的存储来提供高可靠性，PetSet 做的只是将确定的 Pod 与确定的存储关联起来保证状态的连续性。</p></blockquote></li><li><p>Volume，存储卷。K8s 集群中的存储卷跟 Docker 的存储卷有些类似，只不过 Docker 的存储卷作用范围为一个容器，而 K8s 的存储卷的生命周期和作用范围是一个 Pod。每个 Pod 中声明的存储卷由 Pod 中的所有容器共享。</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noreferrer">ConfigMap</a>，很多应用在其初始化或运行期间要依赖一些配置信息。 ConfigMap 是 K8s 提供的一个配置对象，可让你将配置数据注入到 Pod 中。</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/" target="_blank" rel="noreferrer">Secret</a>，密钥对象是用来保存和传递密码、密钥、认证凭证这些敏感信息的对象。</p><p>使用 Secret 的好处是可以避免把敏感信息明文写在配置文件里。在 K8s 集群中配置和使用服务不可避免的要用到各种敏感信息实现登录、认证等功能，例如访问 AWS 存储的用户名密码。为了避免将类似的敏感信息明文写在所有需要使用的配置文件中，可以将这些信息存入一个 Secret 对象，而在配置文件中通过 Secret 对象引用这些敏感信息。</p></li><li><p>Federation，集群联邦。</p><p>在云计算环境中，服务的作用距离范围从近到远一般可以有：同主机（Host，Node）、跨主机同可用区（Available Zone）、跨可用区同地区（Region）、跨地区同服务商（Cloud Service Provider）、跨云平台。</p><p>K8s 的设计定位是单一集群在同一个地域内，因为同一个地区的网络性能才能满足 K8s 的调度和计算存储连接要求。而联合集群服务就是为提供跨 Region 跨服务商 K8s 集群服务而设计的。</p></li><li><p>…</p></li></ul><h3 id="创建对象" tabindex="-1">创建对象 <a class="header-anchor" href="#创建对象" aria-label="Permalink to &quot;创建对象&quot;">​</a></h3><p>1、提供对象的 metadata 信息以及指定对象的 spec 信息， <code>deployment.yaml</code> ：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># Data that helps uniquely identify the object, including a name string, UID, and optional namespace</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deployment</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># tells deployment to run 2 pods matching the template</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.14.2</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># Data that helps uniquely identify the object, including a name string, UID, and optional namespace</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-deployment</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># tells deployment to run 2 pods matching the template</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.14.2</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-service</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 只对 label 为 nginx 的 pod 生效</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 提供给集群内部其他服务访问</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-service</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 只对 label 为 nginx 的 pod 生效</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 提供给集群内部其他服务访问</span></span></code></pre></div><blockquote><p>The precise format of the object <code>spec</code> is different for every Kubernetes object, and contains nested fields specific to that object. The <a href="https://kubernetes.io/docs/reference/kubernetes-api/" target="_blank" rel="noreferrer">Kubernetes API Reference</a> can help you find the spec format for all of the objects you can create using Kubernetes.</p></blockquote><p>2、使用 <code>kubectl apply</code> 来创建对象</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./deployment.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./deployment.yaml</span></span></code></pre></div><h3 id="k8s-api" tabindex="-1">K8s API <a class="header-anchor" href="#k8s-api" aria-label="Permalink to &quot;K8s API&quot;">​</a></h3><p>在上面的两个资源对象中有还有一个需要注意的地方：<code>apiVersion</code>。不同的对象 K8s 提供的 API 组和 API 版本都可能是不同的，比如 Deployment 使用的是 <code>apps/v1</code> 而 Service 使用的是 <code>v1</code>。</p><p>API 的使用和版本的区别可以在 <a href="https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/" target="_blank" rel="noreferrer">Kubernetes API</a> 找到参考。</p><h3 id="对象创建-管理方式" tabindex="-1">对象创建/管理方式 <a class="header-anchor" href="#对象创建-管理方式" aria-label="Permalink to &quot;对象创建/管理方式&quot;">​</a></h3><blockquote><p>参考：<a href="https://kubernetes.io/zh-cn/docs/tasks/manage-kubernetes-objects/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/manage-kubernetes-objects/</a></p></blockquote><table><thead><tr><th>创建/管理方式</th><th>适用对象</th><th>推荐场景</th></tr></thead><tbody><tr><td>指令式</td><td>对象</td><td>开发</td></tr><tr><td>指令式对象配置</td><td>独立文件</td><td>生产</td></tr><tr><td>声明式对象配置</td><td>路径中的文件</td><td>生产</td></tr></tbody></table><blockquote><p>对象管理应该自始至终都使用同一种方式，交叉使用产生的结果可能和预期会不一致。</p></blockquote><h4 id="指令方式" tabindex="-1">指令方式 <a class="header-anchor" href="#指令方式" aria-label="Permalink to &quot;指令方式&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 使用 kubectl 创建一个 live object</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 使用 kubectl 创建一个 live object</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>优点：</p><ul><li>单一动作；</li><li>只需要一步操作就可以管理对象。</li></ul><p>缺点：</p><ul><li>后面的命令无法与前面的命令产生交互；</li><li>不提供与更改相关的审计跟踪；</li><li>不提供用以创建新对象的模板。</li></ul><h4 id="指令配置方式" tabindex="-1">指令配置方式 <a class="header-anchor" href="#指令配置方式" aria-label="Permalink to &quot;指令配置方式&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># create</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># create|update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replace</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># replace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">redis.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># delete</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.yaml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># create</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.yaml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># create|update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replace</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.yaml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># replace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.yaml</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">redis.yaml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># delete</span></span></code></pre></div><p>优点：</p><ul><li>对象配置可以保存在远程；</li><li>对象配置执行前可以进行推送前审查更改等流程；</li><li>对象配置提供模板用以创建新对象。</li></ul><p>缺点：</p><ul><li>需要对配置文件结构有大致的了解；</li><li>需要编写 yaml 文件。</li></ul><p>与声明式对象配置相比具有以下<em>优点</em>：</p><ul><li>更加易于学习和理解；</li><li>随着 K8s 1.5 版本的到来，命令行配置变得更加成熟。</li></ul><p>与声明式对象配置相比具有以下<em>缺点</em>：</p><ul><li>Imperative object configuration works best on files, not directories.</li><li>Updates to live objects must be reflected in configuration files, or they will be lost during the next replacement.</li></ul><h4 id="声明式配置" tabindex="-1">声明式配置 <a class="header-anchor" href="#声明式配置" aria-label="Permalink to &quot;声明式配置&quot;">​</a></h4><blockquote><p>了解即可…</p></blockquote><blockquote><p>When using declarative object configuration, a user operates on object configuration files stored locally, however the user does not define the operations to be taken on the files. Create, update, and delete operations are automatically detected per-object by <code>kubectl</code>. This enables working on directories, where different operations might be needed for different objects.</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configs/</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configs/</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configs/</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configs/</span></span></code></pre></div><p>支持目录递归：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configs/</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configs/</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configs/</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configs/</span></span></code></pre></div><h2 id="rc-rs" tabindex="-1">RC/RS <a class="header-anchor" href="#rc-rs" aria-label="Permalink to &quot;RC/RS&quot;">​</a></h2><p><strong>复制控制器</strong>（<em>Replication Controller</em>， RC）通过监控运行中的 Pod 来保证集群中运行指定数目的 Pod 副本。指定的数目可以是多个也可以是 1 个；少于指定数目，RC 就会启动运行新的 Pod 副本；多于指定数目，RC 就会销毁多余的 Pod 副本。</p><blockquote><p>即使在指定数目为 1 的情况下，通过 RC 运行 Pod 也比直接运行 Pod 更明智，因为 RC 也可以发挥它高可用的能力，保证永远有 1 个 Pod 在运行。</p></blockquote><p><strong>副本集</strong>（Replica Set，RS）是新一代 RC，提供同样的高可用能力，但是 RS 能支持更多种类的匹配模式。RS 对象一般不单独使用，而是作为 Deployment 的理想状态参数使用。</p><h2 id="deployment" tabindex="-1">Deployment <a class="header-anchor" href="#deployment" aria-label="Permalink to &quot;Deployment&quot;">​</a></h2><p>Deployment 表示对 K8s 集群的一次更新操作。作用范围比 RS 更广，可以是创建或者更新一个服务，也可以是滚动升级一个服务。</p><blockquote><p>滚动升级一个服务，实际是创建一个新的 RS，然后逐渐将新 RS 中副本数增加到理想状态，将旧 RS 中的副本数减小到 0 的复合操作；这样一个复合操作用一个 RS 是不太好描述的，所以用一个更通用的 Deployment 来描述。</p></blockquote><h2 id="service" tabindex="-1">Service <a class="header-anchor" href="#service" aria-label="Permalink to &quot;Service&quot;">​</a></h2><p>RC、RS 和 Deployment 只是保证了支撑服务的微服务 Pod 的数量，但是没有解决如何访问这些服务的问题。一个 Pod 只是一个运行服务的实例，随时可能在一个节点上停止，在另一个节点以一个新的 IP 启动一个新的 Pod，因此不能以确定的 IP 和端口号提供服务。</p><p>要稳定地提供服务需要服务发现和负载均衡能力，K8s 提供了 Service 对象。每个 Service 会对应一个集群内部有效的虚拟 IP，集群内部通过虚拟 IP 访问该 Service。</p><p><strong>Label/Selector</strong></p><blockquote><p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</a></p></blockquote><h2 id="应用伸缩-多实例部署" tabindex="-1">应用伸缩/多实例部署 <a class="header-anchor" href="#应用伸缩-多实例部署" aria-label="Permalink to &quot;应用伸缩/多实例部署&quot;">​</a></h2><h3 id="实例扩张" tabindex="-1">实例扩张 <a class="header-anchor" href="#实例扩张" aria-label="Permalink to &quot;实例扩张&quot;">​</a></h3><p><strong>应用伸缩之前</strong></p><p><img src="https://d33wubrfki0l68.cloudfront.net/043eb67914e9474e30a303553d5a4c6c7301f378/0d8f6/docs/tutorials/kubernetes-basics/public/images/module_05_scaling1.svg" alt="before scale"></p><p><strong>应用伸缩之后</strong></p><p><img src="https://d33wubrfki0l68.cloudfront.net/30f75140a581110443397192d70a4cdb37df7bfc/b5f56/docs/tutorials/kubernetes-basics/public/images/module_05_scaling2.svg" alt="after scale"></p><blockquote><p><em>Scaling</em> is accomplished by changing the number of replicas in a Deployment.</p></blockquote><p>在创建 Deploment 的时候只需要修改 <code>replicas</code> 参数的值就可以实现应用伸缩。伸缩/扩展 Deployment 能确保新的 Pod 在具有可用资源的 Node 上被创建，并且能减少 Pod 的数量到理想状态。</p><blockquote><p>K8s 可以实现应用的自动伸缩扩展，同时也能实现将 Pod 的数量减少到 0。</p></blockquote><p>运行应用的多个实例需要一个方法将网络请求分发给它们，而 Service 正好带着负载均衡的功能，能将外部请求均匀的转发给内部应用。Service 会使用端点持续监控正在运行的 Pod，以确保流量仅发送到可用的 Pod。</p><p><strong>实现应用伸缩/扩展</strong></p><p>1、查看已经创建的 ReplicaSet</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rs</span></span></code></pre></div><p>输出类似下面的内容：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">NAME                             DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#e1e4e8;">kubernetes-bootcamp-855d5cc575   1         1         1       5h28m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">NAME                             DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#24292e;">kubernetes-bootcamp-855d5cc575   1         1         1       5h28m</span></span></code></pre></div><p>我们需要关注的字段有 2 个：</p><ul><li><em>DESIRED</em>，显示当前应用期望的副本数，可以在创建 Deployment 的时候指定。</li><li><em>CURRENT</em>，表示当前有多少副本数正在运行。</li></ul><p>2、扩展副本数，使用 <code>kubectl scale</code> 命令</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 将期望副本数增加到 4 个</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=4</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 将期望副本数增加到 4 个</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=4</span></span></code></pre></div><p>再次通过下面的命令查看，发现应用实例已经变成了 4 个。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments</span></span></code></pre></div><p>通过下面的命令查看当前 Pod 数量：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl get pods -o wide</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl get pods -o wide</span></span></code></pre></div><p>输出内容如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">NAME                                   READY   STATUS    RESTARTS      AGE   IP           NODE       NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#e1e4e8;">kubernetes-bootcamp-855d5cc575-gr922   1/1     Running   1 (15h ago)   15h   10.244.0.9   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">kubernetes-bootcamp-855d5cc575-ngsp2   1/1     Running   1 (15h ago)   15h   10.244.0.5   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">kubernetes-bootcamp-855d5cc575-nzsbl   1/1     Running   1 (15h ago)   15h   10.244.0.2   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">kubernetes-bootcamp-855d5cc575-w7xxs   1/1     Running   3 (15h ago)   21h   10.244.0.4   minikube   &lt;none&gt;           &lt;none&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">NAME                                   READY   STATUS    RESTARTS      AGE   IP           NODE       NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#24292e;">kubernetes-bootcamp-855d5cc575-gr922   1/1     Running   1 (15h ago)   15h   10.244.0.9   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#24292e;">kubernetes-bootcamp-855d5cc575-ngsp2   1/1     Running   1 (15h ago)   15h   10.244.0.5   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#24292e;">kubernetes-bootcamp-855d5cc575-nzsbl   1/1     Running   1 (15h ago)   15h   10.244.0.2   minikube   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#24292e;">kubernetes-bootcamp-855d5cc575-w7xxs   1/1     Running   3 (15h ago)   21h   10.244.0.4   minikube   &lt;none&gt;           &lt;none&gt;</span></span></code></pre></div><p>可以看到，每个 Pod 的 IP 地址都是不同的。</p><p>3、创建针对多个实例的 service，命令还是和之前的一样</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">expose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--type=</span><span style="color:#9ECBFF;">&quot;NodePort&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type=</span><span style="color:#032F62;">&quot;NodePort&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span></span></code></pre></div><p>4、使用 <code>minikube service &lt;service-name&gt;</code> 将 minikube 网络暴露出来</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">🎉</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Opening</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">browser...</span></span>
<span class="line"><span style="color:#B392F0;">👉</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#B392F0;">❗</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Because</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">driver</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">linux,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terminal</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">needs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">open</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">it.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">🎉</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Opening</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">browser...</span></span>
<span class="line"><span style="color:#6F42C1;">👉</span><span style="color:#24292E;">  </span><span style="color:#032F62;">http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#6F42C1;">❗</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Because</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">driver</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">linux,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terminal</span><span style="color:#24292E;"> </span><span style="color:#032F62;">needs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">open</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">it.</span></span></code></pre></div><p>6、打开另一个终端窗口，<code>curl http://127.0.0.1:44013</code>，请求几次就可以看到，K8s 会将请求以 LoadBalance 的形式分发到各个可用的 Pod 上。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-855d5cc575-ngsp2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-855d5cc575-gr922</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-855d5cc575-w7xxs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-855d5cc575-ngsp2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-855d5cc575-gr922</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:44013</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-855d5cc575-w7xxs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span></code></pre></div><h3 id="实例缩减" tabindex="-1">实例缩减 <a class="header-anchor" href="#实例缩减" aria-label="Permalink to &quot;实例缩减&quot;">​</a></h3><p>除了扩张应用实例，K8s 同样支持缩减应用实例，命令和扩张一致，只是参数 <code>replicas</code> 的值不同</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=2</span></span></code></pre></div><h2 id="应用滚动更新" tabindex="-1">应用滚动更新 <a class="header-anchor" href="#应用滚动更新" aria-label="Permalink to &quot;应用滚动更新&quot;">​</a></h2><p>更新之前</p><p><img src="https://d33wubrfki0l68.cloudfront.net/30f75140a581110443397192d70a4cdb37df7bfc/fa906/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates1.svg" alt="rolling-update-1"></p><p>更新第一个实例</p><p><img src="https://d33wubrfki0l68.cloudfront.net/678bcc3281bfcc588e87c73ffdc73c7a8380aca9/703a2/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates2.svg" alt="rolling-update-2"></p><p>更新第二个实例</p><p><img src="https://d33wubrfki0l68.cloudfront.net/9b57c000ea41aca21842da9e1d596cf22f1b9561/91786/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates3.svg" alt="rolling-update-3"></p><p>更新第三、四个实例</p><p><img src="https://d33wubrfki0l68.cloudfront.net/6d8bc1ebb4dc67051242bc828d3ae849dbeedb93/fbfa8/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates4.svg" alt="rolling-update-4"></p><p>K8s 中的滚动更新通过 Deployments 实现应用实例在不中断、不停机情况下更新，新的 Pod 会逐步调度到有可用的资源 Node 节点上。</p><p>K8s 的滚动更新支持以下功能：</p><ul><li>应用升级；</li><li>版本回退；</li><li>不停机实现持续集成和分发。</li></ul><br><h3 id="应用升级" tabindex="-1">应用升级 <a class="header-anchor" href="#应用升级" aria-label="Permalink to &quot;应用升级&quot;">​</a></h3><p>1、首先获取一个新版本的镜像</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># kubectl set image 更新一个或多个 Pod 镜像</span></span>
<span class="line"><span style="color:#6A737D;"># deployments/kubernetes-bootcamp 指定要更新的 Deployment</span></span>
<span class="line"><span style="color:#6A737D;"># kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2 指定新的镜像</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/kubernetes-bootcamp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># kubectl set image 更新一个或多个 Pod 镜像</span></span>
<span class="line"><span style="color:#6A737D;"># deployments/kubernetes-bootcamp 指定要更新的 Deployment</span></span>
<span class="line"><span style="color:#6A737D;"># kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2 指定新的镜像</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/kubernetes-bootcamp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2</span></span></code></pre></div><p>2、查看 Pod 变更状态</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> kubectl get pods</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-69b6f9fbb9-jzdkl</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-69b6f9fbb9-n8w8x</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-69b6f9fbb9-xx9s6</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-855d5cc575-gr922</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (15h </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   15h</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-855d5cc575-ngsp2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (15h </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   15h</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-855d5cc575-nzsbl</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (15h </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   15h</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-bootcamp-855d5cc575-w7xxs</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> (15h </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   21h</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> kubectl get pods</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">              </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-69b6f9fbb9-jzdkl</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-69b6f9fbb9-n8w8x</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-69b6f9fbb9-xx9s6</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-855d5cc575-gr922</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (15h </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   15h</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-855d5cc575-ngsp2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (15h </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   15h</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-855d5cc575-nzsbl</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (15h </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   15h</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-bootcamp-855d5cc575-w7xxs</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> (15h </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   21h</span></span></code></pre></div><p>3、等到 Pod 状态都重新变成 Running 时继续将网络暴露，发送请求验证更新</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-69b6f9fbb9-wwkvx</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-69b6f9fbb9-n8w8x</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#B392F0;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bootcamp!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-bootcamp-69b6f9fbb9-xx9s6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> v</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-69b6f9fbb9-wwkvx</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-69b6f9fbb9-n8w8x</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> curl http://127.0.0.1:37417</span></span>
<span class="line"><span style="color:#6F42C1;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bootcamp!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-bootcamp-69b6f9fbb9-xx9s6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> v</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span></span></code></pre></div><p>从结果可以看到，应用负载均衡状态正常，版本更新状态正常，从 v1 升级到了 v2。</p><p>4、还可以使用 <code>kubectl rollout status deployments/&lt;deployment-name&gt;</code> 命令检查更新状态</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> kubectl rollout status deployments/kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#B392F0;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;kubernetes-bootcamp&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rolled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">out</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> kubectl rollout status deployments/kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#6F42C1;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;kubernetes-bootcamp&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rolled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">out</span></span></code></pre></div><p>输出类似的结果表示应用滚动更新成功。</p><p>5、此外，还可以通过检查 Pod 镜像查看滚动更新结果</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">kubernetes-bootcamp-69b6f9fbb9-jzdkl</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Priority:</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Account:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Node:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">minikube/192.168.49.2</span></span>
<span class="line"><span style="color:#B392F0;">Start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Time:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Fri,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2023</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:30:38</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#E1E4E8;">                  pod-template-hash</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">69</span><span style="color:#9ECBFF;">b6f9fbb9</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.12</span></span>
<span class="line"><span style="color:#B392F0;">IPs:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.12</span></span>
<span class="line"><span style="color:#B392F0;">Controlled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">By:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ReplicaSet/kubernetes-bootcamp-69b6f9fbb9</span></span>
<span class="line"><span style="color:#B392F0;">Containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubernetes-bootcamp:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">docker://e63f22e3bb9082ff462859f4c37ce1898e5e38bc1c0960f442ad8af033195ecf</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Image:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">jocatalin/kubernetes-bootcamp:v2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">docker-pullable://jocatalin/kubernetes-bootcamp@sha256:fb1a3ced00cecfc1f83f18ab5cd14199e30adc1b49aa4244f5d65ad3f5feb2a5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">kubernetes-bootcamp-69b6f9fbb9-jzdkl</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Priority:</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Account:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Node:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">minikube/192.168.49.2</span></span>
<span class="line"><span style="color:#6F42C1;">Start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Time:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Fri,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2023</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:30:38</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">app=kubernetes-bootcamp</span></span>
<span class="line"><span style="color:#24292E;">                  pod-template-hash</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">69</span><span style="color:#032F62;">b6f9fbb9</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.12</span></span>
<span class="line"><span style="color:#6F42C1;">IPs:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.12</span></span>
<span class="line"><span style="color:#6F42C1;">Controlled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">By:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ReplicaSet/kubernetes-bootcamp-69b6f9fbb9</span></span>
<span class="line"><span style="color:#6F42C1;">Containers:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubernetes-bootcamp:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">docker://e63f22e3bb9082ff462859f4c37ce1898e5e38bc1c0960f442ad8af033195ecf</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Image:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">jocatalin/kubernetes-bootcamp:v2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">docker-pullable://jocatalin/kubernetes-bootcamp@sha256:fb1a3ced00cecfc1f83f18ab5cd14199e30adc1b49aa4244f5d65ad3f5feb2a5</span></span></code></pre></div><p>从输出结果可以看到，Image 已经变成了新指定的镜像。</p><h3 id="版本回退" tabindex="-1">版本回退 <a class="header-anchor" href="#版本回退" aria-label="Permalink to &quot;版本回退&quot;">​</a></h3><p>该命令会撤销更新操作，默认回退到上一个已知版本。更新是有版本控制的，可以恢复到任何以前已知的部署状态。</p><p>1、可以使用 <code>kubectl rollout undo</code> 命令来进行版本回退，默认回退到上一个版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/kubernetes-bootcamp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/kubernetes-bootcamp</span></span></code></pre></div><p>2、查询历史发布的 Deployment</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">history</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">deployment-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">history</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">deployment-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>输出内容大概如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">deployment.apps/node-hello</span></span>
<span class="line"><span style="color:#B392F0;">REVISION</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">3</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">deployment.apps/node-hello</span></span>
<span class="line"><span style="color:#6F42C1;">REVISION</span><span style="color:#24292E;">  </span><span style="color:#032F62;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">3</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>3、回退到指定版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">roll-back-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--to-revision=</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">revision-number</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">roll-back-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--to-revision=</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">revision-number</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h2 id="自定义服务部署" tabindex="-1">自定义服务部署 <a class="header-anchor" href="#自定义服务部署" aria-label="Permalink to &quot;自定义服务部署&quot;">​</a></h2><p>1、编写 <code>server.js</code>：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">http</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;http&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">handleRequest</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">request</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">response</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Received request for URL: &#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> request.url);</span></span>
<span class="line"><span style="color:#E1E4E8;">  response.</span><span style="color:#B392F0;">writeHead</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  response.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Hello World! V1&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">www</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> http.</span><span style="color:#B392F0;">createServer</span><span style="color:#E1E4E8;">(handleRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">www.</span><span style="color:#B392F0;">listen</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">http</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;http&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">handleRequest</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">request</span><span style="color:#24292E;">, </span><span style="color:#E36209;">response</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Received request for URL: &#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> request.url);</span></span>
<span class="line"><span style="color:#24292E;">  response.</span><span style="color:#6F42C1;">writeHead</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">200</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  response.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Hello World! V1&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">www</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> http.</span><span style="color:#6F42C1;">createServer</span><span style="color:#24292E;">(handleRequest);</span></span>
<span class="line"><span style="color:#24292E;">www.</span><span style="color:#6F42C1;">listen</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">8080</span><span style="color:#24292E;">);</span></span></code></pre></div><p>2、编写 Dockerfile：</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> node:latest</span></span>
<span class="line"><span style="color:#F97583;">EXPOSE</span><span style="color:#E1E4E8;"> 8080</span></span>
<span class="line"><span style="color:#F97583;">COPY</span><span style="color:#E1E4E8;"> server.js .</span></span>
<span class="line"><span style="color:#F97583;">CMD</span><span style="color:#E1E4E8;"> node server.js</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> node:latest</span></span>
<span class="line"><span style="color:#D73A49;">EXPOSE</span><span style="color:#24292E;"> 8080</span></span>
<span class="line"><span style="color:#D73A49;">COPY</span><span style="color:#24292E;"> server.js .</span></span>
<span class="line"><span style="color:#D73A49;">CMD</span><span style="color:#24292E;"> node server.js</span></span></code></pre></div><p>3、构建镜像，有两种方式：</p><p>3.1、使用 <code>minikube build</code>，进入 Dockerfile 所在的目录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">image-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">build-versio</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">image-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">build-versio</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span></code></pre></div><p>3.2、使用与 Minikube VM 相同的 Docker 主机构建镜像</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">eval</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">minikube</span><span style="color:#9ECBFF;"> docker-env)</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">image-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">build-versio</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 退出 VM 主机</span></span>
<span class="line"><span style="color:#79B8FF;">eval</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">minikube</span><span style="color:#9ECBFF;"> docker-env </span><span style="color:#79B8FF;">-u</span><span style="color:#9ECBFF;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">eval</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">minikube</span><span style="color:#032F62;"> docker-env)</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">image-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">build-versio</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 退出 VM 主机</span></span>
<span class="line"><span style="color:#005CC5;">eval</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">minikube</span><span style="color:#032F62;"> docker-env </span><span style="color:#005CC5;">-u</span><span style="color:#032F62;">)</span></span></code></pre></div><p>4、查看镜像构建结果</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ls</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ls</span></span></code></pre></div><p>输出结果大概如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ls</span></span>
<span class="line"><span style="color:#B392F0;">docker.io/library/node-hello:v1</span></span>
<span class="line"><span style="color:#B392F0;">docker.io/library/hello-node:v11</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ls</span></span>
<span class="line"><span style="color:#6F42C1;">docker.io/library/node-hello:v1</span></span>
<span class="line"><span style="color:#6F42C1;">docker.io/library/hello-node:v11</span></span></code></pre></div><p>说明镜像构建成功</p><p>5、创建 Deployment</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image=</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">image-name</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">:</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">version</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">image-name</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">:</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">version</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>6、修改代码，发布 V2</p><p>7、重新构建镜像，使用 <code>kubectl set image deployments</code> 滚动更新应用</p><p>8、修改代码，发布 V3</p><p>9、重新构建，滚动更新应用</p><p>10、从 V3 回滚 V1</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments/ndoe-hello</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--to-revision=1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments/ndoe-hello</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--to-revision=1</span></span></code></pre></div><h2 id="namespace" tabindex="-1">Namespace <a class="header-anchor" href="#namespace" aria-label="Permalink to &quot;Namespace&quot;">​</a></h2><p>当存在大量不同类型的应用时，可以使用 namespace 来区分；还能隔离资源的使用。在 K8s 中，相同 namespace 下的应用具有相同的资源访问控制策略。</p><h3 id="查看" tabindex="-1">查看 <a class="header-anchor" href="#查看" aria-label="Permalink to &quot;查看&quot;">​</a></h3><p>查看当前的 namespace</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span></span></code></pre></div><p>输出内容大概如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-lease</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#B392F0;">kube-public</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#B392F0;">kube-system</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-dashboard</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">                </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-lease</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-public</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-dashboard</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span></code></pre></div><p>K8s 默认存在多个 namesapce，若未指定 namespace，就会被分配到 default 命名空间。</p><h3 id="创建-namespace" tabindex="-1">创建 namespace <a class="header-anchor" href="#创建-namespace" aria-label="Permalink to &quot;创建 namespace&quot;">​</a></h3><p>命令行创建</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl create namespace new-namespace</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl create namespace new-namespace</span></span></code></pre></div><p>通过文件创建</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">new-namespace</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Namespace</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">new-namespace</span></span></code></pre></div><h3 id="删除-namespace" tabindex="-1">删除 namespace <a class="header-anchor" href="#删除-namespace" aria-label="Permalink to &quot;删除 namespace&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl delete namespaces new-namespace</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl delete namespaces new-namespace</span></span></code></pre></div><blockquote><p>注意：</p><ul><li>删除一个 namespace 会自动删除该 namespace 下的所有资源。</li><li>default 和 kube-system 命名空间不可删除。</li></ul></blockquote><h3 id="配置-pod-限额" tabindex="-1">配置 Pod 限额 <a class="header-anchor" href="#配置-pod-限额" aria-label="Permalink to &quot;配置 Pod 限额&quot;">​</a></h3><blockquote><p><a href="http://docs.kubernetes.org.cn/749.html" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/749.html</a></p></blockquote><h3 id="配置-cpu-限额" tabindex="-1">配置 CPU 限额 <a class="header-anchor" href="#配置-cpu-限额" aria-label="Permalink to &quot;配置 CPU 限额&quot;">​</a></h3><blockquote><p><a href="http://docs.kubernetes.org.cn/747.html" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/747.html</a></p></blockquote><h3 id="配置内存限额" tabindex="-1">配置内存限额 <a class="header-anchor" href="#配置内存限额" aria-label="Permalink to &quot;配置内存限额&quot;">​</a></h3><blockquote><p><a href="http://docs.kubernetes.org.cn/746.html" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/746.html</a></p></blockquote><h2 id="statefulset" tabindex="-1">StatefulSet <a class="header-anchor" href="#statefulset" aria-label="Permalink to &quot;StatefulSet&quot;">​</a></h2><blockquote><p><a href="http://docs.kubernetes.org.cn/443.html" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/443.html</a></p></blockquote><h2 id="cronjob" tabindex="-1">CronJob <a class="header-anchor" href="#cronjob" aria-label="Permalink to &quot;CronJob&quot;">​</a></h2><blockquote><p>cronjob 容器内部时间与外部主机对应不上最有效的解决办法：将外部主机的 localtime 挂载到容器内部。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">CronJob</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">jobTemplate</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">File</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">CronJob</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">jobTemplate</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">File</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span></code></pre></div><p>…</p></blockquote><h2 id="ingress" tabindex="-1">Ingress <a class="header-anchor" href="#ingress" aria-label="Permalink to &quot;Ingress&quot;">​</a></h2><blockquote><p>关于 Ingress：<a href="https://www.v2ex.com/t/968820" target="_blank" rel="noreferrer">https://www.v2ex.com/t/968820</a></p></blockquote><p>Ingress 可以将 K8s 集群中的 Serivce 通过 http/https 暴露到集群外部，提供给外部访问。访问的规则被定义在 Ingress 中。</p><p><img src="/assets/image-20230906094111626.24700b7e.png" alt="image-20230906094111626"></p><h3 id="ingress-controller" tabindex="-1">Ingress Controller <a class="header-anchor" href="#ingress-controller" aria-label="Permalink to &quot;Ingress Controller&quot;">​</a></h3><p>可以把 Ingress 看成接口，或者看成是一个规则集。仅仅有 Ingress 是不够的，还需要 <em>Ingress Controller</em> 来负责实现。可以这样认为：Ingress 相当于 <code>nginx.conf</code>；<em>Ingress Controller</em> 相当于 nginx 本体。光有 Ingress 是无效的，需要两者配合才能起作用。</p><h3 id="最小化-ingress" tabindex="-1">最小化 Ingress <a class="header-anchor" href="#最小化-ingress" aria-label="Permalink to &quot;最小化 Ingress&quot;">​</a></h3><p><code>minimal-ingress.yaml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">minimal-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># If the ingressClassName is omitted, a default Ingress class should be defined.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># https://kubernetes.io/docs/concepts/services-networking/ingress/#default-ingress-class</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># ingressClassName: traefik # 在有多个 ingress controller 的情况下才需要使用此字段</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 前缀匹配。此外还有  Exact 精确匹配 https://kubernetes.io/docs/concepts/services-networking/ingress/#examples</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># service 暴露的 port</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">minimal-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># If the ingressClassName is omitted, a default Ingress class should be defined.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># https://kubernetes.io/docs/concepts/services-networking/ingress/#default-ingress-class</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># ingressClassName: traefik # 在有多个 ingress controller 的情况下才需要使用此字段</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 前缀匹配。此外还有  Exact 精确匹配 https://kubernetes.io/docs/concepts/services-networking/ingress/#examples</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-svc</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># service 暴露的 port</span></span></code></pre></div><p>每个 http 规则都包含了下列信息：</p><ul><li>host，可选，如果指定了 host 所有定义的规则都会只对该 host 生效；否则对所有的 IP 都生效。</li><li>paths，所有匹配的路径请求会被 ingress 分发到对应的 service 服务上。</li><li>service 表示 ingress 收到请求后发送到的服务。</li><li>此外还有一个 <code>defaultBackend</code> 配置用来指定某个服务处理未匹配到的请求。</li></ul><h3 id="单-service" tabindex="-1">单 Service <a class="header-anchor" href="#单-service" aria-label="Permalink to &quot;单 Service&quot;">​</a></h3><p>1、创建 <code>my-ingress.yaml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server-svc</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span></code></pre></div><p>2、查看 Ingress 信息</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my-ingress</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my-ingress</span></span></code></pre></div><p>可以看到输出信息大概如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Address:</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.111.11,192.168.111.12</span></span>
<span class="line"><span style="color:#B392F0;">Ingress</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Class:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">traefik</span></span>
<span class="line"><span style="color:#B392F0;">Default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backend:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">defaul</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Rules:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Path</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Backends</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">*</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">my-server-svc:8080</span><span style="color:#E1E4E8;"> (10.42.1.15:8080,10.42.1.16:8080)</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">field.cattle.io/publicEndpoints:</span></span>
<span class="line"><span style="color:#E1E4E8;">                [{</span><span style="color:#9ECBFF;">&quot;addresses&quot;</span><span style="color:#E1E4E8;">:[</span><span style="color:#9ECBFF;">&quot;192.168.111.11&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;192.168.111.12&quot;</span><span style="color:#E1E4E8;">],</span><span style="color:#9ECBFF;">&quot;port&quot;</span><span style="color:#E1E4E8;">:80,</span><span style="color:#9ECBFF;">&quot;protocol&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;HTTP&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;serviceName&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;default:my-server-svc&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;ingressName&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;default...</span></span>
<span class="line"><span style="color:#9ECBFF;">Events:       &lt;none&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Address:</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.111.11,192.168.111.12</span></span>
<span class="line"><span style="color:#6F42C1;">Ingress</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Class:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">traefik</span></span>
<span class="line"><span style="color:#6F42C1;">Default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backend:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">defaul</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Rules:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Path</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Backends</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">*</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">/</span><span style="color:#24292E;">   </span><span style="color:#032F62;">my-server-svc:8080</span><span style="color:#24292E;"> (10.42.1.15:8080,10.42.1.16:8080)</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">field.cattle.io/publicEndpoints:</span></span>
<span class="line"><span style="color:#24292E;">                [{</span><span style="color:#032F62;">&quot;addresses&quot;</span><span style="color:#24292E;">:[</span><span style="color:#032F62;">&quot;192.168.111.11&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;192.168.111.12&quot;</span><span style="color:#24292E;">],</span><span style="color:#032F62;">&quot;port&quot;</span><span style="color:#24292E;">:80,</span><span style="color:#032F62;">&quot;protocol&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;HTTP&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;serviceName&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;default:my-server-svc&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;ingressName&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;default...</span></span>
<span class="line"><span style="color:#032F62;">Events:       &lt;none&gt;</span></span></code></pre></div><p>接下来就可以从 <code>AddressIP:80</code> 访问到 my-server-svc 服务。</p><h3 id="多-service" tabindex="-1">多 Service <a class="header-anchor" href="#多-service" aria-label="Permalink to &quot;多 Service&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/foo</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/bar</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">your-server-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8888</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/foo</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server-svc</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/bar</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">your-server-svc</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8888</span></span></code></pre></div><h3 id="开启-traefik-dashboard" tabindex="-1">开启 traefik dashboard <a class="header-anchor" href="#开启-traefik-dashboard" aria-label="Permalink to &quot;开启 traefik dashboard&quot;">​</a></h3><p>1、<a href="https://github.com/traefik/traefik-helm-chart" target="_blank" rel="noreferrer">安装 traefik</a></p><p>2、进行端口转发</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-A</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port-forward</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">traefik-xxxx-xxx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--address</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">9000</span><span style="color:#9ECBFF;">:9000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-A</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port-forward</span><span style="color:#24292E;"> </span><span style="color:#032F62;">traefik-xxxx-xxx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--address</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">9000</span><span style="color:#032F62;">:9000</span></span></code></pre></div><p>3、访问 <code>https://&lt;your-ip&gt;:9000/dashboard/</code></p><blockquote><p>不要忘记最后面的 <code>/</code>，它也是需要的。</p></blockquote><p>参考：<a href="https://github.com/traefik/traefik-helm-chart/issues/85" target="_blank" rel="noreferrer">https://github.com/traefik/traefik-helm-chart/issues/85</a></p><h3 id="k3s-切换-ingress-nginx" tabindex="-1">k3s 切换 ingress-nginx <a class="header-anchor" href="#k3s-切换-ingress-nginx" aria-label="Permalink to &quot;k3s 切换 ingress-nginx&quot;">​</a></h3><p>在 k3s 中默认使用 traefik 来作为 <em>Ingress Controller</em>，除此之外还有 ingress-nginx 等 controller。</p><blockquote><p>其他 <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noreferrer"><em>Ingress Controller</em></a></p></blockquote><p>如果想要将 k3s 的 treafik 切换成 ingress-nginx，按照以下步骤进行：</p><p>1、用<code>--disable traefik</code>启动 K3s server，然后部署你需要的 ingress。</p><p>2、<a href="https://docs.rancherdesktop.io/zh/how-to-guides/setup-NGINX-Ingress-Controller" target="_blank" rel="noreferrer">可以使用 helm 或者 kubectl 来安装 ingress-nginx</a>：</p><blockquote><p>建议开全局代理</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://kubernetes.github.io/ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--create-namespace</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://kubernetes.github.io/ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--create-namespace</span></span></code></pre></div><p>3、等待 ingress pod 运行并检查状态：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace=ingress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace=ingress-nginx</span></span></code></pre></div><p>4、接下来就可以编写 ingress 然后愉快的使用了~</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server-svc</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span></code></pre></div><p>5、如果只能通过内外访问，无法使用外部 IP 访问 <em>ingress controller</em>，可以尝试修改 ingress-nginx-controller 的 service 配置：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service/ingress-nginx-controller</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service/ingress-nginx-controller</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span></span></code></pre></div><p>将 <code>spec.externalTrafficPolicy</code> 的值设置为 <code>Local</code>。</p><blockquote><p>上面的步骤是通过命令自动部署并运行 ingress-nginx，此外还可以通过手动的方式运行，可以参考：<a href="https://www.cnblogs.com/syushin/p/15271304.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/syushin/p/15271304.html</a></p></blockquote><br><h3 id="切换-controller-踩坑" tabindex="-1">切换 controller 踩坑 <a class="header-anchor" href="#切换-controller-踩坑" aria-label="Permalink to &quot;切换 controller 踩坑&quot;">​</a></h3><blockquote><p>Ingress 还支持 <code>spec.ingressClassName</code> 这个字段，网上很多资料都填得很随便 <code>nginx-example</code> 或者 <code>nginx-1</code>。我也尝试随便填了 <code>nginx-1</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-1</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ingressClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-1</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span></code></pre></div><p>一同操作后创建 <code>my-ingress</code>：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my-ingress.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my-ingress.yaml</span></span></code></pre></div><p>发现 <em>ingress not work as I expected</em>，使用 <code>kubectl describe ingress my-ingress</code> 查看发现 <code>Address</code> 一栏为空，查询许久无果。😢</p><p>后面在查看 <a href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/cloud/deploy.yaml" target="_blank" rel="noreferrer"><code>ingress-nginx-controller.yaml</code></a> 的时候发现它的 IngressClass 配置如下：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IngressClass</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">controller</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">k8s.io/ingress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IngressClass</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">controller</span><span style="color:#24292E;">: </span><span style="color:#032F62;">k8s.io/ingress-nginx</span></span></code></pre></div><p>注意看 <code>name: nginx</code>，随后尝试修改 <code>my-ingress.yaml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ingressClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>重新创建 ingress，<em>it works</em>！<code>Address</code> 通过设置的 ingress 规则现在能成的访问到指定的服务了。</p><p>因此，在未弄清 <code>ingressClassName</code> 字段的作用的情况下，还是留空使用默认的 <em>ingress controller</em> 为妙。</p></blockquote><p>volume</p><br><h2 id="kubenetes-dashboard" tabindex="-1">Kubenetes Dashboard <a class="header-anchor" href="#kubenetes-dashboard" aria-label="Permalink to &quot;Kubenetes Dashboard&quot;">​</a></h2><blockquote><p>参考：<a href="https://docs.rancher.cn/docs/k3s/installation/kube-dashboard/_index" target="_blank" rel="noreferrer">https://docs.rancher.cn/docs/k3s/installation/kube-dashboard/_index</a></p></blockquote><p>1、下载 yaml 配置，<a href="https://github.com/kubernetes/dashboard/releases" target="_blank" rel="noreferrer">https://github.com/kubernetes/dashboard/releases</a></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 以 2.7.0 为例</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 以 2.7.0 为例</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre></div><p>2、运行创建 deployment</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recommended.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># 也可以直接</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recommended.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># 也可以直接</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre></div><p>3、配置用户</p><p>3.1、创建 <code>dashboard.admin-user.yml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><p>3.2、创建 <code>dashboard.admin-user-role.yml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cluster-admin</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cluster-admin</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><p>4、部署 admin-user</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dashboard.admin-user.yml</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dashboard.admin-user-role.yml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dashboard.admin-user.yml</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dashboard.admin-user-role.yml</span></span></code></pre></div><p>5、获取 token</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">token</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin-user</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">token</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin-user</span></span></code></pre></div><p>6、开启代理</p><blockquote><p>参考：<a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/accessing-dashboard/README.md#login-not-available" target="_blank" rel="noreferrer">https://github.com/kubernetes/dashboard/blob/master/docs/user/accessing-dashboard/README.md#login-not-available</a></p></blockquote><p>从外部访问有以下几种方式</p><blockquote><p><strong>方法一：端口转发</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Kubernetes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">URL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> POD_NAME</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get pods </span><span style="color:#79B8FF;">-n</span><span style="color:#9ECBFF;"> kubernetes-dashboard </span><span style="color:#79B8FF;">-l</span><span style="color:#9ECBFF;"> &quot;app.kubernetes.io/name=kubernetes-dashboard,app.kubernetes.io/instance=kubernetes-dashboard&quot; </span><span style="color:#79B8FF;">-o</span><span style="color:#9ECBFF;"> jsonpath=&quot;{.items[0].metadata.name}&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://127.0.0.1:8443/</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port-forward</span><span style="color:#E1E4E8;"> $POD_NAME </span><span style="color:#79B8FF;">8443</span><span style="color:#9ECBFF;">:8443</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">URL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">export</span><span style="color:#24292E;"> POD_NAME</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">kubectl</span><span style="color:#032F62;"> get pods </span><span style="color:#005CC5;">-n</span><span style="color:#032F62;"> kubernetes-dashboard </span><span style="color:#005CC5;">-l</span><span style="color:#032F62;"> &quot;app.kubernetes.io/name=kubernetes-dashboard,app.kubernetes.io/instance=kubernetes-dashboard&quot; </span><span style="color:#005CC5;">-o</span><span style="color:#032F62;"> jsonpath=&quot;{.items[0].metadata.name}&quot;)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://127.0.0.1:8443/</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port-forward</span><span style="color:#24292E;"> $POD_NAME </span><span style="color:#005CC5;">8443</span><span style="color:#032F62;">:8443</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 监听 8080，并转发至 443</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port-forward</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--address</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:443</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 监听 8080，并转发至 443</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port-forward</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--address</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:443</span></span></code></pre></div><ul><li>访问地址：<code>https://&lt;your-ip&gt;:8080/</code></li><li>使用 <code>admin-user/token</code> 登录</li></ul><br><p><strong>方法二：NodePort</strong></p><p>编辑 kubernetes-dashboard 命名空间中的 kubernetes-dashboard 服务</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">nodePort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">30169</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">443</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8443</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">k8s-app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NodePort</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 修改这一行即可，原为 ClusterIP</span></span>
<span class="line"><span style="color:#85E89D;">status</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">loadBalancer</span><span style="color:#E1E4E8;">: {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">nodePort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">30169</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">443</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8443</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">k8s-app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 修改这一行即可，原为 ClusterIP</span></span>
<span class="line"><span style="color:#22863A;">status</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">loadBalancer</span><span style="color:#24292E;">: {}</span></span></code></pre></div><p>重新查看 kubernetes-dashboard 服务的端口地址</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><p>显示大概如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> kubectl -n kubernetes-dashboard get service kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)         </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes-dashboard</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">NodePort</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.43</span><span style="color:#9ECBFF;">.191.193</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">:30511/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">32</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> kubectl -n kubernetes-dashboard get service kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">       </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">      </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)         </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes-dashboard</span><span style="color:#24292E;">   </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.43</span><span style="color:#032F62;">.191.193</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">:30511/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">32</span><span style="color:#032F62;">m</span></span></code></pre></div><p>现在就可以通过 <code>https://&lt;your-server-ip&gt;:30511/</code> 访问到控制台。</p><p><strong>方法三：Ingress</strong></p></blockquote><h2 id="rancher" tabindex="-1">Rancher <a class="header-anchor" href="#rancher" aria-label="Permalink to &quot;Rancher&quot;">​</a></h2><blockquote><p>参考：<a href="https://ranchermanager.docs.rancher.com/pages-for-subheaders/rancher-on-a-single-node-with-docker" target="_blank" rel="noreferrer">https://ranchermanager.docs.rancher.com/pages-for-subheaders/rancher-on-a-single-node-with-docker</a></p></blockquote><p>K8s 的配置、使用、集群管理方面基本上都是基于 <code>yaml</code> 文件，可以使用 Rancher 来管理 K8s 集群、进行项目部署等工作。</p><blockquote><p>Rancher 和 K8s 有什么区别？</p><p>Rancher 和 K8s 都是用来作为容器的调度与编排系统。但是 Rancher 不仅能够管理应用容器，还能管理 K8s 集群。Rancher 2.x 底层基于 K8s 调度引擎，通过 Rancher 的封装，开发者可以在不熟悉 K8s 概念的情况下轻松的通过 Rancher 来部署容器到 K8s 集群当中。</p><p>为实现上述的功能，Rancher 自身提供了一套完整的用于管理 K8s 的组件，包括 Rancher API Server, Cluster Controller, Cluster Agent, Node Agent 等等。组件相互协作使得 Rancher 能够掌控每个 K8s 集群，从而将多集群的管理和使用整合在统一的 Rancher 平台中。Rancher 增强了一些 K8s 的功能，并提供了面向用户友好的使用方式。</p><p>参考：<a href="https://www.zhihu.com/question/309076492%E3%80%82" target="_blank" rel="noreferrer">https://www.zhihu.com/question/309076492。</a></p></blockquote><p>1、通过 docker 启动</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--restart=unless-stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;">:80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">:443</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--privileged</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">rancher/rancher:latest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--restart=unless-stopped</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">:80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">:443</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--privileged</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">rancher/rancher:latest</span></span></code></pre></div><p>2、通过 <code>https://&lt;host&gt;:443</code> 访问</p><h2 id="k8s-衍生产品" tabindex="-1">K8s 衍生产品 <a class="header-anchor" href="#k8s-衍生产品" aria-label="Permalink to &quot;K8s 衍生产品&quot;">​</a></h2><ul><li>k0s: <a href="https://github.com/k0sproject/k0s%EF%BC%8C%E6%A7%BD%E7%82%B9%EF%BC%9A%E7%9B%B8%E6%AF%94%E4%BA%8E" target="_blank" rel="noreferrer">https://github.com/k0sproject/k0s，槽点：相比于</a> microk8s 和 k3s/k3d 体积稍大</li><li>microk8s: <a href="https://github.com/canonical/microk8s%EF%BC%8C%E6%A7%BD%E7%82%B9%EF%BC%9A%E9%80%9A%E8%BF%87" target="_blank" rel="noreferrer">https://github.com/canonical/microk8s，槽点：通过</a> snap 分发</li><li>k3s: <a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noreferrer">https://github.com/k3s-io/k3s/</a></li><li>k3d: <a href="https://github.com/k3d-io/k3d%EF%BC%8C%E5%9C%A8" target="_blank" rel="noreferrer">https://github.com/k3d-io/k3d，在</a> Docker 容器中运行 k3s</li><li>minikube: <a href="https://github.com/kubernetes/minikube%EF%BC%8C%E6%A7%BD%E7%82%B9%EF%BC%9A%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%9A%E8%8A%82%E7%82%B9" target="_blank" rel="noreferrer">https://github.com/kubernetes/minikube，槽点：不支持多节点</a></li></ul><h2 id="k3s-k8s-k9s" tabindex="-1">K3S/K8s/K9S <a class="header-anchor" href="#k3s-k8s-k9s" aria-label="Permalink to &quot;K3S/K8s/K9S&quot;">​</a></h2><blockquote><p><a href="https://juejin.cn/post/6955368911705473060" target="_blank" rel="noreferrer">https://juejin.cn/post/6955368911705473060</a></p></blockquote><blockquote><p>搜索了一番暂时没有发现从 K3s 迁移/升级到 K8s 的案例。</p></blockquote><h2 id="microk8s-k3s-minikube" tabindex="-1">MICROK8S/K3s/Minikube <a class="header-anchor" href="#microk8s-k3s-minikube" aria-label="Permalink to &quot;MICROK8S/K3s/Minikube&quot;">​</a></h2><blockquote><p>MicroK8s vs K3s vs minikube: <a href="https://microk8s.io/compare" target="_blank" rel="noreferrer">https://microk8s.io/compare</a></p></blockquote><h2 id="k3s" tabindex="-1">K3s <a class="header-anchor" href="#k3s" aria-label="Permalink to &quot;K3s&quot;">​</a></h2><h3 id="k3s-部署" tabindex="-1">K3s 部署 <a class="header-anchor" href="#k3s-部署" aria-label="Permalink to &quot;K3s 部署&quot;">​</a></h3><blockquote><p>参考：<a href="https://github.com/k3s-io/k3s" target="_blank" rel="noreferrer">https://github.com/k3s-io/k3s</a></p></blockquote><p>1、master 节点部署。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 下载并安装</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sfL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://get.k3s.io</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span></span>
<span class="line"><span style="color:#6A737D;"># 查看 k3s 启动状态</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">restart</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">stop</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k3s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 节点查询</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nodes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 下载并安装</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sfL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://get.k3s.io</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span></span>
<span class="line"><span style="color:#6A737D;"># 查看 k3s 启动状态</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">restart</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">stop</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k3s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 节点查询</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span></span></code></pre></div><blockquote><p><code>K3S_TOKEN</code> is created at <code>/var/lib/rancher/k3s/server/node-token</code> on your server.</p></blockquote><p>2、worker 节点部署。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> NODE_TOKEN</span><span style="color:#F97583;">=&lt;</span><span style="color:#9ECBFF;">your-node-toke</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sfL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://get.k3s.io</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> K3S_URL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">your-server-i</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:6443</span><span style="color:#E1E4E8;"> K3S_TOKEN</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">${NODE_TOKEN} </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> NODE_TOKEN</span><span style="color:#D73A49;">=&lt;</span><span style="color:#032F62;">your-node-toke</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sfL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://get.k3s.io</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> K3S_URL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">your-server-i</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:6443</span><span style="color:#24292E;"> K3S_TOKEN</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">${NODE_TOKEN} </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span></span></code></pre></div><p>3、或者手动配置 worker 节点。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> NODE_TOKEN</span><span style="color:#F97583;">=&lt;</span><span style="color:#9ECBFF;">your-node-toke</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k3s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">agent</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">your-server-i</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:6443</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--node-label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--token</span><span style="color:#E1E4E8;"> ${NODE_TOKEN}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> NODE_TOKEN</span><span style="color:#D73A49;">=&lt;</span><span style="color:#032F62;">your-node-toke</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k3s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">agent</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">your-server-i</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:6443</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--node-label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">worker</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--token</span><span style="color:#24292E;"> ${NODE_TOKEN}</span></span></code></pre></div><p>4、设置节点角色</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nodes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k8s-node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node-role.kubernetes.io/worker=worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">node-role.kubernetes.io/worker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># worker 角色</span></span>
<span class="line"><span style="color:#B392F0;">node-role.kubernetes.io/master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># master 角色</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k8s-node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node-role.kubernetes.io/worker=worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">node-role.kubernetes.io/worker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># worker 角色</span></span>
<span class="line"><span style="color:#6F42C1;">node-role.kubernetes.io/master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># master 角色</span></span></code></pre></div><h3 id="k3s-操作" tabindex="-1">K3s 操作 <a class="header-anchor" href="#k3s-操作" aria-label="Permalink to &quot;K3s 操作&quot;">​</a></h3><p><strong>停止</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">/usr/local/bin/k3s-killall.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stop</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">restart</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">start</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k3s</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stop</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">restart</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">start</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k3s-agent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">/usr/local/bin/k3s-killall.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stop</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">restart</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">start</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k3s</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stop</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">restart</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">start</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k3s-agent</span></span></code></pre></div><p><strong>卸载 Server</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">/usr/local/bin/k3s-uninstall.sh</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">/usr/local/bin/k3s-uninstall.sh</span></span></code></pre></div><p><strong>卸载 Agent</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">/usr/local/bin/k3s-agent-uninstall.sh</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">/usr/local/bin/k3s-agent-uninstall.sh</span></span></code></pre></div><h3 id="设置私有仓库地址" tabindex="-1">设置私有仓库地址 <a class="header-anchor" href="#设置私有仓库地址" aria-label="Permalink to &quot;设置私有仓库地址&quot;">​</a></h3><blockquote><p>每一个节点都需要设置</p></blockquote><p>编辑文件：<code>/etc/rancher/k3s/registries.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">mirrors</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">192.168.2.203:5000</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;http://192.168.2.203:5000&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">mirrors</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">192.168.2.203:5000</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;http://192.168.2.203:5000&quot;</span></span></code></pre></div><h3 id="设置-node-role" tabindex="-1">设置 node-role <a class="header-anchor" href="#设置-node-role" aria-label="Permalink to &quot;设置 node-role&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nodes</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">your-node-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes.io/role=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-rol</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">your-node-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes.io/role=</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-rol</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h3 id="使用-docker-来作为运行时" tabindex="-1">使用 Docker 来作为运行时 <a class="header-anchor" href="#使用-docker-来作为运行时" aria-label="Permalink to &quot;使用 Docker 来作为运行时&quot;">​</a></h3><blockquote><p>参考：<a href="https://docs.rancher.cn/docs/k3s/advanced/_index" target="_blank" rel="noreferrer">使用 Docker 作为容器运行时</a></p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 使用 containerd 安装命令</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sfL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://get.k3s.io</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span></span>
<span class="line"><span style="color:#6A737D;"># 使用 docker 的安装命令</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sfL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://get.k3s.io</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker</span></span>
<span class="line"><span style="color:#6A737D;"># agent 同理，将 - 修改成 -s - --docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 使用 containerd 安装命令</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sfL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://get.k3s.io</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span></span>
<span class="line"><span style="color:#6A737D;"># 使用 docker 的安装命令</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sfL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://get.k3s.io</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker</span></span>
<span class="line"><span style="color:#6A737D;"># agent 同理，将 - 修改成 -s - --docker</span></span></code></pre></div><h2 id="多节点部署" tabindex="-1">多节点部署 <a class="header-anchor" href="#多节点部署" aria-label="Permalink to &quot;多节点部署&quot;">​</a></h2><blockquote><p>记录 K3s 多节点的安装过程。</p></blockquote><h3 id="虚拟机配置" tabindex="-1">虚拟机配置 <a class="header-anchor" href="#虚拟机配置" aria-label="Permalink to &quot;虚拟机配置&quot;">​</a></h3><blockquote><p>为了尽可能的模拟生产环境，选择 VMware 虚拟机来进行操作。</p></blockquote><p>1、分配虚拟机 IP。</p><p>本次使用的系统是 ubuntu-server-22.04，安装过程中需要注意为虚拟机分配 ip，以保证各个节点之间的通讯。在 VMware 中选择好镜像首次配置好之后，在“网络适配器”一栏选择 NAT 模式：</p><p><img src="/assets/image-20230905095811355.38e5fa7e.png" alt="image-20230905095811355"></p><p>记住此时选择的虚拟网卡是 “VMnet8”，接下来选择 VMware 左上角菜单栏“编辑”=&gt;“虚拟网络编辑器”：</p><p><img src="/assets/image-20230905095954541.b4ab7627.png" alt="image-20230905095954541"></p><p>接下来虚拟机系统的 IP 地址就是要根据这个子网 IP 来配置。或者在下面的配置中需要用到“子网IP”，或者打开“控制面板\网络和 Internet\网络连接”，找到 “VMnet8”：</p><p><img src="/assets/image-20230905101551319.07194822.png" alt="image-20230905101551319"></p><p>右键属性：</p><p><img src="/assets/image-20230905101638022.1c808a1f.png" alt="image-20230905101638022"></p><p>再次进入 IPv4 属性：</p><p><img src="/assets/image-20230905101712986.91eba0ae.png" alt="image-20230905101712986"></p><p>按照 IPv4 中的信息添加虚拟机的网络配置。</p><p>2、在虚拟机的安装过程中会出现类似下面的图：</p><p><img src="/assets/2046382-20230103100708647-851538930.7318a52f.png" alt="img"></p><p>选择手动配置 IP，根据自己的情况：</p><ul><li>subnet: 192.168.111.0/24</li><li>address: 192.168.111.xx，自定义 IP</li><li>gateway: 192.168.111.2</li><li>name server: 8.8.8.8,225.5.5.5</li></ul><p>其中这几个字段分别是：</p><ul><li>subnet，子网，对着 Windows 下的默认网关修改，将最后一位改为 0/24</li><li>address，为此虚拟机分配的 IP，跟 Windows 保持在同一网段下。</li><li>gateway，网关，与 Windows 一致。</li><li>name server 表示 dns 服务器地址。</li></ul><p>2、接下来就可以启动虚拟机了。后续还想扩充其他节点的话可以使用 VMware 的克隆功能。选择对应的虚拟机，右键 =&gt; 管理 =&gt; 克隆。克隆完成后需要修改 mac 地址：</p><p><img src="/assets/image-20230905102026710.4ae41d94.png" alt="image-20230905102026710"></p><p>3、克隆后的虚拟机 IP 和 hostname 都和被克隆的虚拟机一致，需要做一些修改。</p><p>3.1、修改主机名，编辑 <code>/etc/hostname</code>；</p><p>3.2 修改 IP，编辑 <code>/etc/netplan/*.yaml</code>。</p><p>保存，重启虚拟机。</p><h3 id="安装-k3s-集群-k3s-部署" tabindex="-1">[安装 K3s 集群](#K3s 部署) <a class="header-anchor" href="#安装-k3s-集群-k3s-部署" aria-label="Permalink to &quot;[安装 K3s 集群](#K3s 部署)&quot;">​</a></h3><h3 id="安装-rancher" tabindex="-1"><a href="#Rancher">安装 Rancher</a> <a class="header-anchor" href="#安装-rancher" aria-label="Permalink to &quot;[安装 Rancher](#Rancher)&quot;">​</a></h3><blockquote><p>使用 Rancher 管理 K3s 集群。</p></blockquote><h3 id="服务部署测试" tabindex="-1">服务部署测试 <a class="header-anchor" href="#服务部署测试" aria-label="Permalink to &quot;服务部署测试&quot;">​</a></h3><p>1、沿用<a href="#自定义服务部署">自定义服务</a></p><p>2、将服务打包成 docker 镜像之后推送到自定义的 docker-registry</p><p>3、在每一台装有 k3s 的系统上创建文件 <code>/etc/rancher/k3s/registries.yaml</code>，内容如下</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">mirrors</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">&lt;your-ip&gt;:&lt;your-port&gt;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;&lt;your-ip&gt;:&lt;your-port&gt;&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">mirrors</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">&lt;your-ip&gt;:&lt;your-port&gt;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;&lt;your-ip&gt;:&lt;your-port&gt;&quot;</span></span></code></pre></div><blockquote><p>参考：<a href="https://docs.rancher.cn/docs/k3s/installation/private-registry/_index/" target="_blank" rel="noreferrer">私有镜像仓库配置</a></p></blockquote><p>保存后重启 K3s 服务，此时 K3s 服务就可以拉取到 Docker 私服上的镜像了。</p><p>4、测试 <code>my-server-deployment.yaml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-deployment</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-deployment</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my-server-deployment.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my-server-deployment.yaml</span></span></code></pre></div><p>5、创建 Service 对象 <code>my-server-src</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-service</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 只对 label 为 my-server 的 pod 生效</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-server</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># name of this port | optional</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 提供给集群内部其他服务访问</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-service</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 只对 label 为 my-server 的 pod 生效</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-server</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># name of this port | optional</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 提供给集群内部其他服务访问</span></span></code></pre></div><p>6、配置 Ingress，<code>my-server-ingress.yaml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-service</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-service</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span></code></pre></div><h2 id="harbor" tabindex="-1">Harbor <a class="header-anchor" href="#harbor" aria-label="Permalink to &quot;Harbor&quot;">​</a></h2><blockquote><p>docker-registry 与 harbor：<a href="https://cloud.tencent.com/developer/article/1080444" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/1080444</a></p></blockquote><h2 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-label="Permalink to &quot;Helm&quot;">​</a></h2><blockquote><p>如果把 K8s 看成一个操作系统，那么 helm 就类似于 Ubuntu 中的 apt，作为一个包管理器 helm 可以用来快速安装 K8s 中的各种插件和工具。</p></blockquote><blockquote><p><a href="https://helm.sh/zh/docs/" target="_blank" rel="noreferrer">https://helm.sh/zh/docs/</a></p></blockquote><blockquote><p>K3s 中使用 helm 报错：<code>Error: Kubernetes cluster unreachable: Get &quot;http://localhost:8080/version&quot;: dial tcp 127.0.0.1:8080: connect: connection refused</code>。</p><p>解决办法：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> KUBECONFIG</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/etc/rancher/k3s/k3s.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> KUBECONFIG</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/etc/rancher/k3s/k3s.yaml</span></span></code></pre></div><p>参考：<a href="https://github.com/k3s-io/k3s/issues/1126" target="_blank" rel="noreferrer">https://github.com/k3s-io/k3s/issues/1126</a></p></blockquote><h2 id="volume" tabindex="-1">Volume <a class="header-anchor" href="#volume" aria-label="Permalink to &quot;Volume&quot;">​</a></h2><p>K8s 容器中的数据在磁盘上是临时存放的，并且每个 Pod 产生的数据是相互隔离的。此外如果 Pod 被销毁，那么 Pod 产生的数据也会跟着消失。</p><p>K8s 使用 Volume 来解决这个问题。Volume 不是单独的对象，不能被独立创建，只能在 Pod 中定义。因此 Volume 的生命周期和 Pod 的生命周期是一致的。</p><h3 id="volume-的类型" tabindex="-1">Volume 的类型 <a class="header-anchor" href="#volume-的类型" aria-label="Permalink to &quot;Volume 的类型&quot;">​</a></h3><ul><li>emptyDir，一个空目录</li><li>hostPath，将主机的某个目录挂载到容器中</li><li>ConfigMap、Secret，特殊类型，将 K8s 的特定对象挂在到 Pod 中</li><li>PersistentVolume、PersistentVolunmeClaim，K8s 的持久化存储类型</li></ul><h3 id="emptydir" tabindex="-1">EmptyDir <a class="header-anchor" href="#emptydir" aria-label="Permalink to &quot;EmptyDir&quot;">​</a></h3><h3 id="hostpath" tabindex="-1">HostPath <a class="header-anchor" href="#hostpath" aria-label="Permalink to &quot;HostPath&quot;">​</a></h3><h3 id="persistentvolume" tabindex="-1">PersistentVolume <a class="header-anchor" href="#persistentvolume" aria-label="Permalink to &quot;PersistentVolume&quot;">​</a></h3><h3 id="persistentvolumeclaim" tabindex="-1">PersistentVolumeClaim <a class="header-anchor" href="#persistentvolumeclaim" aria-label="Permalink to &quot;PersistentVolumeClaim&quot;">​</a></h3><h2 id="部署-mysql" tabindex="-1">部署 MySQL <a class="header-anchor" href="#部署-mysql" aria-label="Permalink to &quot;部署 MySQL&quot;">​</a></h2><h3 id="使用-hostpath" tabindex="-1">使用 HostPath <a class="header-anchor" href="#使用-hostpath" aria-label="Permalink to &quot;使用 HostPath&quot;">​</a></h3><p>1、配置文件 <code>ms.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 将容器内部的 /var/lib/mysql 路径挂载到主机上的 /data/mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data/mysql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 将容器内部的 /var/lib/mysql 路径挂载到主机上的 /data/mysql</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data/mysql</span></span></code></pre></div><p>2、创建资源对象</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ms.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ms.yaml</span></span></code></pre></div><p>3、创建完成连接到 MySQL 创建 user 数据库</p><p>4、删除资源对象</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ms.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ms.yaml</span></span></code></pre></div><p>5、重新创建资源对象，并查询数据库</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">databases</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Database</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">goods</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">information_schema</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mysql</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">performance_schema</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sys</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rows</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> (0.00 </span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">databases</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">+--------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Database</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">goods</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">information_schema</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mysql</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">performance_schema</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sys</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------------------+</span></span>
<span class="line"><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rows</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> (0.00 </span><span style="color:#032F62;">sec</span><span style="color:#24292E;">)</span></span></code></pre></div><p>可以看到，原先创建的 user 数据库依旧存在。</p><blockquote><p>需要<strong>注意</strong></p><p>HostPath 存储的内容与节点相关，所以它不适合像数据库这类的应用，如果数据库的 Pod 被调度到别的节点，那读取的内容就完全不一样了。</p></blockquote><hr><h3 id="使用-pv-pvc" tabindex="-1">使用 PV/PVC <a class="header-anchor" href="#使用-pv-pvc" aria-label="Permalink to &quot;使用 PV/PVC&quot;">​</a></h3><p>如果要求 Pod 重新调度后仍然能使用之前读写过的数据，就只能使用网络存储了。网络存储种类非常多，且有不同的使用方法。通常，一个云服务提供商至少有块存储、文件存储、对象存储三种。</p><p>K8s 抽象了 PV（PersistentVolume）和 PVC（PersistentVolumeClaim）这两个资源对象来解耦这个问题。</p><ul><li>PV：描述的是持久化存储卷，定义一个持久化存储在宿主机上的目录，比如一个 NFS 的挂载目录。</li><li>PVC：描述的是 Pod 所希望使用的持久化存储的属性，比如，Volume 存储的大小、可读写权限等。</li></ul><p><strong>PV 制作方式</strong></p><ul><li>静态制作：管理员手动创建，一般用在数量 PV 数量较少的情况下。</li><li>动态制作：大规模集群中可能会存在大量的 PV，此时就可以使用 StorageClass 来定义好 PV 的属性来动态创建 PV。</li></ul><blockquote><p>StorageClass：PV 是运维人员来创建的，开发操作 PVC，可是大规模集群中可能会有很多 PV，如果这些 PV 都需要运维手动来处理这也是一件很繁琐的事情，所以就有了动态供给概念，也就是 <em>Dynamic Provisioning</em>。而我们上面的创建的 PV 都是静态供给方式，也就是 <em>Static Provisioning</em>。而动态供给的关键就是 StorageClass，它的作用就是创建 PV 模板。</p></blockquote><p><strong>本地 PV 制作</strong></p><p>1、在对应节点创建并挂载本地目录</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mnt/disks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> vol </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> vol1 vol2 vol3; </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mnt/disks/</span><span style="color:#E1E4E8;">$vol</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tmpfs</span><span style="color:#E1E4E8;"> $vol </span><span style="color:#9ECBFF;">/mnt/disks/</span><span style="color:#E1E4E8;">$vol</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mnt/disks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> vol </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> vol1 vol2 vol3; </span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mnt/disks/</span><span style="color:#24292E;">$vol</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tmpfs</span><span style="color:#24292E;"> $vol </span><span style="color:#032F62;">/mnt/disks/</span><span style="color:#24292E;">$vol</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div><p>2、创建 <code>mysql-pv.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StorageClass</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">provisioner</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes.io/no-provisioner</span></span>
<span class="line"><span style="color:#85E89D;">volumeBindingMode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">WaitForFirstConsumer</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 延迟 PVC 绑定，直到 pod 被调度</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolume</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-pv</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">capacity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeMode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Filesystem</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">persistentVolumeReclaimPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Retain</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># PVC 被删除后，PV 的留存策略</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">local</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 表示 pv 使用本地存储</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/mnt/disks/vol1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 使用 local pv 需要定义 nodeAffinity，k8s 需要根据 nodeAffinity 将 Pod 调度到有对应 local volume 的 node 上</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nodeAffinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">required</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">nodeSelectorTerms</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">matchExpressions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes.io/hostname</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">In</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">values</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">ubt-srv-2</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-pvc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 声明存储的大小</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-pv</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 绑定 PV</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StorageClass</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">provisioner</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/no-provisioner</span></span>
<span class="line"><span style="color:#22863A;">volumeBindingMode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">WaitForFirstConsumer</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 延迟 PVC 绑定，直到 pod 被调度</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolume</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-pv</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">capacity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeMode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Filesystem</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">persistentVolumeReclaimPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Retain</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># PVC 被删除后，PV 的留存策略</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">local</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 表示 pv 使用本地存储</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/mnt/disks/vol1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 使用 local pv 需要定义 nodeAffinity，k8s 需要根据 nodeAffinity 将 Pod 调度到有对应 local volume 的 node 上</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">required</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">nodeSelectorTerms</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/hostname</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">values</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#032F62;">ubt-srv-2</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-pvc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 声明存储的大小</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-pv</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 绑定 PV</span></span></code></pre></div><blockquote><p>Local PV 目前尚不支持 <em>Dynamic Provisioning</em>，无法在创建 PVC 的时候就自动创建出对应的 PV。</p></blockquote><p>3、创建资源对象</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-pv.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># 查看资源信息</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pvc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-pv.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># 查看资源信息</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pvc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span></code></pre></div><p>4、使用 PVC</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># Data that helps uniquely identify the object, including a name string, UID, and optional namespace</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local-pvc</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/lib/mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local-pvc</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">persistentVolumeClaim</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">claimName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-pvc</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># Data that helps uniquely identify the object, including a name string, UID, and optional namespace</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local-pvc</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/lib/mysql</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local-pvc</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">persistentVolumeClaim</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">claimName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-pvc</span></span></code></pre></div><p>5、查看对应节点下的挂载的目录信息</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> df -h</span></span>
<span class="line"><span style="color:#B392F0;">Filesystem</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">Size</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Used</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Avail</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Use%</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Mounted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span></span>
<span class="line"><span style="color:#B392F0;">vol1</span><span style="color:#E1E4E8;">                               </span><span style="color:#79B8FF;">1.9</span><span style="color:#9ECBFF;">G</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">188</span><span style="color:#9ECBFF;">M</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1.8</span><span style="color:#9ECBFF;">G</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">10</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mnt/disks/vol1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> df -h</span></span>
<span class="line"><span style="color:#6F42C1;">Filesystem</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">Size</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Used</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Avail</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Use%</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Mounted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span></span>
<span class="line"><span style="color:#6F42C1;">vol1</span><span style="color:#24292E;">                               </span><span style="color:#005CC5;">1.9</span><span style="color:#032F62;">G</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">188</span><span style="color:#032F62;">M</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1.8</span><span style="color:#032F62;">G</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">%</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mnt/disks/vol1</span></span></code></pre></div><p>删除并重新创建对应的资源对象可以发现数据依然能被完整保存。</p><hr><h3 id="设置时区" tabindex="-1">设置时区 <a class="header-anchor" href="#设置时区" aria-label="Permalink to &quot;设置时区&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">File</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 创建副本的时候按照模板内描述的内容来创建</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">File</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span></code></pre></div><hr><h3 id="自定义配置文件" tabindex="-1">自定义配置文件 <a class="header-anchor" href="#自定义配置文件" aria-label="Permalink to &quot;自定义配置文件&quot;">​</a></h3><p>通过创建 ConfigMap 并挂载到容器中，可自定义 MySQL 配置文件。</p><p>1、创建 <code>mysql-cm.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">my.cnf</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#9ECBFF;">    [mysqld]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#9ECBFF;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#9ECBFF;">    character-set-server=utf8</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">    log_bin=/opt/mysql/log</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">my.cnf</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#032F62;">    [mysqld]</span></span>
<span class="line"><span style="color:#032F62;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#032F62;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#032F62;">    character-set-server=utf8</span></span>
<span class="line"><span style="color:#032F62;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#032F62;">    log_bin=/opt/mysql/log</span></span></code></pre></div><p>2、使用 ConfigMap</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># /etc/my.cnf.d/my.cnf 只对特定的 MySQL 实例生效</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># /etc/mysql/conf.d 存放 MySQL 的全局配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># /etc/my.cnf.d/my.cnf 只对特定的 MySQL 实例生效</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># /etc/mysql/conf.d 存放 MySQL 的全局配置文件</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my.cnf</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span></code></pre></div><p>3、进入容器内部</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/my.cnf.d/my.cnf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/my.cnf.d/my.cnf</span></span></code></pre></div><p>可以发现我们设置的配置生效了。</p><hr><h3 id="使用-secret" tabindex="-1">使用 Secret <a class="header-anchor" href="#使用-secret" aria-label="Permalink to &quot;使用 Secret&quot;">​</a></h3><p>像是测试环境中直接将密码明文暴露的设置方法在生产环境中是不被允许的。在 K8s 中可以借助 <code>Secret</code> 来配置犹如密码等敏感信息。</p><p><strong>Secret 的类型</strong></p><table><thead><tr><th>内置类型</th><th>用法</th></tr></thead><tbody><tr><td><code>Opaque</code></td><td>用户定义的任意数据</td></tr><tr><td><code>kubernetes.io/service-account-token</code></td><td>服务账号令牌</td></tr><tr><td><code>kubernetes.io/dockercfg</code></td><td><code>~/.dockercfg</code> 文件的序列化形式</td></tr><tr><td><code>kubernetes.io/dockerconfigjson</code></td><td><code>~/.docker/config.json</code> 文件的序列化形式</td></tr><tr><td><code>kubernetes.io/basic-auth</code></td><td>用于基本身份认证的凭据</td></tr><tr><td><code>kubernetes.io/ssh-auth</code></td><td>用于 SSH 身份认证的凭据</td></tr><tr><td><code>kubernetes.io/tls</code></td><td>用于 TLS 客户端或者服务器端的数据</td></tr><tr><td><code>bootstrap.kubernetes.io/token</code></td><td>启动引导令牌数据</td></tr></tbody></table><p>如果 <code>type</code> 值为空字符串，则被视为 <code>Opaque</code> 类型。</p><p>1、创建 <code>mysql-secret.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-root-password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-root-password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span></code></pre></div><p>2、在容器配置中以变量引用的方式使用 Secret</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-root-password</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">secretKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-root-password</span></span></code></pre></div><hr><h3 id="定期自动备份" tabindex="-1">定期自动备份 <a class="header-anchor" href="#定期自动备份" aria-label="Permalink to &quot;定期自动备份&quot;">​</a></h3><p>可以使用 K8s 的 CronJob 来实现数据库的定期自动备份。</p><p>1、修改 Secret</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-root-password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cm9vdA==</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-root-password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cm9vdA==</span></span></code></pre></div><p>2、编辑 ConfigMap</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-ext-config</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-host</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">127.0.0.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-ext-config</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">127.0.0.1</span></span></code></pre></div><p>3、编辑 Cron 配置</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">CronJob</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-backup</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">schedule</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;* * * * *&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#timeZone: &quot;Etc/UTC&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">jobTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">OnFailure</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-backup</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_USERNAME</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-username</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_HOST</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-ext-config</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-host</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TZ</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Asia/Shanghai</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">/bin/sh</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#9ECBFF;">-c</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">              set -ex</span></span>
<span class="line"><span style="color:#9ECBFF;">              mysqldump --host=$MYSQL_HOST --user=$MYSQL_USERNAME \</span></span>
<span class="line"><span style="color:#9ECBFF;">              		--password=$MYSQL_ROOT_PASSWORD \</span></span>
<span class="line"><span style="color:#9ECBFF;">              		--routines --all-databases --single-transaction \</span></span>
<span class="line"><span style="color:#9ECBFF;">              		&gt; /opt/mysql-all-db-backup-`date +&quot;%Y%m%d&quot;`.sql</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config-ext</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localtime</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">File</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/localtime</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">CronJob</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-backup</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">schedule</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;* * * * *&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">#timeZone: &quot;Etc/UTC&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">jobTemplate</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">OnFailure</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-backup</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_USERNAME</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">secretKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-username</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_HOST</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-ext-config</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-host</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TZ</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Asia/Shanghai</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#032F62;">/bin/sh</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#032F62;">-c</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">              set -ex</span></span>
<span class="line"><span style="color:#032F62;">              mysqldump --host=$MYSQL_HOST --user=$MYSQL_USERNAME \</span></span>
<span class="line"><span style="color:#032F62;">              		--password=$MYSQL_ROOT_PASSWORD \</span></span>
<span class="line"><span style="color:#032F62;">              		--routines --all-databases --single-transaction \</span></span>
<span class="line"><span style="color:#032F62;">              		&gt; /opt/mysql-all-db-backup-`date +&quot;%Y%m%d&quot;`.sql</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my.cnf</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config-ext</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localtime</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">File</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/localtime</span></span></code></pre></div><blockquote><p><code>set -ex</code> 用于设置脚本的执行选项。其中，<code>-e</code> 选项表示一旦脚本中的任何命令执行失败，就立即终止脚本的执行，<code>-x</code> 选项用于在执行每个命令之前打印该命令及其参数。</p></blockquote><hr><h3 id="主从复制架构" tabindex="-1">主从复制架构 <a class="header-anchor" href="#主从复制架构" aria-label="Permalink to &quot;主从复制架构&quot;">​</a></h3><p>0、Secret</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cm9vdA==</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># root</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mysql-root-password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cm9vdA==</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># root</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mysql-root-password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 经过 base64 加密后的密码</span></span></code></pre></div><p>1、主</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-master</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-master</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-root-password</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 将容器内部的 /var/lib/mysql 路径挂载到主机上的 /data/mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-local</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data/mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config-master</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config-master</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">my.cnf</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#9ECBFF;">    [client]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#9ECBFF;">    [mysql]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#9ECBFF;">    [mysqld]</span></span>
<span class="line"><span style="color:#9ECBFF;">    server_id=1</span></span>
<span class="line"><span style="color:#9ECBFF;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#9ECBFF;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">    log_bin=/opt/mysql/log</span></span>
<span class="line"><span style="color:#9ECBFF;">    skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#9ECBFF;">    skip-name-resolve</span></span>
<span class="line"><span style="color:#9ECBFF;">    read-only=0</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=mysql</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=sys</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=information_schema</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=performance_schema</span></span>
<span class="line"><span style="color:#9ECBFF;">    binlog-do-db=db_user</span></span>
<span class="line"><span style="color:#9ECBFF;">    binlog-do-db=db_goods</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-master</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-master</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">secretKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-root-password</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 将容器内部的 /var/lib/mysql 路径挂载到主机上的 /data/mysql</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my.cnf</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-local</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data/mysql</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config-master</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config-master</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">my.cnf</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#032F62;">    [client]</span></span>
<span class="line"><span style="color:#032F62;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#032F62;">    [mysql]</span></span>
<span class="line"><span style="color:#032F62;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#032F62;">    [mysqld]</span></span>
<span class="line"><span style="color:#032F62;">    server_id=1</span></span>
<span class="line"><span style="color:#032F62;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#032F62;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#032F62;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#032F62;">    log_bin=/opt/mysql/log</span></span>
<span class="line"><span style="color:#032F62;">    skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#032F62;">    skip-name-resolve</span></span>
<span class="line"><span style="color:#032F62;">    read-only=0</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=mysql</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=sys</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=information_schema</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=performance_schema</span></span>
<span class="line"><span style="color:#032F62;">    binlog-do-db=db_user</span></span>
<span class="line"><span style="color:#032F62;">    binlog-do-db=db_goods</span></span></code></pre></div><p>2、从</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-slave</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-slave</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-root-password</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config-salve</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql-config-salve</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">my.cnf</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#9ECBFF;">    [client]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#9ECBFF;">    [mysql]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#9ECBFF;">    [mysqld]</span></span>
<span class="line"><span style="color:#9ECBFF;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#9ECBFF;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#9ECBFF;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">    log_bin=/opt/mysql/log</span></span>
<span class="line"><span style="color:#9ECBFF;">    skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#9ECBFF;">    skip-name-resolve</span></span>
<span class="line"><span style="color:#9ECBFF;">    read-only=1</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=mysql</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=sys</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=information_schema</span></span>
<span class="line"><span style="color:#9ECBFF;">    replicate-ignore-db=performance_schema</span></span>
<span class="line"><span style="color:#9ECBFF;">    binlog-do-db=db_user</span></span>
<span class="line"><span style="color:#9ECBFF;">    binlog-do-db=db_goods</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Which version of the Kubernetes API you&#39;re using to create this object</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># What kind of object you want to create</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-slave</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># What state you desire for the object</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-slave</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">secretKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-secret</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-root-password</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/my.cnf.d/my.cnf</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my.cnf</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config-salve</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql-config-salve</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">my.cnf</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># | 符号被称为折叠标记，表示下方缩进的区块中包含多行文本数据</span></span>
<span class="line"><span style="color:#032F62;">    [client]</span></span>
<span class="line"><span style="color:#032F62;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#032F62;">    [mysql]</span></span>
<span class="line"><span style="color:#032F62;">    default-character-set=utf8</span></span>
<span class="line"><span style="color:#032F62;">    [mysqld]</span></span>
<span class="line"><span style="color:#032F62;">    default_storage_engine=innodb</span></span>
<span class="line"><span style="color:#032F62;">    lower_case_table_names=1</span></span>
<span class="line"><span style="color:#032F62;">    default-time_zone=&#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#032F62;">    log_bin=/opt/mysql/log</span></span>
<span class="line"><span style="color:#032F62;">    skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#032F62;">    skip-name-resolve</span></span>
<span class="line"><span style="color:#032F62;">    read-only=1</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=mysql</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=sys</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=information_schema</span></span>
<span class="line"><span style="color:#032F62;">    replicate-ignore-db=performance_schema</span></span>
<span class="line"><span style="color:#032F62;">    binlog-do-db=db_user</span></span>
<span class="line"><span style="color:#032F62;">    binlog-do-db=db_goods</span></span></code></pre></div><p>3、Service</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3306</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3306</span></span></code></pre></div><p>4、服务部署完毕进行配置</p><p>4.1、主从都要开启 root 账户允许远程访问</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">grant</span><span style="color:#E1E4E8;"> all privileges </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;root&#39;</span><span style="color:#E1E4E8;">@</span><span style="color:#9ECBFF;">&#39;%&#39;</span><span style="color:#E1E4E8;"> identified </span><span style="color:#F97583;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">grant</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">option</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">flush privileges;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">grant</span><span style="color:#24292E;"> all privileges </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;root&#39;</span><span style="color:#24292E;">@</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;"> identified </span><span style="color:#D73A49;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">grant</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">option</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">flush privileges;</span></span></code></pre></div><p>4.2、主库添加主从复制账户</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> &#39;</span><span style="color:#B392F0;">repl</span><span style="color:#E1E4E8;">&#39;@</span><span style="color:#9ECBFF;">&#39;%&#39;</span><span style="color:#E1E4E8;"> IDENTIFIED </span><span style="color:#F97583;">BY</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> REPLICATION SLAVE </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;repl&#39;</span><span style="color:#E1E4E8;">@</span><span style="color:#9ECBFF;">&#39;%&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> &#39;</span><span style="color:#6F42C1;">repl</span><span style="color:#24292E;">&#39;@</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;"> IDENTIFIED </span><span style="color:#D73A49;">BY</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> REPLICATION SLAVE </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;repl&#39;</span><span style="color:#24292E;">@</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><p>4.3、查看主库状态（从库连接的时候需要用到同步的 File 和同步的 Position 信息）</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mysql</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> show </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">| </span><span style="color:#F97583;">File</span><span style="color:#E1E4E8;">          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span>
<span class="line"><span style="color:#F97583;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">| </span><span style="color:#79B8FF;">binlog</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">000007</span><span style="color:#E1E4E8;"> |      </span><span style="color:#79B8FF;">157</span><span style="color:#E1E4E8;"> |              |                  |                   |</span></span>
<span class="line"><span style="color:#F97583;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> sec)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mysql</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> show </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">status</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#24292E;">| </span><span style="color:#D73A49;">File</span><span style="color:#24292E;">          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span>
<span class="line"><span style="color:#D73A49;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#24292E;">| </span><span style="color:#005CC5;">binlog</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">000007</span><span style="color:#24292E;"> |      </span><span style="color:#005CC5;">157</span><span style="color:#24292E;"> |              |                  |                   |</span></span>
<span class="line"><span style="color:#D73A49;">+</span><span style="color:#6A737D;">---------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> sec)</span></span></code></pre></div><p>4.3、从库连接主库</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">change </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">master_host</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;&lt;master-host&gt;&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">master_port</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3306</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">master_user</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;repl&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">master_password</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">master_log_file</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;binlog.000007&#39;</span><span style="color:#E1E4E8;">, # 需要和 </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;"> 中的文件名一致</span></span>
<span class="line"><span style="color:#E1E4E8;">master_log_pos</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">157</span><span style="color:#E1E4E8;">; # 需要和 </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;"> 中的 position 一致</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">change </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">master_host</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;&lt;master-host&gt;&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">master_port</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3306</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">master_user</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;repl&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">master_password</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">master_log_file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;binlog.000007&#39;</span><span style="color:#24292E;">, # 需要和 </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> 中的文件名一致</span></span>
<span class="line"><span style="color:#24292E;">master_log_pos</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">157</span><span style="color:#24292E;">; # 需要和 </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> 中的 position 一致</span></span></code></pre></div><p>4.4、从库开启同步</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">start</span><span style="color:#E1E4E8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 此外还有以下命令</span></span>
<span class="line"><span style="color:#F97583;">stop</span><span style="color:#E1E4E8;"> slave;</span></span>
<span class="line"><span style="color:#F97583;">reset</span><span style="color:#E1E4E8;"> slave;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">start</span><span style="color:#24292E;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 此外还有以下命令</span></span>
<span class="line"><span style="color:#D73A49;">stop</span><span style="color:#24292E;"> slave;</span></span>
<span class="line"><span style="color:#D73A49;">reset</span><span style="color:#24292E;"> slave;</span></span></code></pre></div><p>4.5、查看从库状态</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mysql</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> show slave </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;">\G</span></span>
<span class="line"><span style="color:#F97583;">***************************</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">. </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">***************************</span></span>
<span class="line"><span style="color:#E1E4E8;">               Slave_IO_State: Waiting </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> source </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">send</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">event</span></span>
<span class="line"><span style="color:#E1E4E8;">                  Master_Host: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">178</span></span>
<span class="line"><span style="color:#E1E4E8;">                  Master_User: repl</span></span>
<span class="line"><span style="color:#E1E4E8;">                  Master_Port: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">                Connect_Retry: </span><span style="color:#79B8FF;">60</span></span>
<span class="line"><span style="color:#E1E4E8;">              Master_Log_File: </span><span style="color:#79B8FF;">binlog</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">000007</span></span>
<span class="line"><span style="color:#E1E4E8;">          Read_Master_Log_Pos: </span><span style="color:#79B8FF;">766</span></span>
<span class="line"><span style="color:#E1E4E8;">               Relay_Log_File: mysql</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">slave</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">relay</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">bin</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">000002</span></span>
<span class="line"><span style="color:#E1E4E8;">                Relay_Log_Pos: </span><span style="color:#79B8FF;">323</span></span>
<span class="line"><span style="color:#E1E4E8;">        Relay_Master_Log_File: </span><span style="color:#79B8FF;">binlog</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">000007</span></span>
<span class="line"><span style="color:#E1E4E8;">             Slave_IO_Running: Yes </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#E1E4E8;">            Slave_SQL_Running: Yes </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#E1E4E8;">              Replicate_Do_DB:</span></span>
<span class="line"><span style="color:#E1E4E8;">          Replicate_Ignore_DB:</span></span>
<span class="line"><span style="color:#E1E4E8;">           Replicate_Do_Table:</span></span>
<span class="line"><span style="color:#E1E4E8;">       Replicate_Ignore_Table:</span></span>
<span class="line"><span style="color:#E1E4E8;">      Replicate_Wild_Do_Table:</span></span>
<span class="line"><span style="color:#E1E4E8;">  Replicate_Wild_Ignore_Table:</span></span>
<span class="line"><span style="color:#E1E4E8;">                   Last_Errno: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                   Last_Error:</span></span>
<span class="line"><span style="color:#E1E4E8;">                 Skip_Counter: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">          Exec_Master_Log_Pos: </span><span style="color:#79B8FF;">766</span></span>
<span class="line"><span style="color:#E1E4E8;">              Relay_Log_Space: </span><span style="color:#79B8FF;">541</span></span>
<span class="line"><span style="color:#E1E4E8;">              Until_Condition: </span><span style="color:#F97583;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">               Until_Log_File:</span></span>
<span class="line"><span style="color:#E1E4E8;">                Until_Log_Pos: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_SSL_Allowed: </span><span style="color:#F97583;">No</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_SSL_CA_File:</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_SSL_CA_Path:</span></span>
<span class="line"><span style="color:#E1E4E8;">              Master_SSL_Cert:</span></span>
<span class="line"><span style="color:#E1E4E8;">            Master_SSL_Cipher:</span></span>
<span class="line"><span style="color:#E1E4E8;">               Master_SSL_Key:</span></span>
<span class="line"><span style="color:#E1E4E8;">        Seconds_Behind_Master: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">Master_SSL_Verify_Server_Cert: </span><span style="color:#F97583;">No</span></span>
<span class="line"><span style="color:#E1E4E8;">                Last_IO_Errno: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                Last_IO_Error:</span></span>
<span class="line"><span style="color:#E1E4E8;">               Last_SQL_Errno: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">               Last_SQL_Error:</span></span>
<span class="line"><span style="color:#E1E4E8;">  Replicate_Ignore_Server_Ids:</span></span>
<span class="line"><span style="color:#E1E4E8;">             Master_Server_Id: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">                  Master_UUID: c6d6274f</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">5c35</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">11ee</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">91a0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">2a660ebe931b</span></span>
<span class="line"><span style="color:#E1E4E8;">             Master_Info_File: </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">slave_master_info</span></span>
<span class="line"><span style="color:#E1E4E8;">                    SQL_Delay: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">          SQL_Remaining_Delay: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#E1E4E8;">      Slave_SQL_Running_State: </span><span style="color:#F97583;">Replica</span><span style="color:#E1E4E8;"> has </span><span style="color:#F97583;">read</span><span style="color:#E1E4E8;"> all relay </span><span style="color:#F97583;">log</span><span style="color:#E1E4E8;">; waiting </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> more updates </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_Retry_Count: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">                  Master_Bind:</span></span>
<span class="line"><span style="color:#E1E4E8;">      Last_IO_Error_Timestamp:</span></span>
<span class="line"><span style="color:#E1E4E8;">     Last_SQL_Error_Timestamp:</span></span>
<span class="line"><span style="color:#E1E4E8;">               Master_SSL_Crl:</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_SSL_Crlpath:</span></span>
<span class="line"><span style="color:#E1E4E8;">           Retrieved_Gtid_Set:</span></span>
<span class="line"><span style="color:#E1E4E8;">            Executed_Gtid_Set:</span></span>
<span class="line"><span style="color:#E1E4E8;">                Auto_Position: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">         Replicate_Rewrite_DB:</span></span>
<span class="line"><span style="color:#E1E4E8;">                 Channel_Name:</span></span>
<span class="line"><span style="color:#E1E4E8;">           Master_TLS_Version:</span></span>
<span class="line"><span style="color:#E1E4E8;">       Master_public_key_path:</span></span>
<span class="line"><span style="color:#E1E4E8;">        Get_master_public_key: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">            Network_Namespace:</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> warning (</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> sec)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mysql</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> show slave </span><span style="color:#D73A49;">status</span><span style="color:#24292E;">\G</span></span>
<span class="line"><span style="color:#D73A49;">***************************</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">. </span><span style="color:#D73A49;">row</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">***************************</span></span>
<span class="line"><span style="color:#24292E;">               Slave_IO_State: Waiting </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> source </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">send</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">event</span></span>
<span class="line"><span style="color:#24292E;">                  Master_Host: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">42</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">178</span></span>
<span class="line"><span style="color:#24292E;">                  Master_User: repl</span></span>
<span class="line"><span style="color:#24292E;">                  Master_Port: </span><span style="color:#005CC5;">3306</span></span>
<span class="line"><span style="color:#24292E;">                Connect_Retry: </span><span style="color:#005CC5;">60</span></span>
<span class="line"><span style="color:#24292E;">              Master_Log_File: </span><span style="color:#005CC5;">binlog</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">000007</span></span>
<span class="line"><span style="color:#24292E;">          Read_Master_Log_Pos: </span><span style="color:#005CC5;">766</span></span>
<span class="line"><span style="color:#24292E;">               Relay_Log_File: mysql</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">slave</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">relay</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">bin</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">000002</span></span>
<span class="line"><span style="color:#24292E;">                Relay_Log_Pos: </span><span style="color:#005CC5;">323</span></span>
<span class="line"><span style="color:#24292E;">        Relay_Master_Log_File: </span><span style="color:#005CC5;">binlog</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">000007</span></span>
<span class="line"><span style="color:#24292E;">             Slave_IO_Running: Yes </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#24292E;">            Slave_SQL_Running: Yes </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#24292E;">              Replicate_Do_DB:</span></span>
<span class="line"><span style="color:#24292E;">          Replicate_Ignore_DB:</span></span>
<span class="line"><span style="color:#24292E;">           Replicate_Do_Table:</span></span>
<span class="line"><span style="color:#24292E;">       Replicate_Ignore_Table:</span></span>
<span class="line"><span style="color:#24292E;">      Replicate_Wild_Do_Table:</span></span>
<span class="line"><span style="color:#24292E;">  Replicate_Wild_Ignore_Table:</span></span>
<span class="line"><span style="color:#24292E;">                   Last_Errno: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                   Last_Error:</span></span>
<span class="line"><span style="color:#24292E;">                 Skip_Counter: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">          Exec_Master_Log_Pos: </span><span style="color:#005CC5;">766</span></span>
<span class="line"><span style="color:#24292E;">              Relay_Log_Space: </span><span style="color:#005CC5;">541</span></span>
<span class="line"><span style="color:#24292E;">              Until_Condition: </span><span style="color:#D73A49;">None</span></span>
<span class="line"><span style="color:#24292E;">               Until_Log_File:</span></span>
<span class="line"><span style="color:#24292E;">                Until_Log_Pos: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">           Master_SSL_Allowed: </span><span style="color:#D73A49;">No</span></span>
<span class="line"><span style="color:#24292E;">           Master_SSL_CA_File:</span></span>
<span class="line"><span style="color:#24292E;">           Master_SSL_CA_Path:</span></span>
<span class="line"><span style="color:#24292E;">              Master_SSL_Cert:</span></span>
<span class="line"><span style="color:#24292E;">            Master_SSL_Cipher:</span></span>
<span class="line"><span style="color:#24292E;">               Master_SSL_Key:</span></span>
<span class="line"><span style="color:#24292E;">        Seconds_Behind_Master: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">Master_SSL_Verify_Server_Cert: </span><span style="color:#D73A49;">No</span></span>
<span class="line"><span style="color:#24292E;">                Last_IO_Errno: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                Last_IO_Error:</span></span>
<span class="line"><span style="color:#24292E;">               Last_SQL_Errno: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">               Last_SQL_Error:</span></span>
<span class="line"><span style="color:#24292E;">  Replicate_Ignore_Server_Ids:</span></span>
<span class="line"><span style="color:#24292E;">             Master_Server_Id: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">                  Master_UUID: c6d6274f</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">5c35</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">11ee</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">91a0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">2a660ebe931b</span></span>
<span class="line"><span style="color:#24292E;">             Master_Info_File: </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">slave_master_info</span></span>
<span class="line"><span style="color:#24292E;">                    SQL_Delay: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">          SQL_Remaining_Delay: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#24292E;">      Slave_SQL_Running_State: </span><span style="color:#D73A49;">Replica</span><span style="color:#24292E;"> has </span><span style="color:#D73A49;">read</span><span style="color:#24292E;"> all relay </span><span style="color:#D73A49;">log</span><span style="color:#24292E;">; waiting </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> more updates </span><span style="color:#6A737D;">-- 关注</span></span>
<span class="line"><span style="color:#24292E;">           Master_Retry_Count: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">                  Master_Bind:</span></span>
<span class="line"><span style="color:#24292E;">      Last_IO_Error_Timestamp:</span></span>
<span class="line"><span style="color:#24292E;">     Last_SQL_Error_Timestamp:</span></span>
<span class="line"><span style="color:#24292E;">               Master_SSL_Crl:</span></span>
<span class="line"><span style="color:#24292E;">           Master_SSL_Crlpath:</span></span>
<span class="line"><span style="color:#24292E;">           Retrieved_Gtid_Set:</span></span>
<span class="line"><span style="color:#24292E;">            Executed_Gtid_Set:</span></span>
<span class="line"><span style="color:#24292E;">                Auto_Position: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">         Replicate_Rewrite_DB:</span></span>
<span class="line"><span style="color:#24292E;">                 Channel_Name:</span></span>
<span class="line"><span style="color:#24292E;">           Master_TLS_Version:</span></span>
<span class="line"><span style="color:#24292E;">       Master_public_key_path:</span></span>
<span class="line"><span style="color:#24292E;">        Get_master_public_key: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">            Network_Namespace:</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> warning (</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> sec)</span></span></code></pre></div><p>主要关注这几个线程和状态：Slave_IO_State、Slave_IO_Running、Slave_SQL_Running、Slave_SQL_Running_State 和 Last_IO_Error。</p><p>5、如果主从复制过程中出现异常，一般会显示在 Last_IO_Error 字段，或者也可以查看日志表的记录</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">performance_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">replication_applier_status_by_worker</span><span style="color:#E1E4E8;">\G </span><span style="color:#6A737D;">-- 或者其他类似的表，如果状态异常 MySQL 会在 Slave_IO_State 或者 Slave_SQL_Running_State 中给出提示。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">performance_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">replication_applier_status_by_worker</span><span style="color:#24292E;">\G </span><span style="color:#6A737D;">-- 或者其他类似的表，如果状态异常 MySQL 会在 Slave_IO_State 或者 Slave_SQL_Running_State 中给出提示。</span></span></code></pre></div><p>6、检查账户是否有某种权限</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> User</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">mysql</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> User</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;repl&#39;</span><span style="color:#E1E4E8;">\G</span></span>
<span class="line"><span style="color:#F97583;">***************************</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">. </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">***************************</span></span>
<span class="line"><span style="color:#E1E4E8;">                    Host: %</span></span>
<span class="line"><span style="color:#E1E4E8;">                    User: repl</span></span>
<span class="line"><span style="color:#E1E4E8;">             Select_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">             Insert_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">             Update_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">             Delete_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">             Create_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">               Drop_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">             Reload_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">           Shutdown_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">            Process_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">               File_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">              Grant_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">         References_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">              Index_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">              Alter_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">            Show_db_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">              Super_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">   Create_tmp_table_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">        Lock_tables_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">            Execute_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">         Repl_slave_priv: Y</span></span>
<span class="line"><span style="color:#E1E4E8;">        Repl_client_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">        Create_view_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">          Show_view_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">     Create_routine_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">      Alter_routine_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">        Create_user_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">              Event_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">            Trigger_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">  Create_tablespace_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">                ssl_type:</span></span>
<span class="line"><span style="color:#E1E4E8;">              ssl_cipher: 0x</span></span>
<span class="line"><span style="color:#E1E4E8;">             x509_issuer: 0x</span></span>
<span class="line"><span style="color:#E1E4E8;">            x509_subject: 0x</span></span>
<span class="line"><span style="color:#E1E4E8;">           max_questions: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">             max_updates: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">         max_connections: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    max_user_connections: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                  plugin: caching_sha2_password</span></span>
<span class="line"><span style="color:#E1E4E8;">   authentication_string: $A$</span><span style="color:#79B8FF;">005</span><span style="color:#E1E4E8;">$</span></span>
<span class="line"><span style="color:#E1E4E8;">                                 j}e! _A|lO.9j\qdmwgjpkRYRy</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">3USOLMjb1OCVds4g1KT8H</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ZYLcF0rt3</span></span>
<span class="line"><span style="color:#E1E4E8;">        password_expired: N</span></span>
<span class="line"><span style="color:#E1E4E8;">   password_last_changed: </span><span style="color:#79B8FF;">2023</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">09</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">27</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">49</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">01</span></span>
<span class="line"><span style="color:#E1E4E8;">       password_lifetime: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#E1E4E8;">          account_locked: N</span></span>
<span class="line"><span style="color:#E1E4E8;">        Create_role_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">          Drop_role_priv: N</span></span>
<span class="line"><span style="color:#E1E4E8;">  Password_reuse_history: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#E1E4E8;">     Password_reuse_time: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#E1E4E8;">Password_require_current: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#E1E4E8;">         User_attributes: </span><span style="color:#F97583;">NULL</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> sec)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> User</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">mysql</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> User</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;repl&#39;</span><span style="color:#24292E;">\G</span></span>
<span class="line"><span style="color:#D73A49;">***************************</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">. </span><span style="color:#D73A49;">row</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">***************************</span></span>
<span class="line"><span style="color:#24292E;">                    Host: %</span></span>
<span class="line"><span style="color:#24292E;">                    User: repl</span></span>
<span class="line"><span style="color:#24292E;">             Select_priv: N</span></span>
<span class="line"><span style="color:#24292E;">             Insert_priv: N</span></span>
<span class="line"><span style="color:#24292E;">             Update_priv: N</span></span>
<span class="line"><span style="color:#24292E;">             Delete_priv: N</span></span>
<span class="line"><span style="color:#24292E;">             Create_priv: N</span></span>
<span class="line"><span style="color:#24292E;">               Drop_priv: N</span></span>
<span class="line"><span style="color:#24292E;">             Reload_priv: N</span></span>
<span class="line"><span style="color:#24292E;">           Shutdown_priv: N</span></span>
<span class="line"><span style="color:#24292E;">            Process_priv: N</span></span>
<span class="line"><span style="color:#24292E;">               File_priv: N</span></span>
<span class="line"><span style="color:#24292E;">              Grant_priv: N</span></span>
<span class="line"><span style="color:#24292E;">         References_priv: N</span></span>
<span class="line"><span style="color:#24292E;">              Index_priv: N</span></span>
<span class="line"><span style="color:#24292E;">              Alter_priv: N</span></span>
<span class="line"><span style="color:#24292E;">            Show_db_priv: N</span></span>
<span class="line"><span style="color:#24292E;">              Super_priv: N</span></span>
<span class="line"><span style="color:#24292E;">   Create_tmp_table_priv: N</span></span>
<span class="line"><span style="color:#24292E;">        Lock_tables_priv: N</span></span>
<span class="line"><span style="color:#24292E;">            Execute_priv: N</span></span>
<span class="line"><span style="color:#24292E;">         Repl_slave_priv: Y</span></span>
<span class="line"><span style="color:#24292E;">        Repl_client_priv: N</span></span>
<span class="line"><span style="color:#24292E;">        Create_view_priv: N</span></span>
<span class="line"><span style="color:#24292E;">          Show_view_priv: N</span></span>
<span class="line"><span style="color:#24292E;">     Create_routine_priv: N</span></span>
<span class="line"><span style="color:#24292E;">      Alter_routine_priv: N</span></span>
<span class="line"><span style="color:#24292E;">        Create_user_priv: N</span></span>
<span class="line"><span style="color:#24292E;">              Event_priv: N</span></span>
<span class="line"><span style="color:#24292E;">            Trigger_priv: N</span></span>
<span class="line"><span style="color:#24292E;">  Create_tablespace_priv: N</span></span>
<span class="line"><span style="color:#24292E;">                ssl_type:</span></span>
<span class="line"><span style="color:#24292E;">              ssl_cipher: 0x</span></span>
<span class="line"><span style="color:#24292E;">             x509_issuer: 0x</span></span>
<span class="line"><span style="color:#24292E;">            x509_subject: 0x</span></span>
<span class="line"><span style="color:#24292E;">           max_questions: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">             max_updates: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">         max_connections: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    max_user_connections: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                  plugin: caching_sha2_password</span></span>
<span class="line"><span style="color:#24292E;">   authentication_string: $A$</span><span style="color:#005CC5;">005</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">                                 j}e! _A|lO.9j\qdmwgjpkRYRy</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">3USOLMjb1OCVds4g1KT8H</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ZYLcF0rt3</span></span>
<span class="line"><span style="color:#24292E;">        password_expired: N</span></span>
<span class="line"><span style="color:#24292E;">   password_last_changed: </span><span style="color:#005CC5;">2023</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">09</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">27</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">49</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">01</span></span>
<span class="line"><span style="color:#24292E;">       password_lifetime: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#24292E;">          account_locked: N</span></span>
<span class="line"><span style="color:#24292E;">        Create_role_priv: N</span></span>
<span class="line"><span style="color:#24292E;">          Drop_role_priv: N</span></span>
<span class="line"><span style="color:#24292E;">  Password_reuse_history: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#24292E;">     Password_reuse_time: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#24292E;">Password_require_current: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#24292E;">         User_attributes: </span><span style="color:#D73A49;">NULL</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> sec)</span></span></code></pre></div><p>可以看到 <code>Repl_slave_priv: Y</code> 说明 repl 用户拥有主从复制的权限。</p><h3 id="报错" tabindex="-1">报错 <a class="header-anchor" href="#报错" aria-label="Permalink to &quot;报错&quot;">​</a></h3><p>1、<code>Authentication requires secure connection</code></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Last_IO_Error: Error connecting </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> source </span><span style="color:#9ECBFF;">&#39;repl@10.42.1.217:3306&#39;</span><span style="color:#E1E4E8;">. This was attempt </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">delay</span><span style="color:#E1E4E8;"> of </span><span style="color:#79B8FF;">60</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">seconds</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">between</span><span style="color:#E1E4E8;"> attempts. </span><span style="color:#F97583;">Message</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">Authentication</span><span style="color:#E1E4E8;"> plugin </span><span style="color:#9ECBFF;">&#39;caching_sha2_password&#39;</span><span style="color:#E1E4E8;"> reported error: </span><span style="color:#F97583;">Authentication</span><span style="color:#E1E4E8;"> requires secure connection.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Last_IO_Error: Error connecting </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> source </span><span style="color:#032F62;">&#39;repl@10.42.1.217:3306&#39;</span><span style="color:#24292E;">. This was attempt </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> a </span><span style="color:#D73A49;">delay</span><span style="color:#24292E;"> of </span><span style="color:#005CC5;">60</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">seconds</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">between</span><span style="color:#24292E;"> attempts. </span><span style="color:#D73A49;">Message</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">Authentication</span><span style="color:#24292E;"> plugin </span><span style="color:#032F62;">&#39;caching_sha2_password&#39;</span><span style="color:#24292E;"> reported error: </span><span style="color:#D73A49;">Authentication</span><span style="color:#24292E;"> requires secure connection.</span></span></code></pre></div><p>是因为MySQL 8 以上版本更换了<a href="https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html" target="_blank" rel="noreferrer">身份验证插件</a> caching_sha2_password，使用复制用户请求服务器公钥：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mysql </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u repl </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p123456 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">118</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">96</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">P3307 </span><span style="color:#6A737D;">--get-server-public-key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mysql </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">u repl </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p123456 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">118</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">96</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">P3307 </span><span style="color:#6A737D;">--get-server-public-key</span></span></code></pre></div><p>2、<code>Error executing row event: &#39;Unknown database &#39;xxx&#39;&#39;</code></p><p>在开启主从复制之前需要先将主库数据全量备份，并恢复到从库，主从复制前保证主从库的数据一致。</p><hr><h2 id="部署-postgresql" tabindex="-1">部署 PostgreSQL <a class="header-anchor" href="#部署-postgresql" aria-label="Permalink to &quot;部署 PostgreSQL&quot;">​</a></h2><h3 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h3><p>1、<strong>仓库添加</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bitnami</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://charts.bitnami.com/bitnami</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bitnami</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://charts.bitnami.com/bitnami</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span></code></pre></div><p>2、<strong>Release 拉取</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bitnami/postgresql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bitnami/postgresql</span></span></code></pre></div><h3 id="测试环境" tabindex="-1">测试环境 <a class="header-anchor" href="#测试环境" aria-label="Permalink to &quot;测试环境&quot;">​</a></h3><p>拉取成功后解压，编辑 <code>values.yaml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">primary</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">postgresql</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">auth</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;123456&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 配置 postgres 用户的密码</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LoadBalancer</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 修改此处成 LoadBalancer 或者 NodePort，暴露给外部访问，视情况而定</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">primary</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">postgresql</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">auth</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123456&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 配置 postgres 用户的密码</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">LoadBalancer</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 修改此处成 LoadBalancer 或者 NodePort，暴露给外部访问，视情况而定</span></span></code></pre></div><p>修改完成启动服务</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bitnami/postgresql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看暴露的 IP 和端口</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">svc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values.yaml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bitnami/postgresql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看暴露的 IP 和端口</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span></span></code></pre></div><p>自此，测试环境下应该就能正常访问了。</p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><h3 id="概念" tabindex="-1">概念 <a class="header-anchor" href="#概念" aria-label="Permalink to &quot;概念&quot;">​</a></h3><ul><li><a href="https://kubernetes.io/docs" target="_blank" rel="noreferrer">https://kubernetes.io/docs</a></li><li><a href="http://docs.kubernetes.org.cn/" target="_blank" rel="noreferrer">http://docs.kubernetes.org.cn/</a></li><li><a href="https://zhuanlan.zhihu.com/p/345798544" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/345798544</a></li><li><a href="https://zhuanlan.zhihu.com/p/53260098" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/53260098</a></li><li><a href="https://zhuanlan.zhihu.com/p/39937913" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/39937913</a></li><li><a href="https://blog.csdn.net/lly337/article/details/110917930" target="_blank" rel="noreferrer">https://blog.csdn.net/lly337/article/details/110917930</a></li></ul><h3 id="k8s-落地方式" tabindex="-1">K8s 落地方式 <a class="header-anchor" href="#k8s-落地方式" aria-label="Permalink to &quot;K8s 落地方式&quot;">​</a></h3><ul><li><a href="https://zhuanlan.zhihu.com/p/82666719" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/82666719</a></li></ul><h3 id="上手-1" tabindex="-1">上手 <a class="header-anchor" href="#上手-1" aria-label="Permalink to &quot;上手&quot;">​</a></h3><ul><li><a href="https://zhuanlan.zhihu.com/p/39937913" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/39937913</a></li></ul><h3 id="ingress-1" tabindex="-1">Ingress <a class="header-anchor" href="#ingress-1" aria-label="Permalink to &quot;Ingress&quot;">​</a></h3><ul><li>配置 ingress-nginx service：<a href="https://mmxblog.com/p-7005/Mmx.html" target="_blank" rel="noreferrer">https://mmxblog.com/p-7005/Mmx.html</a></li></ul><h3 id="vmware" tabindex="-1">VMware <a class="header-anchor" href="#vmware" aria-label="Permalink to &quot;VMware&quot;">​</a></h3><ul><li><a href="https://www.cnblogs.com/yeyouqing/articles/17021253.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/yeyouqing/articles/17021253.html</a></li><li><a href="https://blog.csdn.net/cal_room2032/article/details/124629068" target="_blank" rel="noreferrer">https://blog.csdn.net/cal_room2032/article/details/124629068</a></li><li><a href="https://developer.aliyun.com/article/12321" target="_blank" rel="noreferrer">https://developer.aliyun.com/article/12321</a></li></ul><p>局域网无法 ping：</p><ul><li><a href="https://www.cnblogs.com/abc1069/p/16296050.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/abc1069/p/16296050.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/531664664" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/531664664</a></li><li><a href="https://developer.aliyun.com/article/1252261" target="_blank" rel="noreferrer">https://developer.aliyun.com/article/1252261</a></li><li><a href="https://cloud.tencent.com/developer/article/2015588" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/2015588</a></li></ul><h3 id="dashboard" tabindex="-1">Dashboard <a class="header-anchor" href="#dashboard" aria-label="Permalink to &quot;Dashboard&quot;">​</a></h3><ul><li><a href="https://docs.rancher.cn/docs/k3s/installation/kube-dashboard/_index" target="_blank" rel="noreferrer">https://docs.rancher.cn/docs/k3s/installation/kube-dashboard/_index</a></li><li><a href="https://www.ywbj.cc/?p=684" target="_blank" rel="noreferrer">https://www.ywbj.cc/?p=684</a></li></ul><h3 id="volume-1" tabindex="-1">Volume <a class="header-anchor" href="#volume-1" aria-label="Permalink to &quot;Volume&quot;">​</a></h3><ul><li><a href="https://support.huaweicloud.com/basics-cce/kubernetes_0029.html" target="_blank" rel="noreferrer">https://support.huaweicloud.com/basics-cce/kubernetes_0029.html</a></li><li><a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/run-single-instance-stateful-application/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/run-application/run-single-instance-stateful-application/</a></li><li><a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/run-replicated-stateful-application/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/run-application/run-replicated-stateful-application/</a></li><li>StorageClass：<a href="https://www.cnblogs.com/rexcheny/p/10925464.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/rexcheny/p/10925464.html</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>上次更新: <time datetime="2023-11-23T07:01:38.000Z" data-v-7e05ebdb></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><!--[--><!--]--><div id="giscus-comment" class="comment" data-pagefind-ignore="all" data-v-af5a5a9a data-v-3db7ae48><div class="el-affix comment-btn" style="height:;width:;" data-v-3db7ae48><div class="" style=""><!--[--><button ariadisabled="false" type="button" class="el-button el-button--primary is-plain" style="" data-v-3db7ae48><i class="el-icon" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M736 504a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zm-224 0a56 56 0 1 1 0-112 56 56 0 0 1 0 112zM128 128v640h192v160l224-160h352V128H128z"></path></svg><!--]--></i><span class=""><!--[--> 评论 <!--]--></span></button><!--]--></div></div><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"7748ce86\",\"posts_article_文章整理.md\":\"4900a6b3\",\"about.md\":\"fdf33c45\",\"posts_algorithm_常见算法.md\":\"53cd5241\",\"posts_be_java_java lang_java lang.md\":\"4ce84bb5\",\"posts_be_dubbo_dubbo.md\":\"2af19342\",\"posts_be_jvm_jvm.md\":\"2da9864b\",\"posts_algorithm_位运算.md\":\"48f9a671\",\"posts_be_spring_ioc_事务_ioc_事务.md\":\"fba84f71\",\"posts_be_java_java 线程池_java 线程池.md\":\"1ebbcfa9\",\"posts_be_maven_maven.md\":\"28c8b6d0\",\"posts_be_java_java io_java io.md\":\"34caf8f1\",\"posts_be_spring_ioc_di_ioc_di.md\":\"219dcd35\",\"posts_be_java_java 多线程_java 多线程.md\":\"fde28d4e\",\"posts_be_springcloud_index.md\":\"661d2f48\",\"posts_be_spring_spring.md\":\"5b47e8f3\",\"posts_be_java_java 进阶_java 进阶.md\":\"094237e6\",\"posts_be_springsecurity_springsecurity.md\":\"139439b5\",\"posts_be_springboot_thinkinspringboot_index.md\":\"017db498\",\"posts_be_springweb_springmvc_springmvc.md\":\"92fde17e\",\"posts_fe_node.js_node.js.md\":\"d9536650\",\"posts_fe_react_react typescript.md\":\"6fb7e948\",\"posts_devops_nginx_nginx.md\":\"18076169\",\"posts_fe_css_css.md\":\"908ef920\",\"posts_fe_nextjs_next.js.md\":\"5e300ca3\",\"posts_linux_linux.md\":\"dafbc11d\",\"posts_fe_项目配置.md\":\"a5b8ad67\",\"posts_db_clickhouse_clickhouse.md\":\"ac56dbb2\",\"posts_db_mysql_thinkinmysql.md\":\"2a9ed36a\",\"posts_数据结构_数据结构.md\":\"579e2fe5\",\"posts_计算机网络_计算机网络.md\":\"66f5f327\",\"posts_db_redis_redis 数据类型.md\":\"0691cdb0\",\"posts_db_postgresql_pg 语句分析.md\":\"cc1c346d\",\"posts_db_redis_redis 配置详解.md\":\"89b1350a\",\"posts_db_redis_redis.md\":\"b4018c62\",\"posts_devops_grafana_grafana.md\":\"13827f42\",\"posts_devops_docker_docker.md\":\"7347d5cb\",\"posts_devops_gitlab_gitlab.md\":\"234f737e\",\"posts_devops_kubernetes_k8s.md\":\"4413d84b\",\"posts_be_mybitis_mybatis.md\":\"c043ed00\",\"posts_be_mybitis_mybatis-plus-generator.md\":\"fbeebfed\",\"posts_设计模式_设计模式.md\":\"fda6a57f\",\"posts_db_postgresql_postgresql.md\":\"100dbdb3\",\"posts_fe_vuejs_vuejs.md\":\"06d9601d\",\"posts_linux_安装配置_centos 配置.md\":\"b3c4f3f2\",\"posts_linux_安装配置_manjora 安装配置.md\":\"9cedb9f5\",\"posts_be_java_walkthroughjava.md\":\"8943465f\",\"posts_be_java_java 集合_java 集合.md\":\"40adb9e0\",\"posts_math_latex.md\":\"fc03b43c\",\"posts_mw_rocketmq_rocketmq model_rocketmq model.md\":\"6a37be44\",\"posts_be_netty_netty.md\":\"9016777b\",\"posts_math_math.md\":\"b6fc95a4\",\"posts_fe_react_react.md\":\"799dfdee\",\"posts_mw_activemq_index.md\":\"affb2bc1\",\"posts_be_java_java 基础_java 基础.md\":\"61e4e6d8\",\"posts_mw_rocketmq_rocketmq_rocketmq.md\":\"b5a9a64c\",\"posts_be_java_java 反射_范型_java.md\":\"ccffef49\",\"posts_mw_elasticsearch_elasticsearch.md\":\"145c9f5b\",\"posts_mw_kafka_kafka.md\":\"25bed381\",\"posts_devops_kubernetes_kubernetes.md\":\"11f1faf8\",\"posts_db_timescaledb_timescaledb.md\":\"50d3cc99\",\"posts_mw_kafka_kafkasource.md\":\"22523e19\",\"posts_linux_安装配置_ubuntu 安装配置.md\":\"9a3e1675\",\"posts_db_mysql_mysql.md\":\"d9b195cf\",\"posts_be_java_java juc_java juc.md\":\"b439a13b\",\"posts_fe_typescript_typescript.md\":\"4171fc5f\",\"posts_mw_rocketmq_rocketmq source_rocketmq source.md\":\"11eda4de\",\"posts_工具_ffmpeg.md\":\"bae9b4ef\",\"posts_python_python.md\":\"868034da\",\"posts_be_springboot_springboot_springboot.md\":\"40d8f96d\",\"posts_fe_javascript_javascript.md\":\"fd62f8c9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Gnl\",\"description\":\"Gnl's blog\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/about\",\"meta\":{\"sidebar\":false,\"title\":\"关于我\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\"\\n> gnl0ATqq.com\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/位运算\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"位运算基础以及常见用法\",\"title\":\"位运算\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/algorithm/常见算法\",\"meta\":{\"tag\":[\"算法\"],\"description\":\"常见算法思想汇总；分治、动态规划、贪心、回溯、分支界限\",\"title\":\"常见算法\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/article/文章整理\",\"meta\":{\"description\":\"文章推荐\",\"title\":\"文章整理\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/fe/项目配置\",\"meta\":{\"description\":\"前端项目配置\",\"tag\":[\"前端\"],\"title\":\"前端项目配置\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/Linux\",\"meta\":{\"description\":\"Linux 笔记\",\"tag\":[\"Linux\"],\"title\":\"Linux\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/math/Latex\",\"meta\":{\"description\":\"LateX 常用语法\",\"tag\":[\"LateX\"],\"title\":\"LateX\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/math/Math\",\"meta\":{\"description\":\"基础数学函数\",\"title\":\"Math\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/python/Python\",\"meta\":{\"description\":\"Python 笔记\",\"tag\":[\"Python\"],\"title\":\"Python\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/工具/ffmpeg\",\"meta\":{\"description\":\"ffmpeg 常用命令\",\"tag\":[\"ffmpeg\"],\"title\":\"ffmpeg\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/数据结构/数据结构\",\"meta\":{\"description\":\"算法与数据结构笔记\",\"tag\":[\"算法\",\"数据结构\"],\"title\":\"算法与数据结构\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"https://img2018.cnblogs.com/blog/1648163/201909/1648163-20190919085122774-376085378.png\"}},{\"route\":\"/posts/计算机网络/计算机网络\",\"meta\":{\"description\":\"计算机网络笔记\",\"title\":\"计算机网络\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"cover\":\"\"}},{\"route\":\"/posts/设计模式/设计模式\",\"meta\":{\"description\":\"Java 设计模式笔记\",\"tag\":[\"设计模式\",\"Java\"],\"title\":\"设计模式\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Dubbo/Dubbo\",\"meta\":{\"description\":\"Apache Dubbo 是一款 RPC 服务开发框架，用于解决微服务架构下的服务治理与通信问题。\",\"tag\":[\"微服务\",\"Dubbo\",\"后端\"],\"title\":\"Dubbo\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/JVM/JVM\",\"meta\":{\"description\":\"JVM 详解，包括 JVM 体系结构、垃圾回收算法等\",\"tag\":[\"Java\",\"JVM\",\"后端\"],\"title\":\"JVM\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/WalkThroughJava\",\"meta\":{\"title\":\"Walk Though Java\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\" 多线程\\n 多线程异常处理方案\\n在使用 try-catch 的时候有一个条件通常会被忽略：try-catch 只能处理当前线程抛出的异常，在多线程情况下是无法 catch 到其他线程抛出的异常的。\\n看\",\"cover\":\"\"}},{\"route\":\"/posts/be/Maven/Maven\",\"meta\":{\"description\":\"Maven 笔记\",\"tag\":[\"后端\"],\"title\":\"Maven\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/MyBatis\",\"meta\":{\"description\":\"MyBatis 详解\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"MyBatis\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/MyBitis/mybatis-plus-generator\",\"meta\":{\"description\":\"MyBatis 代码生成器\",\"tag\":[\"MyBatis\",\"后端\"],\"title\":\"mybatis-plus-generator\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Netty/Netty\",\"meta\":{\"description\":\"基于 Java NIO 封装的网络框架\",\"tag\":[\"Netty\",\"后端\"],\"title\":\"Netty\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/Spring\",\"meta\":{\"description\":\"Spring 框架详解\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringCloud/index\",\"meta\":{\"description\":\"SpringCloud 详解\",\"tag\":[\"SpringCloud\",\"后端\",\"微服务\"],\"title\":\"SpringCloud\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringSecurity/SpringSecurity\",\"meta\":{\"description\":\"SpringSecurity 笔记\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring Security\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/ClickHouse/ClickHouse\",\"meta\":{\"description\":\"ClickHouse 笔记\",\"tag\":[\"数据库\"],\"title\":\"ClickHouse\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/MySQL\",\"meta\":{\"description\":\"MySQL 详解\",\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"MySQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/MySQL/ThinkInMySQL\",\"meta\":{\"description\":\"在使用 MySQL 的过程中的一些思考\",\"sticky\":true,\"top\":6,\"tag\":[\"MySQL\",\"数据库\"],\"title\":\"Think In MySQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PG 语句分析\",\"meta\":{\"description\":\"记录 PostgreSQL 使用过程中 SQL 语句分析的历程\",\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PG 语句分析\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/PostgreSQL/PostgreSQL\",\"meta\":{\"description\":\"PostgreSQL 详解，包含基础内容、高可用架构等\",\"top\":1,\"sticky\":true,\"tag\":[\"PostgreSQL\",\"数据库\"],\"title\":\"PostgreSQL\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 数据类型\",\"meta\":{\"description\":\"Redis 数据类型详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 数据类型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis 配置详解\",\"meta\":{\"description\":\"Redis 配置详解\",\"top\":7,\"sticky\":true,\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis 配置详解\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/Redis/Redis\",\"meta\":{\"description\":\"Redis 详解\",\"tag\":[\"Redis\",\"NoSQL\",\"数据库\"],\"title\":\"Redis\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/db/TimescaleDB/TimescaleDB\",\"meta\":{\"description\":\"TimescaleDB 详解\",\"top\":5,\"sticky\":true,\"tag\":[\"TimescaleDB\",\"时序数据库\",\"数据库\"],\"title\":\"TimescaleDB\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Docker/Docker\",\"meta\":{\"description\":\"Docker 详解\",\"tag\":[\"Docker\",\"DevOps\"],\"title\":\"Docker\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/GitLab/GitLab\",\"meta\":{\"description\":\"GitLab 私服搭建\",\"top\":3,\"tag\":[\"GitLab\"],\"title\":\"GitLab\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Grafana/Grafana\",\"meta\":{\"description\":\"Grafana 监控搭建\",\"top\":2,\"tag\":[\"Grafana\",\"DevOps\"],\"title\":\"Grafana\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/K8S\",\"meta\":{\"isPublish\":false,\"title\":\"Kubernetes\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\" 虚拟化容器\\n Docker\\nDocker 与传统虚拟化方式的不同之处：Docker 容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，没有进行硬件虚拟；而传统虚拟机技术是虚拟出一套硬件后，\",\"cover\":\"\"}},{\"route\":\"/posts/devops/Kubernetes/Kubernetes\",\"meta\":{\"description\":\"K8s 详解\",\"top\":4,\"sticky\":true,\"tag\":[\"K8s\",\"DevOps\"],\"title\":\"K8s\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg\"}},{\"route\":\"/posts/devops/Nginx/Nginx\",\"meta\":{\"description\":\"Nginx 详解\",\"tag\":[\"Nginx\"],\"title\":\"Nginx\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/CSS/CSS\",\"meta\":{\"description\":\"CSS 详解\",\"tag\":[\"前端\"],\"title\":\"CSS\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/JavaScript/JavaScript\",\"meta\":{\"description\":\"JavaScript 详解\",\"outline\":[2,3],\"tag\":[\"JavaScript\",\"前端\"],\"title\":\"JavaScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Nextjs/Next.js\",\"meta\":{\"description\":\"Next.js 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"Next.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Node.js/Node.js\",\"meta\":{\"description\":\"Node.js 笔记\",\"tag\":[\"前端\"],\"title\":\"Node.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React TypeScript\",\"meta\":{\"description\":\"React + TypeScript 笔记\",\"tag\":[\"React\",\"TypeScript\",\"前端\"],\"title\":\"React + TypeScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/React/React\",\"meta\":{\"description\":\"React 笔记\",\"tag\":[\"React\",\"前端\"],\"title\":\"React\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/TypeScript/TypeScript\",\"meta\":{\"description\":\"TypeScript 笔记\",\"tag\":[\"TypeScript\",\"前端\"],\"title\":\"TypeScript\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/fe/Vuejs/Vuejs\",\"meta\":{\"description\":\"Vue.js 笔记\",\"tag\":[\"Vue.js\",\"前端\"],\"title\":\"Vue.js\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/CentOS 配置\",\"meta\":{\"description\":\"CentOS 笔记\",\"tag\":[\"Linux\"],\"title\":\"CentOS 笔记\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Manjora 安装配置\",\"meta\":{\"description\":\"Manjora 笔记\",\"tag\":[\"Linux\"],\"title\":\"Manjora 安装\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/linux/安装配置/Ubuntu 安装配置\",\"meta\":{\"description\":\"Ubuntu 安装\",\"tag\":[\"Linux\"],\"title\":\"Ubuntu 安装\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/ActiveMQ/index\",\"meta\":{\"description\":\"ActiveMQ 详解\",\"tag\":[\"MQ\",\"中间件\"],\"title\":\"ActiveMQ\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Elasticsearch/Elasticsearch\",\"meta\":{\"description\":\"Elasticsearch 详解\",\"outline\":[2,3],\"tag\":[\"Elasticsearch\",\"中间件\"],\"title\":\"Elasticsearch\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/Kafka\",\"meta\":{\"description\":\"Kafka 是一个分布式流处理平台，基于发布/订阅模式的消息队列，主要应用于大数据实时处理领域。使用 Kafka 可以帮助进行解耦、异步、削峰等操作。\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/Kafka/KafkaSource\",\"meta\":{\"description\":\"Kafka 源码深入\",\"tag\":[\"Kafka\",\"MQ\",\"中间件\"],\"title\":\"Kafka Source\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java IO/Java IO\",\"meta\":{\"description\":\"Java 中的 IO 操作，包括 BIO 和 NIO\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java IO\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java JUC/Java JUC\",\"meta\":{\"description\":\"JUC 指的是 `java.util.concurrent` 包及其子包下用于并发场景的类\",\"tag\":[\"Java\",\"后端\"],\"title\":\"JUC\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java lang/Java lang\",\"meta\":{\"title\":\"Java lang\",\"date\":\"2023-11-23 07:01:38\",\"tag\":[],\"description\":\"\\n Runtime\\n每一个 Java 程序都有一个单实例的 Runtime 对象，它允许正在运行的 Java 程序能够获取到运行环境信息。\\n一些常用的方法如下：\\n* `getRuntime()`\\n* \",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 反射+范型/Java\",\"meta\":{\"description\":\"Java 反射和泛型详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 反射和泛型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 基础/Java 基础\",\"meta\":{\"description\":\"Java 基础内容\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 基础内容\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 多线程/Java 多线程\",\"meta\":{\"description\":\"Java 多线程详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 多线程\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 线程池/Java 线程池\",\"meta\":{\"description\":\"线程池是 Java 中用于管理和复用线程的机制。它包含了一个线程队列，可以用来创建并发执行的任务，提高程序的执行效率\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 线程池\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 进阶/Java 进阶\",\"meta\":{\"description\":\"Java 进阶内容，包括: SPI、JNDI\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 进阶\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Java/Java 集合/Java 集合\",\"meta\":{\"description\":\"Java 集合部分详解\",\"tag\":[\"Java\",\"后端\"],\"title\":\"Java 集合\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&DI/IOC&DI\",\"meta\":{\"description\":\"Spring IOC&DI\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/Spring/IOC&事务/IOC&事务\",\"meta\":{\"description\":\"Spring IOC & 事务\",\"tag\":[\"Spring\",\"后端\"],\"title\":\"Spring\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/SpringBoot/SpringBoot\",\"meta\":{\"description\":\"SpringBoot 详解\",\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"SpringBoot\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringBoot/ThinkInSpringBoot/index\",\"meta\":{\"description\":\"深入 SpringBoot 源码与一点思考\",\"sticky\":true,\"tag\":[\"SpringBoot\",\"后端\"],\"title\":\"Think-in-Springboot\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/be/SpringWeb/SpringMVC/SpringMVC\",\"meta\":{\"description\":\"Spring Web MVC 是建立在 Servlet API 上的 Web 框架\",\"tag\":[\"SpringMVC\",\"后端\"],\"title\":\"Spring MVC\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\",\"meta\":{\"description\":\"RocketMQ 是一个分布式的中间件服务，采用异步通信模型和发布/订阅消息传输模型。\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Model/RocketMQ Model\",\"meta\":{\"description\":\"RocketMQ 领域模型\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 领域模型\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}},{\"route\":\"/posts/mw/RocketMQ/RocketMQ Source/RocketMQ Source\",\"meta\":{\"description\":\"RocketMQ 源码解析\",\"tag\":[\"RocketMQ\",\"MQ\",\"中间件\"],\"title\":\"RocketMQ 源码解析\",\"date\":\"2023-11-23 07:01:38\",\"cover\":\"\"}}],\"hotArticle\":{\"title\":\"Pinned\",\"nextText\":\"换一组\",\"pageSize\":5,\"empty\":\"暂无内容\"},\"recommend\":false,\"footer\":{\"copyright\":\"2023-Present | Gnl\",\"version\":false},\"themeColor\":\"el-green\",\"author\":\"Gnl\",\"comment\":{\"repo\":\"gnl00/gnl00.github.io\",\"repoId\":\"R_kgDOGR5o6w\",\"category\":\"Announcements\",\"categoryId\":\"DIC_kwDOGR5o684CatYO\"},\"mermaid\":true},\"lastUpdatedText\":\"上次更新\",\"logo\":\"/logo-transform.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"前端项目工程化\",\"link\":\"/posts/fe/项目配置\"},{\"text\":\"JavaScript\",\"link\":\"/posts/fe/JavaScript/JavaScript\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/TypeScript/TypeScript\"},{\"text\":\"React\",\"link\":\"/posts/fe/React/React\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/Vuejs/Vuejs\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"Java\",\"link\":\"/posts/be/Java/Java\"},{\"text\":\"Spring\",\"link\":\"/posts/be/Spring/Spring\"},{\"text\":\"SpringBoot\",\"link\":\"/posts/be/SpringBoot/SpringBoot\"},{\"text\":\"SpringCloud\",\"link\":\"/posts/be/SpringCloud/SpringCloud\"},{\"text\":\"Dubbo\",\"link\":\"/posts/be/Dubbo/Dubbo\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/posts/db/MySQL/MySQL\"},{\"text\":\"PostgreSQL\",\"link\":\"/posts/db/PostgreSQL/PostgreSQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/Redis/Redis\"}]},{\"text\":\"中间件\",\"items\":[{\"text\":\"Netty\",\"link\":\"/posts/mw/Netty/Netty\"},{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/RocketMQ/RocketMQ/RocketMQ\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/Kafka/Kafka\"},{\"text\":\"Elesticsearch\",\"link\":\"/posts/mw/Elesticsearch/Elesticsearch\"}]},{\"text\":\"DevOps\",\"items\":[{\"text\":\"Docker\",\"link\":\"/posts/mw/Docker/Docker\"},{\"text\":\"Kubernetes\",\"link\":\"/posts/mw/Kubernetes/Kubernetes\"},{\"text\":\"GitLab\",\"link\":\"/posts/mw/GitLab/GitLab\"}]},{\"text\":\"关于\",\"link\":\"/about\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>